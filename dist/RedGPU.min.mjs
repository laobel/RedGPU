var t=1e-6,e="undefined"!=typeof Float32Array?Float32Array:Array,r=Math.random,n=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var i=Object.freeze({EPSILON:t,get ARRAY_TYPE(){return e},RANDOM:r,setMatrixArrayType:function(t){e=t},toRadian:function(t){return t*n},equals:function(e,r){return Math.abs(e-r)<=t*Math.max(1,Math.abs(e),Math.abs(r))}});function a(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=r[0],u=r[1],l=r[2],f=r[3];return t[0]=n*s+a*u,t[1]=i*s+o*u,t[2]=n*l+a*f,t[3]=i*l+o*f,t}function o(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}var s=a,u=o,l=Object.freeze({create:function(){var t=new e(4);return e!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},clone:function(t){var r=new e(4);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},fromValues:function(t,r,n,i){var a=new e(4);return a[0]=t,a[1]=r,a[2]=n,a[3]=i,a},set:function(t,e,r,n,i){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t},transpose:function(t,e){if(t===e){var r=e[1];t[1]=e[2],t[2]=r}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},invert:function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=r*a-i*n;return o?(o=1/o,t[0]=a*o,t[1]=-n*o,t[2]=-i*o,t[3]=r*o,t):null},adjoint:function(t,e){var r=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=r,t},determinant:function(t){return t[0]*t[3]-t[2]*t[1]},multiply:a,rotate:function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=n*u+a*s,t[1]=i*u+o*s,t[2]=n*-s+a*u,t[3]=i*-s+o*u,t},scale:function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=r[0],u=r[1];return t[0]=n*s,t[1]=i*s,t[2]=a*u,t[3]=o*u,t},fromRotation:function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t},fromScaling:function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},str:function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3])},LDU:function(t,e,r,n){return t[2]=n[2]/n[0],r[0]=n[0],r[1]=n[1],r[3]=n[3]-t[2]*r[1],[t,e,r]},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t},subtract:o,exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},equals:function(e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=r[0],u=r[1],l=r[2],f=r[3];return Math.abs(n-s)<=t*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-u)<=t*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(a-l)<=t*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(o-f)<=t*Math.max(1,Math.abs(o),Math.abs(f))},multiplyScalar:function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t},multiplyScalarAndAdd:function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t},mul:s,sub:u});function f(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=r[0],f=r[1],m=r[2],c=r[3],h=r[4],d=r[5];return t[0]=n*l+a*f,t[1]=i*l+o*f,t[2]=n*m+a*c,t[3]=i*m+o*c,t[4]=n*h+a*d+s,t[5]=i*h+o*d+u,t}function m(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t}var c=f,h=m,d=Object.freeze({create:function(){var t=new e(6);return e!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},clone:function(t){var r=new e(6);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},fromValues:function(t,r,n,i,a,o){var s=new e(6);return s[0]=t,s[1]=r,s[2]=n,s[3]=i,s[4]=a,s[5]=o,s},set:function(t,e,r,n,i,a,o){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=a,t[5]=o,t},invert:function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=r*a-n*i;return u?(u=1/u,t[0]=a*u,t[1]=-n*u,t[2]=-i*u,t[3]=r*u,t[4]=(i*s-a*o)*u,t[5]=(n*o-r*s)*u,t):null},determinant:function(t){return t[0]*t[3]-t[1]*t[2]},multiply:f,rotate:function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=Math.sin(r),f=Math.cos(r);return t[0]=n*f+a*l,t[1]=i*f+o*l,t[2]=n*-l+a*f,t[3]=i*-l+o*f,t[4]=s,t[5]=u,t},scale:function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=r[0],f=r[1];return t[0]=n*l,t[1]=i*l,t[2]=a*f,t[3]=o*f,t[4]=s,t[5]=u,t},translate:function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=r[0],f=r[1];return t[0]=n,t[1]=i,t[2]=a,t[3]=o,t[4]=n*l+a*f+s,t[5]=i*l+o*f+u,t},fromRotation:function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=-r,t[3]=n,t[4]=0,t[5]=0,t},fromScaling:function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},fromTranslation:function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},str:function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t},subtract:m,multiplyScalar:function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t},multiplyScalarAndAdd:function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},equals:function(e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=r[0],f=r[1],m=r[2],c=r[3],h=r[4],d=r[5];return Math.abs(n-l)<=t*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(i-f)<=t*Math.max(1,Math.abs(i),Math.abs(f))&&Math.abs(a-m)<=t*Math.max(1,Math.abs(a),Math.abs(m))&&Math.abs(o-c)<=t*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(s-h)<=t*Math.max(1,Math.abs(s),Math.abs(h))&&Math.abs(u-d)<=t*Math.max(1,Math.abs(u),Math.abs(d))},mul:c,sub:h});function p(){var t=new e(9);return e!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function v(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],f=e[7],m=e[8],c=r[0],h=r[1],d=r[2],p=r[3],v=r[4],_=r[5],g=r[6],x=r[7],y=r[8];return t[0]=c*n+h*o+d*l,t[1]=c*i+h*s+d*f,t[2]=c*a+h*u+d*m,t[3]=p*n+v*o+_*l,t[4]=p*i+v*s+_*f,t[5]=p*a+v*u+_*m,t[6]=g*n+x*o+y*l,t[7]=g*i+x*s+y*f,t[8]=g*a+x*u+y*m,t}function _(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t}var g=v,x=_,y=Object.freeze({create:p,fromMat4:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},clone:function(t){var r=new e(9);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},fromValues:function(t,r,n,i,a,o,s,u,l){var f=new e(9);return f[0]=t,f[1]=r,f[2]=n,f[3]=i,f[4]=a,f[5]=o,f[6]=s,f[7]=u,f[8]=l,f},set:function(t,e,r,n,i,a,o,s,u,l){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=a,t[5]=o,t[6]=s,t[7]=u,t[8]=l,t},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},transpose:function(t,e){if(t===e){var r=e[1],n=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=r,t[5]=e[7],t[6]=n,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},invert:function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],f=e[8],m=f*o-s*l,c=-f*a+s*u,h=l*a-o*u,d=r*m+n*c+i*h;return d?(d=1/d,t[0]=m*d,t[1]=(-f*n+i*l)*d,t[2]=(s*n-i*o)*d,t[3]=c*d,t[4]=(f*r-i*u)*d,t[5]=(-s*r+i*a)*d,t[6]=h*d,t[7]=(-l*r+n*u)*d,t[8]=(o*r-n*a)*d,t):null},adjoint:function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],f=e[8];return t[0]=o*f-s*l,t[1]=i*l-n*f,t[2]=n*s-i*o,t[3]=s*u-a*f,t[4]=r*f-i*u,t[5]=i*a-r*s,t[6]=a*l-o*u,t[7]=n*u-r*l,t[8]=r*o-n*a,t},determinant:function(t){var e=t[0],r=t[1],n=t[2],i=t[3],a=t[4],o=t[5],s=t[6],u=t[7],l=t[8];return e*(l*a-o*u)+r*(-l*i+o*s)+n*(u*i-a*s)},multiply:v,translate:function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],f=e[7],m=e[8],c=r[0],h=r[1];return t[0]=n,t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=c*n+h*o+l,t[7]=c*i+h*s+f,t[8]=c*a+h*u+m,t},rotate:function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],f=e[7],m=e[8],c=Math.sin(r),h=Math.cos(r);return t[0]=h*n+c*o,t[1]=h*i+c*s,t[2]=h*a+c*u,t[3]=h*o-c*n,t[4]=h*s-c*i,t[5]=h*u-c*a,t[6]=l,t[7]=f,t[8]=m,t},scale:function(t,e,r){var n=r[0],i=r[1];return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=i*e[3],t[4]=i*e[4],t[5]=i*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},fromTranslation:function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},fromRotation:function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=-r,t[4]=n,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromScaling:function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromMat2d:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},fromQuat:function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=r+r,s=n+n,u=i+i,l=r*o,f=n*o,m=n*s,c=i*o,h=i*s,d=i*u,p=a*o,v=a*s,_=a*u;return t[0]=1-m-d,t[3]=f-_,t[6]=c+v,t[1]=f+_,t[4]=1-l-d,t[7]=h-p,t[2]=c-v,t[5]=h+p,t[8]=1-l-m,t},normalFromMat4:function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],f=e[8],m=e[9],c=e[10],h=e[11],d=e[12],p=e[13],v=e[14],_=e[15],g=r*s-n*o,x=r*u-i*o,y=r*l-a*o,S=n*u-i*s,T=n*l-a*s,U=i*l-a*u,b=f*p-m*d,M=f*v-c*d,P=f*_-h*d,w=m*v-c*p,E=m*_-h*p,G=c*_-h*v,D=g*G-x*E+y*w+S*P-T*M+U*b;return D?(D=1/D,t[0]=(s*G-u*E+l*w)*D,t[1]=(u*P-o*G-l*M)*D,t[2]=(o*E-s*P+l*b)*D,t[3]=(i*E-n*G-a*w)*D,t[4]=(r*G-i*P+a*M)*D,t[5]=(n*P-r*E-a*b)*D,t[6]=(p*U-v*T+_*S)*D,t[7]=(v*y-d*U-_*x)*D,t[8]=(d*T-p*y+_*g)*D,t):null},projection:function(t,e,r){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/r,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},str:function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t},subtract:_,multiplyScalar:function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t},multiplyScalarAndAdd:function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},equals:function(e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],f=e[7],m=e[8],c=r[0],h=r[1],d=r[2],p=r[3],v=r[4],_=r[5],g=r[6],x=r[7],y=r[8];return Math.abs(n-c)<=t*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(i-h)<=t*Math.max(1,Math.abs(i),Math.abs(h))&&Math.abs(a-d)<=t*Math.max(1,Math.abs(a),Math.abs(d))&&Math.abs(o-p)<=t*Math.max(1,Math.abs(o),Math.abs(p))&&Math.abs(s-v)<=t*Math.max(1,Math.abs(s),Math.abs(v))&&Math.abs(u-_)<=t*Math.max(1,Math.abs(u),Math.abs(_))&&Math.abs(l-g)<=t*Math.max(1,Math.abs(l),Math.abs(g))&&Math.abs(f-x)<=t*Math.max(1,Math.abs(f),Math.abs(x))&&Math.abs(m-y)<=t*Math.max(1,Math.abs(m),Math.abs(y))},mul:g,sub:x});function S(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function T(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],f=e[7],m=e[8],c=e[9],h=e[10],d=e[11],p=e[12],v=e[13],_=e[14],g=e[15],x=r[0],y=r[1],S=r[2],T=r[3];return t[0]=x*n+y*s+S*m+T*p,t[1]=x*i+y*u+S*c+T*v,t[2]=x*a+y*l+S*h+T*_,t[3]=x*o+y*f+S*d+T*g,x=r[4],y=r[5],S=r[6],T=r[7],t[4]=x*n+y*s+S*m+T*p,t[5]=x*i+y*u+S*c+T*v,t[6]=x*a+y*l+S*h+T*_,t[7]=x*o+y*f+S*d+T*g,x=r[8],y=r[9],S=r[10],T=r[11],t[8]=x*n+y*s+S*m+T*p,t[9]=x*i+y*u+S*c+T*v,t[10]=x*a+y*l+S*h+T*_,t[11]=x*o+y*f+S*d+T*g,x=r[12],y=r[13],S=r[14],T=r[15],t[12]=x*n+y*s+S*m+T*p,t[13]=x*i+y*u+S*c+T*v,t[14]=x*a+y*l+S*h+T*_,t[15]=x*o+y*f+S*d+T*g,t}function U(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=n+n,u=i+i,l=a+a,f=n*s,m=n*u,c=n*l,h=i*u,d=i*l,p=a*l,v=o*s,_=o*u,g=o*l;return t[0]=1-(h+p),t[1]=m+g,t[2]=c-_,t[3]=0,t[4]=m-g,t[5]=1-(f+p),t[6]=d+v,t[7]=0,t[8]=c+_,t[9]=d-v,t[10]=1-(f+h),t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t}function b(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function M(t,e){var r=e[0],n=e[1],i=e[2],a=e[4],o=e[5],s=e[6],u=e[8],l=e[9],f=e[10];return t[0]=Math.hypot(r,n,i),t[1]=Math.hypot(a,o,s),t[2]=Math.hypot(u,l,f),t}function P(t,r){var n=new e(3);M(n,r);var i=1/n[0],a=1/n[1],o=1/n[2],s=r[0]*i,u=r[1]*a,l=r[2]*o,f=r[4]*i,m=r[5]*a,c=r[6]*o,h=r[8]*i,d=r[9]*a,p=r[10]*o,v=s+m+p,_=0;return v>0?(_=2*Math.sqrt(v+1),t[3]=.25*_,t[0]=(c-d)/_,t[1]=(h-l)/_,t[2]=(u-f)/_):s>m&&s>p?(_=2*Math.sqrt(1+s-m-p),t[3]=(c-d)/_,t[0]=.25*_,t[1]=(u+f)/_,t[2]=(h+l)/_):m>p?(_=2*Math.sqrt(1+m-s-p),t[3]=(h-l)/_,t[0]=(u+f)/_,t[1]=.25*_,t[2]=(c+d)/_):(_=2*Math.sqrt(1+p-s-m),t[3]=(u-f)/_,t[0]=(h+l)/_,t[1]=(c+d)/_,t[2]=.25*_),t}function w(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t[4]=e[4]-r[4],t[5]=e[5]-r[5],t[6]=e[6]-r[6],t[7]=e[7]-r[7],t[8]=e[8]-r[8],t[9]=e[9]-r[9],t[10]=e[10]-r[10],t[11]=e[11]-r[11],t[12]=e[12]-r[12],t[13]=e[13]-r[13],t[14]=e[14]-r[14],t[15]=e[15]-r[15],t}var E=T,G=w,D=Object.freeze({create:function(){var t=new e(16);return e!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},clone:function(t){var r=new e(16);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r[8]=t[8],r[9]=t[9],r[10]=t[10],r[11]=t[11],r[12]=t[12],r[13]=t[13],r[14]=t[14],r[15]=t[15],r},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},fromValues:function(t,r,n,i,a,o,s,u,l,f,m,c,h,d,p,v){var _=new e(16);return _[0]=t,_[1]=r,_[2]=n,_[3]=i,_[4]=a,_[5]=o,_[6]=s,_[7]=u,_[8]=l,_[9]=f,_[10]=m,_[11]=c,_[12]=h,_[13]=d,_[14]=p,_[15]=v,_},set:function(t,e,r,n,i,a,o,s,u,l,f,m,c,h,d,p,v){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=a,t[5]=o,t[6]=s,t[7]=u,t[8]=l,t[9]=f,t[10]=m,t[11]=c,t[12]=h,t[13]=d,t[14]=p,t[15]=v,t},identity:S,transpose:function(t,e){if(t===e){var r=e[1],n=e[2],i=e[3],a=e[6],o=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[6]=e[9],t[7]=e[13],t[8]=n,t[9]=a,t[11]=e[14],t[12]=i,t[13]=o,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},invert:function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],f=e[8],m=e[9],c=e[10],h=e[11],d=e[12],p=e[13],v=e[14],_=e[15],g=r*s-n*o,x=r*u-i*o,y=r*l-a*o,S=n*u-i*s,T=n*l-a*s,U=i*l-a*u,b=f*p-m*d,M=f*v-c*d,P=f*_-h*d,w=m*v-c*p,E=m*_-h*p,G=c*_-h*v,D=g*G-x*E+y*w+S*P-T*M+U*b;return D?(D=1/D,t[0]=(s*G-u*E+l*w)*D,t[1]=(i*E-n*G-a*w)*D,t[2]=(p*U-v*T+_*S)*D,t[3]=(c*T-m*U-h*S)*D,t[4]=(u*P-o*G-l*M)*D,t[5]=(r*G-i*P+a*M)*D,t[6]=(v*y-d*U-_*x)*D,t[7]=(f*U-c*y+h*x)*D,t[8]=(o*E-s*P+l*b)*D,t[9]=(n*P-r*E-a*b)*D,t[10]=(d*T-p*y+_*g)*D,t[11]=(m*y-f*T-h*g)*D,t[12]=(s*M-o*w-u*b)*D,t[13]=(r*w-n*M+i*b)*D,t[14]=(p*x-d*S-v*g)*D,t[15]=(f*S-m*x+c*g)*D,t):null},adjoint:function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],f=e[8],m=e[9],c=e[10],h=e[11],d=e[12],p=e[13],v=e[14],_=e[15];return t[0]=s*(c*_-h*v)-m*(u*_-l*v)+p*(u*h-l*c),t[1]=-(n*(c*_-h*v)-m*(i*_-a*v)+p*(i*h-a*c)),t[2]=n*(u*_-l*v)-s*(i*_-a*v)+p*(i*l-a*u),t[3]=-(n*(u*h-l*c)-s*(i*h-a*c)+m*(i*l-a*u)),t[4]=-(o*(c*_-h*v)-f*(u*_-l*v)+d*(u*h-l*c)),t[5]=r*(c*_-h*v)-f*(i*_-a*v)+d*(i*h-a*c),t[6]=-(r*(u*_-l*v)-o*(i*_-a*v)+d*(i*l-a*u)),t[7]=r*(u*h-l*c)-o*(i*h-a*c)+f*(i*l-a*u),t[8]=o*(m*_-h*p)-f*(s*_-l*p)+d*(s*h-l*m),t[9]=-(r*(m*_-h*p)-f*(n*_-a*p)+d*(n*h-a*m)),t[10]=r*(s*_-l*p)-o*(n*_-a*p)+d*(n*l-a*s),t[11]=-(r*(s*h-l*m)-o*(n*h-a*m)+f*(n*l-a*s)),t[12]=-(o*(m*v-c*p)-f*(s*v-u*p)+d*(s*c-u*m)),t[13]=r*(m*v-c*p)-f*(n*v-i*p)+d*(n*c-i*m),t[14]=-(r*(s*v-u*p)-o*(n*v-i*p)+d*(n*u-i*s)),t[15]=r*(s*c-u*m)-o*(n*c-i*m)+f*(n*u-i*s),t},determinant:function(t){var e=t[0],r=t[1],n=t[2],i=t[3],a=t[4],o=t[5],s=t[6],u=t[7],l=t[8],f=t[9],m=t[10],c=t[11],h=t[12],d=t[13],p=t[14],v=t[15];return(e*o-r*a)*(m*v-c*p)-(e*s-n*a)*(f*v-c*d)+(e*u-i*a)*(f*p-m*d)+(r*s-n*o)*(l*v-c*h)-(r*u-i*o)*(l*p-m*h)+(n*u-i*s)*(l*d-f*h)},multiply:T,translate:function(t,e,r){var n,i,a,o,s,u,l,f,m,c,h,d,p=r[0],v=r[1],_=r[2];return e===t?(t[12]=e[0]*p+e[4]*v+e[8]*_+e[12],t[13]=e[1]*p+e[5]*v+e[9]*_+e[13],t[14]=e[2]*p+e[6]*v+e[10]*_+e[14],t[15]=e[3]*p+e[7]*v+e[11]*_+e[15]):(n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],f=e[7],m=e[8],c=e[9],h=e[10],d=e[11],t[0]=n,t[1]=i,t[2]=a,t[3]=o,t[4]=s,t[5]=u,t[6]=l,t[7]=f,t[8]=m,t[9]=c,t[10]=h,t[11]=d,t[12]=n*p+s*v+m*_+e[12],t[13]=i*p+u*v+c*_+e[13],t[14]=a*p+l*v+h*_+e[14],t[15]=o*p+f*v+d*_+e[15]),t},scale:function(t,e,r){var n=r[0],i=r[1],a=r[2];return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*a,t[9]=e[9]*a,t[10]=e[10]*a,t[11]=e[11]*a,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},rotate:function(e,r,n,i){var a,o,s,u,l,f,m,c,h,d,p,v,_,g,x,y,S,T,U,b,M,P,w,E,G=i[0],D=i[1],L=i[2],B=Math.hypot(G,D,L);return B<t?null:(G*=B=1/B,D*=B,L*=B,a=Math.sin(n),s=1-(o=Math.cos(n)),u=r[0],l=r[1],f=r[2],m=r[3],c=r[4],h=r[5],d=r[6],p=r[7],v=r[8],_=r[9],g=r[10],x=r[11],y=G*G*s+o,S=D*G*s+L*a,T=L*G*s-D*a,U=G*D*s-L*a,b=D*D*s+o,M=L*D*s+G*a,P=G*L*s+D*a,w=D*L*s-G*a,E=L*L*s+o,e[0]=u*y+c*S+v*T,e[1]=l*y+h*S+_*T,e[2]=f*y+d*S+g*T,e[3]=m*y+p*S+x*T,e[4]=u*U+c*b+v*M,e[5]=l*U+h*b+_*M,e[6]=f*U+d*b+g*M,e[7]=m*U+p*b+x*M,e[8]=u*P+c*w+v*E,e[9]=l*P+h*w+_*E,e[10]=f*P+d*w+g*E,e[11]=m*P+p*w+x*E,r!==e&&(e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e)},rotateX:function(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],f=e[9],m=e[10],c=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=a*i+l*n,t[5]=o*i+f*n,t[6]=s*i+m*n,t[7]=u*i+c*n,t[8]=l*i-a*n,t[9]=f*i-o*n,t[10]=m*i-s*n,t[11]=c*i-u*n,t},rotateY:function(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[0],o=e[1],s=e[2],u=e[3],l=e[8],f=e[9],m=e[10],c=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i-l*n,t[1]=o*i-f*n,t[2]=s*i-m*n,t[3]=u*i-c*n,t[8]=a*n+l*i,t[9]=o*n+f*i,t[10]=s*n+m*i,t[11]=u*n+c*i,t},rotateZ:function(t,e,r){var n=Math.sin(r),i=Math.cos(r),a=e[0],o=e[1],s=e[2],u=e[3],l=e[4],f=e[5],m=e[6],c=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=a*i+l*n,t[1]=o*i+f*n,t[2]=s*i+m*n,t[3]=u*i+c*n,t[4]=l*i-a*n,t[5]=f*i-o*n,t[6]=m*i-s*n,t[7]=c*i-u*n,t},fromTranslation:function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},fromScaling:function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromRotation:function(e,r,n){var i,a,o,s=n[0],u=n[1],l=n[2],f=Math.hypot(s,u,l);return f<t?null:(s*=f=1/f,u*=f,l*=f,i=Math.sin(r),o=1-(a=Math.cos(r)),e[0]=s*s*o+a,e[1]=u*s*o+l*i,e[2]=l*s*o-u*i,e[3]=0,e[4]=s*u*o-l*i,e[5]=u*u*o+a,e[6]=l*u*o+s*i,e[7]=0,e[8]=s*l*o+u*i,e[9]=u*l*o-s*i,e[10]=l*l*o+a,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)},fromXRotation:function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=n,t[6]=r,t[7]=0,t[8]=0,t[9]=-r,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromYRotation:function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=0,t[2]=-r,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=r,t[9]=0,t[10]=n,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromZRotation:function(t,e){var r=Math.sin(e),n=Math.cos(e);return t[0]=n,t[1]=r,t[2]=0,t[3]=0,t[4]=-r,t[5]=n,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromRotationTranslation:U,fromQuat2:function(t,r){var n=new e(3),i=-r[0],a=-r[1],o=-r[2],s=r[3],u=r[4],l=r[5],f=r[6],m=r[7],c=i*i+a*a+o*o+s*s;return c>0?(n[0]=2*(u*s+m*i+l*o-f*a)/c,n[1]=2*(l*s+m*a+f*i-u*o)/c,n[2]=2*(f*s+m*o+u*a-l*i)/c):(n[0]=2*(u*s+m*i+l*o-f*a),n[1]=2*(l*s+m*a+f*i-u*o),n[2]=2*(f*s+m*o+u*a-l*i)),U(t,r,n),t},getTranslation:b,getScaling:M,getRotation:P,fromRotationTranslationScale:function(t,e,r,n){var i=e[0],a=e[1],o=e[2],s=e[3],u=i+i,l=a+a,f=o+o,m=i*u,c=i*l,h=i*f,d=a*l,p=a*f,v=o*f,_=s*u,g=s*l,x=s*f,y=n[0],S=n[1],T=n[2];return t[0]=(1-(d+v))*y,t[1]=(c+x)*y,t[2]=(h-g)*y,t[3]=0,t[4]=(c-x)*S,t[5]=(1-(m+v))*S,t[6]=(p+_)*S,t[7]=0,t[8]=(h+g)*T,t[9]=(p-_)*T,t[10]=(1-(m+d))*T,t[11]=0,t[12]=r[0],t[13]=r[1],t[14]=r[2],t[15]=1,t},fromRotationTranslationScaleOrigin:function(t,e,r,n,i){var a=e[0],o=e[1],s=e[2],u=e[3],l=a+a,f=o+o,m=s+s,c=a*l,h=a*f,d=a*m,p=o*f,v=o*m,_=s*m,g=u*l,x=u*f,y=u*m,S=n[0],T=n[1],U=n[2],b=i[0],M=i[1],P=i[2],w=(1-(p+_))*S,E=(h+y)*S,G=(d-x)*S,D=(h-y)*T,L=(1-(c+_))*T,B=(v+g)*T,R=(d+x)*U,C=(v-g)*U,I=(1-(c+p))*U;return t[0]=w,t[1]=E,t[2]=G,t[3]=0,t[4]=D,t[5]=L,t[6]=B,t[7]=0,t[8]=R,t[9]=C,t[10]=I,t[11]=0,t[12]=r[0]+b-(w*b+D*M+R*P),t[13]=r[1]+M-(E*b+L*M+C*P),t[14]=r[2]+P-(G*b+B*M+I*P),t[15]=1,t},fromQuat:function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=r+r,s=n+n,u=i+i,l=r*o,f=n*o,m=n*s,c=i*o,h=i*s,d=i*u,p=a*o,v=a*s,_=a*u;return t[0]=1-m-d,t[1]=f+_,t[2]=c-v,t[3]=0,t[4]=f-_,t[5]=1-l-d,t[6]=h+p,t[7]=0,t[8]=c+v,t[9]=h-p,t[10]=1-l-m,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},frustum:function(t,e,r,n,i,a,o){var s=1/(r-e),u=1/(i-n),l=1/(a-o);return t[0]=2*a*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*a*u,t[6]=0,t[7]=0,t[8]=(r+e)*s,t[9]=(i+n)*u,t[10]=(o+a)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=o*a*2*l,t[15]=0,t},perspective:function(t,e,r,n,i){var a,o=1/Math.tan(e/2);return t[0]=o/r,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(a=1/(n-i),t[10]=(i+n)*a,t[14]=2*i*n*a):(t[10]=-1,t[14]=-2*n),t},perspectiveFromFieldOfView:function(t,e,r,n){var i=Math.tan(e.upDegrees*Math.PI/180),a=Math.tan(e.downDegrees*Math.PI/180),o=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),u=2/(o+s),l=2/(i+a);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=-(o-s)*u*.5,t[9]=(i-a)*l*.5,t[10]=n/(r-n),t[11]=-1,t[12]=0,t[13]=0,t[14]=n*r/(r-n),t[15]=0,t},ortho:function(t,e,r,n,i,a,o){var s=1/(e-r),u=1/(n-i),l=1/(a-o);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+r)*s,t[13]=(i+n)*u,t[14]=(o+a)*l,t[15]=1,t},lookAt:function(e,r,n,i){var a,o,s,u,l,f,m,c,h,d,p=r[0],v=r[1],_=r[2],g=i[0],x=i[1],y=i[2],T=n[0],U=n[1],b=n[2];return Math.abs(p-T)<t&&Math.abs(v-U)<t&&Math.abs(_-b)<t?S(e):(m=p-T,c=v-U,h=_-b,a=x*(h*=d=1/Math.hypot(m,c,h))-y*(c*=d),o=y*(m*=d)-g*h,s=g*c-x*m,(d=Math.hypot(a,o,s))?(a*=d=1/d,o*=d,s*=d):(a=0,o=0,s=0),u=c*s-h*o,l=h*a-m*s,f=m*o-c*a,(d=Math.hypot(u,l,f))?(u*=d=1/d,l*=d,f*=d):(u=0,l=0,f=0),e[0]=a,e[1]=u,e[2]=m,e[3]=0,e[4]=o,e[5]=l,e[6]=c,e[7]=0,e[8]=s,e[9]=f,e[10]=h,e[11]=0,e[12]=-(a*p+o*v+s*_),e[13]=-(u*p+l*v+f*_),e[14]=-(m*p+c*v+h*_),e[15]=1,e)},targetTo:function(t,e,r,n){var i=e[0],a=e[1],o=e[2],s=n[0],u=n[1],l=n[2],f=i-r[0],m=a-r[1],c=o-r[2],h=f*f+m*m+c*c;h>0&&(f*=h=1/Math.sqrt(h),m*=h,c*=h);var d=u*c-l*m,p=l*f-s*c,v=s*m-u*f;return(h=d*d+p*p+v*v)>0&&(d*=h=1/Math.sqrt(h),p*=h,v*=h),t[0]=d,t[1]=p,t[2]=v,t[3]=0,t[4]=m*v-c*p,t[5]=c*d-f*v,t[6]=f*p-m*d,t[7]=0,t[8]=f,t[9]=m,t[10]=c,t[11]=0,t[12]=i,t[13]=a,t[14]=o,t[15]=1,t},str:function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},frob:function(t){return Math.hypot(t[0],t[1],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t[8]=e[8]+r[8],t[9]=e[9]+r[9],t[10]=e[10]+r[10],t[11]=e[11]+r[11],t[12]=e[12]+r[12],t[13]=e[13]+r[13],t[14]=e[14]+r[14],t[15]=e[15]+r[15],t},subtract:w,multiplyScalar:function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12]*r,t[13]=e[13]*r,t[14]=e[14]*r,t[15]=e[15]*r,t},multiplyScalarAndAdd:function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t[4]=e[4]+r[4]*n,t[5]=e[5]+r[5]*n,t[6]=e[6]+r[6]*n,t[7]=e[7]+r[7]*n,t[8]=e[8]+r[8]*n,t[9]=e[9]+r[9]*n,t[10]=e[10]+r[10]*n,t[11]=e[11]+r[11]*n,t[12]=e[12]+r[12]*n,t[13]=e[13]+r[13]*n,t[14]=e[14]+r[14]*n,t[15]=e[15]+r[15]*n,t},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},equals:function(e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],f=e[7],m=e[8],c=e[9],h=e[10],d=e[11],p=e[12],v=e[13],_=e[14],g=e[15],x=r[0],y=r[1],S=r[2],T=r[3],U=r[4],b=r[5],M=r[6],P=r[7],w=r[8],E=r[9],G=r[10],D=r[11],L=r[12],B=r[13],R=r[14],C=r[15];return Math.abs(n-x)<=t*Math.max(1,Math.abs(n),Math.abs(x))&&Math.abs(i-y)<=t*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(a-S)<=t*Math.max(1,Math.abs(a),Math.abs(S))&&Math.abs(o-T)<=t*Math.max(1,Math.abs(o),Math.abs(T))&&Math.abs(s-U)<=t*Math.max(1,Math.abs(s),Math.abs(U))&&Math.abs(u-b)<=t*Math.max(1,Math.abs(u),Math.abs(b))&&Math.abs(l-M)<=t*Math.max(1,Math.abs(l),Math.abs(M))&&Math.abs(f-P)<=t*Math.max(1,Math.abs(f),Math.abs(P))&&Math.abs(m-w)<=t*Math.max(1,Math.abs(m),Math.abs(w))&&Math.abs(c-E)<=t*Math.max(1,Math.abs(c),Math.abs(E))&&Math.abs(h-G)<=t*Math.max(1,Math.abs(h),Math.abs(G))&&Math.abs(d-D)<=t*Math.max(1,Math.abs(d),Math.abs(D))&&Math.abs(p-L)<=t*Math.max(1,Math.abs(p),Math.abs(L))&&Math.abs(v-B)<=t*Math.max(1,Math.abs(v),Math.abs(B))&&Math.abs(_-R)<=t*Math.max(1,Math.abs(_),Math.abs(R))&&Math.abs(g-C)<=t*Math.max(1,Math.abs(g),Math.abs(C))},mul:E,sub:G});function L(){var t=new e(3);return e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function B(t){var e=t[0],r=t[1],n=t[2];return Math.hypot(e,r,n)}function R(t,r,n){var i=new e(3);return i[0]=t,i[1]=r,i[2]=n,i}function C(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t}function I(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t}function N(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t}function F(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return Math.hypot(r,n,i)}function A(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2];return r*r+n*n+i*i}function V(t){var e=t[0],r=t[1],n=t[2];return e*e+r*r+n*n}function O(t,e){var r=e[0],n=e[1],i=e[2],a=r*r+n*n+i*i;return a>0&&(a=1/Math.sqrt(a)),t[0]=e[0]*a,t[1]=e[1]*a,t[2]=e[2]*a,t}function Y(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function X(t,e,r){var n=e[0],i=e[1],a=e[2],o=r[0],s=r[1],u=r[2];return t[0]=i*u-a*s,t[1]=a*o-n*u,t[2]=n*s-i*o,t}var z,$=C,k=I,W=N,Z=F,H=A,q=B,j=V,J=(z=L(),function(t,e,r,n,i,a){var o,s;for(e||(e=3),r||(r=0),s=n?Math.min(n*e+r,t.length):t.length,o=r;o<s;o+=e)z[0]=t[o],z[1]=t[o+1],z[2]=t[o+2],i(z,z,a),t[o]=z[0],t[o+1]=z[1],t[o+2]=z[2];return t}),Q=Object.freeze({create:L,clone:function(t){var r=new e(3);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r},length:B,fromValues:R,copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},set:function(t,e,r,n){return t[0]=e,t[1]=r,t[2]=n,t},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t},subtract:C,multiply:I,divide:N,ceil:function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},floor:function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},min:function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t},max:function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t},round:function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},scale:function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t},scaleAndAdd:function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t},distance:F,squaredDistance:A,squaredLength:V,negate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},inverse:function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},normalize:O,dot:Y,cross:X,lerp:function(t,e,r,n){var i=e[0],a=e[1],o=e[2];return t[0]=i+n*(r[0]-i),t[1]=a+n*(r[1]-a),t[2]=o+n*(r[2]-o),t},hermite:function(t,e,r,n,i,a){var o=a*a,s=o*(2*a-3)+1,u=o*(a-2)+a,l=o*(a-1),f=o*(3-2*a);return t[0]=e[0]*s+r[0]*u+n[0]*l+i[0]*f,t[1]=e[1]*s+r[1]*u+n[1]*l+i[1]*f,t[2]=e[2]*s+r[2]*u+n[2]*l+i[2]*f,t},bezier:function(t,e,r,n,i,a){var o=1-a,s=o*o,u=a*a,l=s*o,f=3*a*s,m=3*u*o,c=u*a;return t[0]=e[0]*l+r[0]*f+n[0]*m+i[0]*c,t[1]=e[1]*l+r[1]*f+n[1]*m+i[1]*c,t[2]=e[2]*l+r[2]*f+n[2]*m+i[2]*c,t},random:function(t,e){e=e||1;var n=2*r()*Math.PI,i=2*r()-1,a=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(n)*a,t[1]=Math.sin(n)*a,t[2]=i*e,t},transformMat4:function(t,e,r){var n=e[0],i=e[1],a=e[2],o=r[3]*n+r[7]*i+r[11]*a+r[15];return o=o||1,t[0]=(r[0]*n+r[4]*i+r[8]*a+r[12])/o,t[1]=(r[1]*n+r[5]*i+r[9]*a+r[13])/o,t[2]=(r[2]*n+r[6]*i+r[10]*a+r[14])/o,t},transformMat3:function(t,e,r){var n=e[0],i=e[1],a=e[2];return t[0]=n*r[0]+i*r[3]+a*r[6],t[1]=n*r[1]+i*r[4]+a*r[7],t[2]=n*r[2]+i*r[5]+a*r[8],t},transformQuat:function(t,e,r){var n=r[0],i=r[1],a=r[2],o=r[3],s=e[0],u=e[1],l=e[2],f=i*l-a*u,m=a*s-n*l,c=n*u-i*s,h=i*c-a*m,d=a*f-n*c,p=n*m-i*f,v=2*o;return f*=v,m*=v,c*=v,h*=2,d*=2,p*=2,t[0]=s+f+h,t[1]=u+m+d,t[2]=l+c+p,t},rotateX:function(t,e,r,n){var i=[],a=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],a[0]=i[0],a[1]=i[1]*Math.cos(n)-i[2]*Math.sin(n),a[2]=i[1]*Math.sin(n)+i[2]*Math.cos(n),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t},rotateY:function(t,e,r,n){var i=[],a=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],a[0]=i[2]*Math.sin(n)+i[0]*Math.cos(n),a[1]=i[1],a[2]=i[2]*Math.cos(n)-i[0]*Math.sin(n),t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t},rotateZ:function(t,e,r,n){var i=[],a=[];return i[0]=e[0]-r[0],i[1]=e[1]-r[1],i[2]=e[2]-r[2],a[0]=i[0]*Math.cos(n)-i[1]*Math.sin(n),a[1]=i[0]*Math.sin(n)+i[1]*Math.cos(n),a[2]=i[2],t[0]=a[0]+r[0],t[1]=a[1]+r[1],t[2]=a[2]+r[2],t},angle:function(t,e){var r=R(t[0],t[1],t[2]),n=R(e[0],e[1],e[2]);O(r,r),O(n,n);var i=Y(r,n);return i>1?0:i<-1?Math.PI:Math.acos(i)},zero:function(t){return t[0]=0,t[1]=0,t[2]=0,t},str:function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},equals:function(e,r){var n=e[0],i=e[1],a=e[2],o=r[0],s=r[1],u=r[2];return Math.abs(n-o)<=t*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-s)<=t*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(a-u)<=t*Math.max(1,Math.abs(a),Math.abs(u))},sub:$,mul:k,div:W,dist:Z,sqrDist:H,len:q,sqrLen:j,forEach:J});function K(){var t=new e(4);return e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function tt(t){var r=new e(4);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r}function et(t,r,n,i){var a=new e(4);return a[0]=t,a[1]=r,a[2]=n,a[3]=i,a}function rt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function nt(t,e,r,n,i){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t}function it(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t}function at(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t[2]=e[2]-r[2],t[3]=e[3]-r[3],t}function ot(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t[2]=e[2]*r[2],t[3]=e[3]*r[3],t}function st(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t[2]=e[2]/r[2],t[3]=e[3]/r[3],t}function ut(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t}function lt(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2],a=e[3]-t[3];return Math.hypot(r,n,i,a)}function ft(t,e){var r=e[0]-t[0],n=e[1]-t[1],i=e[2]-t[2],a=e[3]-t[3];return r*r+n*n+i*i+a*a}function mt(t){var e=t[0],r=t[1],n=t[2],i=t[3];return Math.hypot(e,r,n,i)}function ct(t){var e=t[0],r=t[1],n=t[2],i=t[3];return e*e+r*r+n*n+i*i}function ht(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=r*r+n*n+i*i+a*a;return o>0&&(o=1/Math.sqrt(o)),t[0]=r*o,t[1]=n*o,t[2]=i*o,t[3]=a*o,t}function dt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function pt(t,e,r,n){var i=e[0],a=e[1],o=e[2],s=e[3];return t[0]=i+n*(r[0]-i),t[1]=a+n*(r[1]-a),t[2]=o+n*(r[2]-o),t[3]=s+n*(r[3]-s),t}function vt(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function _t(e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=r[0],u=r[1],l=r[2],f=r[3];return Math.abs(n-s)<=t*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-u)<=t*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(a-l)<=t*Math.max(1,Math.abs(a),Math.abs(l))&&Math.abs(o-f)<=t*Math.max(1,Math.abs(o),Math.abs(f))}var gt=at,xt=ot,yt=st,St=lt,Tt=ft,Ut=mt,bt=ct,Mt=function(){var t=K();return function(e,r,n,i,a,o){var s,u;for(r||(r=4),n||(n=0),u=i?Math.min(i*r+n,e.length):e.length,s=n;s<u;s+=r)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],t[3]=e[s+3],a(t,t,o),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2],e[s+3]=t[3];return e}}(),Pt=Object.freeze({create:K,clone:tt,fromValues:et,copy:rt,set:nt,add:it,subtract:at,multiply:ot,divide:st,ceil:function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},floor:function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},min:function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t[2]=Math.min(e[2],r[2]),t[3]=Math.min(e[3],r[3]),t},max:function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t[2]=Math.max(e[2],r[2]),t[3]=Math.max(e[3],r[3]),t},round:function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},scale:ut,scaleAndAdd:function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t[2]=e[2]+r[2]*n,t[3]=e[3]+r[3]*n,t},distance:lt,squaredDistance:ft,length:mt,squaredLength:ct,negate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},inverse:function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},normalize:ht,dot:dt,cross:function(t,e,r,n){var i=r[0]*n[1]-r[1]*n[0],a=r[0]*n[2]-r[2]*n[0],o=r[0]*n[3]-r[3]*n[0],s=r[1]*n[2]-r[2]*n[1],u=r[1]*n[3]-r[3]*n[1],l=r[2]*n[3]-r[3]*n[2],f=e[0],m=e[1],c=e[2],h=e[3];return t[0]=m*l-c*u+h*s,t[1]=-f*l+c*o-h*a,t[2]=f*u-m*o+h*i,t[3]=-f*s+m*a-c*i,t},lerp:pt,random:function(t,e){var n,i,a,o,s,u;e=e||1;do{s=(n=2*r()-1)*n+(i=2*r()-1)*i}while(s>=1);do{u=(a=2*r()-1)*a+(o=2*r()-1)*o}while(u>=1);var l=Math.sqrt((1-s)/u);return t[0]=e*n,t[1]=e*i,t[2]=e*a*l,t[3]=e*o*l,t},transformMat4:function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3];return t[0]=r[0]*n+r[4]*i+r[8]*a+r[12]*o,t[1]=r[1]*n+r[5]*i+r[9]*a+r[13]*o,t[2]=r[2]*n+r[6]*i+r[10]*a+r[14]*o,t[3]=r[3]*n+r[7]*i+r[11]*a+r[15]*o,t},transformQuat:function(t,e,r){var n=e[0],i=e[1],a=e[2],o=r[0],s=r[1],u=r[2],l=r[3],f=l*n+s*a-u*i,m=l*i+u*n-o*a,c=l*a+o*i-s*n,h=-o*n-s*i-u*a;return t[0]=f*l+h*-o+m*-u-c*-s,t[1]=m*l+h*-s+c*-o-f*-u,t[2]=c*l+h*-u+f*-s-m*-o,t[3]=e[3],t},zero:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},str:function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},exactEquals:vt,equals:_t,sub:gt,mul:xt,div:yt,dist:St,sqrDist:Tt,len:Ut,sqrLen:bt,forEach:Mt});function wt(){var t=new e(4);return e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Et(t,e,r){r*=.5;var n=Math.sin(r);return t[0]=n*e[0],t[1]=n*e[1],t[2]=n*e[2],t[3]=Math.cos(r),t}function Gt(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=r[0],u=r[1],l=r[2],f=r[3];return t[0]=n*f+o*s+i*l-a*u,t[1]=i*f+o*u+a*s-n*l,t[2]=a*f+o*l+n*u-i*s,t[3]=o*f-n*s-i*u-a*l,t}function Dt(t,e,r){r*=.5;var n=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=n*u+o*s,t[1]=i*u+a*s,t[2]=a*u-i*s,t[3]=o*u-n*s,t}function Lt(t,e,r){r*=.5;var n=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=n*u-a*s,t[1]=i*u+o*s,t[2]=a*u+n*s,t[3]=o*u-i*s,t}function Bt(t,e,r){r*=.5;var n=e[0],i=e[1],a=e[2],o=e[3],s=Math.sin(r),u=Math.cos(r);return t[0]=n*u+i*s,t[1]=i*u-n*s,t[2]=a*u+o*s,t[3]=o*u-a*s,t}function Rt(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=Math.sqrt(r*r+n*n+i*i),s=Math.exp(a),u=o>0?s*Math.sin(o)/o:0;return t[0]=r*u,t[1]=n*u,t[2]=i*u,t[3]=s*Math.cos(o),t}function Ct(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=Math.sqrt(r*r+n*n+i*i),s=o>0?Math.atan2(o,a)/o:0;return t[0]=r*s,t[1]=n*s,t[2]=i*s,t[3]=.5*Math.log(r*r+n*n+i*i+a*a),t}function It(e,r,n,i){var a,o,s,u,l,f=r[0],m=r[1],c=r[2],h=r[3],d=n[0],p=n[1],v=n[2],_=n[3];return(o=f*d+m*p+c*v+h*_)<0&&(o=-o,d=-d,p=-p,v=-v,_=-_),1-o>t?(a=Math.acos(o),s=Math.sin(a),u=Math.sin((1-i)*a)/s,l=Math.sin(i*a)/s):(u=1-i,l=i),e[0]=u*f+l*d,e[1]=u*m+l*p,e[2]=u*c+l*v,e[3]=u*h+l*_,e}function Nt(t,e){var r,n=e[0]+e[4]+e[8];if(n>0)r=Math.sqrt(n+1),t[3]=.5*r,r=.5/r,t[0]=(e[5]-e[7])*r,t[1]=(e[6]-e[2])*r,t[2]=(e[1]-e[3])*r;else{var i=0;e[4]>e[0]&&(i=1),e[8]>e[3*i+i]&&(i=2);var a=(i+1)%3,o=(i+2)%3;r=Math.sqrt(e[3*i+i]-e[3*a+a]-e[3*o+o]+1),t[i]=.5*r,r=.5/r,t[3]=(e[3*a+o]-e[3*o+a])*r,t[a]=(e[3*a+i]+e[3*i+a])*r,t[o]=(e[3*o+i]+e[3*i+o])*r}return t}var Ft,At,Vt,Ot,Yt,Xt,zt=tt,$t=et,kt=rt,Wt=nt,Zt=it,Ht=Gt,qt=ut,jt=dt,Jt=pt,Qt=mt,Kt=Qt,te=ct,ee=te,re=ht,ne=vt,ie=_t,ae=(Ft=L(),At=R(1,0,0),Vt=R(0,1,0),function(t,e,r){var n=Y(e,r);return n<-.999999?(X(Ft,At,e),q(Ft)<1e-6&&X(Ft,Vt,e),O(Ft,Ft),Et(t,Ft,Math.PI),t):n>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(X(Ft,e,r),t[0]=Ft[0],t[1]=Ft[1],t[2]=Ft[2],t[3]=1+n,re(t,t))}),oe=(Ot=wt(),Yt=wt(),function(t,e,r,n,i,a){return It(Ot,e,i,a),It(Yt,r,n,a),It(t,Ot,Yt,2*a*(1-a)),t}),se=(Xt=p(),function(t,e,r,n){return Xt[0]=r[0],Xt[3]=r[1],Xt[6]=r[2],Xt[1]=n[0],Xt[4]=n[1],Xt[7]=n[2],Xt[2]=-e[0],Xt[5]=-e[1],Xt[8]=-e[2],re(t,Nt(t,Xt))}),ue=Object.freeze({create:wt,identity:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},setAxisAngle:Et,getAxisAngle:function(e,r){var n=2*Math.acos(r[3]),i=Math.sin(n/2);return i>t?(e[0]=r[0]/i,e[1]=r[1]/i,e[2]=r[2]/i):(e[0]=1,e[1]=0,e[2]=0),n},getAngle:function(t,e){var r=jt(t,e);return Math.acos(2*r*r-1)},multiply:Gt,rotateX:Dt,rotateY:Lt,rotateZ:Bt,calculateW:function(t,e){var r=e[0],n=e[1],i=e[2];return t[0]=r,t[1]=n,t[2]=i,t[3]=Math.sqrt(Math.abs(1-r*r-n*n-i*i)),t},exp:Rt,ln:Ct,pow:function(t,e,r){return Ct(t,e),qt(t,t,r),Rt(t,t),t},slerp:It,random:function(t){var e=r(),n=r(),i=r(),a=Math.sqrt(1-e),o=Math.sqrt(e);return t[0]=a*Math.sin(2*Math.PI*n),t[1]=a*Math.cos(2*Math.PI*n),t[2]=o*Math.sin(2*Math.PI*i),t[3]=o*Math.cos(2*Math.PI*i),t},invert:function(t,e){var r=e[0],n=e[1],i=e[2],a=e[3],o=r*r+n*n+i*i+a*a,s=o?1/o:0;return t[0]=-r*s,t[1]=-n*s,t[2]=-i*s,t[3]=a*s,t},conjugate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},fromMat3:Nt,fromEuler:function(t,e,r,n){var i=.5*Math.PI/180;e*=i,r*=i,n*=i;var a=Math.sin(e),o=Math.cos(e),s=Math.sin(r),u=Math.cos(r),l=Math.sin(n),f=Math.cos(n);return t[0]=a*u*f-o*s*l,t[1]=o*s*f+a*u*l,t[2]=o*u*l-a*s*f,t[3]=o*u*f+a*s*l,t},str:function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},clone:zt,fromValues:$t,copy:kt,set:Wt,add:Zt,mul:Ht,scale:qt,dot:jt,lerp:Jt,length:Qt,len:Kt,squaredLength:te,sqrLen:ee,normalize:re,exactEquals:ne,equals:ie,rotationTo:ae,sqlerp:oe,setAxes:se});function le(t,e,r){var n=.5*r[0],i=.5*r[1],a=.5*r[2],o=e[0],s=e[1],u=e[2],l=e[3];return t[0]=o,t[1]=s,t[2]=u,t[3]=l,t[4]=n*l+i*u-a*s,t[5]=i*l+a*o-n*u,t[6]=a*l+n*s-i*o,t[7]=-n*o-i*s-a*u,t}function fe(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}var me=kt,ce=kt;function he(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=r[4],u=r[5],l=r[6],f=r[7],m=e[4],c=e[5],h=e[6],d=e[7],p=r[0],v=r[1],_=r[2],g=r[3];return t[0]=n*g+o*p+i*_-a*v,t[1]=i*g+o*v+a*p-n*_,t[2]=a*g+o*_+n*v-i*p,t[3]=o*g-n*p-i*v-a*_,t[4]=n*f+o*s+i*l-a*u+m*g+d*p+c*_-h*v,t[5]=i*f+o*u+a*s-n*l+c*g+d*v+h*p-m*_,t[6]=a*f+o*l+n*u-i*s+h*g+d*_+m*v-c*p,t[7]=o*f-n*s-i*u-a*l+d*g-m*p-c*v-h*_,t}var de=he,pe=jt,ve=Qt,_e=ve,ge=te,xe=ge,ye=Object.freeze({create:function(){var t=new e(8);return e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},clone:function(t){var r=new e(8);return r[0]=t[0],r[1]=t[1],r[2]=t[2],r[3]=t[3],r[4]=t[4],r[5]=t[5],r[6]=t[6],r[7]=t[7],r},fromValues:function(t,r,n,i,a,o,s,u){var l=new e(8);return l[0]=t,l[1]=r,l[2]=n,l[3]=i,l[4]=a,l[5]=o,l[6]=s,l[7]=u,l},fromRotationTranslationValues:function(t,r,n,i,a,o,s){var u=new e(8);u[0]=t,u[1]=r,u[2]=n,u[3]=i;var l=.5*a,f=.5*o,m=.5*s;return u[4]=l*i+f*n-m*r,u[5]=f*i+m*t-l*n,u[6]=m*i+l*r-f*t,u[7]=-l*t-f*r-m*n,u},fromRotationTranslation:le,fromTranslation:function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},fromRotation:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},fromMat4:function(t,r){var n=wt();P(n,r);var i=new e(3);return b(i,r),le(t,n,i),t},copy:fe,identity:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},set:function(t,e,r,n,i,a,o,s,u){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=a,t[5]=o,t[6]=s,t[7]=u,t},getReal:me,getDual:function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},setReal:ce,setDual:function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},getTranslation:function(t,e){var r=e[4],n=e[5],i=e[6],a=e[7],o=-e[0],s=-e[1],u=-e[2],l=e[3];return t[0]=2*(r*l+a*o+n*u-i*s),t[1]=2*(n*l+a*s+i*o-r*u),t[2]=2*(i*l+a*u+r*s-n*o),t},translate:function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=.5*r[0],u=.5*r[1],l=.5*r[2],f=e[4],m=e[5],c=e[6],h=e[7];return t[0]=n,t[1]=i,t[2]=a,t[3]=o,t[4]=o*s+i*l-a*u+f,t[5]=o*u+a*s-n*l+m,t[6]=o*l+n*u-i*s+c,t[7]=-n*s-i*u-a*l+h,t},rotateX:function(t,e,r){var n=-e[0],i=-e[1],a=-e[2],o=e[3],s=e[4],u=e[5],l=e[6],f=e[7],m=s*o+f*n+u*a-l*i,c=u*o+f*i+l*n-s*a,h=l*o+f*a+s*i-u*n,d=f*o-s*n-u*i-l*a;return Dt(t,e,r),n=t[0],i=t[1],a=t[2],o=t[3],t[4]=m*o+d*n+c*a-h*i,t[5]=c*o+d*i+h*n-m*a,t[6]=h*o+d*a+m*i-c*n,t[7]=d*o-m*n-c*i-h*a,t},rotateY:function(t,e,r){var n=-e[0],i=-e[1],a=-e[2],o=e[3],s=e[4],u=e[5],l=e[6],f=e[7],m=s*o+f*n+u*a-l*i,c=u*o+f*i+l*n-s*a,h=l*o+f*a+s*i-u*n,d=f*o-s*n-u*i-l*a;return Lt(t,e,r),n=t[0],i=t[1],a=t[2],o=t[3],t[4]=m*o+d*n+c*a-h*i,t[5]=c*o+d*i+h*n-m*a,t[6]=h*o+d*a+m*i-c*n,t[7]=d*o-m*n-c*i-h*a,t},rotateZ:function(t,e,r){var n=-e[0],i=-e[1],a=-e[2],o=e[3],s=e[4],u=e[5],l=e[6],f=e[7],m=s*o+f*n+u*a-l*i,c=u*o+f*i+l*n-s*a,h=l*o+f*a+s*i-u*n,d=f*o-s*n-u*i-l*a;return Bt(t,e,r),n=t[0],i=t[1],a=t[2],o=t[3],t[4]=m*o+d*n+c*a-h*i,t[5]=c*o+d*i+h*n-m*a,t[6]=h*o+d*a+m*i-c*n,t[7]=d*o-m*n-c*i-h*a,t},rotateByQuatAppend:function(t,e,r){var n=r[0],i=r[1],a=r[2],o=r[3],s=e[0],u=e[1],l=e[2],f=e[3];return t[0]=s*o+f*n+u*a-l*i,t[1]=u*o+f*i+l*n-s*a,t[2]=l*o+f*a+s*i-u*n,t[3]=f*o-s*n-u*i-l*a,s=e[4],u=e[5],l=e[6],f=e[7],t[4]=s*o+f*n+u*a-l*i,t[5]=u*o+f*i+l*n-s*a,t[6]=l*o+f*a+s*i-u*n,t[7]=f*o-s*n-u*i-l*a,t},rotateByQuatPrepend:function(t,e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=r[0],u=r[1],l=r[2],f=r[3];return t[0]=n*f+o*s+i*l-a*u,t[1]=i*f+o*u+a*s-n*l,t[2]=a*f+o*l+n*u-i*s,t[3]=o*f-n*s-i*u-a*l,s=r[4],u=r[5],l=r[6],f=r[7],t[4]=n*f+o*s+i*l-a*u,t[5]=i*f+o*u+a*s-n*l,t[6]=a*f+o*l+n*u-i*s,t[7]=o*f-n*s-i*u-a*l,t},rotateAroundAxis:function(e,r,n,i){if(Math.abs(i)<t)return fe(e,r);var a=Math.hypot(n[0],n[1],n[2]);i*=.5;var o=Math.sin(i),s=o*n[0]/a,u=o*n[1]/a,l=o*n[2]/a,f=Math.cos(i),m=r[0],c=r[1],h=r[2],d=r[3];e[0]=m*f+d*s+c*l-h*u,e[1]=c*f+d*u+h*s-m*l,e[2]=h*f+d*l+m*u-c*s,e[3]=d*f-m*s-c*u-h*l;var p=r[4],v=r[5],_=r[6],g=r[7];return e[4]=p*f+g*s+v*l-_*u,e[5]=v*f+g*u+_*s-p*l,e[6]=_*f+g*l+p*u-v*s,e[7]=g*f-p*s-v*u-_*l,e},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t[2]=e[2]+r[2],t[3]=e[3]+r[3],t[4]=e[4]+r[4],t[5]=e[5]+r[5],t[6]=e[6]+r[6],t[7]=e[7]+r[7],t},multiply:he,mul:de,scale:function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t},dot:pe,lerp:function(t,e,r,n){var i=1-n;return pe(e,r)<0&&(n=-n),t[0]=e[0]*i+r[0]*n,t[1]=e[1]*i+r[1]*n,t[2]=e[2]*i+r[2]*n,t[3]=e[3]*i+r[3]*n,t[4]=e[4]*i+r[4]*n,t[5]=e[5]*i+r[5]*n,t[6]=e[6]*i+r[6]*n,t[7]=e[7]*i+r[7]*n,t},invert:function(t,e){var r=ge(e);return t[0]=-e[0]/r,t[1]=-e[1]/r,t[2]=-e[2]/r,t[3]=e[3]/r,t[4]=-e[4]/r,t[5]=-e[5]/r,t[6]=-e[6]/r,t[7]=e[7]/r,t},conjugate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},length:ve,len:_e,squaredLength:ge,sqrLen:xe,normalize:function(t,e){var r=ge(e);if(r>0){r=Math.sqrt(r);var n=e[0]/r,i=e[1]/r,a=e[2]/r,o=e[3]/r,s=e[4],u=e[5],l=e[6],f=e[7],m=n*s+i*u+a*l+o*f;t[0]=n,t[1]=i,t[2]=a,t[3]=o,t[4]=(s-n*m)/r,t[5]=(u-i*m)/r,t[6]=(l-a*m)/r,t[7]=(f-o*m)/r}return t},str:function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},equals:function(e,r){var n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],l=e[6],f=e[7],m=r[0],c=r[1],h=r[2],d=r[3],p=r[4],v=r[5],_=r[6],g=r[7];return Math.abs(n-m)<=t*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(i-c)<=t*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(a-h)<=t*Math.max(1,Math.abs(a),Math.abs(h))&&Math.abs(o-d)<=t*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(s-p)<=t*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(u-v)<=t*Math.max(1,Math.abs(u),Math.abs(v))&&Math.abs(l-_)<=t*Math.max(1,Math.abs(l),Math.abs(_))&&Math.abs(f-g)<=t*Math.max(1,Math.abs(f),Math.abs(g))}});function Se(){var t=new e(2);return e!=Float32Array&&(t[0]=0,t[1]=0),t}function Te(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function Ue(t,e,r){return t[0]=e[0]*r[0],t[1]=e[1]*r[1],t}function be(t,e,r){return t[0]=e[0]/r[0],t[1]=e[1]/r[1],t}function Me(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.hypot(r,n)}function Pe(t,e){var r=e[0]-t[0],n=e[1]-t[1];return r*r+n*n}function we(t){var e=t[0],r=t[1];return Math.hypot(e,r)}function Ee(t){var e=t[0],r=t[1];return e*e+r*r}var Ge=we,De=Te,Le=Ue,Be=be,Re=Me,Ce=Pe,Ie=Ee,Ne=function(){var t=Se();return function(e,r,n,i,a,o){var s,u;for(r||(r=2),n||(n=0),u=i?Math.min(i*r+n,e.length):e.length,s=n;s<u;s+=r)t[0]=e[s],t[1]=e[s+1],a(t,t,o),e[s]=t[0],e[s+1]=t[1];return e}}(),Fe=Object.freeze({create:Se,clone:function(t){var r=new e(2);return r[0]=t[0],r[1]=t[1],r},fromValues:function(t,r){var n=new e(2);return n[0]=t,n[1]=r,n},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t},set:function(t,e,r){return t[0]=e,t[1]=r,t},add:function(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t},subtract:Te,multiply:Ue,divide:be,ceil:function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},floor:function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},min:function(t,e,r){return t[0]=Math.min(e[0],r[0]),t[1]=Math.min(e[1],r[1]),t},max:function(t,e,r){return t[0]=Math.max(e[0],r[0]),t[1]=Math.max(e[1],r[1]),t},round:function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},scale:function(t,e,r){return t[0]=e[0]*r,t[1]=e[1]*r,t},scaleAndAdd:function(t,e,r,n){return t[0]=e[0]+r[0]*n,t[1]=e[1]+r[1]*n,t},distance:Me,squaredDistance:Pe,length:we,squaredLength:Ee,negate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t},inverse:function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},normalize:function(t,e){var r=e[0],n=e[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t},dot:function(t,e){return t[0]*e[0]+t[1]*e[1]},cross:function(t,e,r){var n=e[0]*r[1]-e[1]*r[0];return t[0]=t[1]=0,t[2]=n,t},lerp:function(t,e,r,n){var i=e[0],a=e[1];return t[0]=i+n*(r[0]-i),t[1]=a+n*(r[1]-a),t},random:function(t,e){e=e||1;var n=2*r()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},transformMat2:function(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i,t[1]=r[1]*n+r[3]*i,t},transformMat2d:function(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[2]*i+r[4],t[1]=r[1]*n+r[3]*i+r[5],t},transformMat3:function(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[3]*i+r[6],t[1]=r[1]*n+r[4]*i+r[7],t},transformMat4:function(t,e,r){var n=e[0],i=e[1];return t[0]=r[0]*n+r[4]*i+r[12],t[1]=r[1]*n+r[5]*i+r[13],t},rotate:function(t,e,r,n){var i=e[0]-r[0],a=e[1]-r[1],o=Math.sin(n),s=Math.cos(n);return t[0]=i*s-a*o+r[0],t[1]=i*o+a*s+r[1],t},angle:function(t,e){var r=t[0],n=t[1],i=e[0],a=e[1],o=r*r+n*n;o>0&&(o=1/Math.sqrt(o));var s=i*i+a*a;s>0&&(s=1/Math.sqrt(s));var u=(r*i+n*a)*o*s;return u>1?0:u<-1?Math.PI:Math.acos(u)},zero:function(t){return t[0]=0,t[1]=0,t},str:function(t){return"vec2("+t[0]+", "+t[1]+")"},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]},equals:function(e,r){var n=e[0],i=e[1],a=r[0],o=r[1];return Math.abs(n-a)<=t*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-o)<=t*Math.max(1,Math.abs(i),Math.abs(o))},len:Ge,sub:De,mul:Le,div:Be,dist:Re,sqrDist:Ce,sqrLen:Ie,forEach:Ne});let Ae={};function Ve(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Oe(t,e){var r=e.get(t);if(!r)throw new TypeError("attempted to get private field on non-instance");return r.get?r.get.call(t):r.value}function Ye(t,e,r){var n=e.get(t);if(!n)throw new TypeError("attempted to set private field on non-instance");if(n.set)n.set.call(t,r);else{if(!n.writable)throw new TypeError("attempted to set read only private field");n.value=r}return r}Ae.glMatrix=i,Ae.mat2=l,Ae.mat2d=d,Ae.mat3=y,Ae.mat4=D,Ae.quat=ue,Ae.quat2=ye,Ae.vec2=Fe,Ae.vec3=Q,Ae.vec4=Pt,Object.defineProperty(Ae,"__esModule",{value:!0});let Xe=1;class ze{static getNextUUID(){return Xe++}constructor(){this._UUID=Xe++}updateUUID(){this._UUID=Xe++}}let $e={float:1*Float32Array.BYTES_PER_ELEMENT,float2:2*Float32Array.BYTES_PER_ELEMENT,float3:3*Float32Array.BYTES_PER_ELEMENT,float4:4*Float32Array.BYTES_PER_ELEMENT,mat2:4*Float32Array.BYTES_PER_ELEMENT,mat3:12*Float32Array.BYTES_PER_ELEMENT,mat4:16*Float32Array.BYTES_PER_ELEMENT};var ke={rgb2hex:(t,e,r)=>"#"+(16777216+(r|e<<8|t<<16)).toString(16).slice(1),regHex:function(){const t=/^#(?:[0-9a-fA-F]{3}){1,2}$/;return function(e){return t.test(e)}}(),hexToRGB_ZeroToOne:function(t){let e,r;if(/^#([A-Fa-f0-9]{3}){1,2}$/.test(t))return r=[],e=t.substring(1).split(""),3===e.length&&(e=[e[0],e[0],e[1],e[1],e[2],e[2]]),e="0x"+e.join(""),r[0]=(e>>16&255)/255,r[1]=(e>>8&255)/255,r[2]=(255&e)/255,r;qe.throwFunc("RedGLUtil.hexToRGB_ZeroToOne : 잘못된 hex값입니다.",t)}};let We=function(t,e,r){return Math.max(e,Math.min(r,t))};var Ze={clamp:We,nextHighestPowerOfTwo:function(){let t;return function(e){for(--e,t=1;t<32;t<<=1)e|=e>>t;return e+1}}(),quaternionToRotationMat4:function(t,e){let r=t[0],n=t[1],i=t[2],a=t[3],o=r+r,s=n+n,u=i+i,l=r*o,f=r*s,m=r*u,c=n*s,h=n*u,d=i*u,p=a*o,v=a*s,_=a*u;return e[0]=1-(c+d),e[4]=f-_,e[8]=m+v,e[1]=f+_,e[5]=1-(l+d),e[9]=h-p,e[2]=m-v,e[6]=h+p,e[10]=1-(l+c),e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},mat4ToEuler:function(t,e,r){e=e||[0,0,0],r=r||"XYZ";let n=t[0],i=t[4],a=t[8],o=t[1],s=t[5],u=t[9],l=t[2],f=t[6],m=t[10];return"XYZ"===r?(e[1]=Math.asin(We(a,-1,1)),Math.abs(a)<.99999?(e[0]=Math.atan2(-u,m),e[2]=Math.atan2(-i,n)):(e[0]=Math.atan2(f,s),e[2]=0)):"YXZ"===r?(e[0]=Math.asin(-We(u,-1,1)),Math.abs(u)<.99999?(e[1]=Math.atan2(a,m),e[2]=Math.atan2(o,s)):(e[1]=Math.atan2(-l,n),e[2]=0)):"ZXY"===r?(e[0]=Math.asin(We(f,-1,1)),Math.abs(f)<.99999?(e[1]=Math.atan2(-l,m),e[2]=Math.atan2(-i,s)):(e[1]=0,e[2]=Math.atan2(o,n))):"ZYX"===r?(e[1]=Math.asin(-We(l,-1,1)),Math.abs(l)<.99999?(e[0]=Math.atan2(f,m),e[2]=Math.atan2(o,n)):(e[0]=0,e[2]=Math.atan2(-i,s))):"YZX"===r?(e[2]=Math.asin(We(o,-1,1)),Math.abs(o)<.99999?(e[0]=Math.atan2(-u,s),e[1]=Math.atan2(-l,n)):(e[0]=0,e[1]=Math.atan2(a,m))):"XZY"===r&&(e[2]=Math.asin(-We(i,-1,1)),Math.abs(i)<.99999?(e[0]=Math.atan2(f,s),e[1]=Math.atan2(a,n)):(e[0]=Math.atan2(-u,m),e[1]=0)),e},calculateNormals:function(t,e){let r,n,i=[];for(r=0;r<t.length;r+=3)i[r+0]=0,i[r+1]=0,i[r+2]=0;for(r=0;r<e.length;r+=3){let a,o,s,u,l=[],f=[],m=[];for(a=3*e[r],o=3*e[r+1],s=3*e[r+2],l[0]=t[s+0]-t[o+0],l[1]=t[s+1]-t[o+1],l[2]=t[s+2]-t[o+2],f[0]=t[a+0]-t[o+0],f[1]=t[a+1]-t[o+1],f[2]=t[a+2]-t[o+2],m[0]=l[1]*f[2]-l[2]*f[1],m[1]=l[2]*f[0]-l[0]*f[2],m[2]=l[0]*f[1]-l[1]*f[0],n=0;n<3;n++)u=3*e[r+n],i[u+0]=i[u+0]+m[0],i[u+1]=i[u+1]+m[1],i[u+2]=i[u+2]+m[2]}for(r=0;r<t.length;r+=3){let t=[];t[0]=i[r+0],t[1]=i[r+1],t[2]=i[r+2];let e=Math.sqrt(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);0===e&&(e=1),t[0]=t[0]/e,t[1]=t[1]/e,t[2]=t[2]/e,i[r+0]=t[0],i[r+1]=t[1],i[r+2]=t[2]}return i}};const He=(t=>{let e,r,n,i,a,o=[0,0,0],s=Ae.mat4.create(),u=Ae.mat4.create();return(t,l,f)=>(t=2*t/f.viewRect[2]-1,l=-2*l/f.viewRect[3]+1,e=1,a=f.camera,Ae.mat4.multiply(u,f.projectionMatrix,a.matrix),i=Ae.mat4.clone(u),Ae.mat4.invert(i,i),o=[t,l,1],Ae.mat4.identity(s),Ae.mat4.translate(s,s,o),Ae.mat4.multiply(i,i,s),o[0]=i[12],o[1]=i[13],o[2]=i[14],r=u[12]*t+u[13]*l+u[15],0!==r&&(n=1/r,o[0]/=n,o[1]/=n,o[2]/=n,o[0]=o[0]+a.x,o[1]=o[1]+a.y,o[2]=o[2]+a.z),o)})();var qe={throwFunc:function(){throw"Error : "+Array.prototype.slice.call(arguments).join(" ")},...ke,...Ze,getFlatChildList:t=>{let e=function(t){const e=[...t],r=[];for(;e.length;){const t=e.shift();r.push(t),e.push(...t._children)}return r}(t);return e=e.reverse(),e},screenToWorld:He};class je{constructor(t=[],e=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST){Array.isArray(t)||qe.throwFunc(`${this.constructor.name} - only allow Array Instance. / inputValue : ${t} { type : ${typeof t} }`),this.redStruct=JSON.parse(JSON.stringify(t)),this.redStructOffsetMap={};let r=0,n=$e.float4;this.redStruct.map(t=>{if(t.valueName||qe.throwFunc(`${this.constructor.name} - need valueName / inputValue : ${t.valueName} { type : ${typeof t.valueName} }`),t.hasOwnProperty("size")||qe.throwFunc(`${this.constructor.name} - need size / inputValue : ${t.size} { type : ${typeof t.size} }`),t.size<=n){Math.floor(r/n)!=Math.floor((r+t.size-1)/n)&&(r+=n-r%n),t.offset=r,r+=t.size}else r%n&&(r+=n-r%n),t.offset=r,r+=t.size;this.redStructOffsetMap[t.valueName]=t.offset,t._UUID=t.valueName+"_"+ze.getNextUUID()});let i=r%n;this.size=this.redStruct.length?r+(i?n-i:0):n,this.usage=e}}class Je{constructor(){Qe.set(this,{writable:!0,value:void 0}),Ve(this,"detectGPU",t=>{}),Ke.set(this,{writable:!0,value:t=>{let e,r,n,i,a,o,s=window.navigator,u=s.userAgent.toLowerCase(),l=s.platform.toLowerCase(),f=s.appVersion.toLowerCase(),m="pc",c=0,h=t=>u.includes("whale")?(r=parseFloat(/whale\/([\d]+)/.exec(u)[1]),e="whale"):0,d=t=>{if(u.includes(a="chrome")||u.includes(a="crios"))return e="chrome",r=parseFloat(("chrome"===a?/chrome\/([\d]+)/:/crios\/([\d]+)/).exec(u)[1])},p=t=>u.includes("firefox")?(e="firefox",r=parseFloat(/firefox\/([\d]+)/.exec(u)[1])):0,v=t=>u.includes("safari")?(e="safari",r=parseFloat(/safari\/([\d]+)/.exec(u)[1])):0,_=t=>{let n;return u.includes(n="opera")||u.includes(n="opr")?(e="opera",r="opera"===n?parseFloat(/version\/([\d]+)/.exec(u)[1]):parseFloat(/opr\/([\d]+)/.exec(u)[1])):0},g=t=>u.includes("naver")?e="naver":0;if(u.includes("android"))e=n="android",m=u.includes("mobile")?(e+="Tablet","tablet"):"mobile",i=(a=/android ([\d.]+)/.exec(u))?(a=a[1].split("."),parseFloat(a[0]+"."+a[1])):0,c=1,h()||g()||_()||d()||p()||(r=a=/safari\/([\d.]+)/.exec(u)?parseFloat(a[1]):0);else if(u.includes(a="ipad")||u.includes(a="iphone"))m="ipad"===a?"tablet":"mobile",e=n=a,i=(a=/os ([\d_]+)/.exec(u))?(a=a[1].split("_"),parseFloat(a[0]+"."+a[1])):0,c=1,h()||g()||_()||d()||p()||(r=(a=/mobile\/([\S]+)/.exec(u))?parseFloat(a[1]):0);else if(l.includes("win")){for(a in o={5.1:"xp","6.0":"vista",6.1:"7",6.2:"8",6.3:"8.1","10.0":"10"})if(u.includes("windows nt "+a)){i=o[a];break}n="win",(u.includes("edge")?(u.includes("iemobile")&&(n="winMobile"),e="edge",r=/edge\/([\d]+)/.exec(u)[1]):u.includes("msie")||u.includes("trident")?(u.includes("iemobile")&&(n="winMobile"),e="ie",r=u.includes("msie 7")&&u.includes("trident")?-1:u.includes("msie")?parseFloat(/msie ([\d]+)/.exec(u)[1]):11):void 0)||h()||_()||d()||p()||v()}else l.includes("mac")?(n="mac",a=/os x ([\d._]+)/.exec(u)[1].replace("_",".").split("."),i=parseFloat(a[0]+"."+a[1]),h()||_()||d()||p()||v()):(n=f.includes("x11")?"unix":f.includes("linux")?"linux":0,h()||d()||p());for(a in o={device:m,isMobile:c,browser:e,browserVer:r,os:n,osVer:i,down:c?"touchstart":"mousedown",move:c?"touchmove":"mousemove",up:c?"touchend":"mouseup",click:"click",over:"mouseover",out:"mouseout"})o.hasOwnProperty(a)&&(this[a]=o[a])}}),Oe(this,Ke).call(this),"ie"===this.browser&&(console.table=console.log)}}var Qe=new WeakMap,Ke=new WeakMap;class tr{}function er(t){return new Worker(URL.createObjectURL(new Blob([`(${t})()`],{type:"application/javascript"})))}Ve(tr,"MESH_UNIFORM_POOL_NUM",100),Ve(tr,"GLSL_VERSION","#version 460"),Ve(tr,"MAX_DIRECTIONAL_LIGHT",8),Ve(tr,"MAX_POINT_LIGHT",100),Ve(tr,"MAX_SPOT_LIGHT",1),Ve(tr,"SET_INDEX_ComputeUniforms",0),Ve(tr,"SET_INDEX_SystemUniforms_vertex",0),Ve(tr,"SET_INDEX_SystemUniforms_fragment",1),Ve(tr,"SET_INDEX_MeshUniforms",2),Ve(tr,"SET_INDEX_VertexUniforms",3),Ve(tr,"SET_INDEX_FragmentUniforms",3),Ve(tr,"GLSL_SystemUniforms_vertex",{systemUniforms:`\n\t\tconst float TRUTHY = 1.0;\n\t\tlayout( set =  ${tr.SET_INDEX_SystemUniforms_vertex}, binding = 0 ) uniform SystemUniforms {\n\t        mat4 perspectiveMTX;\n\t        mat4 cameraMTX;\n\t        vec2 resolution;\n\t        float time;\n\t    } systemUniforms;\n\t    `,meshUniforms:`\n\t\tlayout( set = ${tr.SET_INDEX_MeshUniforms}, binding = 0 ) uniform MeshMatrixUniforms {\n\t        mat4 modelMatrix[${tr.MESH_UNIFORM_POOL_NUM}];\n\t        mat4 normalMatrix[${tr.MESH_UNIFORM_POOL_NUM}];\n\t    } meshMatrixUniforms;\n\t    layout( set = ${tr.SET_INDEX_MeshUniforms}, binding = 1 ) uniform MeshUniformIndex {\n\t        float index;\n\t        float mouseColorID;\n\t        float sumOpacity;\n\t    } meshUniforms;\n\t\t`,calcDisplacement:"\n\t\t vec3 calcDisplacement(vec3 vNormal, float displacementFlowSpeedX, float displacementFlowSpeedY, float displacementPower, vec2 targetUV, texture2D targetDisplacementTexture, sampler targetSampler){\n\t\t    return normalize(vNormal) * texture(sampler2D(targetDisplacementTexture, targetSampler), targetUV + vec2(\n\t\t              displacementFlowSpeedX * (systemUniforms.time/1000.0),\n\t\t               displacementFlowSpeedY * (systemUniforms.time/1000.0)\n\t\t          )).x * displacementPower ;\n\t\t }\n\t\t",getSprite3DMatrix:"\n\t\tmat4 getSprite3DMatrix(mat4 cameraMTX, mat4 mvMatrix){\n\t\t\tmat4 tMTX = cameraMTX * mvMatrix;\n\t\t\ttMTX[0][0] = mvMatrix[0][0], tMTX[0][1] = 0.0, tMTX[0][2] = 0.0;\n\t\t\ttMTX[1][0] = 0.0, tMTX[1][1] = mvMatrix[1][1], tMTX[1][2] = 0.0;\n\t\t\ttMTX[2][0] = 0.0, tMTX[2][1] = 0.0, tMTX[2][2] = mvMatrix[2][2];\n\t\t\treturn tMTX;\n\t\t}\n\t\t"}),Ve(tr,"GLSL_SystemUniforms_fragment",{systemUniforms:`\n\t\tconst float TRUTHY = 1.0;\n\t\tconst int MAX_DIRECTIONAL_LIGHT = ${tr.MAX_DIRECTIONAL_LIGHT};\n\t\tconst int MAX_POINT_LIGHT =  ${tr.MAX_POINT_LIGHT};\n\t\tconst int MAX_SPOT_LIGHT =  ${tr.MAX_SPOT_LIGHT};\n\t\tstruct DirectionalLight {\n\t        vec4 color;\n\t        vec3 position;\n\t        float intensity;\n\t\t};\n\t\tstruct PointLight {\n\t        vec4 color;\n\t        vec3 position;\n\t        float intensity;\n\t        float radius;\n\t\t};\n\t\tstruct AmbientLight {\n\t        vec4 color;\n\t        float intensity;\n\t\t};\n\t\tstruct SpotLight {\n\t        vec4 color;\n\t        vec3 position;\n\t        float intensity;\n\t        float cutoff;\n\t        float exponent;\n\t\t};\n\t\tlayout( set =  ${tr.SET_INDEX_SystemUniforms_fragment}, binding = 0 ) uniform SystemUniforms {\n\t        float directionalLightCount;\n\t        float pointLightCount;\n\t        float spotLightCount;\n\t        DirectionalLight directionalLightList[MAX_DIRECTIONAL_LIGHT];\n\t        PointLight pointLightList[MAX_POINT_LIGHT];\n\t        AmbientLight ambientLight;\t        \n\t        SpotLight spotLightList[MAX_SPOT_LIGHT];\n\t        vec3 cameraPosition;\n\t        vec2 resolution;\n        } systemUniforms;\n        /////////////////////////////////////////////////////////////////////////////\n        vec4 la = systemUniforms.ambientLight.color * systemUniforms.ambientLight.intensity;\n        vec4 calcDirectionalLight(\n            vec4 diffuseColor,\n            vec3 N,\t\t\n\t\t\tfloat loopNum,\n\t\t\tDirectionalLight[MAX_DIRECTIONAL_LIGHT] lightList,\n\t\t\tfloat shininess,\n\t\t\tfloat specularPower,\n\t\t\tvec4 specularColor,\n\t\t\tfloat specularTextureValue\n\t\t){\n\t\t    vec4 ld = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t    vec4 ls = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t    \n\t\t    vec3 L;\t\n\t\t    vec4 lightColor;\n\t\t    \n\t\t    float lambertTerm;\n\t\t    float intensity;\n\t\t    float specular;\n\t\t    \t\t    \n\t\t    DirectionalLight lightInfo;\n\t\t    for(int i = 0; i< loopNum; i++){\n\t\t        lightInfo = lightList[i];\n\t\t\t    L = normalize(-lightInfo.position);\t\n\t\t\t    lightColor = lightInfo.color;\n\t\t\t    lambertTerm = dot(N,-L);\n\t\t\t    intensity = lightInfo.intensity;\n\t\t\t    if(lambertTerm > 0.0){\n\t\t\t\t\tld += lightColor * diffuseColor * lambertTerm * intensity;\n\t\t\t\t\tspecular = pow( max(dot(reflect(L, N), -L), 0.0), shininess) * specularPower * specularTextureValue;\n\t\t\t\t\tls +=  specularColor * specular * intensity ;\n\t\t\t    }\n\t\t    }\n\t\t    return ld + ls;\n\t\t}\n\t\t/////////////////////////////////////////////////////////////////////////////\n\t\tvec4 calcPointLight(\n            vec4 diffuseColor,\n            vec3 N,\t\t\n\t\t\tfloat loopNum,\n\t\t\tPointLight[MAX_POINT_LIGHT] lightList,\n\t\t\tfloat shininess,\n\t\t\tfloat specularPower,\n\t\t\tvec4 specularColor,\n\t\t\tfloat specularTextureValue,\n\t\t\tvec3 vVertexPosition\n\t\t){\n\t\t\tvec4 ld = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t    vec4 ls = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t    \n\t\t    vec3 L;\t\n\t\t    vec4 lightColor;\n\t\t    \n\t\t    float lambertTerm;\n\t\t    float intensity;\n\t\t    float specular;\n\t\t  \n\t\t    PointLight lightInfo;\n\t\t    float distanceLength ;\n\t\t    float attenuation;\n\t\t    for(int i = 0; i< loopNum; i++){\n\t\t        lightInfo = lightList[i];\n\t\t        L = -lightInfo.position + vVertexPosition;\n\t\t\t    distanceLength = abs(length(L));\n\t\t\t    if(lightInfo.radius> distanceLength){\n\t\t\t        L = normalize(L);\t\n\t\t\t\t    lightColor = lightInfo.color;\n\t\t\t\t    lambertTerm = dot(N,-L);\n\t\t\t\t    intensity = lightInfo.intensity;\n\t\t\t\t    if(lambertTerm > 0.0){\n\t\t\t\t        attenuation = clamp(1.0 - distanceLength*distanceLength/(lightInfo.radius*lightInfo.radius), 0.0, 1.0); \n\t\t\t            attenuation *= attenuation;\n\t\t\t\t\t\tld += lightColor * diffuseColor * lambertTerm * intensity * attenuation;\n\t\t\t\t\t\tspecular = pow( max(dot(reflect(L, N), -L), 0.0), shininess) * specularPower * specularTextureValue;\n\t\t\t\t\t\tls +=  specularColor * specular * intensity * attenuation ;\n\t\t\t\t    }\n\t\t\t    }\n\t\t    }\n\t\t    return ld + ls;\n\t\t}\n\t\tvec4 calcSpotLight(\n            vec4 diffuseColor,\n            vec3 N,\t\t\n\t\t\tfloat loopNum,\n\t\t\tSpotLight[MAX_SPOT_LIGHT] lightList,\n\t\t\tfloat shininess,\n\t\t\tfloat specularPower,\n\t\t\tvec4 specularColor,\n\t\t\tfloat specularTextureValue,\n\t\t\tvec3 vVertexPosition\n\t\t){\n\t\t\tvec4 ld = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t    vec4 ls = vec4(0.0, 0.0, 0.0, 1.0);\n\t\t    \n\t\t    vec3 L;\t\n\t\t    vec4 lightColor;\n\t\t    \n\t\t    float lambertTerm;\n\t\t    float intensity;\n\t\t    float specular;\n\t\t  \n\t\t    SpotLight lightInfo;\n\t        float distanceLength ;\n\t\t    float attenuation;\n\t\t    for(int i = 0; i< loopNum; i++){\n\t\t        lightInfo = lightList[i];\n\t\t        L = -lightInfo.position + vVertexPosition;\n\t\t\t    distanceLength = abs(length(L));\n\t\t\t    vec3 spotDirection = vec3(0.1,-1,0);\n\t\t\t    L = normalize(L);\t\n\t\t\t    lambertTerm = dot(N,-L);\n\t\t\t\tfloat spotEffect = dot(normalize(spotDirection),L);\n                lightColor = lightInfo.color;\n\t\t        float limit = 10;\n\t\t        float inLight = step(cos(limit * 3.141592653589793/180), spotEffect);\n                float light = inLight * spotEffect;\n\t\t\t    if(lambertTerm > 0 && spotEffect > lightInfo.cutoff ){\t\t\t     \n\t\t\t        if(spotEffect > cos(limit * 3.141592653589793/180) ){\n\t\t\t\t        spotEffect = pow(spotEffect, lightInfo.exponent);\n\t\t                attenuation = spotEffect * light ;\n\t\t\t\t\t    intensity = lightInfo.intensity;\t\t\t\t\t \n\t\t\t\t     \n\t\t\t\t\t\tld += lightColor * diffuseColor * intensity * attenuation;\n\t\t\t\t\t\tspecular = pow( max(dot(reflect(L, N), -L), 0.0), shininess) * specularPower * specularTextureValue;\n\t\t\t\t\t\tls +=  specularColor * specular * intensity * attenuation ;\n\t\t\t\t\t}\n\t\t\t    }\n\t\t    }\n\t\t    return ld + ls;\n\t\t}\n\t\t/////////////////////////////////////////////////////////////////////////////\n\t\tvec3 getFlatNormal(vec3 vertexPosition){\n\t\t\tvec3 dx = dFdx(vertexPosition.xyz);\n\t\t\tvec3 dy = dFdy(vertexPosition.xyz);\n\t\t\treturn normalize(cross(normalize(dy), normalize(dx)));\n\t\t}\n\t\t`,perturb_normal:"\n\t\tvec3 perturb_normal( vec3 N, vec3 V, vec2 texcoord, vec3 normalColor , float normalPower)\n\t\t{\t   \n\t\t\tvec3 map = normalColor;\n\t\t\tmap =  map * 255./127. - 128./127.;\n\t\t\tmap.xy *= -normalPower;\n\t\t\tmat3 TBN = cotangent_frame(N, V, texcoord);\n\t\t\treturn normalize(TBN * map);\n\t\t}\n\t\t",cotangent_frame:"\n\t\tmat3 cotangent_frame(vec3 N, vec3 p, vec2 uv)\n\t\t{\n\t\t\tvec3 dp1 = dFdx( p );\n\t\t\tvec3 dp2 = dFdy( p );\n\t\t\tvec2 duv1 = dFdx( uv );\n\t\t\tvec2 duv2 = dFdy( uv );\n\t\t\t\n\t\t\tvec3 dp2perp = cross( dp2, N );\n\t\t\tvec3 dp1perp = cross( N, dp1 );\n\t\t\tvec3 T = dp2perp * duv1.x + dp1perp * duv2.x;\n\t\t\tvec3 B = dp2perp * duv1.y + dp1perp * duv2.y;\n\t\t\t\n\t\t\tfloat invmax = inversesqrt( max( dot(T,T), dot(B,B) ) );\n\t\t\treturn mat3( T * invmax, B * invmax, N );\n\t\t}\n\t\t"});const rr=er(async()=>{let t=(t=>{let e=function(){let t;return function(e){for(--e,t=1;t<32;t<<=1)e|=e>>t;return e+1}}();return t=>{const r=t.src;let n;fetch(r,{mode:"cors"}).then(t=>{if(n={url:t.url,ok:t.ok,status:t.status,statusText:t.statusText,type:t.type},!t.ok)throw Error("error");t.blob().then(t=>self.createImageBitmap(t)).then(t=>{let n=e(t.width),i=e(t.height);n>1920&&(n=1920),i>1920&&(i=1920);let a=[],o=0,s=Math.round(Math.log2(Math.max(n,i))),u=t=>{const e=new OffscreenCanvas(n,i),l=e.getContext("2d");l.fillStyle="rgba(0,0,0,0)",l.fillRect(0,0,n,i),l.drawImage(t,0,0,n,i);let f,m=l.getImageData(0,0,n,i).data;const c=256*Math.ceil(4*n/256);if(c==4*n)f=m;else{f=new Uint8ClampedArray(c*i);let t=0;for(let e=0;e<i;++e)for(let r=0;r<n;++r){let n=4*r+e*c;f[n]=m[t],f[n+1]=m[t+1],f[n+2]=m[t+2],f[n+3]=m[t+3],t+=4}}a.push({data:f.buffer,width:n,height:i,bytesPerRow:c}),n=Math.max(Math.floor(n/2),1),i=Math.max(Math.floor(i/2),1),o++,o==s+1?self.postMessage({src:r,imageDatas:a,ok:!0}):u(e)};u(t)})}).catch(t=>{self.postMessage({error:n,src:r})})}})();self.addEventListener("message",e=>{t(e.data)})}),nr=er(async()=>{let t=await import("https://unpkg.com/@webgpu/glslang@0.0.15/dist/web-devel/glslang.js"),e=await t.default(),r=(t=>{let e=(t,r)=>{let n,i,a,o,s;if(r>t.length||r<=0)return[];if(r===t.length)return[t];if(1===r){for(a=[],n=0;n<t.length;n++)a.push([t[n]]);return a}for(a=[],n=0;n<t.length-r+1;n++)for(o=t.slice(n,n+1),s=e(t.slice(n+1),r-1),i=0;i<s.length;i++)a.push(o.concat(s[i]));return a};return t=>{let r,n,i,a;for(i=[],r=1;r<=t.length;r++)for(a=e(t,r),n=0;n<a.length;n++)i.push(a[n]);return i}})(),n=async t=>{const n=t.src,i=n.shaderType,a=n.shaderName;let o=n.originSource,s={},u=0;const l=r(n.optionList.sort());let f=t=>{let r=a+"_"+t.join("_");if(!s[r]){s[r]=1;let n=function(t,e){t=JSON.parse(JSON.stringify(t));let r=e.length;for(;r--;){let n=new RegExp(`//#RedGPU#${e[r]}#`,"gi");t=t.replace(n,"")}return t}(o,t),l=e.compileGLSL(n,i);u++,self.postMessage({endCompile:!0,shaderName:a,searchKey:r,compileGLSL:l,shaderType:i})}};l.forEach(t=>{f(t)}),self.postMessage({end:!0,shaderName:a,shaderType:i,totalNum:u})};self.addEventListener("message",t=>{n(t.data)})}),ir=t=>new Promise((e,r)=>{rr.addEventListener("message",(function n(i){i.data.src===t&&(rr.removeEventListener("message",n),i.data.error&&r(i.data.error),e(i.data))})),rr.postMessage({src:t,workerType:"image"})}),ar=(t,e,r,n,i,a)=>new Promise((o,s)=>{nr.addEventListener("message",(function n(a){if(a.data.shaderName===r&&a.data.shaderType===i){if(a.data.endCompile){let r=a.data.searchKey;if(!e.sourceMap.has(r)){e.sourceMap.set(r,a.data.compileGLSL);let n={key:r,code:a.data.compileGLSL};e.shaderModuleMap[r]=t.device.createShaderModule(n)}a.data.error&&s(a.data.error)}a.data.end&&(nr.removeEventListener("message",n),o(a))}})),nr.postMessage({src:{originSource:n,shaderName:r,shaderType:i,optionList:a},workerType:"compileGLSL"})}),or={vertex:{},fragment:{}},sr={vertex:{},fragment:{}};class ur{constructor(t,e,r,n){lr.set(this,{writable:!0,value:void 0}),Ve(this,"type",void 0),Ve(this,"originSource",void 0),Ve(this,"shaderModuleMap",void 0),Ve(this,"sourceMap",void 0),Ve(this,"GPUShaderModule",void 0),Ve(this,"currentKey",void 0);let i=r.name,a=or[e][i];if(a||(or[e][i]=new Map,sr[e][i]={}),Ye(this,lr,t),this.type=e,this.originSource=n,this.sourceMap=or[e][i],this.shaderModuleMap=sr[e][i],!a){let t=r.PROGRAM_OPTION_LIST[e];t.length&&ar(Oe(this,lr),this,i,this.originSource,this.type,t).then(t=>{})}this.searchShaderModule([i])}searchShaderModule(t){t.sort();let e=t.join("_");if(this.currentKey!=e){if(this.currentKey=e,this.shaderModuleMap[e])return this.GPUShaderModule=this.shaderModuleMap[e];{let r;r=this.sourceMap.get(e),r instanceof Uint32Array||r||this.sourceMap.set(e,r=Oe(this,lr).glslang.compileGLSL(function(t,e){t=JSON.parse(JSON.stringify(t));let r=e.length;for(;r--;)t=t.replace(new RegExp(`//#RedGPU#${e[r]}#`,"gi"),"");return t}(this.originSource,t),this.type)),this.shaderModuleDescriptor={key:e,code:r},this.GPUShaderModule=Oe(this,lr).device.createShaderModule(this.shaderModuleDescriptor),this.shaderModuleMap[e]=this.GPUShaderModule}}}}var lr=new WeakMap;class fr{constructor(t){mr.set(this,{writable:!0,value:void 0}),Ve(this,"GPUBindGroup",null),Ye(this,mr,t)}setGPUBindGroup(t){this.GPUBindGroup=Oe(this,mr).device.createBindGroup(t)}}var mr=new WeakMap;const cr=new Map;class hr extends ze{get redGPUContext(){return Oe(this,pr)}set redGPUContext(t){Ye(this,pr,t)}constructor(t){let e,r;super(),Ve(this,"uniformBufferDescriptor_vertex",void 0),Ve(this,"uniformBufferDescriptor_fragment",void 0),Ve(this,"GPUBindGroupLayout",void 0),dr.set(this,{writable:!0,value:!1}),Ve(this,"vShaderModule",void 0),Ve(this,"fShaderModule",void 0),Ve(this,"vertexStage",void 0),Ve(this,"fragmentStage",void 0),Ve(this,"entries",void 0),pr.set(this,{writable:!0,value:void 0}),Ve(this,"uniformBuffer_vertex",void 0),Ve(this,"uniformBuffer_fragment",void 0),Ve(this,"uniformBindGroup_material",void 0),Ve(this,"needResetBindingInfo",!0);let n=this.constructor,i=n.vertexShaderGLSL,a=n.fragmentShaderGLSL;n.PROGRAM_OPTION_LIST;if(r=new ur(t,"fragment",n,a),e=new ur(t,"vertex",n,i),!n.uniformBufferDescriptor_vertex)throw new Error(n.name+" : must define a static uniformBufferDescriptor_vertex.");if(!n.uniformBufferDescriptor_fragment)throw new Error(n.name+" : must define a static uniformBufferDescriptor_fragment.");if(!n.uniformsBindGroupLayoutDescriptor_material)throw new Error(n.name+" : must define a static uniformsBindGroupLayoutDescriptor_material.");this.uniformBufferDescriptor_vertex=new je(n.uniformBufferDescriptor_vertex),this.uniformBufferDescriptor_fragment=new je(n.uniformBufferDescriptor_fragment),this.GPUBindGroupLayout=function(t,e){let r;return(r=cr.get(e))||(r=t.device.createBindGroupLayout(e),cr.set(e,r)),r}(t,n.uniformsBindGroupLayoutDescriptor_material),this.vShaderModule=e,this.fShaderModule=r,this.uniformBuffer_vertex=new fn(t),this.uniformBuffer_vertex.setBuffer(this.uniformBufferDescriptor_vertex),this.uniformBuffer_fragment=new fn(t),this.uniformBuffer_fragment.setBuffer(this.uniformBufferDescriptor_fragment),this.uniformBindGroup_material=new fr(t),Ye(this,pr,t)}updateUniformBuffer(){let t,e,r,n,i,a=new Float32Array(1);for(e=this.uniformBufferDescriptor_vertex.redStruct,r=this.uniformBufferDescriptor_fragment.redStruct,t=e.length>r.length?e.length:r.length;t--;)n=e[t],n&&(i=this[n.valueName],null!=i&&null!=i||qe.throwFunc(`uniformBufferDescriptor_vertex에 올바르지않은 ${n.valueName}가 존재함`),"number"==typeof i?(a[0]=i,i=a):"boolean"==typeof i&&(a[0]=i?1:0,i=a),this.uniformBuffer_vertex.float32Array.set(i,n.offset/Float32Array.BYTES_PER_ELEMENT)),n=r[t],n&&(i=this[n.valueName],null!=i&&null!=i||qe.throwFunc(`uniformBufferDescriptor_fragment에 올바르지않은 ${n.valueName}가 존재함`),"number"==typeof i?(a[0]=i,i=a):"boolean"==typeof i&&(a[0]=i?1:0,i=a),this.uniformBuffer_fragment.float32Array.set(i,n.offset/Float32Array.BYTES_PER_ELEMENT));this.uniformBuffer_vertex.GPUBuffer.setSubData(0,this.uniformBuffer_vertex.float32Array),this.uniformBuffer_fragment.GPUBuffer.setSubData(0,this.uniformBuffer_fragment.float32Array)}checkTexture(t,e){throw new Error(this.constructor.name+" : checkTexture must override!!!")}resetBindingInfo(){throw new Error(this.constructor.name+" : resetBindingInfo must override!!!")}_afterResetBindingInfo(){this.searchModules(),this.setUniformBindGroupDescriptor(),this.uniformBindGroup_material.setGPUBindGroup(this.uniformBindGroupDescriptor),Oe(this,dr)||(this.updateUniformBuffer(),Ye(this,dr,!0)),this.updateUUID()}searchModules(){let t=[this.constructor.name],e=[this.constructor.name],r=0,n=Math.max(this.constructor.PROGRAM_OPTION_LIST.vertex.length,this.constructor.PROGRAM_OPTION_LIST.fragment.length);for(;r<n;r++){let n;n=this.constructor.PROGRAM_OPTION_LIST.vertex[r],n&&this[n]&&t.push(n),n=this.constructor.PROGRAM_OPTION_LIST.fragment[r],n&&this[n]&&e.push(n)}this.vShaderModule.searchShaderModule(t),this.fShaderModule.searchShaderModule(e)}setUniformBindGroupDescriptor(){this.uniformBindGroupDescriptor={layout:this.GPUBindGroupLayout,entries:this.entries}}}var dr=new WeakMap,pr=new WeakMap;Ve(hr,"uniformBufferDescriptor_empty",[]);let vr=new Float32Array(1);const _r=(t,...e)=>[t,...e].reduce((t,e)=>e(t)),gr=function(t){return e=>class extends e{constructor(...e){super(...e),Ve(this,"_"+t,null),Ve(this,`__${t}RenderYn`,0)}set[t](e){this.checkTexture(e,t)}get[t](){return this["_"+t]}}},xr=gr("diffuseTexture"),yr=gr("normalTexture"),Sr=gr("specularTexture"),Tr=gr("emissiveTexture"),Ur=gr("environmentTexture"),br=gr("refractionTexture"),Mr=gr("displacementTexture"),Pr=gr("roughnessTexture"),wr=gr("occlusionTexture");var Er={mix:_r,EmptyClass:class{},color:t=>{var e,r,n;return e=class extends t{constructor(...t){super(...t),r.set(this,{writable:!0,value:"#ff0000"}),n.set(this,{writable:!0,value:1}),Ve(this,"_colorRGBA",new Float32Array([1,0,0,Oe(this,n)]))}get color(){return Oe(this,r)}set color(t){Ye(this,r,t);let e=qe.hexToRGB_ZeroToOne(t);this._colorRGBA[0]=e[0]*Oe(this,n),this._colorRGBA[1]=e[1]*Oe(this,n),this._colorRGBA[2]=e[2]*Oe(this,n),this._colorRGBA[3]=Oe(this,n),this.uniformBuffer_fragment&&this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.colorRGBA,this._colorRGBA)}get colorAlpha(){return Oe(this,n)}set colorAlpha(t){let e=qe.hexToRGB_ZeroToOne(Oe(this,r));this._colorRGBA[0]=e[0]*t,this._colorRGBA[1]=e[1]*t,this._colorRGBA[2]=e[2]*t,this._colorRGBA[3]=t,Ye(this,n,t),this.uniformBuffer_fragment&&this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.colorRGBA,this._colorRGBA)}get colorRGBA(){return this._colorRGBA}},r=new WeakMap,n=new WeakMap,e},alpha:t=>{var e,r;return e=class extends t{constructor(...t){super(...t),r.set(this,{writable:!0,value:1})}get alpha(){return Oe(this,r)}set alpha(t){Ye(this,r,t),vr[0]=Oe(this,r),this.uniformBuffer_fragment&&this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.alpha,vr)}},r=new WeakMap,e},defineNumber:function(t,e={}){let r,n=e.hasOwnProperty("min"),i=e.hasOwnProperty("max"),a=e.min,o=e.max;return r=r=>{var s,u;return s=class extends r{constructor(...r){super(...r),u.set(this,{writable:!0,value:{min:a,max:o}}),Ve(this,"#"+t,e.value)}set[t](r){this["#"+t]=null,"number"!=typeof r&&qe.throwFunc(`${t} : only allow Number. - inputValue : ${r} { type : ${typeof r} }`),n&&r<a&&(r=a),i&&r>o&&(r=o),this["#"+t]=r,e.callback&&e.callback.call(this,r)}get[t](){return this["#"+t]}},u=new WeakMap,s},r},diffuseTexture:xr,normalTexture:yr,specularTexture:Sr,emissiveTexture:t=>{let e=class extends t{constructor(...t){super(...t),Ve(this,"_emissivePower",1)}get emissivePower(){return this._emissivePower}set emissivePower(t){this._emissivePower=t,vr[0]=this._emissivePower,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.emissivePower,vr)}};return _r(e,Tr)},environmentTexture:t=>{let e=class extends t{constructor(...t){super(...t),Ve(this,"_environmentPower",1)}get environmentPower(){return this._environmentPower}set environmentPower(t){this._environmentPower=t,vr[0]=this._environmentPower,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.environmentPower,vr)}};return _r(e,Ur)},refractionTexture:t=>{let e=class extends t{constructor(...t){super(...t),Ve(this,"_refractionPower",1),Ve(this,"_refractionRatio",.95)}get refractionPower(){return this._refractionPower}set refractionPower(t){this._refractionPower=t,vr[0]=this._refractionPower,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.refractionPower,vr)}get refractionRatio(){return this._refractionRatio}set refractionRatio(t){this._refractionRatio=t,vr[0]=this._refractionRatio,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.refractionRatio,vr)}};return _r(e,br)},displacementTexture:t=>{let e=class extends t{constructor(...t){super(...t),Ve(this,"_displacementFlowSpeedX",0),Ve(this,"_displacementFlowSpeedY",0),Ve(this,"_displacementPower",.1)}get displacementFlowSpeedY(){return this._displacementFlowSpeedY}set displacementFlowSpeedY(t){this._displacementFlowSpeedY=t,vr[0]=this._displacementFlowSpeedY,this.uniformBuffer_vertex.GPUBuffer.setSubData(this.uniformBufferDescriptor_vertex.redStructOffsetMap.displacementFlowSpeedY,vr)}get displacementFlowSpeedX(){return this._displacementFlowSpeedX}set displacementFlowSpeedX(t){this._displacementFlowSpeedX=t,vr[0]=this._displacementFlowSpeedX,this.uniformBuffer_vertex.GPUBuffer.setSubData(this.uniformBufferDescriptor_vertex.redStructOffsetMap.displacementFlowSpeedX,vr)}get displacementPower(){return this._displacementPower}set displacementPower(t){this._displacementPower=t,vr[0]=this._displacementPower,this.uniformBuffer_vertex.GPUBuffer.setSubData(this.uniformBufferDescriptor_vertex.redStructOffsetMap.displacementPower,vr)}};return _r(e,Mr)},roughnessTextureGLTF:t=>{let e=class extends t{constructor(...t){super(...t),Ve(this,"_roughnessTexCoordIndex",0),Ve(this,"_roughnessFactor",1)}set roughnessTexture(t){this.checkTexture(t,"roughnessTexture")}get roughnessTexture(){return this._roughnessTexture}get roughnessTexCoordIndex(){return this._roughnessTexCoordIndex}set roughnessTexCoordIndex(t){this._roughnessTexCoordIndex=t,vr[0]=t,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.roughnessTexCoordIndex,vr)}get roughnessFactor(){return this._roughnessFactor}set roughnessFactor(t){this._roughnessFactor=t,vr[0]=t,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.roughnessFactor,vr)}};return _r(e,Pr)},occlusionTextureGLTF:t=>{let e=class extends t{constructor(...t){super(...t),Ve(this,"_occlusionTexCoordIndex",0),Ve(this,"_occlusionPower",1)}set occlusionTexture(t){this.checkTexture(t,"occlusionTexture")}get occlusionTexture(){return this._occlusionTexture}get occlusionTexCoordIndex(){return this._occlusionTexCoordIndex}set occlusionTexCoordIndex(t){this._occlusionTexCoordIndex=t,vr[0]=t,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.occlusionTexCoordIndex,vr)}get occlusionPower(){return this._occlusionPower}set occlusionPower(t){this._occlusionPower=t,vr[0]=t,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.occlusionPower,vr)}};return _r(e,wr)},basicLightPropertys:t=>class extends t{constructor(...t){super(...t),Ve(this,"_normalPower",1),Ve(this,"_shininess",32),Ve(this,"_specularPower",1),Ve(this,"_specularColor","#ffffff"),Ve(this,"_specularColorRGBA",new Float32Array([1,1,1,1])),Ve(this,"_useFlatMode",!1)}get normalPower(){return this._normalPower}set normalPower(t){this._normalPower=t,vr[0]=this._normalPower,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.normalPower,vr)}get shininess(){return this._shininess}set shininess(t){this._shininess=t,vr[0]=this._shininess,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.shininess,vr)}get specularPower(){return this._specularPower}set specularPower(t){this._specularPower=t,vr[0]=this._specularPower,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.specularPower,vr)}get specularColor(){return this._specularColor}set specularColor(t){this._specularColor=t;let e=qe.hexToRGB_ZeroToOne(t);this._specularColorRGBA[0]=e[0],this._specularColorRGBA[1]=e[1],this._specularColorRGBA[2]=e[2],this._specularColorRGBA[3]=1,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.specularColorRGBA,this._specularColorRGBA)}get specularColorRGBA(){return this._specularColorRGBA}get useFlatMode(){return this._useFlatMode}set useFlatMode(t){this._useFlatMode=t,vr[0]=t?1:0,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.useFlatMode,vr)}}};let Gr=new Float32Array(1);class Dr extends(Er.mix(hr,Er.diffuseTexture,Er.normalTexture,Er.specularTexture,Er.emissiveTexture,Er.displacementTexture,Er.basicLightPropertys,Er.alpha)){constructor(t,e,r,n,i,a){super(t),Lr.set(this,{writable:!0,value:void 0}),this.diffuseTexture=e,this.normalTexture=r,this.emissiveTexture=i,this.specularTexture=n,this.displacementTexture=a,this.needResetBindingInfo=!0}checkTexture(t,e){if(t)if(t._GPUTexture){let r;switch(e){case"diffuseTexture":this._diffuseTexture=t,r=e;break;case"normalTexture":this._normalTexture=t,r=e;break;case"specularTexture":this._specularTexture=t,r=e;break;case"emissiveTexture":this._emissiveTexture=t,r=e;break;case"displacementTexture":this._displacementTexture=t,r=e}r&&(Gr[0]=this[`__${e}RenderYn`]=1,"displacementTexture"==r?this.uniformBuffer_vertex.GPUBuffer.setSubData(this.uniformBufferDescriptor_vertex.redStructOffsetMap[`__${e}RenderYn`],Gr):this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap[`__${e}RenderYn`],Gr)),this.needResetBindingInfo=!0}else t.addUpdateTarget(this,e);else this["_"+e]&&(this["_"+e]=null,Gr[0]=this[`__${e}RenderYn`]=0,"displacementTexture"==e?this.uniformBuffer_vertex.GPUBuffer.setSubData(this.uniformBufferDescriptor_vertex.redStructOffsetMap[`__${e}RenderYn`],Gr):this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap[`__${e}RenderYn`],Gr),this.needResetBindingInfo=!0)}resetBindingInfo(){this.entries=[{binding:0,resource:{buffer:this.uniformBuffer_vertex.GPUBuffer,offset:0,size:this.uniformBufferDescriptor_vertex.size}},{binding:1,resource:this._displacementTexture?this._displacementTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:2,resource:this._displacementTexture?this._displacementTexture._GPUTextureView:this.redGPUContext.state.emptyTextureView},{binding:3,resource:{buffer:this.uniformBuffer_fragment.GPUBuffer,offset:0,size:this.uniformBufferDescriptor_fragment.size}},{binding:4,resource:this._diffuseTexture?this._diffuseTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:5,resource:this._diffuseTexture?this._diffuseTexture._GPUTextureView:this.redGPUContext.state.emptyTextureView},{binding:6,resource:this._normalTexture?this._normalTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:7,resource:this._normalTexture?this._normalTexture._GPUTextureView:this.redGPUContext.state.emptyTextureView},{binding:8,resource:this._specularTexture?this._specularTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:9,resource:this._specularTexture?this._specularTexture._GPUTextureView:this.redGPUContext.state.emptyTextureView},{binding:10,resource:this._emissiveTexture?this._emissiveTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:11,resource:this._emissiveTexture?this._emissiveTexture._GPUTextureView:this.redGPUContext.state.emptyTextureView}],this._afterResetBindingInfo()}}var Lr=new WeakMap;Ve(Dr,"vertexShaderGLSL",`\n\t${tr.GLSL_VERSION}\n    ${tr.GLSL_SystemUniforms_vertex.systemUniforms}\n    ${tr.GLSL_SystemUniforms_vertex.calcDisplacement}    \n    ${tr.GLSL_SystemUniforms_vertex.meshUniforms}\n         \n\tlayout( location = 0 ) in vec3 position;\n\tlayout( location = 1 ) in vec3 normal;\n\tlayout( location = 2 ) in vec2 uv;\n\tlayout( location = 0 ) out vec3 vNormal;\n\tlayout( location = 1 ) out vec2 vUV;\n\tlayout( location = 2 ) out vec4 vVertexPosition;\t\n\tlayout( location = 3 ) out float vMouseColorID;\t\n\tlayout( location = 4 ) out float vSumOpacity;\n\tlayout( set = ${tr.SET_INDEX_VertexUniforms}, binding = 0 ) uniform VertexUniforms {\n        float displacementFlowSpeedX;\n        float displacementFlowSpeedY;\n        float displacementPower;\n        float __displacementTextureRenderYn;\n    } vertexUniforms;\n\t\n\tlayout( set = ${tr.SET_INDEX_VertexUniforms}, binding = 1 ) uniform sampler uSampler;\n\tlayout( set = ${tr.SET_INDEX_VertexUniforms}, binding = 2 ) uniform texture2D uDisplacementTexture;\n\tvoid main() {\t\t\n\t\tvVertexPosition = meshMatrixUniforms.modelMatrix[ int(meshUniforms.index) ] * vec4(position, 1.0);\n\t\tvNormal = (meshMatrixUniforms.normalMatrix[ int(meshUniforms.index) ] * vec4(normal,1.0)).xyz;\n\t\tvUV = uv;\n\t\tvMouseColorID = meshUniforms.mouseColorID;\n\t\tvSumOpacity = meshUniforms.sumOpacity;\n\t\tif(vertexUniforms.__displacementTextureRenderYn == TRUTHY) vVertexPosition.xyz += calcDisplacement(vNormal, vertexUniforms.displacementFlowSpeedX, vertexUniforms.displacementFlowSpeedY, vertexUniforms.displacementPower, uv, uDisplacementTexture, uSampler);\n\t\tgl_Position = systemUniforms.perspectiveMTX * systemUniforms.cameraMTX * vVertexPosition;\n\t\n\t\n\t}\n\t`),Ve(Dr,"fragmentShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_fragment.systemUniforms}\n\t${tr.GLSL_SystemUniforms_fragment.cotangent_frame}\n\t${tr.GLSL_SystemUniforms_fragment.perturb_normal}\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 3 ) uniform FragmentUniforms {\n        float normalPower;\n        float shininess; \n        float specularPower;\n\t    vec4 specularColor;\n\t    float emissivePower;\n\t    float alpha;\n\t    float useFlatMode;\n\t    //\n\t    float __diffuseTextureRenderYn;\n\t\tfloat __normalTextureRenderYn;\n\t\tfloat __specularTextureRenderYn;\n\t\tfloat __emissiveTextureRenderYn;\n    } fragmentUniforms;\n\n\tlayout( location = 0 ) in vec3 vNormal;\n\tlayout( location = 1 ) in vec2 vUV;\n\tlayout( location = 2 ) in vec4 vVertexPosition;\n\tlayout( location = 3 ) in float vMouseColorID;\t\n\tlayout( location = 4 ) in float vSumOpacity;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 4 ) uniform sampler uDiffuseSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 5 ) uniform texture2D uDiffuseTexture;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 6 ) uniform sampler uNormalSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 7 ) uniform texture2D uNormalTexture;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 8 ) uniform sampler uSpecularSampler;\t\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 9 ) uniform texture2D uSpecularTexture;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 10 ) uniform sampler uEmissiveSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 11 ) uniform texture2D uEmissiveTexture;\n\tlayout( location = 0 ) out vec4 outColor;\n\t\n\tlayout( location = 1 ) out vec4 out_MouseColorID_Depth;\n\n\tvoid main() {\n\t\tfloat testAlpha = 0.0;\n\t\tvec4 diffuseColor = vec4(0.0);\n\t\tif(fragmentUniforms.__diffuseTextureRenderYn == TRUTHY) diffuseColor = texture(sampler2D(uDiffuseTexture, uDiffuseSampler), vUV) ;\n\t\t\n\t\t\n\t    vec3 N = normalize(vNormal);\n\t\tvec4 normalColor = vec4(0.0);\n\t\tif(fragmentUniforms.__normalTextureRenderYn == TRUTHY) normalColor = texture(sampler2D(uNormalTexture, uNormalSampler), vUV) ;\n\t\tif(fragmentUniforms.useFlatMode == TRUTHY) N = getFlatNormal(vVertexPosition.xyz);\n\t\tif(fragmentUniforms.__normalTextureRenderYn == TRUTHY) N = perturb_normal(N, vVertexPosition.xyz, vUV, normalColor.rgb, fragmentUniforms.normalPower) ;\n\t\n\t\ttestAlpha = diffuseColor.a;\n\t\n\t\tfloat specularTextureValue = 1.0;\n\t\tif(fragmentUniforms.__specularTextureRenderYn == TRUTHY) specularTextureValue = texture(sampler2D(uSpecularTexture, uSpecularSampler), vUV).r ;\n\t\t\n\t\tvec4 finalColor = \n\t\tcalcDirectionalLight(\n\t\t\tdiffuseColor,\n\t\t\tN,\t\t\n\t\t\tsystemUniforms.directionalLightCount,\n\t\t\tsystemUniforms.directionalLightList,\n\t\t\tfragmentUniforms.shininess,\n\t\t\tfragmentUniforms.specularPower,\n\t\t\tfragmentUniforms.specularColor,\n\t\t\tspecularTextureValue\n\t\t)\n\t\t+\n\t\tcalcPointLight(\n\t\t\tdiffuseColor,\n\t\t\tN,\t\t\n\t\t\tsystemUniforms.pointLightCount,\n\t\t\tsystemUniforms.pointLightList,\n\t\t\tfragmentUniforms.shininess,\n\t\t\tfragmentUniforms.specularPower,\n\t\t\tfragmentUniforms.specularColor,\n\t\t\tspecularTextureValue,\n\t\t\tvVertexPosition.xyz\n\t\t)\n\t\t+ la;\n\t\t\n\t\tif(fragmentUniforms.__emissiveTextureRenderYn == TRUTHY) {\n\t\t\tvec4 emissiveColor = texture(sampler2D(uEmissiveTexture, uEmissiveSampler), vUV);\n\t\t\tfinalColor.rgb += emissiveColor.rgb * fragmentUniforms.emissivePower;\n\t\t}\n\t\t\n\t\tfinalColor.a = testAlpha;\n\t\toutColor = finalColor;\n\t\toutColor.a *= fragmentUniforms.alpha * vSumOpacity;\n\t\tout_MouseColorID_Depth = vec4(vMouseColorID, gl_FragCoord.z/gl_FragCoord.w, 0.0, 0.0);\n\t\t\n\t}\n`),Ve(Dr,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(Dr,"uniformsBindGroupLayoutDescriptor_material",{entries:[{binding:0,visibility:GPUShaderStage.VERTEX,type:"uniform-buffer"},{binding:1,visibility:GPUShaderStage.VERTEX,type:"sampler"},{binding:2,visibility:GPUShaderStage.VERTEX,type:"sampled-texture"},{binding:3,visibility:GPUShaderStage.FRAGMENT,type:"uniform-buffer"},{binding:4,visibility:GPUShaderStage.FRAGMENT,type:"sampler"},{binding:5,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture"},{binding:6,visibility:GPUShaderStage.FRAGMENT,type:"sampler"},{binding:7,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture"},{binding:8,visibility:GPUShaderStage.FRAGMENT,type:"sampler"},{binding:9,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture"},{binding:10,visibility:GPUShaderStage.FRAGMENT,type:"sampler"},{binding:11,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture"}]}),Ve(Dr,"uniformBufferDescriptor_vertex",[{size:$e.float,valueName:"displacementFlowSpeedX"},{size:$e.float,valueName:"displacementFlowSpeedY"},{size:$e.float,valueName:"displacementPower"},{size:$e.float,valueName:"__displacementTextureRenderYn"}]),Ve(Dr,"uniformBufferDescriptor_fragment",[{size:$e.float,valueName:"normalPower"},{size:$e.float,valueName:"shininess"},{size:$e.float,valueName:"specularPower"},{size:$e.float4,valueName:"specularColorRGBA"},{size:$e.float,valueName:"emissivePower"},{size:$e.float,valueName:"alpha"},{size:$e.float,valueName:"useFlatMode"},{size:$e.float,valueName:"__diffuseTextureRenderYn"},{size:$e.float,valueName:"__normalTextureRenderYn"},{size:$e.float,valueName:"__specularTextureRenderYn"},{size:$e.float,valueName:"__emissiveTextureRenderYn"}]);class Br extends(Er.mix(hr,Er.color,Er.alpha)){constructor(t,e="#ff0000",r=1){super(t),this.color=e,this.colorAlpha=r,this.needResetBindingInfo=!0}resetBindingInfo(){this.entries=[{binding:0,resource:{buffer:this.uniformBuffer_fragment.GPUBuffer,offset:0,size:this.uniformBufferDescriptor_fragment.size}}],this._afterResetBindingInfo()}}Ve(Br,"vertexShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_vertex.systemUniforms}\n\t${tr.GLSL_SystemUniforms_vertex.meshUniforms}\n\tlayout( location = 0 ) in vec3 position;\n\tlayout( location = 1 ) in vec3 normal;\n\tlayout( location = 0 ) out float vMouseColorID;\t\n\tlayout( location = 1 ) out float vSumOpacity;\n\tvoid main() {\n\t\tvMouseColorID = meshUniforms.mouseColorID;\n\t\tvSumOpacity = meshUniforms.sumOpacity;\n\t\tgl_Position = systemUniforms.perspectiveMTX * systemUniforms.cameraMTX * meshMatrixUniforms.modelMatrix[ int(meshUniforms.index) ] * vec4(position,1.0);\n\t\n\t}\n\t`),Ve(Br,"fragmentShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_fragment.systemUniforms}\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 0 ) uniform FragmentUniforms {\n        vec4 color;\n        float alpha;\n    } fragmentUniforms;\n\tlayout( location = 0 ) in float vMouseColorID;\n\tlayout( location = 1 ) in float vSumOpacity;\n\tlayout( location = 0 ) out vec4 outColor;\n\tlayout( location = 1 ) out vec4 out_MouseColorID_Depth;\n\n\tvoid main() {\n\t\toutColor = fragmentUniforms.color;\n\t\toutColor.a *= vSumOpacity;\n\t\toutColor.a *= fragmentUniforms.alpha;\t\n\t\tout_MouseColorID_Depth = vec4(vMouseColorID, gl_FragCoord.z/gl_FragCoord.w, 0.0, 0.0);\n\t\t\n\t}\n\t`),Ve(Br,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(Br,"uniformsBindGroupLayoutDescriptor_material",{entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,type:"uniform-buffer"}]}),Ve(Br,"uniformBufferDescriptor_vertex",hr.uniformBufferDescriptor_empty),Ve(Br,"uniformBufferDescriptor_fragment",[{size:$e.float4,valueName:"colorRGBA"},{size:$e.float,valueName:"alpha"}]);class Rr extends(Er.mix(hr,Er.color,Er.alpha,Er.basicLightPropertys)){constructor(t,e="#ff0000",r=1){super(t),this.color=e,this.colorAlpha=r,this.needResetBindingInfo=!0}resetBindingInfo(){this.entries=[{binding:0,resource:{buffer:this.uniformBuffer_fragment.GPUBuffer,offset:0,size:this.uniformBufferDescriptor_fragment.size}}],this._afterResetBindingInfo()}}Ve(Rr,"vertexShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_vertex.systemUniforms}\n\t${tr.GLSL_SystemUniforms_vertex.meshUniforms}\n\tlayout( location = 0 ) in vec3 position;\n\tlayout( location = 1 ) in vec3 normal;\n\tlayout( location = 0 ) out vec3 vNormal;\n\tlayout( location = 1 ) out vec4 vVertexPosition;\n\tlayout( location = 2 ) out float vMouseColorID;\n\tlayout( location = 3 ) out float vSumOpacity;\n\tvoid main() {\n\t\tvVertexPosition = meshMatrixUniforms.modelMatrix[ int(meshUniforms.index) ] * vec4(position,1.0);\n\t\tvNormal = (meshMatrixUniforms.normalMatrix[ int(meshUniforms.index) ] * vec4(normal,1.0)).xyz;\n\t\tvMouseColorID = meshUniforms.mouseColorID;\n\t\tvSumOpacity = meshUniforms.sumOpacity;\n\t\tgl_Position = systemUniforms.perspectiveMTX * systemUniforms.cameraMTX * vVertexPosition;\n\t}\n\t`),Ve(Rr,"fragmentShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_fragment.systemUniforms}\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 0 ) uniform FragmentUniforms {\n        vec4 color;\n        float shininess; \n        float specularPower;\n\t    vec4 specularColor;\n        float alpha;\n        float useFlatMode;\n    } fragmentUniforms;\n\tlayout( location = 0 ) in vec3 vNormal;\n\tlayout( location = 1 ) in vec4 vVertexPosition;\n\tlayout( location = 2 ) in float vMouseColorID;\t\n\tlayout( location = 3 ) in float vSumOpacity;\n\tlayout( location = 0 ) out vec4 outColor;\t\n\tlayout( location = 1 ) out vec4 out_MouseColorID_Depth;\n\tvoid main() {\n\t\tfloat testAlpha = fragmentUniforms.color.a * vSumOpacity;\n\n\t\tvec3 N = normalize(vNormal);\n\t\tif(fragmentUniforms.useFlatMode == TRUTHY) N = getFlatNormal(vVertexPosition.xyz);\n\n\t\tfloat specularTextureValue = 1.0;\n\t\t\n\t\tvec4 finalColor = \n\t\tcalcDirectionalLight(\n\t\t\tfragmentUniforms.color,\n\t\t\tN,\t\t\n\t\t\tsystemUniforms.directionalLightCount,\n\t\t\tsystemUniforms.directionalLightList,\n\t\t\tfragmentUniforms.shininess,\n\t\t\tfragmentUniforms.specularPower,\n\t\t\tfragmentUniforms.specularColor,\n\t\t\tspecularTextureValue\n\t\t)\n\t\t+\n\t    calcPointLight(\n\t\t\tfragmentUniforms.color,\n\t\t\tN,\t\t\n\t\t\tsystemUniforms.pointLightCount,\n\t\t\tsystemUniforms.pointLightList,\n\t\t\tfragmentUniforms.shininess,\n\t\t\tfragmentUniforms.specularPower,\n\t\t\tfragmentUniforms.specularColor,\n\t\t\tspecularTextureValue,\n\t\t\tvVertexPosition.xyz\n\t\t)\n\t\t+ la;\n\t\t\t\n\t\tfinalColor.a = testAlpha;\n\t\toutColor = finalColor;\n\t\toutColor.a *= fragmentUniforms.alpha;\n\t\tout_MouseColorID_Depth = vec4(vMouseColorID, gl_FragCoord.z/gl_FragCoord.w, 0.0, 0.0);\n\t\t\n\t}\n`),Ve(Rr,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(Rr,"uniformsBindGroupLayoutDescriptor_material",{entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,type:"uniform-buffer"}]}),Ve(Rr,"uniformBufferDescriptor_vertex",hr.uniformBufferDescriptor_empty),Ve(Rr,"uniformBufferDescriptor_fragment",[{size:$e.float4,valueName:"colorRGBA"},{size:$e.float,valueName:"shininess"},{size:$e.float,valueName:"specularPower"},{size:$e.float4,valueName:"specularColorRGBA"},{size:$e.float,valueName:"alpha"},{size:$e.float,valueName:"useFlatMode"}]);let Cr=new Float32Array(1);class Ir extends(Er.mix(hr,Er.color,Er.alpha,Er.normalTexture,Er.specularTexture,Er.emissiveTexture,Er.displacementTexture,Er.basicLightPropertys)){constructor(t,e="#ff0000",r=1,n,i,a,o){super(t),Nr.set(this,{writable:!0,value:void 0}),this.color=e,this.colorAlpha=r,this.normalTexture=n,this.specularTexture=i,this.emissiveTexture=a,this.displacementTexture=o,this.needResetBindingInfo=!0}checkTexture(t,e){if(t)if(t._GPUTexture){let r;switch(e){case"normalTexture":this._normalTexture=t,r=e;break;case"specularTexture":this._specularTexture=t,r=e;break;case"emissiveTexture":this._emissiveTexture=t,r=e;break;case"displacementTexture":this._displacementTexture=t,r=e}r&&(Cr[0]=this[`__${e}RenderYn`]=1,"displacementTexture"==r?this.uniformBuffer_vertex.GPUBuffer.setSubData(this.uniformBufferDescriptor_vertex.redStructOffsetMap[`__${e}RenderYn`],Cr):this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap[`__${e}RenderYn`],Cr)),this.needResetBindingInfo=!0}else t.addUpdateTarget(this,e);else this["_"+e]&&(this["_"+e]=null,Cr[0]=this[`__${e}RenderYn`]=0,"displacementTexture"==e?this.uniformBuffer_vertex.GPUBuffer.setSubData(this.uniformBufferDescriptor_vertex.redStructOffsetMap[`__${e}RenderYn`],Cr):this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap[`__${e}RenderYn`],Cr),this.needResetBindingInfo=!0)}resetBindingInfo(){this.entries=[{binding:0,resource:{buffer:this.uniformBuffer_vertex.GPUBuffer,offset:0,size:this.uniformBufferDescriptor_vertex.size}},{binding:1,resource:this._displacementTexture?this._displacementTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:2,resource:this._displacementTexture?this._displacementTexture._GPUTextureView:this.redGPUContext.state.emptyTextureView},{binding:3,resource:{buffer:this.uniformBuffer_fragment.GPUBuffer,offset:0,size:this.uniformBufferDescriptor_fragment.size}},{binding:4,resource:this._normalTexture?this._normalTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:5,resource:this._normalTexture?this._normalTexture._GPUTextureView:this.redGPUContext.state.emptyTextureView},{binding:6,resource:this._specularTexture?this._specularTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:7,resource:this._specularTexture?this._specularTexture._GPUTextureView:this.redGPUContext.state.emptyTextureView},{binding:8,resource:this._emissiveTexture?this._emissiveTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:9,resource:this._emissiveTexture?this._emissiveTexture._GPUTextureView:this.redGPUContext.state.emptyTextureView}],this._afterResetBindingInfo()}}var Nr=new WeakMap;Ve(Ir,"vertexShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_vertex.systemUniforms}\n    ${tr.GLSL_SystemUniforms_vertex.calcDisplacement}    \n    ${tr.GLSL_SystemUniforms_vertex.meshUniforms}\n\tlayout( location = 0 ) in vec3 position;\n\tlayout( location = 1 ) in vec3 normal;\n\tlayout( location = 2 ) in vec2 uv;\n\tlayout( location = 0 ) out vec3 vNormal;\n\tlayout( location = 1 ) out vec2 vUV;\n\tlayout( location = 2 ) out vec4 vVertexPosition;\n\tlayout( location = 3 ) out float vMouseColorID;\t\n\tlayout( location = 4 ) out float vSumOpacity;\n\tlayout( set = ${tr.SET_INDEX_VertexUniforms}, binding = 0 ) uniform VertexUniforms {\n        float displacementFlowSpeedX;\n        float displacementFlowSpeedY;\n        float displacementPower;\n        float __displacementTextureRenderYn;\n    } vertexUniforms;\n    \n    layout( set = ${tr.SET_INDEX_VertexUniforms}, binding = 1 ) uniform sampler uSampler;\n\tlayout( set = ${tr.SET_INDEX_VertexUniforms}, binding = 2) uniform texture2D uDisplacementTexture;\n\tvoid main() {\n\t\tvVertexPosition = meshMatrixUniforms.modelMatrix[ int(meshUniforms.index) ] * vec4(position,1.0);\n\t\tvNormal = (meshMatrixUniforms.normalMatrix[ int(meshUniforms.index) ] * vec4(normal,1.0)).xyz;\n\t\tvUV = uv;\n\t\tvMouseColorID = meshUniforms.mouseColorID;\n\t\tvSumOpacity = meshUniforms.sumOpacity;\n\t\tif(vertexUniforms.__displacementTextureRenderYn == TRUTHY)  vVertexPosition.xyz += calcDisplacement(vNormal, vertexUniforms.displacementFlowSpeedX, vertexUniforms.displacementFlowSpeedY, vertexUniforms.displacementPower, uv, uDisplacementTexture, uSampler);\n\t\tgl_Position = systemUniforms.perspectiveMTX * systemUniforms.cameraMTX * vVertexPosition;\n\t}\n\t`),Ve(Ir,"fragmentShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_fragment.systemUniforms}\n\t${tr.GLSL_SystemUniforms_fragment.cotangent_frame}\n\t${tr.GLSL_SystemUniforms_fragment.perturb_normal}\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 3 ) uniform FragmentUniforms {\n        vec4 color;\n        float normalPower;\n        float shininess; \n        float specularPower;\n\t    vec4 specularColor;\n\t    float emissivePower;\n\t    float alpha;\n\t    float useFlatMode;\n\t    //\n\t\tfloat __normalTextureRenderYn;\n\t\tfloat __specularTextureRenderYn;\n\t\tfloat __emissiveTextureRenderYn;\n    } fragmentUniforms;\n\tlayout( location = 0 ) in vec3 vNormal;\n\tlayout( location = 1 ) in vec2 vUV;\n\tlayout( location = 2 ) in vec4 vVertexPosition;\n\tlayout( location = 3 ) in float vMouseColorID;\t\n\tlayout( location = 4 ) in float vSumOpacity;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 4 ) uniform sampler uNormalSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 5 ) uniform texture2D uNormalTexture;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 6 ) uniform sampler uSpecularSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 7 ) uniform texture2D uSpecularTexture;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 8 ) uniform sampler uEmissiveSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 9 ) uniform texture2D uEmissiveTexture;\n\tlayout( location = 0 ) out vec4 outColor;\n\t\n\tlayout( location = 1 ) out vec4 out_MouseColorID_Depth;\n\t\n\tvoid main() {\n\t\tfloat testAlpha = fragmentUniforms.color.a * vSumOpacity;\n\t\t\n\t\tvec3 N = normalize(vNormal);\n\t\tvec4 normalColor = vec4(0.0);\n\t\tif(fragmentUniforms.__normalTextureRenderYn == TRUTHY) normalColor = texture(sampler2D(uNormalTexture, uNormalSampler), vUV) ;\n\t\tif(fragmentUniforms.useFlatMode == TRUTHY) N = getFlatNormal(vVertexPosition.xyz);\n\t\tif(fragmentUniforms.__normalTextureRenderYn == TRUTHY) N = perturb_normal(N, vVertexPosition.xyz, vUV, normalColor.rgb, fragmentUniforms.normalPower) ;\n\t\t\n\t\tfloat specularTextureValue = 1.0;\n\t\tif(fragmentUniforms.__specularTextureRenderYn == TRUTHY) specularTextureValue = texture(sampler2D(uSpecularTexture, uSpecularSampler), vUV).r ;\n\t\t\n\t\tvec4 finalColor = \n\t\tcalcDirectionalLight(\n\t\t\tfragmentUniforms.color,\n\t\t\tN,\t\t\n\t\t\tsystemUniforms.directionalLightCount,\n\t\t\tsystemUniforms.directionalLightList,\n\t\t\tfragmentUniforms.shininess,\n\t\t\tfragmentUniforms.specularPower,\n\t\t\tfragmentUniforms.specularColor,\n\t\t\tspecularTextureValue\n\t\t)\n\t    +\n\t    calcPointLight(\n\t\t\tfragmentUniforms.color,\n\t\t\tN,\t\t\n\t\t\tsystemUniforms.pointLightCount,\n\t\t\tsystemUniforms.pointLightList,\n\t\t\tfragmentUniforms.shininess,\n\t\t\tfragmentUniforms.specularPower,\n\t\t\tfragmentUniforms.specularColor,\n\t\t\tspecularTextureValue,\n\t\t\tvVertexPosition.xyz\n\t\t)\n\t\t+ la;\n\n\t\tif(fragmentUniforms.__emissiveTextureRenderYn == TRUTHY) {\n\t\t\tvec4 emissiveColor = texture(sampler2D(uEmissiveTexture, uEmissiveSampler), vUV);\n\t\t\tfinalColor.rgb += emissiveColor.rgb * fragmentUniforms.emissivePower;\n\t\t}\n\t\t\n\t\tfinalColor.a = testAlpha;\n\t\toutColor = finalColor;\n\t\toutColor.a *= fragmentUniforms.alpha;\n\t\tout_MouseColorID_Depth = vec4(vMouseColorID, gl_FragCoord.z/gl_FragCoord.w, 0.0, 0.0);\n\t\t\n\t}\n`),Ve(Ir,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(Ir,"uniformsBindGroupLayoutDescriptor_material",{entries:[{binding:0,visibility:GPUShaderStage.VERTEX,type:"uniform-buffer"},{binding:1,visibility:GPUShaderStage.VERTEX,type:"sampler"},{binding:2,visibility:GPUShaderStage.VERTEX,type:"sampled-texture"},{binding:3,visibility:GPUShaderStage.FRAGMENT,type:"uniform-buffer"},{binding:4,visibility:GPUShaderStage.FRAGMENT,type:"sampler"},{binding:5,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture"},{binding:6,visibility:GPUShaderStage.FRAGMENT,type:"sampler"},{binding:7,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture"},{binding:8,visibility:GPUShaderStage.FRAGMENT,type:"sampler"},{binding:9,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture"}]}),Ve(Ir,"uniformBufferDescriptor_vertex",[{size:$e.float,valueName:"displacementFlowSpeedX"},{size:$e.float,valueName:"displacementFlowSpeedY"},{size:$e.float,valueName:"displacementPower"},{size:$e.float,valueName:"__displacementTextureRenderYn"}]),Ve(Ir,"uniformBufferDescriptor_fragment",[{size:$e.float4,valueName:"colorRGBA"},{size:$e.float,valueName:"normalPower"},{size:$e.float,valueName:"shininess"},{size:$e.float,valueName:"specularPower"},{size:$e.float4,valueName:"specularColorRGBA"},{size:$e.float,valueName:"emissivePower"},{size:$e.float,valueName:"alpha"},{size:$e.float,valueName:"useFlatMode"},{size:$e.float,valueName:"__normalTextureRenderYn"},{size:$e.float,valueName:"__specularTextureRenderYn"},{size:$e.float,valueName:"__emissiveTextureRenderYn"}]);let Fr=new Float32Array(1);class Ar extends(Er.mix(hr,Er.diffuseTexture,Er.normalTexture,Er.specularTexture,Er.emissiveTexture,Er.environmentTexture,Er.displacementTexture,Er.basicLightPropertys,Er.alpha)){constructor(t,e,r,n,i,a,o){super(t),Vr.set(this,{writable:!0,value:void 0}),this.diffuseTexture=e,this.environmentTexture=r,this.normalTexture=n,this.emissiveTexture=a,this.specularTexture=i,this.displacementTexture=o,this.needResetBindingInfo=!0}checkTexture(t,e){if(t)if(t._GPUTexture){let r;switch(e){case"diffuseTexture":this._diffuseTexture=t,r=e;break;case"normalTexture":this._normalTexture=t,r=e;break;case"specularTexture":this._specularTexture=t,r=e;break;case"emissiveTexture":this._emissiveTexture=t,r=e;break;case"environmentTexture":this._environmentTexture=t,r=e;break;case"displacementTexture":this._displacementTexture=t,r=e}r&&(Fr[0]=this[`__${e}RenderYn`]=1,"displacementTexture"==r?this.uniformBuffer_vertex.GPUBuffer.setSubData(this.uniformBufferDescriptor_vertex.redStructOffsetMap[`__${e}RenderYn`],Fr):this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap[`__${e}RenderYn`],Fr)),this.needResetBindingInfo=!0}else t.addUpdateTarget(this,e);else this["_"+e]&&(this["_"+e]=null,Fr[0]=this[`__${e}RenderYn`]=0,"displacementTexture"==e?this.uniformBuffer_vertex.GPUBuffer.setSubData(this.uniformBufferDescriptor_vertex.redStructOffsetMap[`__${e}RenderYn`],Fr):this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap[`__${e}RenderYn`],Fr),this.needResetBindingInfo=!0)}resetBindingInfo(){this.entries=[{binding:0,resource:{buffer:this.uniformBuffer_vertex.GPUBuffer,offset:0,size:this.uniformBufferDescriptor_vertex.size}},{binding:1,resource:this._displacementTexture?this._displacementTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:2,resource:this._displacementTexture?this._displacementTexture._GPUTextureView:this.redGPUContext.state.emptyTextureView},{binding:3,resource:{buffer:this.uniformBuffer_fragment.GPUBuffer,offset:0,size:this.uniformBufferDescriptor_fragment.size}},{binding:4,resource:this._diffuseTexture?this._diffuseTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:5,resource:this._diffuseTexture?this._diffuseTexture._GPUTextureView:this.redGPUContext.state.emptyTextureView},{binding:6,resource:this._normalTexture?this._normalTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:7,resource:this._normalTexture?this._normalTexture._GPUTextureView:this.redGPUContext.state.emptyTextureView},{binding:8,resource:this._specularTexture?this._specularTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:9,resource:this._specularTexture?this._specularTexture._GPUTextureView:this.redGPUContext.state.emptyTextureView},{binding:10,resource:this._emissiveTexture?this._emissiveTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:11,resource:this._emissiveTexture?this._emissiveTexture._GPUTextureView:this.redGPUContext.state.emptyTextureView},{binding:12,resource:this._environmentTexture?this._environmentTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:13,resource:this._environmentTexture?this._environmentTexture._GPUTextureView:this.redGPUContext.state.emptyCubeTextureView}],this._afterResetBindingInfo()}}var Vr=new WeakMap;Ve(Ar,"vertexShaderGLSL",`\n\t${tr.GLSL_VERSION}\n    ${tr.GLSL_SystemUniforms_vertex.systemUniforms}\n    ${tr.GLSL_SystemUniforms_vertex.calcDisplacement}    \n    ${tr.GLSL_SystemUniforms_vertex.meshUniforms}\n         \n\tlayout( location = 0 ) in vec3 position;\n\tlayout( location = 1 ) in vec3 normal;\n\tlayout( location = 2 ) in vec2 uv;\n\tlayout( location = 0 ) out vec3 vNormal;\n\tlayout( location = 1 ) out vec2 vUV;\n\tlayout( location = 2 ) out vec4 vVertexPosition;\t\n\tlayout( location = 3 ) out float vMouseColorID;\t\n\tlayout( location = 4 ) out float vSumOpacity;\n\tlayout( set = ${tr.SET_INDEX_VertexUniforms}, binding = 0 ) uniform VertexUniforms {\n        float displacementFlowSpeedX;\n        float displacementFlowSpeedY;\n        float displacementPower;        \n\t\tfloat __displacementTextureRenderYn;\n    } vertexUniforms;\n\t\n\tlayout( set = ${tr.SET_INDEX_VertexUniforms}, binding = 1 ) uniform sampler uDisplacementSampler;\n\tlayout( set = ${tr.SET_INDEX_VertexUniforms}, binding = 2 ) uniform texture2D uDisplacementTexture;\n\tvoid main() {\t\t\n\t\tvVertexPosition = meshMatrixUniforms.modelMatrix[ int(meshUniforms.index) ] * vec4(position, 1.0);\n\t\tvNormal = (meshMatrixUniforms.normalMatrix[ int(meshUniforms.index) ] * vec4(normal,1.0)).xyz;\n\t\tvUV = uv;\n\t\tvMouseColorID = meshUniforms.mouseColorID;\n\t\tvSumOpacity = meshUniforms.sumOpacity;\n\t\tif(vertexUniforms.__displacementTextureRenderYn == TRUTHY) vVertexPosition.xyz += calcDisplacement(vNormal, vertexUniforms.displacementFlowSpeedX, vertexUniforms.displacementFlowSpeedY, vertexUniforms.displacementPower, uv, uDisplacementTexture, uDisplacementSampler);\n\t\tgl_Position = systemUniforms.perspectiveMTX * systemUniforms.cameraMTX * vVertexPosition;\n\t\n\t\n\t}\n\t`),Ve(Ar,"fragmentShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_fragment.systemUniforms}\n\t${tr.GLSL_SystemUniforms_fragment.cotangent_frame}\n\t${tr.GLSL_SystemUniforms_fragment.perturb_normal}\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 3 ) uniform FragmentUniforms {\n        float normalPower;\n        float shininess; \n        float specularPower;\n\t    vec4 specularColor;\n\t    float emissivePower;\n\t    float environmentPower;\n\t    float alpha;\n\t    float useFlatMode;\n\t    //\n\t    float __diffuseTextureRenderYn;\n\t\tfloat __environmentTextureRenderYn;\n\t\tfloat __normalTextureRenderYn;\n\t\tfloat __specularTextureRenderYn;\n\t\tfloat __emissiveTextureRenderYn;\n    } fragmentUniforms;\n\n\tlayout( location = 0 ) in vec3 vNormal;\n\tlayout( location = 1 ) in vec2 vUV;\n\tlayout( location = 2 ) in vec4 vVertexPosition;\n\tlayout( location = 3 ) in float vMouseColorID;\n\tlayout( location = 4 ) in float vSumOpacity;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 4 ) uniform sampler uDiffuseSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 5 ) uniform texture2D uDiffuseTexture;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 6 ) uniform sampler uNormalSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 7 ) uniform texture2D uNormalTexture;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 8 ) uniform sampler uSpecularSampler;\t\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 9 ) uniform texture2D uSpecularTexture;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 10 ) uniform sampler uEmissiveSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 11 ) uniform texture2D uEmissiveTexture;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 12 ) uniform sampler uEnvironmentSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 13 ) uniform textureCube uEnvironmentTexture;\n\tlayout( location = 0 ) out vec4 outColor;\n\tlayout( location = 1 ) out vec4 out_MouseColorID_Depth;\n\tvoid main() {\n\t\tfloat testAlpha = 0.0;\n\t\tvec4 diffuseColor = vec4(0.0);\n\t\tif(fragmentUniforms.__diffuseTextureRenderYn == TRUTHY) diffuseColor = texture(sampler2D(uDiffuseTexture, uDiffuseSampler), vUV) ;\n\t\t\n\t\t\n\t    vec3 N = normalize(vNormal);\n\t\tvec4 normalColor = vec4(0.0);\n\t\tif(fragmentUniforms.__normalTextureRenderYn == TRUTHY) normalColor = texture(sampler2D(uNormalTexture, uNormalSampler), vUV) ;\n\t\tif(fragmentUniforms.useFlatMode == TRUTHY) N = getFlatNormal(vVertexPosition.xyz);\n\t\tif(fragmentUniforms.__normalTextureRenderYn == TRUTHY) N = perturb_normal(N, vVertexPosition.xyz, vUV, normalColor.rgb, fragmentUniforms.normalPower) ;\n\t\n\t\tif(fragmentUniforms.__environmentTextureRenderYn == TRUTHY) {\n\t\t\tvec3 R = reflect( vVertexPosition.xyz - systemUniforms.cameraPosition, N);\n\t\t\tvec4 reflectionColor = texture(samplerCube(uEnvironmentTexture,uEnvironmentSampler), R);\n\t\t\tdiffuseColor = mix(diffuseColor, reflectionColor, fragmentUniforms.environmentPower);\n\t\t}\n\t\t\n\t\ttestAlpha = diffuseColor.a ;\n\t\t\n\t\tfloat specularTextureValue = 1.0;\n\t\tif(fragmentUniforms.__specularTextureRenderYn == TRUTHY) specularTextureValue = texture(sampler2D(uSpecularTexture, uSpecularSampler), vUV).r ;\n\t\t\n\t\tvec4 finalColor = \n\t\tcalcDirectionalLight(\n\t\t\tdiffuseColor,\n\t\t\tN,\t\t\n\t\t\tsystemUniforms.directionalLightCount,\n\t\t\tsystemUniforms.directionalLightList,\n\t\t\tfragmentUniforms.shininess,\n\t\t\tfragmentUniforms.specularPower,\n\t\t\tfragmentUniforms.specularColor,\n\t\t\tspecularTextureValue\n\t\t)\n\t\t+\n\t\tcalcPointLight(\n\t\t\tdiffuseColor,\n\t\t\tN,\t\t\n\t\t\tsystemUniforms.pointLightCount,\n\t\t\tsystemUniforms.pointLightList,\n\t\t\tfragmentUniforms.shininess,\n\t\t\tfragmentUniforms.specularPower,\n\t\t\tfragmentUniforms.specularColor,\n\t\t\tspecularTextureValue,\n\t\t\tvVertexPosition.xyz\n\t\t)\n\t\t+ la;\n\t\t\n\t\tif(fragmentUniforms.__emissiveTextureRenderYn == TRUTHY) {\n\t\t\tvec4 emissiveColor = texture(sampler2D(uEmissiveTexture, uEmissiveSampler), vUV);\n\t\t\tfinalColor.rgb += emissiveColor.rgb * fragmentUniforms.emissivePower;\n\t\t}\n\t\t\n\t\t\n\t\tfinalColor.a = testAlpha;\n\t\toutColor = finalColor;\n\t\toutColor.a *= fragmentUniforms.alpha * vSumOpacity;\n\n\t\tout_MouseColorID_Depth = vec4(vMouseColorID, gl_FragCoord.z/gl_FragCoord.w, 0.0, 0.0);\n\t\t\n\t}\n`),Ve(Ar,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(Ar,"uniformsBindGroupLayoutDescriptor_material",{entries:[{binding:0,visibility:GPUShaderStage.VERTEX,type:"uniform-buffer"},{binding:1,visibility:GPUShaderStage.VERTEX,type:"sampler"},{binding:2,visibility:GPUShaderStage.VERTEX,type:"sampled-texture"},{binding:3,visibility:GPUShaderStage.FRAGMENT,type:"uniform-buffer"},{binding:4,visibility:GPUShaderStage.FRAGMENT,type:"sampler"},{binding:5,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture"},{binding:6,visibility:GPUShaderStage.FRAGMENT,type:"sampler"},{binding:7,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture"},{binding:8,visibility:GPUShaderStage.FRAGMENT,type:"sampler"},{binding:9,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture"},{binding:10,visibility:GPUShaderStage.FRAGMENT,type:"sampler"},{binding:11,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture"},{binding:12,visibility:GPUShaderStage.FRAGMENT,type:"sampler"},{binding:13,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture",viewDimension:"cube"}]}),Ve(Ar,"uniformBufferDescriptor_vertex",[{size:$e.float,valueName:"displacementFlowSpeedX"},{size:$e.float,valueName:"displacementFlowSpeedY"},{size:$e.float,valueName:"displacementPower"},{size:$e.float,valueName:"__displacementTextureRenderYn"}]),Ve(Ar,"uniformBufferDescriptor_fragment",[{size:$e.float,valueName:"normalPower"},{size:$e.float,valueName:"shininess"},{size:$e.float,valueName:"specularPower"},{size:$e.float4,valueName:"specularColorRGBA"},{size:$e.float,valueName:"emissivePower"},{size:$e.float,valueName:"environmentPower"},{size:$e.float,valueName:"alpha"},{size:$e.float,valueName:"useFlatMode"},{size:$e.float,valueName:"__diffuseTextureRenderYn"},{size:$e.float,valueName:"__environmentTextureRenderYn"},{size:$e.float,valueName:"__normalTextureRenderYn"},{size:$e.float,valueName:"__specularTextureRenderYn"},{size:$e.float,valueName:"__emissiveTextureRenderYn"}]);let Or=new Float32Array(1);class Yr extends(Er.mix(hr,Er.diffuseTexture,Er.alpha)){constructor(t,e){super(t),this.diffuseTexture=e,this.needResetBindingInfo=!0}checkTexture(t,e){if(t)if(t._GPUTexture){let r;switch(e){case"diffuseTexture":this._diffuseTexture=t,r=e}r&&(Or[0]=this[`__${e}RenderYn`]=1,"displacementTexture"==r?this.uniformBuffer_vertex.GPUBuffer.setSubData(this.uniformBufferDescriptor_vertex.redStructOffsetMap[`__${e}RenderYn`],Or):this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap[`__${e}RenderYn`],Or)),this.needResetBindingInfo=!0}else t.addUpdateTarget(this,e);else this["_"+e]&&(this["_"+e]=null,Or[0]=this[`__${e}RenderYn`]=0,"displacementTexture"==e?this.uniformBuffer_vertex.GPUBuffer.setSubData(this.uniformBufferDescriptor_vertex.redStructOffsetMap[`__${e}RenderYn`],Or):this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap[`__${e}RenderYn`],Or),this.needResetBindingInfo=!0)}resetBindingInfo(){this.entries=[{binding:0,resource:{buffer:this.uniformBuffer_fragment.GPUBuffer,offset:0,size:this.uniformBufferDescriptor_fragment.size}},{binding:1,resource:this._diffuseTexture?this._diffuseTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:2,resource:this._diffuseTexture?this._diffuseTexture._GPUTextureView:this.redGPUContext.state.emptyTextureView}],this._afterResetBindingInfo()}}Ve(Yr,"vertexShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_vertex.systemUniforms}\n    ${tr.GLSL_SystemUniforms_vertex.meshUniforms}\n\tlayout( location = 0 ) in vec3 position;\n\tlayout( location = 1 ) in vec3 normal;\n\tlayout( location = 2 ) in vec2 uv;\n\tlayout( location = 0 ) out vec3 vNormal;\n\tlayout( location = 1 ) out vec2 vUV;\n\tlayout( location = 2 ) out float vMouseColorID;\t\n\tlayout( location = 3 ) out float vSumOpacity;\n\tvoid main() {\n\t\tvNormal = normal;\n\t\tvUV = uv;\n\t\tvMouseColorID = meshUniforms.mouseColorID;\n\t\tvSumOpacity = meshUniforms.sumOpacity;\n\t\tgl_Position = systemUniforms.perspectiveMTX * systemUniforms.cameraMTX * meshMatrixUniforms.modelMatrix[ int(meshUniforms.index) ] * vec4(position,1.0);\n\t}\n\t`),Ve(Yr,"fragmentShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\tconst float TRUTHY = 1.0;\n\tlayout( location = 0 ) in vec3 vNormal;\n\tlayout( location = 1 ) in vec2 vUV;\n\tlayout( location = 2 ) in float vMouseColorID;\t\n\tlayout( location = 3 ) in float vSumOpacity;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 0 ) uniform FragmentUniforms {\n        float alpha;\n        //\n        float __diffuseTextureRenderYn;\n    } fragmentUniforms;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 1 ) uniform sampler uSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 2 ) uniform texture2D uDiffuseTexture;\n\tlayout( location = 0 ) out vec4 outColor;\n\tlayout( location = 1 ) out vec4 out_MouseColorID_Depth;\n\tvoid main() {\n\t\tvec4 diffuseColor = vec4(0.0);\n\t\tif(fragmentUniforms.__diffuseTextureRenderYn == TRUTHY) diffuseColor = texture(sampler2D(uDiffuseTexture, uSampler), vUV) ;\n\t\toutColor = diffuseColor;\n\t\toutColor.a *= fragmentUniforms.alpha * vSumOpacity;\n\t\tout_MouseColorID_Depth = vec4(vMouseColorID, gl_FragCoord.z/gl_FragCoord.w, 0.0, 0.0);\n\t\t\n\t}\n`),Ve(Yr,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(Yr,"uniformsBindGroupLayoutDescriptor_material",{entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,type:"uniform-buffer"},{binding:1,visibility:GPUShaderStage.FRAGMENT,type:"sampler"},{binding:2,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture"}]}),Ve(Yr,"uniformBufferDescriptor_vertex",hr.uniformBufferDescriptor_empty),Ve(Yr,"uniformBufferDescriptor_fragment",[{size:$e.float,valueName:"alpha"},{size:$e.float,valueName:"__diffuseTextureRenderYn"}]);class Xr extends hr{constructor(t){super(t),this.needResetBindingInfo=!0}resetBindingInfo(){this.entries=[],this._afterResetBindingInfo()}}Ve(Xr,"vertexShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_vertex.systemUniforms}\n    ${tr.GLSL_SystemUniforms_vertex.meshUniforms}\n\tlayout( location = 0 ) in vec3 position;\n\tlayout( location = 1 ) in vec4 color;\n\tlayout( location = 0 ) out vec4 vColor;\n\n\tvoid main() {\n\t\tgl_Position = systemUniforms.perspectiveMTX * systemUniforms.cameraMTX * meshMatrixUniforms.modelMatrix[ int(meshUniforms.index) ] * vec4(position,1.0);\n\t\tvColor = color;\n\t}\n\t`),Ve(Xr,"fragmentShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\tlayout( location = 0 ) in vec4 vColor;\n\tlayout( location = 0 ) out vec4 outColor;\n\t\n\tvoid main() {\n\t\toutColor = vColor;\n\t\t\n\t}\n\t`),Ve(Xr,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(Xr,"uniformsBindGroupLayoutDescriptor_material",{entries:[]}),Ve(Xr,"uniformBufferDescriptor_vertex",hr.uniformBufferDescriptor_empty),Ve(Xr,"uniformBufferDescriptor_fragment",hr.uniformBufferDescriptor_empty);class zr extends(Er.mix(hr)){set skyBoxTexture(t){this.checkTexture(t,"skyBoxTexture")}get skyBoxTexture(){return this._skyBoxTexture}constructor(t,e){super(t),Ve(this,"_skyBoxTexture",void 0),this.skyBoxTexture=e,this.needResetBindingInfo=!0}checkTexture(t,e){if(t)if(t._GPUTexture){switch(e){case"skyBoxTexture":this._skyBoxTexture=t}this.needResetBindingInfo=!0}else t.addUpdateTarget(this,e);else this["_"+e]&&(this["_"+e]=null,this.needResetBindingInfo=!0)}resetBindingInfo(){this.entries=[{binding:0,resource:this._skyBoxTexture?this._skyBoxTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:1,resource:this._skyBoxTexture?this._skyBoxTexture._GPUTextureView:this.redGPUContext.state.emptyCubeTextureView}],this._afterResetBindingInfo()}}Ve(zr,"vertexShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_vertex.systemUniforms}\n    ${tr.GLSL_SystemUniforms_vertex.meshUniforms}\n\tlayout( location = 0 ) in vec3 position;\n\tlayout( location = 0 ) out vec3 vReflectionCubeCoord;\n\tvoid main() {\n\t\tgl_Position = systemUniforms.perspectiveMTX * systemUniforms.cameraMTX * meshMatrixUniforms.modelMatrix[ int(meshUniforms.index) ] * vec4(position,1.0);\n\t\tvReflectionCubeCoord = (meshMatrixUniforms.modelMatrix[ int(meshUniforms.index) ] *vec4(position, 0.0)).xyz;\n\t}\n\t`),Ve(zr,"fragmentShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\tlayout( location = 0 ) in vec3 vReflectionCubeCoord;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 0) uniform sampler uSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 1) uniform textureCube uSkyBoxTexture;\n\tlayout( location = 0 ) out vec4 outColor;\n\t\n\tvoid main() {\n\t\tvec4 diffuseColor = vec4(0.0);\n\t\t//#RedGPU#skyBoxTexture# diffuseColor = texture(samplerCube(uSkyBoxTexture,uSampler), vReflectionCubeCoord) ;\n\t\toutColor = diffuseColor;\n\t\t\n\t}\n`),Ve(zr,"PROGRAM_OPTION_LIST",{vertex:[],fragment:["skyBoxTexture"]}),Ve(zr,"uniformsBindGroupLayoutDescriptor_material",{entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,type:"sampler"},{binding:1,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture",viewDimension:"cube"}]}),Ve(zr,"uniformBufferDescriptor_vertex",hr.uniformBufferDescriptor_empty),Ve(zr,"uniformBufferDescriptor_fragment",hr.uniformBufferDescriptor_empty);class $r extends(Er.mix(hr,Er.alpha)){constructor(t){super(t),this.needResetBindingInfo=!0}resetBindingInfo(){this.entries=[{binding:0,resource:{buffer:this.uniformBuffer_fragment.GPUBuffer,offset:0,size:this.uniformBufferDescriptor_fragment.size}}],this._afterResetBindingInfo()}}Ve($r,"vertexShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_vertex.systemUniforms}\n\t${tr.GLSL_SystemUniforms_vertex.meshUniforms}\n\tlayout( location = 0 ) in vec3 position;\n\tlayout( location = 1 ) in vec4 color;\n\tlayout( location = 0 ) out float vMouseColorID;\n\tlayout( location = 1 ) out vec4 vColor;\t\t\n\tlayout( location = 2 ) out float vSumOpacity;\n\tvoid main() {\n\t\tvMouseColorID = meshUniforms.mouseColorID;\n\t\tvColor = color;\n\t\tvSumOpacity = meshUniforms.sumOpacity;\n\t\tgl_Position = systemUniforms.perspectiveMTX * systemUniforms.cameraMTX * meshMatrixUniforms.modelMatrix[ int(meshUniforms.index) ] * vec4(position,1.0);\n\t\n\t}\n\t`),Ve($r,"fragmentShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_fragment.systemUniforms}\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 0 ) uniform FragmentUniforms {\n         float alpha;\n    } fragmentUniforms;\n\tlayout( location = 0 ) in float vMouseColorID;\n\tlayout( location = 1 ) in vec4 vColor;\t\t\t\n\tlayout( location = 2 ) in float vSumOpacity;\n\tlayout( location = 0 ) out vec4 outColor;\t\n\tlayout( location = 1 ) out vec4 out_MouseColorID_Depth;\n\tvoid main() {\n\t\toutColor = vColor;\n\t\toutColor.a *= fragmentUniforms.alpha * vSumOpacity;\n\t\tout_MouseColorID_Depth = vec4(vMouseColorID, gl_FragCoord.z/gl_FragCoord.w, 0.0, 0.0);\n\t\t\n\t}\n\t`),Ve($r,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve($r,"uniformsBindGroupLayoutDescriptor_material",{entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,type:"uniform-buffer"}]}),Ve($r,"uniformBufferDescriptor_vertex",hr.uniformBufferDescriptor_empty),Ve($r,"uniformBufferDescriptor_fragment",[{size:$e.float,valueName:"alpha"}]);let kr=new Float32Array(1);class Wr extends(Er.mix(hr,Er.diffuseTexture,Er.alpha)){get width(){return this._width}set width(t){this._width=t,kr[0]=this._width,this.uniformBuffer_vertex.GPUBuffer.setSubData(this.uniformBufferDescriptor_vertex.redStructOffsetMap.width,kr)}get height(){return this._height}set height(t){this._height=t,kr[0]=this._height,this.uniformBuffer_vertex.GPUBuffer.setSubData(this.uniformBufferDescriptor_vertex.redStructOffsetMap.height,kr)}constructor(t,e){super(t),Zr.set(this,{writable:!0,value:!1}),Hr.set(this,{writable:!0,value:!1}),Ve(this,"_width",256),Ve(this,"_height",256),this.diffuseTexture=e,this.needResetBindingInfo=!0}get useFixedScale(){return Oe(this,Zr)}set useFixedScale(t){Ye(this,Zr,t),this.needResetBindingInfo=!0}get useSprite3DMode(){return Oe(this,Hr)}set useSprite3DMode(t){Ye(this,Hr,t),this.needResetBindingInfo=!0}checkTexture(t,e){if(t)if(t._GPUTexture){switch(e){case"diffuseTexture":this._diffuseTexture=t}this.needResetBindingInfo=!0}else t.addUpdateTarget(this,e);else this["_"+e]&&(this["_"+e]=null,this.needResetBindingInfo=!0)}resetBindingInfo(){this.entries=[{binding:0,resource:{buffer:this.uniformBuffer_vertex.GPUBuffer,offset:0,size:this.uniformBufferDescriptor_vertex.size}},{binding:1,resource:{buffer:this.uniformBuffer_fragment.GPUBuffer,offset:0,size:this.uniformBufferDescriptor_fragment.size}},{binding:2,resource:this.redGPUContext.state.emptySampler.GPUSampler},{binding:3,resource:this._diffuseTexture?this._diffuseTexture._GPUTextureView:this.redGPUContext.state.emptyTextureView}],this._afterResetBindingInfo()}}var Zr=new WeakMap,Hr=new WeakMap;Ve(Wr,"vertexShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_vertex.systemUniforms}\n    ${tr.GLSL_SystemUniforms_vertex.meshUniforms}\n\tlayout( set = ${tr.SET_INDEX_VertexUniforms}, binding = 0 ) uniform VertexUniforms {\n        float width;\n        float height;\n    } vertexUniforms;\n\tlayout( location = 0 ) in vec3 position;\n\tlayout( location = 1 ) in vec3 normal;\n\tlayout( location = 2 ) in vec2 uv;\n\tlayout( location = 0 ) out vec3 vNormal;\n\tlayout( location = 1 ) out vec2 vUV;\n\tlayout( location = 2 ) out float vMouseColorID;\t\n\tlayout( location = 3 ) out float vSumOpacity;\n    ${tr.GLSL_SystemUniforms_vertex.getSprite3DMatrix}\t\n\tvoid main() {\n\t\tfloat w = vertexUniforms.width ;\n\t\tfloat h = vertexUniforms.height ;\n\t\tmat4 modelMatrix = meshMatrixUniforms.modelMatrix[ int(meshUniforms.index) ];\n\t\tmat4 targetMatrix;\n\t\t\n\t\t// 기본\n\t\ttargetMatrix = modelMatrix * mat4( w / max( w, h ), 0.0, 0.0, 0.0,   0.0, h / max( w, h ), 0.0, 0.0,    0.0, 0.0, 1.0, 0.0,    0.0, 0.0, 0.0, 1.0 );\n\t\tgl_Position = systemUniforms.perspectiveMTX * systemUniforms.cameraMTX * targetMatrix * vec4(position,1.0);\t\t\t\t\n\t\t\n\t\t// sprite3D\n\t\t//#RedGPU#useSprite3DMode#  targetMatrix = modelMatrix * mat4( w / systemUniforms.resolution.y, 0.0, 0.0, 0.0,    0.0, h / systemUniforms.resolution.y, 0.0, 0.0,    0.0, 0.0, 1.0, 0.0,    0.0, 0.0, 0.0, 1.0);\n\t\t//#RedGPU#useSprite3DMode#  gl_Position = systemUniforms.perspectiveMTX * getSprite3DMatrix( systemUniforms.cameraMTX, targetMatrix ) * vec4(position,1.0);\t\n\t\t\t\n\t\t\n\t\t//#RedGPU#useSprite3DMode#  //#RedGPU#useFixedScale#  gl_Position /= gl_Position.w;\n\t\t//#RedGPU#useSprite3DMode#  //#RedGPU#useFixedScale#  gl_Position.xy += position.xy * vec2((systemUniforms.perspectiveMTX * targetMatrix)[0][0],(systemUniforms.perspectiveMTX * targetMatrix)[1][1]);\n\t\n\t\t\n\t\tvNormal = normal;\n\t\tvUV = uv;\n\t\tvMouseColorID = meshUniforms.mouseColorID;\n\t\tvSumOpacity = meshUniforms.sumOpacity;\n\t}\n\t`),Ve(Wr,"fragmentShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\tlayout( location = 0 ) in vec3 vNormal;\n\tlayout( location = 1 ) in vec2 vUV;\n\tlayout( location = 2 ) in float vMouseColorID;\t\n\tlayout( location = 3 ) in float vSumOpacity;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 1 ) uniform FragmentUniforms {\n        float alpha;\n    } fragmentUniforms;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 2 ) uniform sampler uSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 3 ) uniform texture2D uDiffuseTexture;\n\tlayout( location = 0 ) out vec4 outColor;\n\t\n\tlayout( location = 1 ) out vec4 out_MouseColorID_Depth;\n\tvoid main() {\n\t\tvec4 diffuseColor = vec4(0.0);\n\t\t//#RedGPU#diffuseTexture# diffuseColor = texture(sampler2D(uDiffuseTexture, uSampler), vUV) ;\n\t\t// if(diffuseColor.a < 0.05) discard;\n\t\toutColor = diffuseColor;\n\t\toutColor.a *= fragmentUniforms.alpha * vSumOpacity;\n\t\tout_MouseColorID_Depth = vec4(vMouseColorID, gl_FragCoord.z/gl_FragCoord.w, 0.0, 0.0);\n\t\t\n\t}\n`),Ve(Wr,"PROGRAM_OPTION_LIST",{vertex:["useFixedScale","useSprite3DMode"],fragment:["diffuseTexture"]}),Ve(Wr,"uniformsBindGroupLayoutDescriptor_material",{entries:[{binding:0,visibility:GPUShaderStage.VERTEX,type:"uniform-buffer"},{binding:1,visibility:GPUShaderStage.FRAGMENT,type:"uniform-buffer"},{binding:2,visibility:GPUShaderStage.FRAGMENT,type:"sampler"},{binding:3,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture"}]}),Ve(Wr,"uniformBufferDescriptor_vertex",[{size:$e.float,valueName:"width"},{size:$e.float,valueName:"height"}]),Ve(Wr,"uniformBufferDescriptor_fragment",[{size:$e.float,valueName:"alpha"}]);let qr=new Float32Array(1);class jr extends(Er.mix(hr,Er.alpha,Er.diffuseTexture)){get frameRate(){return Oe(this,Jr)}set frameRate(t){t<1&&Ye(this,Jr,1),Ye(this,Jr,t),this._perFrameTime=1e3/Oe(this,Jr)}constructor(t,e){super(t),Jr.set(this,{writable:!0,value:void 0}),Qr.set(this,{writable:!0,value:0}),Kr.set(this,{writable:!0,value:{}}),e&&(this.addAction("default",e),this.setAction("default")),this.needResetBindingInfo=!0,this.sheetRect=new Float32Array(4),this.currentIndex=0,this.loop=!0,this._playYn=!0}update(t){if(Oe(this,Qr)||Ye(this,Qr,this._perFrameTime+t),this._playYn&&Oe(this,Qr)<t){let e=parseInt((t-Oe(this,Qr))/this._perFrameTime);e=e||1,Ye(this,Qr,this._perFrameTime+t),this.currentIndex+=e,this.currentIndex>=this.totalFrame&&(this.loop?(this._playYn=!0,this.currentIndex=0):(this._playYn=!1,this.currentIndex=this.totalFrame-1))}this.sheetRect[0]=1/this.segmentW,this.sheetRect[1]=1/this.segmentH,this.sheetRect[2]=this.currentIndex%this.segmentW/this.segmentW,this.sheetRect[3]=Math.floor(this.currentIndex/this.segmentH)/this.segmentH,this.uniformBuffer_vertex&&this.uniformBuffer_vertex.GPUBuffer.setSubData(this.uniformBufferDescriptor_vertex.redStructOffsetMap.sheetRect,this.sheetRect)}addAction(t,e){Oe(this,Kr)[t]=e}removeAction(t,e){delete Oe(this,Kr)[t]}setAction(t){this.diffuseTexture=Oe(this,Kr)[t].texture,this.segmentW=Oe(this,Kr)[t].segmentW,this.segmentH=Oe(this,Kr)[t].segmentH,this.totalFrame=Oe(this,Kr)[t].totalFrame,this.frameRate=Oe(this,Kr)[t].frameRate,this.currentIndex=0,Ye(this,Qr,0)}play(){this._playYn=!0,Ye(this,Qr,0)}pause(){this._playYn=!1}stop(){this._playYn=!1,this.currentIndex=0}gotoAndStop(t){t>this.totalFrame-1&&(t=this.totalFrame-1),t<0&&(t=0),this._playYn=!1,this.currentIndex=t}gotoAndPlay(t){t>this.totalFrame-1&&(t=this.totalFrame-1),t<0&&(t=0),this._playYn=!0,this.currentIndex=t,Ye(this,Qr,0)}checkTexture(t,e){if(t)if(t._GPUTexture){let r;switch(e){case"diffuseTexture":this._diffuseTexture=t,r=e}r&&(qr[0]=this[`__${e}RenderYn`]=1,"displacementTexture"==r?this.uniformBuffer_vertex.GPUBuffer.setSubData(this.uniformBufferDescriptor_vertex.redStructOffsetMap[`__${e}RenderYn`],qr):this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap[`__${e}RenderYn`],qr)),this.needResetBindingInfo=!0}else t.addUpdateTarget(this,e);else this["_"+e]&&(this["_"+e]=null,qr[0]=this[`__${e}RenderYn`]=0,"displacementTexture"==e?this.uniformBuffer_vertex.GPUBuffer.setSubData(this.uniformBufferDescriptor_vertex.redStructOffsetMap[`__${e}RenderYn`],qr):this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap[`__${e}RenderYn`],qr),this.needResetBindingInfo=!0)}resetBindingInfo(){this.entries=[{binding:0,resource:{buffer:this.uniformBuffer_vertex.GPUBuffer,offset:0,size:this.uniformBufferDescriptor_vertex.size}},{binding:1,resource:{buffer:this.uniformBuffer_fragment.GPUBuffer,offset:0,size:this.uniformBufferDescriptor_fragment.size}},{binding:2,resource:this._diffuseTexture?this._diffuseTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:3,resource:this._diffuseTexture?this._diffuseTexture._GPUTextureView:this.redGPUContext.state.emptyTextureView}],this._afterResetBindingInfo()}}var Jr=new WeakMap,Qr=new WeakMap,Kr=new WeakMap;Ve(jr,"vertexShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_vertex.systemUniforms}\n    ${tr.GLSL_SystemUniforms_vertex.meshUniforms}\n    layout( set = ${tr.SET_INDEX_VertexUniforms}, binding = 0 ) uniform VertexUniforms {\n        vec4 sheetRect;\n    } vertexUniforms;\n\tlayout( location = 0 ) in vec3 position;\n\tlayout( location = 1 ) in vec3 normal;\n\tlayout( location = 2 ) in vec2 uv;\n\tlayout( location = 0 ) out vec3 vNormal;\n\tlayout( location = 1 ) out vec2 vUV;\n\tlayout( location = 2 ) out float vMouseColorID;\n\tlayout( location = 3 ) out float vSumOpacity;\t\n\tvoid main() {\n\t\tvUV = uv;\n\t\tvUV = vec2(\n\t\t\tvUV.s * vertexUniforms.sheetRect.x + vertexUniforms.sheetRect.z,\n\t\t\tvUV.t * vertexUniforms.sheetRect.y -vertexUniforms.sheetRect.w\n\t\t);\t\n\t\tvSumOpacity = meshUniforms.sumOpacity;\t\n\t\tgl_Position = systemUniforms.perspectiveMTX * systemUniforms.cameraMTX * meshMatrixUniforms.modelMatrix[ int(meshUniforms.index) ] * vec4(position,1.0);\n\t\tvNormal = normal;\n\t\tvMouseColorID = meshUniforms.mouseColorID;\n\t\n\t}\n\t`),Ve(jr,"fragmentShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\tconst float TRUTHY = 1.0;\n\tlayout( location = 0 ) in vec3 vNormal;\n\tlayout( location = 1 ) in vec2 vUV;\n\tlayout( location = 2 ) in float vMouseColorID;\t\n\tlayout( location = 3 ) in float vSumOpacity;\t\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 1 ) uniform FragmentUniforms {\n        float alpha;\n        //\n        float __diffuseTextureRenderYn;\n    } fragmentUniforms;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 2 ) uniform sampler uSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 3 ) uniform texture2D uDiffuseTexture;\n\tlayout( location = 0 ) out vec4 outColor;\n\t\n\tlayout( location = 1 ) out vec4 out_MouseColorID_Depth;\n\tvoid main() {\n\t\tvec4 diffuseColor = vec4(0.0);\n\t\tif(fragmentUniforms.__diffuseTextureRenderYn == TRUTHY) diffuseColor = texture(sampler2D(uDiffuseTexture, uSampler), vUV) ;\n\t\t\n\t\tif(diffuseColor.a<0.05) discard;\n\t\t\t\n\t\toutColor = diffuseColor;\n\t\toutColor.a *= fragmentUniforms.alpha * vSumOpacity;\n\t\tout_MouseColorID_Depth = vec4(vMouseColorID, gl_FragCoord.z/gl_FragCoord.w, 0.0, 0.0);\n\t\t\n\t}\n`),Ve(jr,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(jr,"uniformsBindGroupLayoutDescriptor_material",{entries:[{binding:0,visibility:GPUShaderStage.VERTEX,type:"uniform-buffer"},{binding:1,visibility:GPUShaderStage.FRAGMENT,type:"uniform-buffer"},{binding:2,visibility:GPUShaderStage.FRAGMENT,type:"sampler"},{binding:3,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture"}]}),Ve(jr,"uniformBufferDescriptor_vertex",[{size:$e.float4,valueName:"sheetRect"}]),Ve(jr,"uniformBufferDescriptor_fragment",[{size:$e.float,valueName:"alpha"},{size:$e.float,valueName:"__diffuseTextureRenderYn"}]);const tn={};class en{constructor(t,e={}){if(e={magFilter:e.magFilter||"linear",minFilter:e.minFilter||"linear",mipmapFilter:e.mipmapFilter||"linear",addressModeU:e.addressModeU||"repeat",addressModeV:e.addressModeV||"repeat",addressModeW:e.addressModeW||"repeat"},this.string=JSON.stringify(e),tn[this.string])return tn[this.string];this.GPUSampler=t.device.createSampler(e),tn[this.string]=this}}let rn,nn,an=new Set;class on{get detector(){return Oe(this,ln)}constructor(t,e){sn.set(this,{writable:!0,value:0}),un.set(this,{writable:!0,value:0}),ln.set(this,{writable:!0,value:void 0}),Ve(this,"viewList",[]),new Promise(async t=>{nn?(nn.compileGLSL(` ${tr.GLSL_VERSION}\nvoid main(){} `,"vertex"),nn.compileGLSL(` ${tr.GLSL_VERSION}\nvoid main(){} `,"fragment"),t()):(rn=await import("https://unpkg.com/@webgpu/glslang@0.0.15/dist/web-devel/glslang.js"),nn=await rn.default(),nn.compileGLSL(` ${tr.GLSL_VERSION}\nvoid main(){} `,"vertex"),nn.compileGLSL(` ${tr.GLSL_VERSION}\nvoid main(){} `,"fragment"),t())}).then(r=>{Ye(this,ln,new Je(this));let n=!0;navigator.gpu?navigator.gpu.requestAdapter({powerPreference:"high-performance"}).then(r=>{r.requestDevice({}).then(r=>{this.glslang=nn,this.canvas=t,this.context=t.getContext("gpupresent"),this.device=r,this.swapChainFormat="bgra8unorm",this.swapChain=function(t,e,r){const n={device:t,format:e,usage:GPUTextureUsage.OUTPUT_ATTACHMENT|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC};return r.configureSwapChain(n)}(this.device,this.swapChainFormat,this.context),this.state={Geometry:new Map,Buffer:{vertexBuffer:new Map,indexBuffer:new Map},emptySampler:new en(this),emptyTextureView:r.createTexture({size:{width:1,height:1,depth:1},format:"r8unorm",usage:GPUTextureUsage.SAMPLED}).createView(),emptyCubeTextureView:r.createTexture({size:{width:1,height:1,depth:1},dimension:"2d",mipLevelCount:1,sampleCount:1,format:"r8unorm",usage:GPUTextureUsage.SAMPLED}).createView({format:"r8unorm",dimension:"cube",aspect:"all",baseMipLevel:0,mipLevelCount:1,baseArrayLayer:0,arrayLayerCount:6})},[Oe(this,ln).click,Oe(this,ln).move,Oe(this,ln).down,Oe(this,ln).up].forEach(t=>{let e,r,n,i;e="offsetX",r="offsetY",this.canvas.addEventListener(t,t=>{let e,r,a;for(t.preventDefault(),Oe(this,ln).isMobile?t.changedTouches[0]&&(e={type:t.type,x:t.changedTouches[0].clientX,y:t.changedTouches[0].clientY,nativeEvent:t},n=t.changedTouches[0].clientX,i=t.changedTouches[0].clientY):(e={type:t.type,x:t.offsetX,y:t.offsetY,nativeEvent:t},n=t.offsetX,i=t.offsetY),r=this.viewList.length;r--;)a=this.viewList[r],a.mouseEventChecker.mouseEventInfo.push(e),a.mouseX=n-a.viewRect[0],a.mouseY=i-a.viewRect[1]},!1)}),Oe(this,ln).detectGPU(),this.setSize("100%","100%"),an.size||window.addEventListener("resize",t=>{for(const t of an)t.setSize()}),an.add(this),e.call(this,!0),new Rr(this),new Br(this),new Xr(this),new zr(this),new Dr(this),new Yr(this),new Ar(this),new Ir(this),new $r(this),new Wr(this),new jr(this)})}).catch(t=>{n=!1,e(!1,t)}):e(n=!1,"navigate.gpu is null")})}addView(t){this.viewList.push(t),t.resetTexture(this)}removeView(t){this.viewList.includes(t)&&this.viewList.splice(t,1)}setSize(t=Oe(this,sn),e=Oe(this,un)){let r,n;Ye(this,sn,t),Ye(this,un,e);let i=document.body.getBoundingClientRect();i.height=window.innerHeight,r="number"!=typeof t&&t.includes("%")?parseInt(+i.width*t.replace("%","")/100):t,n="number"!=typeof e&&e.includes("%")?parseInt(+i.height*e.replace("%","")/100):e,r<1&&(r=1),n<1&&(n=1),this.canvas.width=r,this.canvas.height=n,this.canvas.style.width=r+"px",this.canvas.style.height=n+"px",this.viewList.forEach(t=>{t.setSize(),t.setLocation()})}}var sn=new WeakMap,un=new WeakMap,ln=new WeakMap;Ve(on,"useDebugConsole",!1);class fn extends ze{constructor(t){super(),mn.set(this,{writable:!0,value:void 0}),Ve(this,"GPUBuffer",void 0),Ve(this,"uniformBufferDescriptor",void 0),t instanceof on||qe.throwFunc(`${this.constructor.name} - only allow redGPUContext Instance.- inputValue : ${t} { type : ${typeof t} }`),Ye(this,mn,t)}setBuffer(t){t instanceof je||qe.throwFunc(`${this.constructor.name} - only allow UniformBufferDescriptor Instance.- inputValue : ${t} { type : ${typeof t} }`),this.GPUBuffer&&this.GPUBuffer.destroy(),this.GPUBuffer=Oe(this,mn).device.createBuffer(t),this.float32Array=new Float32Array(t.size/Float32Array.BYTES_PER_ELEMENT),this.uniformBufferDescriptor=t}}var mn=new WeakMap;class cn extends ze{get children(){return this._children}set children(t){this._children=t}constructor(){super(),Ve(this,"_children",[]),Ve(this,"_parent",void 0)}addChild(...t){t.forEach(t=>{t instanceof kn||qe.throwFunc(`addChild - only allow BaseObject3D Instance. - inputValue : ${t} { type : ${typeof t} }`),this._children.includes(t)?qe.throwFunc(`${t} : Already registered object. - inputValue : ${t} { type : ${typeof t} }`):(t._parent=this.directionalLightList?null:this,this._children.push(t))}),cn.needFlatListUpdate=!0}addChildAt(t,e){t instanceof kn||qe.throwFunc(`addChildAt - only allow BaseObject3D Instance. - inputValue : ${t}, ${e} { type : ${typeof t}, ${typeof e} }`),this._children.includes(t)&&this.removeChild(t),this._children.length<e&&(e=this._children.length),null!=e?this._children.splice(e,0,t):(t._parent=this.directionalLightList?null:this,this._children.push(t)),cn.needFlatListUpdate=!0}removeChild(t){this._children.includes(t)?(t._parent=null,this._children.splice(this._children.indexOf(t),1)):qe.throwFunc(`removeChild - Attempt to delete an object that does not exist. - inputValue : ${t} { type : ${typeof t} }`),cn.needFlatListUpdate=!0}removeChildAt(t){this._children[t]?(this._children[t]._parent=null,this._children.splice(t,1)):qe.throwFunc(`removeChildAt - No object at index. - inputValue : ${t} { type : ${typeof t} }`),cn.needFlatListUpdate=!0}removeChildAll(){let t=this._children.length;for(;t--;)this._children[t]._parent=null;this._children.length=0,cn.needFlatListUpdate=!0}getChildAt(t){return this._children[t]}getChildIndex(t){this._children.indexOf(t)}numChildren(){return this._children.length}}class hn extends ze{constructor(t,e){super(),dn.set(this,{writable:!0,value:void 0}),pn.set(this,{writable:!0,value:void 0}),Ve(this,"GPURenderPipeline",void 0),Ye(this,dn,t),Ye(this,pn,e),this.GPURenderPipeline=null}update(t,e){let r=Oe(this,pn);const n=t.device,i={layout:n.createPipelineLayout({bindGroupLayouts:[e.systemUniformInfo_vertex.GPUBindGroupLayout,e.systemUniformInfo_fragment.GPUBindGroupLayout,r.GPUBindGroupLayout,r._material.GPUBindGroupLayout]}),vertexStage:{module:r._material.vShaderModule.GPUShaderModule,entryPoint:"main"},fragmentStage:{module:r._material.fShaderModule.GPUShaderModule,entryPoint:"main"},vertexState:r._geometry.vertexState,colorStates:[{format:t.swapChainFormat,colorBlend:{srcFactor:r._blendColorSrc,dstFactor:r._blendColorDst,operation:"add"},alphaBlend:{srcFactor:r._blendAlphaSrc,dstFactor:r._blendAlphaDst,operation:"add"}},{format:"rgba32float"}],rasterizationState:{frontFace:"ccw",cullMode:r._cullMode},primitiveTopology:r._primitiveTopology,depthStencilState:{format:"depth24plus-stencil8",depthWriteEnabled:r._depthWriteEnabled,depthCompare:r._depthCompare},sampleCount:4};this.GPURenderPipeline=n.createRenderPipeline(i)}}var dn=new WeakMap,pn=new WeakMap;class vn{constructor(t){_n.set(this,{writable:!0,value:[]})}get effectList(){return Oe(this,_n)}addEffect(t){Oe(this,_n).push(t)}removeEffect(t){Oe(this,_n).includes(t)?Oe(this,_n).splice(Oe(this,_n).indexOf(t),1):qe.throwFunc(`removeEffect - Attempt to delete an object that does not exist. - inputValue : ${t} { type : ${typeof t} }`)}}var _n=new WeakMap;let gn=function(t){if(t.length){let e=t.shift();e.info[e.type].call(e.info.target,{target:e.info.target,type:"out"})}};class xn extends ze{get mouseEventInfo(){return Oe(this,Mn)}constructor(t){super(),yn.set(this,{writable:!0,value:void 0}),Sn.set(this,{writable:!0,value:void 0}),Tn.set(this,{writable:!0,value:[]}),Un.set(this,{writable:!0,value:void 0}),bn.set(this,{writable:!0,value:void 0}),Mn.set(this,{writable:!0,value:[]}),Ve(this,"checkMouseEvent",(function(t,e){let r,n;for(r=0,n=Oe(this,Mn).length;r<n;r++){let n,i,a=Oe(this,Mn)[r];e&&(n=xn.mouseMAP[e]),n?(a.type==t.detector.down&&(i="down",i&&n[i]&&n[i].call(n.target,{target:n.target,type:i,nativeEvent:a.nativeEvent})),a.type==t.detector.up&&(i="up",i&&n[i]&&n[i].call(n.target,{target:n.target,type:i,nativeEvent:a.nativeEvent})),Oe(this,bn)&&Oe(this,bn)!=n&&(i="out",i&&Oe(this,bn)[i]&&Oe(this,bn)[i].call(Oe(this,bn).target,{target:Oe(this,bn).target,type:i})),Oe(this,bn)!=n&&(i="over",i&&n[i]&&n[i].call(n.target,{target:n.target,type:i,nativeEvent:a.nativeEvent})),Ye(this,bn,n)):(i="out",Oe(this,bn)&&Oe(this,bn)[i]&&Oe(this,Tn).push({info:Oe(this,bn),type:i,nativeEvent:a.nativeEvent}),Ye(this,bn,null)),gn(Oe(this,Tn))}Oe(this,bn)?this.cursorState="pointer":this.cursorState="default",Oe(this,Mn).length=0})),Ve(this,"check",t=>(Oe(this,yn)||(Ye(this,yn,Oe(this,Un).readPixelArrayBuffer(t,Oe(this,Un),Oe(this,Un).baseAttachment_mouseColorID_depth_ResolveTarget,Oe(this,Un).mouseX,Oe(this,Un).mouseY)),Oe(this,yn).then(e=>{Ye(this,yn,null),Ye(this,Sn,Math.round(new Float32Array(e)[0])),this.checkMouseEvent(t,Oe(this,Sn))})),this.cursorState)),Ye(this,Un,t)}}var yn=new WeakMap,Sn=new WeakMap,Tn=new WeakMap,Un=new WeakMap,bn=new WeakMap,Mn=new WeakMap;Ve(xn,"mouseMAP",{});class Pn extends ze{get mouseEventChecker(){return Oe(this,Nn)}get useFrustumCulling(){return this._useFrustumCulling}set useFrustumCulling(t){this._useFrustumCulling=t}get postEffect(){return Oe(this,In)}get scene(){return Oe(this,En)}set scene(t){Ye(this,En,t)}get camera(){return Oe(this,Gn)}set camera(t){Ye(this,Gn,t)}get y(){return this._y}get x(){return this._x}get width(){return Oe(this,Dn)}get height(){return Oe(this,Ln)}get viewRect(){return Oe(this,Bn)}constructor(t,e,r){super(),wn.set(this,{writable:!0,value:void 0}),En.set(this,{writable:!0,value:void 0}),Gn.set(this,{writable:!0,value:void 0}),Ve(this,"projectionMatrix",void 0),Ve(this,"_x",0),Ve(this,"_y",0),Dn.set(this,{writable:!0,value:"100%"}),Ln.set(this,{writable:!0,value:"100%"}),Bn.set(this,{writable:!0,value:[]}),Ve(this,"systemUniformInfo_vertex",void 0),Ve(this,"systemUniformInfo_fragment",void 0),Rn.set(this,{writable:!0,value:void 0}),Cn.set(this,{writable:!0,value:void 0}),Ve(this,"baseAttachment",void 0),Ve(this,"baseAttachmentView",void 0),Ve(this,"baseAttachment_ResolveTarget",void 0),Ve(this,"baseAttachment_ResolveTargetView",void 0),Ve(this,"baseAttachment_mouseColorID_depth",void 0),Ve(this,"baseAttachment_mouseColorID_depthView",void 0),Ve(this,"baseAttachment_mouseColorID_depth_ResolveTarget",void 0),Ve(this,"baseAttachment_mouseColorID_depth_ResolveTargetView",void 0),Ve(this,"baseDepthStencilAttachment",void 0),Ve(this,"baseDepthStencilAttachmentView",void 0),In.set(this,{writable:!0,value:void 0}),Ve(this,"debugLightList",[]),Ve(this,"mouseX",0),Ve(this,"mouseY",0),Ve(this,"_useFrustumCulling",!0),Nn.set(this,{writable:!0,value:void 0}),Fn.set(this,{writable:!0,value:function(t){let e=$e.mat4+$e.mat4+$e.float2+$e.float;const r={size:e,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST},n={entries:[{binding:0,visibility:GPUShaderStage.VERTEX,type:"uniform-buffer"}]};let i,a,o,s;return Ye(this,Rn,new Float32Array(e/Float32Array.BYTES_PER_ELEMENT)),s={layout:a=t.createBindGroupLayout(n),entries:[{binding:0,resource:{buffer:i=t.createBuffer(r),offset:0,size:e}}]},o=t.createBindGroup(s),{GPUBuffer:i,GPUBindGroupLayout:a,GPUBindGroup:o}}}),An.set(this,{writable:!0,value:function(t){let e=$e.float4+2*$e.float4*tr.MAX_DIRECTIONAL_LIGHT+3*$e.float4*tr.MAX_POINT_LIGHT+$e.float4*$e.float4+3*$e.float4*tr.MAX_SPOT_LIGHT+$e.float4+$e.float2;const r={size:e,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST},n={entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,type:"uniform-buffer"}]};let i,a,o,s;return Ye(this,Cn,new Float32Array(e/Float32Array.BYTES_PER_ELEMENT)),s={layout:a=t.createBindGroupLayout(n),entries:[{binding:0,resource:{buffer:i=t.createBuffer(r),offset:0,size:e}}]},o=t.createBindGroup(s),{GPUBuffer:i,GPUBindGroupLayout:a,GPUBindGroup:o}}}),Ve(this,"readPixelArrayBuffer",async(t,e,r,n=0,i=0,a=1,o=1)=>{let s=e.viewRect;if(n>0&&n<s[2]&&i>0&&i<s[3]){let e,s,u,l,f;return e=t.device.createCommandEncoder(),s=t.device.createBuffer({size:16*a*o,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),u={texture:r,origin:{x:n,y:i,z:0}},l={buffer:s,bytesPerRow:Math.max(256,4*a*o),rowsPerImage:1},f={width:a,height:o,depth:1},e.copyTextureToBuffer(u,l,f),t.device.defaultQueue.submit([e.finish()]),s=t.device.createBufferMapped({size:16*a*o,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})[0],new Promise(t=>{l.buffer.mapReadAsync().then(e=>{s.unmap(),s.destroy(),s=null,t(e)})})}}),Ye(this,wn,t),this.camera=r,this.scene=e,this.systemUniformInfo_vertex=Oe(this,Fn).call(this,t.device),this.systemUniformInfo_fragment=Oe(this,An).call(this,t.device),this.projectionMatrix=Ae.mat4.create(),Ye(this,In,new vn(t)),Ye(this,Nn,new xn(this))}resetTexture(t){Ye(this,Bn,this.getViewRect(t));let e={colorAttachments:[{key:"baseAttachment",format:t.swapChainFormat,usage:GPUTextureUsage.OUTPUT_ATTACHMENT,resolveUsage:GPUTextureUsage.OUTPUT_ATTACHMENT|GPUTextureUsage.COPY_SRC|GPUTextureUsage.SAMPLED},{key:"baseAttachment_mouseColorID_depth",format:"rgba32float",usage:GPUTextureUsage.OUTPUT_ATTACHMENT,resolveUsage:GPUTextureUsage.OUTPUT_ATTACHMENT|GPUTextureUsage.COPY_SRC|GPUTextureUsage.SAMPLED}],depthStencilAttachment:{key:"baseDepthStencilAttachment",format:"depth24plus-stencil8",usage:GPUTextureUsage.OUTPUT_ATTACHMENT}},r={width:Oe(this,Bn)[2],height:Oe(this,Bn)[3],depth:1};[...e.colorAttachments,e.depthStencilAttachment].forEach(e=>{let n=e.key,i=e.format,a=e.usage,o=e.resolveUsage;this[n]&&(this[n].destroy(),o&&this[n+"_ResolveTarget"].destroy()),this[n]=t.device.createTexture({size:r,sampleCount:4,format:i,usage:a}),this[n+"View"]=this[n].createView(),o&&(this[n+"_ResolveTarget"]=t.device.createTexture({size:r,sampleCount:1,format:i,usage:o}),this[n+"_ResolveTargetView"]=this[n+"_ResolveTarget"].createView())})}updateSystemUniform(t,e){let r,n,i,a,o,s;for(r=this.systemUniformInfo_vertex,n=this.systemUniformInfo_fragment,Ye(this,Bn,this.getViewRect(e)),a=0,i=Math.abs(Oe(this,Bn)[2]/Oe(this,Bn)[3]),this.camera.hasOwnProperty("farClipping")?Ae.mat4.perspective(this.projectionMatrix,Math.PI/180*this.camera.fov,i,this.camera.nearClipping,this.camera.farClipping):(Ae.mat4.ortho(this.projectionMatrix,0,1,0,1,-1e3,1e3),Ae.mat4.scale(this.projectionMatrix,this.projectionMatrix,[1/Oe(this,Bn)[2],1/Oe(this,Bn)[3],1]),Ae.mat4.translate(this.projectionMatrix,this.projectionMatrix,[0,Oe(this,Bn)[3],0])),Oe(this,Rn).set(this.projectionMatrix,a),a+=$e.mat4/Float32Array.BYTES_PER_ELEMENT,Oe(this,Rn).set(this.camera.matrix,a),a+=$e.mat4/Float32Array.BYTES_PER_ELEMENT,Oe(this,Rn).set([Oe(this,Bn)[2],Oe(this,Bn)[3],performance.now()],a),a+=$e.float2/Float32Array.BYTES_PER_ELEMENT,a=0,Oe(this,Cn).set([this.scene.directionalLightList.length,this.scene.pointLightList.length,this.scene.spotLightList.length],a),this.debugLightList.length=0,o=0,a=$e.float4/Float32Array.BYTES_PER_ELEMENT,s=this.scene.directionalLightList.length;o<s;o++){let t=this.scene.directionalLightList[o];t&&(Oe(this,Cn).set(t._colorRGBA,a),a+=$e.float4/Float32Array.BYTES_PER_ELEMENT,Oe(this,Cn).set([t._x,t._y,t._z,t._intensity],a),a+=$e.float4/Float32Array.BYTES_PER_ELEMENT,t.useDebugMesh&&this.debugLightList.push(t._debugMesh))}for(a=($e.float4+2*$e.float4*tr.MAX_DIRECTIONAL_LIGHT)/Float32Array.BYTES_PER_ELEMENT,o=0,s=this.scene.pointLightList.length;o<s;o++){let t=this.scene.pointLightList[o];t&&(Oe(this,Cn).set(t._colorRGBA,a),a+=$e.float4/Float32Array.BYTES_PER_ELEMENT,Oe(this,Cn).set([t._x,t._y,t._z,t._intensity],a),a+=$e.float4/Float32Array.BYTES_PER_ELEMENT,Oe(this,Cn).set([t._radius],a),a+=$e.float4/Float32Array.BYTES_PER_ELEMENT,t.useDebugMesh&&this.debugLightList.push(t._debugMesh))}a=($e.float4+2*$e.float4*tr.MAX_DIRECTIONAL_LIGHT+3*$e.float4*tr.MAX_POINT_LIGHT)/Float32Array.BYTES_PER_ELEMENT;let u=this.scene.ambientLight;for(Oe(this,Cn).set(u?u._colorRGBA:[0,0,0,0],a),a+=$e.float4/Float32Array.BYTES_PER_ELEMENT,Oe(this,Cn).set([u?u._intensity:1],a),a+=$e.float4/Float32Array.BYTES_PER_ELEMENT,o=0,s=this.scene.spotLightList.length;o<s;o++){let t=this.scene.spotLightList[o];t&&(Oe(this,Cn).set(t._colorRGBA,a),a+=$e.float4/Float32Array.BYTES_PER_ELEMENT,Oe(this,Cn).set([t._x,t._y,t._z,t._intensity],a),a+=$e.float4/Float32Array.BYTES_PER_ELEMENT,Oe(this,Cn).set([t.cutoff,t.exponent],a),a+=$e.float4/Float32Array.BYTES_PER_ELEMENT,t.useDebugMesh&&this.debugLightList.push(t._debugMesh.children))}a=($e.float4+2*$e.float4*tr.MAX_DIRECTIONAL_LIGHT+3*$e.float4*tr.MAX_POINT_LIGHT+3*$e.float4*tr.MAX_SPOT_LIGHT+2*$e.float4)/Float32Array.BYTES_PER_ELEMENT,Oe(this,Cn).set([this.camera.x,this.camera.y,this.camera.z],a),a+=$e.float4/Float32Array.BYTES_PER_ELEMENT,Oe(this,Cn).set([Oe(this,Bn)[2],Oe(this,Bn)[3]],a),t.setBindGroup(0,r.GPUBindGroup),t.setBindGroup(1,n.GPUBindGroup),r.GPUBuffer.setSubData(0,Oe(this,Rn)),n.GPUBuffer.setSubData(0,Oe(this,Cn))}getViewRect(t){return["number"==typeof this.x?this.x:parseInt(this.x)/100*t.canvas.width,"number"==typeof this.y?this.y:parseInt(this.y)/100*t.canvas.height,"number"==typeof this.width?this.width:parseInt(parseInt(this.width)/100*t.canvas.width),"number"==typeof this.height?this.height:parseInt(parseInt(this.height)/100*t.canvas.height)]}setSize(t=Oe(this,Dn),e=Oe(this,Ln)){let r=Oe(this,Bn).toString();"number"==typeof t?Ye(this,Dn,t<1?1:parseInt(t)):t.includes("%")&&+t.replace("%","")>=0?Ye(this,Dn,t):qe.throwFunc("View setSize : width는 0이상의 숫자나 %만 허용.",t),"number"==typeof e?Ye(this,Ln,e<1?1:parseInt(e)):e.includes("%")&&+e.replace("%","")>=0?Ye(this,Ln,e):qe.throwFunc("View setSize : height는 0이상의 숫자나 %만 허용.",e),this.getViewRect(Oe(this,wn)).toString()!=r&&this.resetTexture(Oe(this,wn))}setLocation(t=this._x,e=this._y){"number"==typeof t?this._x=parseInt(t):t.includes("%")&&+t.replace("%","")>=0?this._x=t:qe.throwFunc("View setLocation : x는 0이상의 숫자나 %만 허용.",t),"number"==typeof e?this._y=parseInt(e):e.includes("%")&&+e.replace("%","")>=0?this._y=e:qe.throwFunc("View setLocation : y는 0이상의 숫자나 %만 허용.",e),this.getViewRect(Oe(this,wn))}computeViewFrustumPlanes(){let t=Ae.mat4.create();Ae.mat4.multiply(t,this.projectionMatrix,this.camera.matrix);let e=[];e[0]=[t[3]-t[0],t[7]-t[4],t[11]-t[8],t[15]-t[12]],e[1]=[t[3]+t[0],t[7]+t[4],t[11]+t[8],t[15]+t[12]],e[2]=[t[3]+t[1],t[7]+t[5],t[11]+t[9],t[15]+t[13]],e[3]=[t[3]-t[1],t[7]-t[5],t[11]-t[9],t[15]-t[13]],e[4]=[t[3]-t[2],t[7]-t[6],t[11]-t[10],t[15]-t[14]],e[5]=[t[3]+t[2],t[7]+t[6],t[11]+t[10],t[15]+t[14]];for(let t=0;t<e.length;t++){let r=e[t],n=Math.sqrt(r[0]*r[0]+r[1]*r[1]+r[2]*r[2]);r[0]/=n,r[1]/=n,r[2]/=n,r[3]/=n}return e}}var wn=new WeakMap,En=new WeakMap,Gn=new WeakMap,Dn=new WeakMap,Ln=new WeakMap,Bn=new WeakMap,Rn=new WeakMap,Cn=new WeakMap,In=new WeakMap,Nn=new WeakMap,Fn=new WeakMap,An=new WeakMap;const Vn=[];let On=0,Yn=0,Xn=new Float32Array(1);const zn=new je([{size:$e.mat4*tr.MESH_UNIFORM_POOL_NUM,valueName:"matrix"},{size:$e.mat4*tr.MESH_UNIFORM_POOL_NUM,valueName:"normalMatrix"}]);let $n=0;class kn extends cn{get sumOpacity(){return this._sumOpacity}set sumOpacity(t){this._sumOpacity=t,Xn[0]=this._sumOpacity,this.uniformBuffer_mesh.GPUBuffer.setSubData($e.float2,Xn)}get opacity(){return this._opacity}set opacity(t){this._opacity=t}get renderDrawLayerIndex(){return this._renderDrawLayerIndex}set renderDrawLayerIndex(t){this._renderDrawLayerIndex=t}get blendColorSrc(){return this._blendColorSrc}set blendColorSrc(t){this._blendColorSrc=t,this.dirtyPipeline=!0}get blendColorDst(){return this._blendColorDst}set blendColorDst(t){this._blendColorDst=t,this.dirtyPipeline=!0}get blendAlphaDst(){return this._blendAlphaDst}set blendAlphaDst(t){this._blendAlphaDst=t,this.dirtyPipeline=!0}get blendAlphaSrc(){return this._blendAlphaSrc}set blendAlphaSrc(t){this._blendAlphaSrc=t,this.dirtyPipeline=!0}get x(){return this._x}set x(t){this._x=t,this.dirtyTransform=!0}get y(){return this._y}set y(t){this._y=t,this.dirtyTransform=!0}get z(){return this._z}set z(t){this._z=t,this.dirtyTransform=!0}getPosition(){return[this._x,this._y,this._z]}setPosition(t,e,r){this._x=t,this._y=e,this._z=r,this.dirtyTransform=!0}get pivotZ(){return this._pivotZ}set pivotZ(t){this._pivotZ=t,this.dirtyTransform=!0}get pivotY(){return this._pivotY}set pivotY(t){this._pivotY=t,this.dirtyTransform=!0}get pivotX(){return this._pivotX}set pivotX(t){this._pivotX=t,this.dirtyTransform=!0}getPivotPosition(){return[this._pivotX,this._pivotY,this._pivotZ]}setPivotPosition(t,e,r){this._pivotX=t,this._pivotY=e,this._pivotZ=r,this.dirtyTransform=!0}get rotationX(){return this._rotationX}set rotationX(t){this._rotationX=t,this.dirtyTransform=!0}get rotationY(){return this._rotationY}set rotationY(t){this._rotationY=t,this.dirtyTransform=!0}get rotationZ(){return this._rotationZ}set rotationZ(t){this._rotationZ=t,this.dirtyTransform=!0}getRotation(){return[this._rotationX,this._rotationY,this._rotationZ]}setRotation(t,e,r){this._rotationX=t,this._rotationY=e,this._rotationZ=r,this.dirtyTransform=!0}get scaleX(){return this._scaleX}set scaleX(t){this._scaleX=t,this.dirtyTransform=!0}get scaleY(){return this._scaleY}set scaleY(t){this._scaleY=t,this.dirtyTransform=!0}get scaleZ(){return this._scaleZ}set scaleZ(t){this._scaleZ=t,this.dirtyTransform=!0}getScale(){return[this._scaleX,this._scaleY,this._scaleZ]}setScale(t,e,r){this._scaleX=t,this._scaleY=e,this._scaleZ=r,this.dirtyTransform=!0}get geometry(){return this._geometry}set geometry(t){this._geometry=t,this.dirtyPipeline=!0}get material(){return this._material}set material(t){this._material=t,this.dirtyPipeline=!0}get depthWriteEnabled(){return this._depthWriteEnabled}set depthWriteEnabled(t){this.dirtyPipeline=!0,this._depthWriteEnabled=t}get depthCompare(){return this._depthCompare}set depthCompare(t){this.dirtyPipeline=!0,this._depthCompare=t}get cullMode(){return this._cullMode}set cullMode(t){this.dirtyPipeline=!0,this._cullMode=t}get primitiveTopology(){return this._primitiveTopology}set primitiveTopology(t){this.dirtyPipeline=!0,this._primitiveTopology=t}constructor(t){super(),Ve(this,"_x",0),Ve(this,"_y",0),Ve(this,"_z",0),Ve(this,"_pivotX",0),Ve(this,"_pivotY",0),Ve(this,"_pivotZ",0),Ve(this,"_rotationX",0),Ve(this,"_rotationY",0),Ve(this,"_rotationZ",0),Ve(this,"_scaleX",1),Ve(this,"_scaleY",1),Ve(this,"_scaleZ",1),Ve(this,"dirtyTransform",!0),Ve(this,"dirtyPipeline",!0),Ve(this,"_material",void 0),Ve(this,"_geometry",void 0),Wn.set(this,{writable:!0,value:void 0}),Ve(this,"_depthWriteEnabled",!0),Ve(this,"_depthCompare","less-equal"),Ve(this,"_cullMode","back"),Ve(this,"_primitiveTopology","triangle-list"),Ve(this,"_blendColorSrc","src-alpha"),Ve(this,"_blendColorDst","one-minus-src-alpha"),Ve(this,"_blendAlphaSrc","one"),Ve(this,"_blendAlphaDst","one-minus-src-alpha"),Ve(this,"pipeline",void 0),Zn.set(this,{writable:!0,value:void 0}),Hn.set(this,{writable:!0,value:0}),Ve(this,"_renderDrawLayerIndex",va.DRAW_LAYER_INDEX0),Ve(this,"_sumOpacity",1),Ve(this,"_opacity",1),Ve(this,"targetTo",(t=>{let e=new Float32Array([0,1,0]),r=[],n=[],i=Ae.mat4.create();return function(t,a,o){r[0]=t,r[1]=a,r[2]=o,Ae.mat4.identity(i),Ae.mat4.targetTo(i,[this._x,this._y,this._z],r,e),n=qe.mat4ToEuler(i,[]),this._rotationX=180*-n[0]/Math.PI,this._rotationY=180*-n[1]/Math.PI,this._rotationZ=180*-n[2]/Math.PI,this.dirtyTransform=!0}})()),Ve(this,"localToWorld",(t=>{let e;return e=Ae.mat4.create(),function(t=0,r=0,n=0){return"number"==typeof t||qe.throwFunc("BaseObject3D - localToWorld : x - number만 허용함","입력값 : ",t),"number"==typeof r||qe.throwFunc("BaseObject3D - localToWorld : y - number만 허용함","입력값 : ",r),"number"==typeof n||qe.throwFunc("BaseObject3D - localToWorld : z - number만 허용함","입력값 : ",n),e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t,e[13]=r,e[14]=n,e[15]=1,Ae.mat4.multiply(e,this.matrix,e),[e[12],e[13],e[14]]}})()),Ve(this,"worldToLocal",(t=>{let e,r;return e=Ae.mat4.create(),r=Ae.mat4.create(),function(t=0,n=0,i=0){return"number"==typeof t||qe.throwFunc("BaseObject3D - worldToLocal : x - number만 허용함","입력값 : ",t),"number"==typeof n||qe.throwFunc("BaseObject3D - worldToLocal : y - number만 허용함","입력값 : ",n),"number"==typeof i||qe.throwFunc("BaseObject3D - worldToLocal : z - number만 허용함","입력값 : ",i),Ae.mat4.invert(e,this.matrix),Ae.mat4.transpose(e,e),Ae.mat4.multiply(r,e,this.matrix),[r[0]*t+r[1]*n+r[2]*i+r[3],r[4]*t+r[5]*n+r[6]*i+r[7],r[8]*t+r[9]*n+r[10]*i+r[11]]}})()),Ve(this,"getScreenPoint",(t=>{let e,r,n,i=Ae.mat4.create(),a=Ae.mat4.create();return n={x:0,y:0,z:0,w:0},function(t,o=0,s=0,u=0){let l=this.localToWorld(o,s,u);return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=l[0],a[13]=l[1],a[14]=l[2],a[15]=1,t instanceof Pn||qe.throwFunc("BaseObject3D - getScreenPoint : redView - RedView Instance 만 허용함","입력값 : ",t),e=t.camera,r=t.viewRect,Ae.mat4.multiply(i,t.projectionMatrix,e.matrix),Ae.mat4.multiply(i,i,a),n.x=i[12],n.y=i[13],n.z=i[14],n.w=i[15],n.x=.5*n.x/n.w+.5,n.y=.5*n.y/n.w+.5,[(r[0]+n.x*r[2])/window.devicePixelRatio,(r[1]+(1-n.y)*r[3])/window.devicePixelRatio]}})()),Ye(this,Wn,t);let e=function(t,e){let r;Vn[Yn]||(r=new fn(t),r.setBuffer(zn),Vn[Yn]=r),r=Vn[Yn];let n={float32Array:r.float32Array,uniformBuffer_meshMatrix:r,offsetMatrix:$e.mat4*On,offsetNormalMatrix:$e.mat4*tr.MESH_UNIFORM_POOL_NUM+$e.mat4*On,uniformIndex:On};return On++,On==tr.MESH_UNIFORM_POOL_NUM&&(Yn++,On=0),n}(t);this.uniformBuffer_meshMatrix=e.uniformBuffer_meshMatrix,this.uniformBuffer_meshMatrix.meshFloat32Array=e.float32Array,this.offsetMatrix=e.offsetMatrix,this.offsetNormalMatrix=e.offsetNormalMatrix,$n++,Ye(this,Hn,$n),this.uniformBuffer_mesh=new fn(t),this.uniformBuffer_mesh.setBuffer(kn.uniformBufferDescriptor_meshIndex),this.uniformBuffer_mesh.GPUBuffer.setSubData(0,new Float32Array([e.uniformIndex])),this.uniformBuffer_mesh.GPUBuffer.setSubData($e.float,new Float32Array([Oe(this,Hn)])),this.sumOpacity=1,Ye(this,Zn,[{binding:0,resource:{buffer:this.uniformBuffer_meshMatrix.GPUBuffer,offset:0,size:2*$e.mat4*tr.MESH_UNIFORM_POOL_NUM}},{binding:1,resource:{buffer:this.uniformBuffer_mesh.GPUBuffer,offset:0,size:$e.float}}]),this.GPUBindGroupLayout=t.device.createBindGroupLayout(kn.uniformsBindGroupLayoutDescriptor_mesh),this.GPUBindGroup=Oe(this,Wn).device.createBindGroup({layout:this.GPUBindGroupLayout,entries:Oe(this,Zn)}),this.pipeline=new hn(t,this),this.normalMatrix=Ae.mat4.create(),this.matrix=Ae.mat4.create(),this.localMatrix=Ae.mat4.create()}addEventListener(t,e){xn.mouseMAP[Oe(this,Hn)]||(xn.mouseMAP[Oe(this,Hn)]={target:this}),xn.mouseMAP[Oe(this,Hn)][t]=e}removeEventListener(t){xn.mouseMAP[Oe(this,Hn)]&&(xn.mouseMAP[Oe(this,Hn)][t]=null)}}var Wn=new WeakMap,Zn=new WeakMap,Hn=new WeakMap;Ve(kn,"uniformsBindGroupLayoutDescriptor_mesh",{entries:[{binding:0,visibility:GPUShaderStage.VERTEX,type:"uniform-buffer"},{binding:1,visibility:GPUShaderStage.VERTEX,type:"uniform-buffer"}]}),Ve(kn,"uniformBufferDescriptor_meshIndex",new je([{size:$e.float,valueName:"meshUniformIndex"},{size:$e.float,valueName:"mouseColorID"},{size:$e.float,valueName:"sumOpacity"}]));class qn extends kn{constructor(t,e,r){super(t),this.geometry=e,this.material=r}}const jn={};class Jn extends ze{constructor(t,e,r,n=Jn.TYPE_2D){if(super(),this.callback=r,n===Jn.TYPE_2D){let t=location.pathname.split("/");t.length>1&&t.pop();let n=location.origin+t.join("/")+"/"+e;(e.includes(";base64,")||e.includes("://"))&&(n=e),jn[n]?jn[n].loaded?(this.imageDatas=jn[n].imageDatas,r&&r.call(this,{ok:!0})):jn[n].tempList.push(this):(jn[n]={loaded:!1,tempList:[]},jn[n].tempList.push(this),ir(n).then(t=>{jn[n].loaded=!0,jn[n].imageDatas=t.imageDatas,jn[n].tempList.forEach(e=>{e.imageDatas=jn[n].imageDatas,e.callback&&e.callback.call(e,t)}),jn[n].tempList.length=0}).catch(t=>{jn[n].tempList.forEach(e=>{e.callback&&e.callback.call(e,t)}),jn[n].tempList.length=0}))}else{let t=0,n=0,i=0,a=[];e.forEach((e,o)=>{if(e){let s=location.pathname.split("/");s.length>1&&s.pop();let u=location.origin+s.join("/")+"/"+e;(e.includes(";base64,")||e.includes("://"))&&(u=e),jn[u]?jn[u].loaded?(this.imageDatas=jn[u].imageDatas,r&&r.call(this,{ok:!0})):jn[u].tempList.push(this):(jn[u]={loaded:!1,imgList:a,tempList:[]},jn[u].tempList.push(this),ir(u).then(e=>{a[o]=e,i++,t=Math.max(t,e.imageDatas[0].width),n=Math.max(n,e.imageDatas[0].height),t>1920&&(t=1920),n>1920&&(n=1920),6==i&&(jn[u].loaded=!0,jn[u].imgList=a,jn[u].maxW=t,jn[u].maxH=n,jn[u].tempList.forEach(t=>{t.imgList=jn[u].imgList,t.maxW=jn[u].maxW,t.maxH=jn[u].maxH,t.callback&&t.callback.call(t,e)}),jn[u].tempList.length=0)}).catch(t=>{jn[u].tempList.forEach(e=>{e.callback&&e.callback.call(e,t)}),jn[u].tempList.length=0}))}else;})}}}function Qn(t,e,r,n,i,a=-1){return new Promise((o,s)=>{r.forEach((r,o)=>{if(!i.useMipmap&&o)return;if(o>i.mipMaps)return;let s=new Uint8ClampedArray(r.data),u=r.width,l=r.height,f=r.bytesPerRow;const m=e.createBuffer({size:s.byteLength+s.byteLength%4,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.COPY_SRC});m.setSubData(0,s);const c={buffer:m,bytesPerRow:f,rowsPerImage:l},h={texture:n,mipLevel:o,arrayLayer:Math.max(a,0)},d={width:u,height:l,depth:1};t.copyBufferToTexture(c,h,d)}),o()})}Ve(Jn,"TYPE_2D","TYPE_2D"),Ve(Jn,"TYPE_CUBE","TYPE_CUBE");class Kn extends ze{constructor(){super(),ti.set(this,{writable:!0,value:[]}),Ve(this,"_GPUTexture",void 0),Ve(this,"_GPUTextureView",void 0)}get GPUTexture(){return this._GPUTexture}get GPUTextureView(){return this._GPUTextureView}resolve(t){this._GPUTexture=t,this instanceof ii?this._GPUTextureView=t?t.createView():null:(this._GPUTexture=t,t._GPUTextureView?this._GPUTextureView=t._GPUTextureView:t._GPUTextureView=this._GPUTextureView=t?t.createView({format:"rgba8unorm",dimension:"cube",aspect:"all",baseMipLevel:0,mipLevelCount:this.mipMaps+1,baseArrayLayer:0,arrayLayerCount:6}):null);let e=Oe(this,ti).length;for(;e--;){let t=Oe(this,ti)[e];t[0][t[1]]=this}Oe(this,ti).length=0}addUpdateTarget(t,e){Oe(this,ti).push([t,e])}}var ti=new WeakMap;let ei;const ri=new Map;let ni;class ii extends Kn{constructor(t,e,r,n=!0,i,a){if(super(),ei||(ei=new en(t)),this.sampler=r||ei,this.onload=i,this.onerror=a,this.mapKey=e+n+this.sampler.string,this.useMipmap=n,e){let r=this;new Jn(t,e,(function(e){ri.get(r.mapKey)?(r.resolve(ri.get(r.mapKey)),r.onload&&r.onload(r)):e.ok?function(t,e,r){let n,i,a,o,s;n=e[0].width,i=e[0].height,r.useMipmap&&(r.mipMaps=Math.round(Math.log2(Math.max(n,i))),r.mipMaps>10&&(r.mipMaps=10)),a={size:{width:n,height:i,depth:1},dimension:"2d",format:"rgba8unorm",mipLevelCount:r.useMipmap?r.mipMaps+1:1,usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.SAMPLED},o=t.device.createTexture(a),ri.set(r.mapKey,o),s=t.device.createCommandEncoder({}),Qn(s,t.device,e,o,r).then(e=>{t.device.defaultQueue.submit([s.finish()]),r.resolve(o),r.onload&&r.onload(r)})}(t,this.imageDatas,r):(r.resolve(null),r.onerror&&r.onerror(r))}),Jn.TYPE_2D)}else;}}const ai=new Map;class oi extends Kn{constructor(t,e,r,n=!0,i,a){if(super(),ni||(ni=new en(t)),this.sampler=r||ni,this.onload=i,this.onerror=a,this.mapKey=e+n+this.sampler.string,this.useMipmap=n,e){let r=this;new Jn(t,e,(function(e){ai.get(r.mapKey)?(r.resolve(ai.get(r.mapKey)),r.onload&&r.onload(r)):e.ok?function(t,e,r){let n,i,a,o,s;n=e[0].imageDatas[0].width,i=e[0].imageDatas[0].height,r.useMipmap&&(r.mipMaps=Math.round(Math.log2(Math.max(n,i))),r.mipMaps>10&&(r.mipMaps=10)),a={size:{width:n,height:i,depth:r instanceof ii?1:6},dimension:"2d",format:"rgba8unorm",mipLevelCount:r.useMipmap?r.mipMaps+1:1,usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.SAMPLED},o=t.device.createTexture(a),ai.set(r.mapKey,o);let u=[];s=t.device.createCommandEncoder({}),e.forEach((e,n)=>{u.push(Qn(s,t.device,e.imageDatas,o,r,n))}),Promise.all(u).then(e=>{t.device.defaultQueue.submit([s.finish()]),r.resolve(o),r.onload&&r.onload.call(r)})}(t,this.imgList,r):(r.resolve(null),r.onerror&&r.onerror(r))}),Jn.TYPE_CUBE)}else;}}class si extends ze{constructor(t,e,r,n){let i,a;super(),Ve(this,"textures",[]),i=0,a=t=>{i++,n&&n.call(this,{totalNum:e.length,loaded:i}),i==e.length&&requestAnimationFrame(t=>{r&&r.call(this,this)})},(e=e||[]).length?e.forEach((e,r)=>{let n,i,o,s=ii;e.hasOwnProperty("src")?(i=e.src,o=e.sampler):i=e,i instanceof Array&&(s=oi),n={src:i,texture:null,loadEnd:!1,loadSuccess:!1,userInfo:e},n.texture=new s(t,i,o,!0,(function(t){n.loadSuccess=!0,n.loadEnd=!0,a()}),(function(t){n.loadSuccess=!1,n.loadEnd=!0,a()})),this.textures.push(n)}):requestAnimationFrame(t=>{r&&r.call(this,this)})}getTextureByIndex(t){if(this.textures[t])return this.textures[t].texture}}const ui={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class li{constructor(t,e,r){switch(this.accessor=e.accessors[r],this.bufferView=e.bufferViews[this.accessor.bufferView],this.bufferIndex=this.bufferView.buffer,this.buffer=e.buffers[this.bufferIndex],this.bufferURIDataView=null,this.buffer.uri&&(this.bufferURIDataView=t.parsingResult.uris.buffers[this.bufferIndex]),this.componentType=ui[this.accessor.componentType],this.componentType_BYTES_PER_ELEMENT=this.componentType.BYTES_PER_ELEMENT,this.componentType){case Float32Array:this.getMethod="getFloat32";break;case Uint32Array:this.getMethod="getUint32";break;case Uint16Array:this.getMethod="getUint16";break;case Int16Array:this.getMethod="getInt16";break;case Uint8Array:this.getMethod="getUint8";break;case Int8Array:this.getMethod="getInt8";break;default:qe.throwFunc("파싱할수없는 타입",this.componentType)}this.accessorBufferOffset=this.accessor.byteOffset||0,this.bufferViewOffset=this.bufferView.byteOffset||0,this.bufferViewByteStride=this.bufferView.byteStride||0,this.startIndex=(this.bufferViewOffset+this.accessorBufferOffset)/this.componentType_BYTES_PER_ELEMENT}}let fi;fi=function(t,e,r){let n,i=[],a=new li(t,e,r),o=a.componentType_BYTES_PER_ELEMENT,s=a.bufferURIDataView,u=a.getMethod,l=a.accessor.type,f=a.accessor.count,m=a.startIndex;switch(l){case"SCALAR":for(n=m+1*f;m<n;m++)i.push(s[u](m*o,!0));break;case"VEC4":for(n=m+4*f;m<n;m++)i.push(s[u](m*o,!0));break;case"VEC3":for(n=m+3*f;m<n;m++)i.push(s[u](m*o,!0))}return i};let mi=function(t,e,r){return new Promise(r=>{if(e.animations||(e.animations=[]),e.animations.length){let n=e.nodes,i=e.meshes,a=0,o=0;e.animations.forEach((function(s){let u=s.samplers,l=[];l.minTime=1e7,l.maxTime=-1,l.name=s.name,t.parsingResult.animations.push(l);let f=0;const m=s.channels.length;o+=m;let c=h=>{let d,p,v,_,g,x=[],y=s.channels[h];if(d=u[y.sampler],p=y.target,_=n[p.node],"mesh"in _)v=_.Mesh,i[_.mesh].primitives.forEach(t=>x.push(t.Mesh));else{let e;if(!t.parsingResult.groups[p.node])return;e=t.parsingResult.groups[p.node],v=e}"scale"!=p.path&&"rotation"!=p.path&&"translation"!=p.path&&"weights"!=p.path||l.push(g={key:p.path,time:fi(t,e,d.input),data:fi(t,e,d.output),interpolation:d.interpolation,target:v,targets:x}),g&&(l.minTime>g.time[0]&&(l.minTime=g.time[0]),l.maxTime<g.time[g.time.length-1]&&(l.maxTime=g.time[g.time.length-1])),f++,a++,f!=m&&requestAnimationFrame(t=>c(f)),a==o&&(t.parsingResult.animations.length&&t.parsingResult.animations.forEach(e=>t.playAnimation(e)),r())};c(f)}))}else r()})};class ci extends kn{constructor(t){super(t),hi.set(this,{writable:!0,value:new Float32Array([0,1,0])}),Ve(this,"fov",60),Ve(this,"nearClipping",.1),Ve(this,"farClipping",1e5)}get x(){return this._x}set x(t){this._x=t,this.matrix[12]=t}get y(){return this._y}set y(t){this._y=t,this.matrix[13]=t}get z(){return this._z}set z(t){this._z=t,this.matrix[14]=t}lookAt(t,e,r){Ae.mat4.lookAt(this.matrix,[this.x,this.y,this.z],[t,e,r],Oe(this,hi))}}var hi=new WeakMap;let di=function(t,e){e.cameras&&e.cameras.forEach((function(e){let r=new ci(t.redGPUContext);"orthographic"==e.type?r.mode2DYn=!0:(r.fov=180*e.perspective.yfov/Math.PI,r.farClipping=e.perspective.zfar,r.nearClipping=e.perspective.znear),t.parsingResult.cameras.push(r)}))};const pi=function(){const t=Ae.mat4.create(),e=[0,0,0];let r=[];const n=[];let i;return function(a,o){"matrix"in o&&(i=o.matrix,qe.mat4ToEuler(i,e),a._rotationX=-180*e[0]/Math.PI,a._rotationY=-180*e[1]/Math.PI,a._rotationZ=-180*e[2]/Math.PI,a._x=i[12],a._y=i[13],a._z=i[14],Ae.mat4.getScaling(n,i),a._scaleX=n[0],a._scaleY=n[1],a._scaleZ=n[2]),"rotation"in o&&(r=o.rotation,qe.quaternionToRotationMat4(r,t),qe.mat4ToEuler(t,e),a._rotationX=-180*e[0]/Math.PI,a._rotationY=-180*e[1]/Math.PI,a._rotationZ=-180*e[2]/Math.PI),"translation"in o&&(a._x=o.translation[0],a._y=o.translation[1],a._z=o.translation[2]),"scale"in o&&(a._scaleX=o.scale[0],a._scaleY=o.scale[1],a._scaleZ=o.scale[2]),a.dirtyTransform=!0}}();let vi=function(t,e,r,n){if(r[n].Mesh){let t=r[n].Mesh;e.joints.push(t),t.primitiveTopology="line-list",t.depthCompare="never"}else requestAnimationFrame((function(){vi(t,e,r,n)}))},_i=function(t,e,r,n){let i={joints:[],inverseBindMatrices:[]},a=e.nodes;r.joints.forEach((function(e){vi(t,i,a,e)})),r.skeleton&&(i.skeleton=e.nodes[r.skeleton].Mesh);let o,s=r.inverseBindMatrices,u=new li(t,e,s),l=u.componentType_BYTES_PER_ELEMENT,f=u.bufferViewByteStride,m=u.bufferURIDataView,c=u.getMethod,h=u.accessor.type,d=u.accessor.count,p=0,v=f/l,_=u.startIndex;switch(h){case"MAT4":if(f)for(o=_+d*(f/l);_<o;_++)p%v<16&&i.inverseBindMatrices.push(m[c](_*l,!0)),p++;else for(o=_+16*d;_<o;_++)i.inverseBindMatrices.push(m[c](_*l,!0)),p++}i.inverseBindMatrices=new Float32Array(i.inverseBindMatrices),n.skinInfo=i,n.material.useSkin=!!n.skinInfo},gi=new Float32Array(1);class xi extends(Er.mix(hr,Er.diffuseTexture,Er.normalTexture,Er.emissiveTexture,Er.environmentTexture,Er.displacementTexture,Er.roughnessTextureGLTF,Er.occlusionTextureGLTF,Er.basicLightPropertys)){set alphaBlend(t){this._alphaBlend=t,gi[0]=t,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.alphaBlend,gi)}get alphaBlend(){return this._alphaBlend}set cutOff(t){this._cutOff=t,gi[0]=t,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.cutOff,gi)}get cutOff(){return this._cutOff}get useCutOff(){return this._useCutOff}set useCutOff(t){this._useCutOff=t,gi[0]=t?1:0,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.useCutOff,gi)}get useSkin(){return this._useSkin}set useSkin(t){this._useSkin=t,gi[0]=t?1:0,this.uniformBuffer_vertex.GPUBuffer.setSubData(this.uniformBufferDescriptor_vertex.redStructOffsetMap.useSkin,gi)}set emissivePower(t){this._emissivePower=t,gi[0]=t,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.emissivePower,gi)}get emissivePower(){return this._emissivePower}get useMaterialDoubleSide(){return this._useMaterialDoubleSide}set useMaterialDoubleSide(t){this._useMaterialDoubleSide=t,gi[0]=t?1:0,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.useMaterialDoubleSide,gi)}get useVertexTangent(){return this._useVertexTangent}set useVertexTangent(t){this._useVertexTangent=t,gi[0]=t,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.useVertexTangent,gi)}get metallicFactor(){return this._metallicFactor}set metallicFactor(t){this._metallicFactor=t,gi[0]=t,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.metallicFactor,gi)}get useVertexColor_0(){return this._useVertexColor_0}set useVertexColor_0(t){this._useVertexColor_0=t,gi[0]=t?1:0,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.useVertexColor_0,gi)}get baseColorFactor(){return this._baseColorFactor}set baseColorFactor(t){this._baseColorFactor=new Float32Array(t),this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.baseColorFactor,this._baseColorFactor)}get diffuseTexCoordIndex(){return this._diffuseTexCoordIndex}set diffuseTexCoordIndex(t){this._diffuseTexCoordIndex=t,gi[0]=t,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.diffuseTexCoordIndex,gi)}get normalTexCoordIndex(){return this._normalTexCoordIndex}set normalTexCoordIndex(t){this._normalTexCoordIndex=t,gi[0]=t,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.normalTexCoordIndex,gi)}get emissiveTexCoordIndex(){return this._emissiveTexCoordIndex}set emissiveTexCoordIndex(t){this._emissiveTexCoordIndex=t,gi[0]=t,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.emissiveTexCoordIndex,gi)}constructor(t,e,r,n,i,a,o){super(t),Ve(this,"_baseColorFactor",new Float32Array(4)),Ve(this,"_useVertexColor_0",!1),Ve(this,"_diffuseTexCoordIndex",0),Ve(this,"_normalTexCoordIndex",0),Ve(this,"_emissiveTexCoordIndex",0),Ve(this,"_metallicFactor",1),Ve(this,"_useMaterialDoubleSide",!1),Ve(this,"_useVertexTangent",!1),Ve(this,"_emissivePower",1),Ve(this,"_cutOff",0),Ve(this,"_useCutOff",!0),Ve(this,"_alphaBlend",0),Ve(this,"_useSkin",!1),Ve(this,"jointMatrix",new Float32Array(128*$e.mat4/Float32Array.BYTES_PER_ELEMENT)),Ve(this,"inverseBindMatrixForJoint",new Float32Array(128*$e.mat4/Float32Array.BYTES_PER_ELEMENT)),Ve(this,"globalTransformOfNodeThatTheMeshIsAttachedTo",new Float32Array($e.mat4/Float32Array.BYTES_PER_ELEMENT)),yi.set(this,{writable:!0,value:void 0}),this.diffuseTexture=e,this.environmentTexture=r,this.normalTexture=n,this.occlusionTexture=i,this.emissiveTexture=a,this.roughnessTexture=o,this.needResetBindingInfo=!0}checkTexture(t,e){if(t)if(t._GPUTexture){let r;switch(e){case"diffuseTexture":this._diffuseTexture=t,r=e;break;case"normalTexture":this._normalTexture=t,r=e;break;case"environmentTexture":this._environmentTexture=t,r=e;break;case"emissiveTexture":this._emissiveTexture=t,r=e;break;case"roughnessTexture":this._roughnessTexture=t,r=e;break;case"occlusionTexture":this._occlusionTexture=t,r=e}r&&(gi[0]=this[`__${e}RenderYn`]=1,"displacementTexture"==r?this.uniformBuffer_vertex.GPUBuffer.setSubData(this.uniformBufferDescriptor_vertex.redStructOffsetMap[`__${e}RenderYn`],gi):this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap[`__${e}RenderYn`],gi)),this.needResetBindingInfo=!0}else t.addUpdateTarget(this,e);else this["_"+e]&&(this["_"+e]=null,gi[0]=this[`__${e}RenderYn`]=0,"displacementTexture"==e?this.uniformBuffer_vertex.GPUBuffer.setSubData(this.uniformBufferDescriptor_vertex.redStructOffsetMap[`__${e}RenderYn`],gi):this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap[`__${e}RenderYn`],gi),this.needResetBindingInfo=!0,this.needResetBindingInfo=!0)}resetBindingInfo(){this.entries=[{binding:0,resource:{buffer:this.uniformBuffer_vertex.GPUBuffer,offset:0,size:this.uniformBufferDescriptor_vertex.size}},{binding:1,resource:this._displacementTexture?this._displacementTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:2,resource:this._displacementTexture?this._displacementTexture._GPUTextureView:this.redGPUContext.state.emptyTextureView},{binding:3,resource:{buffer:this.uniformBuffer_fragment.GPUBuffer,offset:0,size:this.uniformBufferDescriptor_fragment.size}},{binding:4,resource:this._diffuseTexture?this._diffuseTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:5,resource:this._diffuseTexture?this._diffuseTexture._GPUTextureView:this.redGPUContext.state.emptyTextureView},{binding:6,resource:this._normalTexture?this._normalTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:7,resource:this._normalTexture?this._normalTexture._GPUTextureView:this.redGPUContext.state.emptyTextureView},{binding:8,resource:this._roughnessTexture?this._roughnessTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:9,resource:this._roughnessTexture?this._roughnessTexture._GPUTextureView:this.redGPUContext.state.emptyTextureView},{binding:10,resource:this._emissiveTexture?this._emissiveTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:11,resource:this._emissiveTexture?this._emissiveTexture._GPUTextureView:this.redGPUContext.state.emptyTextureView},{binding:12,resource:this._environmentTexture?this._environmentTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:13,resource:this._environmentTexture?this._environmentTexture._GPUTextureView:this.redGPUContext.state.emptyCubeTextureView},{binding:14,resource:this._occlusionTexture?this._occlusionTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:15,resource:this._occlusionTexture?this._occlusionTexture._GPUTextureView:this.redGPUContext.state.emptyTextureView}],this._afterResetBindingInfo()}}var yi=new WeakMap;Ve(xi,"vertexShaderGLSL",`\n\t${tr.GLSL_VERSION}\n    ${tr.GLSL_SystemUniforms_vertex.systemUniforms}\n    ${tr.GLSL_SystemUniforms_vertex.calcDisplacement}\n    ${tr.GLSL_SystemUniforms_vertex.meshUniforms}\n         \n\tlayout( location = 0 ) in vec3 position;\n\tlayout( location = 1 ) in vec3 normal;\n\tlayout( location = 2 ) in vec2 uv;\n\tlayout( location = 3 ) in vec2 uv1;\n\tlayout( location = 4 ) in vec4 vertexColor_0;\n\tlayout( location = 5 ) in vec4 aVertexWeight;\n\tlayout( location = 6 ) in vec4 aVertexJoint;\n\tlayout( location = 7 ) in vec4 vertexTangent;\n\tlayout( location = 0 ) out vec4 vVertexColor_0;\n\tlayout( location = 1 ) out vec3 vNormal;\n\tlayout( location = 2 ) out vec2 vUV;\n\tlayout( location = 3 ) out vec2 vUV1;\n\tlayout( location = 4 ) out vec4 vVertexTangent;\n\tlayout( location = 5 ) out vec4 vVertexPosition;\n\tlayout( location = 6 ) out float vMouseColorID;\t\n\tlayout( location = 7 ) out float vSumOpacity;\n\tlayout( set = ${tr.SET_INDEX_VertexUniforms}, binding = 0 ) uniform VertexUniforms {\n\t\tmat4 jointMatrix[128];\n\t\tmat4 inverseBindMatrixForJoint[128];\n\t\tmat4 globalTransformOfNodeThatTheMeshIsAttachedTo;\n        float displacementFlowSpeedX;\n        float displacementFlowSpeedY;\n        float displacementPower;\n        float __displacementTextureRenderYn;\n        float useSkin;\n        \n    } vertexUniforms;\n\t\n\tlayout( set = ${tr.SET_INDEX_VertexUniforms}, binding = 1 ) uniform sampler uDisplacementSampler;\n\tlayout( set = ${tr.SET_INDEX_VertexUniforms}, binding = 2 ) uniform texture2D uDisplacementTexture;\n\tvoid main() {\t\t\n\t\tmat4 targetMatrix = meshMatrixUniforms.modelMatrix[ int(meshUniforms.index) ] ;\n\t\tmat4 skinMat = mat4(1.0,0.0,0.0,0.0, 0.0,1.0,0.0,0.0, 0.0,0.0,1.0,0.0, 0.0,0.0,0.0,1.0);\n\t\tif(vertexUniforms.useSkin == TRUTHY) {\n\t\t\tskinMat =\n\t\t\taVertexWeight.x * vertexUniforms.globalTransformOfNodeThatTheMeshIsAttachedTo * vertexUniforms.jointMatrix[ int(aVertexJoint.x) ] * vertexUniforms.inverseBindMatrixForJoint[int(aVertexJoint.x)]+\n\t\t\taVertexWeight.y * vertexUniforms.globalTransformOfNodeThatTheMeshIsAttachedTo * vertexUniforms.jointMatrix[ int(aVertexJoint.y) ] * vertexUniforms.inverseBindMatrixForJoint[int(aVertexJoint.y)]+\n\t\t\taVertexWeight.z * vertexUniforms.globalTransformOfNodeThatTheMeshIsAttachedTo * vertexUniforms.jointMatrix[ int(aVertexJoint.z) ] * vertexUniforms.inverseBindMatrixForJoint[int(aVertexJoint.z)]+\n\t\t\taVertexWeight.w * vertexUniforms.globalTransformOfNodeThatTheMeshIsAttachedTo * vertexUniforms.jointMatrix[ int(aVertexJoint.w) ] * vertexUniforms.inverseBindMatrixForJoint[int(aVertexJoint.w)];\n\t\t\tvVertexPosition = meshMatrixUniforms.modelMatrix[ int(meshUniforms.index) ] * skinMat * vec4(position, 1.0);\n\t\t\tvNormal = (meshMatrixUniforms.normalMatrix[ int(meshUniforms.index) ]  * skinMat * vec4(normal,0.0)).xyz;\n\t\t}else{\n\t\t\tvVertexPosition = meshMatrixUniforms.modelMatrix[ int(meshUniforms.index) ] * vec4(position, 1.0);\n\t\t\tvNormal = (meshMatrixUniforms.normalMatrix[ int(meshUniforms.index) ] *  vec4(normal,1.0)).xyz;\n\t\t}\n\t\t\n\t\tvVertexColor_0 = vertexColor_0;\n\t\t\n\t\tvUV = uv;\n\t\tvUV1 = uv1;\n\t\tvVertexTangent = vertexTangent;\n\t\tvMouseColorID = meshUniforms.mouseColorID;\n\t\tvSumOpacity = meshUniforms.sumOpacity;\n\t\tif(vertexUniforms.__displacementTextureRenderYn == TRUTHY) vVertexPosition.xyz += calcDisplacement(vNormal, vertexUniforms.displacementFlowSpeedX, vertexUniforms.displacementFlowSpeedY, vertexUniforms.displacementPower, uv, uDisplacementTexture, uDisplacementSampler);\n\t\tgl_Position = systemUniforms.perspectiveMTX * systemUniforms.cameraMTX * vVertexPosition;\t\t\n\t}\n\t`),Ve(xi,"fragmentShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_fragment.systemUniforms}\n\t${tr.GLSL_SystemUniforms_fragment.cotangent_frame}\n\t${tr.GLSL_SystemUniforms_fragment.perturb_normal}\n\t\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 3 ) uniform FragmentUniforms {\n        float normalPower;\n        float shininess; \n\t    float emissivePower;\n\t    float occlusionPower;\n\t    float environmentPower;\n\t    vec4 baseColorFactor;\n\t    float diffuseTexCoordIndex;\n\t    float normalTexCoordIndex;\n\t    float emissiveTexCoordIndex;\n\t    float roughnessTexCoordIndex;\n\t    float occlusionTexCoordIndex;\n\t    float metallicFactor;\n\t    float roughnessFactor;\n\t    float cutOff;\n\t    float alphaBlend;\n\t    //\n\t    float useFlatMode;\n\t    float useCutOff;\n\t    float useVertexTangent;\n\t    float useVertexColor_0;\n\t    float useMaterialDoubleSide;\n\t    //\n\t    float __diffuseTextureRenderYn;\n\t\tfloat __environmentTextureRenderYn;\n\t\tfloat __normalTextureRenderYn;\n\t\tfloat __occlusionTextureRenderYn;\n\t\tfloat __emissiveTextureRenderYn;\n\t\tfloat __roughnessTextureRenderYn;\n\t    \n    } fragmentUniforms;\n\tlayout( location = 0 ) in vec4 vVertexColor_0;\n\tlayout( location = 1 ) in vec3 vNormal;\n\tlayout( location = 2 ) in vec2 vUV;\n\tlayout( location = 3 ) in vec2 vUV1;\n\tlayout( location = 4 ) in vec4 vVertexTangent;\n\tlayout( location = 5 ) in vec4 vVertexPosition;\n\tlayout( location = 6 ) in float vMouseColorID;\t\n\tlayout( location = 7 ) in float vSumOpacity;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 4 ) uniform sampler uDiffuseSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 5 ) uniform texture2D uDiffuseTexture;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 6 ) uniform sampler uNormalSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 7 ) uniform texture2D uNormalTexture;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 8 ) uniform sampler uRoughnessSampler;\t\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 9 ) uniform texture2D uRoughnessTexture;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 10 ) uniform sampler uEmissiveSampler;\t\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 11 ) uniform texture2D uEmissiveTexture;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 12 ) uniform sampler uEnvironmentSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 13 ) uniform textureCube uEnvironmentTexture;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 14 ) uniform sampler uOcclusionSampler;\t\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 15 ) uniform texture2D uOcclusionTexture;\n\tlayout( location = 0 ) out vec4 outColor;\n\t\n\tlayout( location = 1 ) out vec4 out_MouseColorID_Depth;\n\tvec2 diffuseTexCoord;\n\tvec2 normalTexCoord;\n\tvec2 emissiveTexCoord;\n\tvec2 roughnessTexCoord;\n\tvec2 occlusionTexCoord;\n\tvoid main() {\n\t\t// 인덱스 찾고\n\t\tdiffuseTexCoord = fragmentUniforms.diffuseTexCoordIndex == 0.0 ? vUV : vUV1;\n\t\tnormalTexCoord = fragmentUniforms.normalTexCoordIndex == 0.0 ? vUV : vUV1;\n\t\temissiveTexCoord = fragmentUniforms.emissiveTexCoordIndex == 0.0 ? vUV : vUV1;\n\t\troughnessTexCoord = fragmentUniforms.roughnessTexCoordIndex == 0.0 ? vUV : vUV1;\n\t\tocclusionTexCoord = fragmentUniforms.occlusionTexCoordIndex == 0.0 ? vUV : vUV1;\n\t\t\n\t\t\n\t\tfloat tMetallicPower = fragmentUniforms.metallicFactor;\n\t\tfloat tRoughnessPower = fragmentUniforms.roughnessFactor;\n\t\t\n\t\tvec4 roughnessColor = vec4(0.0);\n\t\tif(fragmentUniforms.__roughnessTextureRenderYn == TRUTHY) {\n\t\t\troughnessColor = texture(sampler2D(uRoughnessTexture, uRoughnessSampler), roughnessTexCoord);\n\t\t\ttMetallicPower *= roughnessColor.b; // 메탈릭 산출 roughnessColor.b\n\t\t\ttRoughnessPower *= roughnessColor.g; // 거칠기 산출 roughnessColor.g\n\t\t}\n\t\t\n\t\t\n\t\n\t\tvec4 diffuseColor = fragmentUniforms.baseColorFactor;\n\t\tif(fragmentUniforms.useVertexColor_0 == TRUTHY) diffuseColor *= clamp(vVertexColor_0,0.0,1.0) ;\n\t\tif(fragmentUniforms.__diffuseTextureRenderYn == TRUTHY) diffuseColor *= texture(sampler2D(uDiffuseTexture, uDiffuseSampler), diffuseTexCoord) ;\n\t\t\t\n\t\tfloat tAlpha = diffuseColor.a;\n\t\tif(fragmentUniforms.useCutOff == TRUTHY) {\n\t\t\tif(tAlpha <= fragmentUniforms.cutOff) discard;\n\t\t}\n\t\t\n\t    vec3 N = normalize(vNormal);\n\t    bool backFaceYn = false;\n\t    if(fragmentUniforms.useMaterialDoubleSide == TRUTHY) {\n\t\t    vec3 fdx = dFdx(vVertexPosition.xyz);\n\t\t\tvec3 fdy = dFdy(vVertexPosition.xyz);\n\t\t\tvec3 faceNormal = normalize(cross(fdy,fdx));\n\t\t\tif (dot (vNormal, faceNormal) < 0.0) { N = -N; backFaceYn = true; };\n\t    } \n\t\tvec4 normalColor = vec4(0.0);\n\t\tif(fragmentUniforms.__normalTextureRenderYn == TRUTHY) normalColor = texture(sampler2D(uNormalTexture, uNormalSampler), normalTexCoord) ;\n\t\tif(fragmentUniforms.useFlatMode == TRUTHY) N = getFlatNormal(vVertexPosition.xyz);\n\t\tif(fragmentUniforms.__normalTextureRenderYn == TRUTHY) N = perturb_normal(N, vVertexPosition.xyz, backFaceYn ?  1.0 - normalTexCoord : normalTexCoord, vec3(normalColor.r, 1.0- normalColor.g, normalColor.b), fragmentUniforms.normalPower) ;\n\n\t\tif(fragmentUniforms.useVertexTangent == TRUTHY) {\n\t\t\tif(fragmentUniforms.__normalTextureRenderYn == TRUTHY){\n\t\t\t\tvec3 pos_dx = dFdx(vVertexPosition.xyz);\n\t\t\t\tvec3 pos_dy = dFdy(vVertexPosition.xyz);\n\t\t\t\tvec3 tex_dx = dFdx(vec3(normalTexCoord, 0.0));\n\t\t\t\tvec3 tex_dy = dFdy(vec3(normalTexCoord, 0.0));\n\t\t\t\tvec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);\n\t\t\t\tvec3 ng = normalize(vNormal);\n\t\t\t\tt = normalize(t - ng * dot(ng, t));\n\t\t\t\tvec3 b = normalize(cross(ng, t));\n\t\t\t\tmat3 tbn = mat3(t, b, ng);\n\t\t\t\tN = normalize(tbn * ((2.0 * normalColor.rgb - 1.0) * vec3(1.0, 1.0 * vVertexTangent.w,1.0)));\n\t\t\t\tN = backFaceYn ? -N : N;\n\t\t\t}\t\t\t\n\t\t}\n\n\t\tif(fragmentUniforms.__environmentTextureRenderYn == TRUTHY) {\n\t\t\t// 환경맵 계산\n\t\t\tvec3 R = reflect( vVertexPosition.xyz - systemUniforms.cameraPosition, N);\n\t\t\tvec4 reflectionColor = texture(samplerCube(uEnvironmentTexture,uEnvironmentSampler), R);\t\t\n\t\t\t// 환경맵 합성\n\t\t\tdiffuseColor.rgb = mix( diffuseColor.rgb , reflectionColor.rgb , max(tMetallicPower-tRoughnessPower,0.0)*(1.0-tRoughnessPower));\n\t\t\tdiffuseColor = mix( diffuseColor , vec4(0.04, 0.04, 0.04, 1.0) , tRoughnessPower * (tMetallicPower) * 0.5);\n\t\t}\n\t\t\n\n\n\t\n\t\toutColor = diffuseColor;\n\t\tvec4 specularLightColor = vec4(1.0, 1.0, 1.0, 1.0);\n\t    vec4 ld = vec4(0.0, 0.0, 0.0, 1.0);\n\t    vec4 ls = vec4(0.0, 0.0, 0.0, 1.0);\n\n\t    vec3 L;\t\n\n\n\t    float lambertTerm;\n\t    float intensity;\n\t    float specular;\n\n\t\tDirectionalLight lightInfo;\n\t\tvec4 lightColor;\n\t\tfor(int i=0; i<systemUniforms.directionalLightCount; i++){\n\t\t\tlightInfo = systemUniforms.directionalLightList[i];\n\t\t\tvec3 L = normalize(-lightInfo.position);\n\t\t\tfloat lambertTerm = dot(N,-L);\n\t\t\tif(lambertTerm > 0.0){\n\t\t\t\tld += lightInfo.color * diffuseColor * lambertTerm * lightInfo.intensity * lightInfo.color.a;\n\t\t\t\tspecular = pow( max(dot(reflect(L, N), -L), 0.0), pow(fragmentUniforms.shininess, 1.0-tRoughnessPower+0.04) );\n\t\t\t\tspecular *= pow(1.0-tRoughnessPower+0.04, 2.0 * (1.0-tMetallicPower)) ;\n\t\t\t\tls +=  specularLightColor * specular * fragmentUniforms.metallicFactor * lightInfo.intensity * lightInfo.color.a * (1.0-tRoughnessPower+0.04);\n\t\t\t}\n\t\t}\n\t\t\n\t\t vec4 finalColor = ld + ls + la;;\n\t\t\n\t\tif(fragmentUniforms.__emissiveTextureRenderYn == TRUTHY) {\n\t\t\t// 이미시브 합성\n\t\t\tvec4 emissiveColor = texture(sampler2D(uEmissiveTexture, uEmissiveSampler), emissiveTexCoord);\n\t\t\tfinalColor.rgb += emissiveColor.rgb * fragmentUniforms.emissivePower;\n\t\t}\t\t\n\t\n\t\tif(fragmentUniforms.__occlusionTextureRenderYn == TRUTHY) {\n\t\t// 오클루젼 합성\n\t\t\tvec4 occlusionColor =texture(sampler2D(uOcclusionTexture, uOcclusionSampler), occlusionTexCoord);\n\t\t\tfinalColor.rgb = mix(finalColor.rgb, finalColor.rgb * occlusionColor.r, occlusionColor.r * fragmentUniforms.occlusionPower);\n\t\t}\n\n\n\t\t// 알파블렌드 - BLEND\n\t\tif( fragmentUniforms.alphaBlend == 2.0 ) {\t\t\n\t\t\tfinalColor.a = tAlpha;\n\t\t}\n\t\toutColor = finalColor;\n\t\tout_MouseColorID_Depth = vec4(vMouseColorID, gl_FragCoord.z/gl_FragCoord.w, 0.0, 0.0);\n\t\t\n\t}\n`),Ve(xi,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(xi,"uniformsBindGroupLayoutDescriptor_material",{entries:[{binding:0,visibility:GPUShaderStage.VERTEX,type:"uniform-buffer"},{binding:1,visibility:GPUShaderStage.VERTEX,type:"sampler"},{binding:2,visibility:GPUShaderStage.VERTEX,type:"sampled-texture"},{binding:3,visibility:GPUShaderStage.FRAGMENT,type:"uniform-buffer"},{binding:4,visibility:GPUShaderStage.FRAGMENT,type:"sampler"},{binding:5,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture"},{binding:6,visibility:GPUShaderStage.FRAGMENT,type:"sampler"},{binding:7,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture"},{binding:8,visibility:GPUShaderStage.FRAGMENT,type:"sampler"},{binding:9,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture"},{binding:10,visibility:GPUShaderStage.FRAGMENT,type:"sampler"},{binding:11,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture"},{binding:12,visibility:GPUShaderStage.FRAGMENT,type:"sampler"},{binding:13,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture",viewDimension:"cube"},{binding:14,visibility:GPUShaderStage.FRAGMENT,type:"sampler"},{binding:15,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture"}]}),Ve(xi,"uniformBufferDescriptor_vertex",[{size:128*$e.mat4,valueName:"jointMatrix"},{size:128*$e.mat4,valueName:"inverseBindMatrixForJoint"},{size:$e.mat4,valueName:"globalTransformOfNodeThatTheMeshIsAttachedTo"},{size:$e.float,valueName:"displacementFlowSpeedX"},{size:$e.float,valueName:"displacementFlowSpeedY"},{size:$e.float,valueName:"displacementPower"},{size:$e.float,valueName:"__displacementTextureRenderYn"},{size:$e.float,valueName:"useSkin"}]),Ve(xi,"uniformBufferDescriptor_fragment",[{size:$e.float,valueName:"normalPower"},{size:$e.float,valueName:"shininess"},{size:$e.float,valueName:"emissivePower"},{size:$e.float,valueName:"occlusionPower"},{size:$e.float,valueName:"environmentPower"},{size:$e.float4,valueName:"baseColorFactor"},{size:$e.float,valueName:"diffuseTexCoordIndex"},{size:$e.float,valueName:"normalTexCoordIndex"},{size:$e.float,valueName:"emissiveTexCoordIndex"},{size:$e.float,valueName:"roughnessTexCoordIndex"},{size:$e.float,valueName:"occlusionTexCoordIndex"},{size:$e.float,valueName:"metallicFactor"},{size:$e.float,valueName:"roughnessFactor"},{size:$e.float,valueName:"cutOff"},{size:$e.float,valueName:"alphaBlend"},{size:$e.float,valueName:"useFlatMode"},{size:$e.float,valueName:"useCutOff"},{size:$e.float,valueName:"useVertexTangent"},{size:$e.float,valueName:"useVertexColor_0"},{size:$e.float,valueName:"useMaterialDoubleSide"},{size:$e.float,valueName:"__diffuseTextureRenderYn"},{size:$e.float,valueName:"__environmentTextureRenderYn"},{size:$e.float,valueName:"__normalTextureRenderYn"},{size:$e.float,valueName:"__occlusionTextureRenderYn"},{size:$e.float,valueName:"__emissiveTextureRenderYn"},{size:$e.float,valueName:"__roughnessTextureRenderYn"}]);class Si{constructor(t,e){this.attributeHint=t,this.format=e,this.stride=$e[e]}}class Ti extends ze{get volume(){return this._volume||this.volumeCalculate(),this._volume}constructor(){super(),Ve(this,"_volume",void 0)}volumeCalculate(){let t,e,r,n,i,a,o,s,u,l,f,m,c=this.interleaveBuffer.stride;for(t=e=r=n=i=a=0,l=this.interleaveBuffer.data,f=0,m=this.interleaveBuffer.vertexCount;f<m;f++)o=f*c,s=o+1,u=o+2,t=l[o]<t?l[o]:t,n=l[o]>n?l[o]:n,e=l[s]<e?l[s]:e,i=l[s]>i?l[s]:i,r=l[u]<r?l[u]:r,a=l[u]>a?l[u]:a;return this._volume={},this._volume.volume=[n-t,i-e,a-r],this._volume.minX=t,this._volume.maxX=n,this._volume.minY=e,this._volume.maxY=i,this._volume.minZ=r,this._volume.maxZ=a,this._volume.xSize=Math.max(Math.abs(t),Math.abs(n)),this._volume.ySize=Math.max(Math.abs(e),Math.abs(i)),this._volume.zSize=Math.max(Math.abs(r),Math.abs(a)),this._volume.geometryRadius=Math.max(this._volume.xSize,this._volume.ySize,this._volume.zSize),this._volume}}class Ui extends Ti{constructor(t,e,r){super(),Ve(this,"interleaveBuffer",void 0),Ve(this,"indexBuffer",void 0),Ve(this,"vertexState",void 0),this.interleaveBuffer=e,this.indexBuffer=r;let n=0,i=[];e.interleaveInfo.forEach((function(t,e){i.push({attributeHint:t.attributeHint,shaderLocation:e,offset:n,format:t.format}),n+=t.stride})),this.vertexState={indexFormat:"uint32",vertexBuffers:[{arrayStride:n,attributes:i}]},this.volumeCalculate()}}class bi extends ze{constructor(t,e,r,n,i,a){if(super(),Ve(this,"type",void 0),Ve(this,"vertexCount",void 0),Ve(this,"bufferDescriptor",void 0),Ve(this,"GPUBuffer",void 0),t.state.Buffer[r].has(e))return t.state.Buffer[r].get(e);let o;switch(this.type=r,this.vertexCount=0,this.stride=0,r){case bi.TYPE_VERTEX:o=a||GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_DST,this.interleaveInfo=i,i.forEach(t=>{this.vertexCount+=t.stride/Float32Array.BYTES_PER_ELEMENT,this.stride+=t.stride/Float32Array.BYTES_PER_ELEMENT}),this.vertexCount=n.length/this.vertexCount;break;case bi.TYPE_INDEX:o=a||GPUBufferUsage.INDEX|GPUBufferUsage.COPY_DST,this.indexNum=n.length}this.bufferDescriptor={size:n.byteLength,usage:o},this.data=n,this.GPUBuffer=t.device.createBuffer(this.bufferDescriptor),this.GPUBuffer.setSubData(0,n),t.state.Buffer[r].set(e,this)}update(t){this.data=t,this.GPUBuffer.setSubData(0,new Float32Array(t))}destroy(){this.GPUBuffer&&this.GPUBuffer.destroy(),this.GPUBuffer=null}}Ve(bi,"TYPE_VERTEX","vertexBuffer"),Ve(bi,"TYPE_INDEX","indexBuffer");let Mi=function(t,e,r,n,i,a,o,s,u){let l=0,f=e.length/3,m=0;for(;l<f;l++)e.length&&(t[m++]=e[3*l+0],t[m++]=e[3*l+1],t[m++]=e[3*l+2]),n.length?(t[m++]=n[3*l+0],t[m++]=n[3*l+1],t[m++]=n[3*l+2]):(t[m++]=0,t[m++]=0,t[m++]=0),i.length||i.push(0,0),i.length&&(t[m++]=i[2*l+0],t[m++]=i[2*l+1]),a.length?(t[m++]=a[2*l+0],t[m++]=a[2*l+1]):i.length&&(t[m++]=i[2*l+0],t[m++]=i[2*l+1]),r.length?(t[m++]=r[4*l+0],t[m++]=r[4*l+1],t[m++]=r[4*l+2],t[m++]=r[4*l+3]):(t[m++]=0,t[m++]=0,t[m++]=0,t[m++]=0),o.length?(t[m++]=o[4*l+0],t[m++]=o[4*l+1],t[m++]=o[4*l+2],t[m++]=o[4*l+3]):(t[m++]=0,t[m++]=0,t[m++]=0,t[m++]=0),s.length?(t[m++]=s[4*l+0],t[m++]=s[4*l+1],t[m++]=s[4*l+2],t[m++]=s[4*l+3]):(t[m++]=0,t[m++]=0,t[m++]=0,t[m++]=0),u.length?(t[m++]=u[4*l+0],t[m++]=u[4*l+1],t[m++]=u[4*l+2],t[m++]=u[4*l+3]):(t[m++]=0,t[m++]=0,t[m++]=0,t[m++]=0)},Pi=function(t,e,r,n,i,a,o,s,u,l,f,m){let c,h=n.componentType_BYTES_PER_ELEMENT,d=n.bufferViewByteStride,p=n.bufferURIDataView,v=n.getMethod,_=n.accessor.type,g=n.accessor.count,x=0,y=d/h,S=n.startIndex;switch(_){case"VEC4":if(d)for(c=S+g*(d/h);S<c;S++)x%y<4&&("WEIGHTS_0"==r?u.push(p[v](S*h,!0)):"JOINTS_0"==r?l.push(p[v](S*h,!0)):"COLOR_0"==r?f.push(p[v](S*h,!0)):"TANGENT"==r&&m.push(p[v](S*h,!0))),x++;else for(c=S+4*g;S<c;S++)"WEIGHTS_0"==r?u.push(p[v](S*h,!0)):"JOINTS_0"==r?l.push(p[v](S*h,!0)):"COLOR_0"==r?f.push(p[v](S*h,!0)):"TANGENT"==r&&m.push(p[v](S*h,!0)),x++;break;case"VEC3":if(d)for(c=S+g*(d/h);S<c;S++)x%y<3&&("NORMAL"==r?s.push(p[v](S*h,!0)):"POSITION"==r?i.push(p[v](S*h,!0)):"COLOR_0"==r&&(f.push(p[v](S*h,!0)),x%y==2&&f.push(1))),x++;else for(c=S+3*g;S<c;S++)"NORMAL"==r?s.push(p[v](S*h,!0)):"POSITION"==r?i.push(p[v](S*h,!0)):"COLOR_0"==r&&(f.push(p[v](S*h,!0)),x%3==2&&f.push(1)),x++;break;case"VEC2":if(d)for(c=S+g*(d/h);S<c;S++)x%y<2&&("TEXCOORD_0"==r?a.push(p[v](S*h,!0)):"TEXCOORD_1"==r?o.push(p[v](S*h,!0)):qe.throwFunc("VEC2에서 현재 지원하고 있지 않는 키",r)),x++;else for(c=S+2*g;S<c;S++)"TEXCOORD_0"==r?a.push(p[v](S*h,!0)):"TEXCOORD_1"==r?o.push(p[v](S*h,!0)):qe.throwFunc("VEC2에서 현재 지원하고 있지 않는 키",r),x++}},wi=function(){let t=function(t,e,r){return e.images[r].uri.indexOf("blob:http")>-1?e.images[r].uri:(e.images[r].uri.indexOf(";base64,")>-1?"":t.path)+e.images[r].uri},e=function(t,e,r){let n={magFilter:"linear",minFilter:"linear",mipmapFilter:"linear",addressModeU:"repeat",addressModeV:"repeat",addressModeW:"repeat"},i={33071:"clamp-to-edge",33648:"mirror-repeat",10497:"repeat"},a={9728:"nearest",9729:"linear"},o={9728:"nearest",9729:"linear"};if(e.samplers){let t=e.samplers[r];"magFilter"in t&&(n.magFilter=a[t.magFilter]||"linear"),"minFilter"in t&&(n.minFilter=o[t.minFilter]||"linear"),"wrapS"in t&&(n.addressModeU=i[t.wrapS]),"wrapT"in t&&(n.addressModeV=i[t.wrapT])}return n.string=JSON.stringify(n),n};return function(r,n,i){let a,o,s=!1,u=.5;if("material"in i){let l=r.environmentTexture;a=new xi(r.redGPUContext,null,l,null,null,null,null);let f=i.material,m=n.materials[f];if("doubleSided"in m&&(s=!!m.doubleSided),"alphaMode"in m&&(o=m.alphaMode),"alphaCutoff"in m&&(u=m.alphaCutoff),"baseColorTexture"in m.pbrMetallicRoughness){let i=m.pbrMetallicRoughness.baseColorTexture.index,o=n.textures[i],s=o.source,u=t(r,n,s),l=o.sampler,f=e(0,n,l);r.parsingResult.textureRawList.push({src:u,sampler:new en(r.redGPUContext,f),targetTexture:"diffuseTexture",targetMaterial:a})}if("metallicRoughnessTexture"in m.pbrMetallicRoughness){let i=m.pbrMetallicRoughness.metallicRoughnessTexture.index,o=n.textures[i],s=o.source,u=t(r,n,s),l=o.sampler,f=e(0,n,l);r.parsingResult.textureRawList.push({src:u,sampler:new en(r.redGPUContext,f),targetTexture:"roughnessTexture",targetMaterial:a})}let c=m.normalTexture;if(null!=c){c=c.index;let i=n.textures[c],o=i.source,s=t(r,n,o),u=i.sampler,l=e(0,n,u);r.parsingResult.textureRawList.push({src:s,sampler:new en(r.redGPUContext,l),targetTexture:"normalTexture",targetMaterial:a})}let h=m.emissiveTexture;if(null!=h){h=h.index;let i=n.textures[h],o=i.source,s=t(r,n,o),u=i.sampler,l=e(0,n,u);r.parsingResult.textureRawList.push({src:s,sampler:new en(r.redGPUContext,l),targetTexture:"emissiveTexture",targetMaterial:a})}let d,p,v,_=m.occlusionTexture;if(null!=_){_=_.index;let i=n.textures[_],o=i.source,s=t(r,n,o),u=i.sampler,l=e(0,n,u);r.parsingResult.textureRawList.push({src:s,sampler:new en(r.redGPUContext,l),targetTexture:"occlusionTexture",targetMaterial:a})}"metallicFactor"in m.pbrMetallicRoughness&&(d=m.pbrMetallicRoughness.metallicFactor),"roughnessFactor"in m.pbrMetallicRoughness&&(p=m.pbrMetallicRoughness.roughnessFactor),v=m.pbrMetallicRoughness&&m.pbrMetallicRoughness.baseColorFactor?m.pbrMetallicRoughness.baseColorFactor:[1,1,1,1],a.baseColorFactor=v,m.pbrMetallicRoughness&&(a.metallicFactor=null!=d?d:1,a.roughnessFactor=null!=p?p:1),a.emissiveFactor=null!=m.emissiveFactor?m.emissiveFactor:new Float32Array([1,1,1]),m.pbrMetallicRoughness&&(m.pbrMetallicRoughness.metallicRoughnessTexture&&(a.roughnessTexCoordIndex=m.pbrMetallicRoughness.metallicRoughnessTexture.texCoord||0),m.pbrMetallicRoughness.baseColorTexture&&(a.diffuseTexCoordIndex=m.pbrMetallicRoughness.baseColorTexture.texCoord||0)),m.occlusionTexture&&(a.occlusionTexCoordIndex=m.occlusionTexture.texCoord||0,a.occlusionPower=m.occlusionTexture.strength||1),m.emissiveTexture&&(a.emissiveTexCoordIndex=m.emissiveTexture.texCoord||0),m.normalTexture&&(a.normalTexCoordIndex=m.normalTexture.texCoord||0)}else{let t=[Math.random(),Math.random(),Math.random(),1];a=new xi(r.redGPUContext),a.baseColorFactor=t}return[a,s,o,u]}}(),Ei=function(t,e,r,n,i,a,o,s,u,l){if(r.sparse){let a=[],o=[],s=[];!function(){let i,u,l,f,m,c=r.sparse,h=c.values,d=n.bufferViews[h.bufferView],p=d.buffer;n.buffers[p].uri&&(i=t.parsingResult.uris.buffers[p]),f=ui[r.componentType],f==Float32Array&&(m="getFloat32"),f==Uint32Array&&(m="getUint32"),f==Uint16Array&&(m="getUint16"),f==Int16Array&&(m="getInt16"),f==Uint8Array&&(m="getUint8"),f==Int8Array&&(m="getInt8");let v=r.byteOffset||0;switch(u=((d.byteOffset||0)+v)/f.BYTES_PER_ELEMENT,r.type){case"VEC3":for(l=u+f.BYTES_PER_ELEMENT*c.count/f.BYTES_PER_ELEMENT*3;u<l;u++)"NORMAL"==e?o.push(i[m](u*f.BYTES_PER_ELEMENT,!0)):"POSITION"==e&&a.push(i[m](u*f.BYTES_PER_ELEMENT,!0));break;case"VEC2":for(l=u+f.BYTES_PER_ELEMENT*c.count/f.BYTES_PER_ELEMENT*2;u<l;u++)"TEXCOORD_0"==e&&s.push(i[m](u*f.BYTES_PER_ELEMENT,!0))}}();let u,l,f,m,c,h=r.sparse,d=h.indices,p=n.bufferViews[d.bufferView],v=p.buffer;n.buffers[v].uri&&(u=t.parsingResult.uris.buffers[v]),m=ui[d.componentType],m==Uint16Array?c="getUint16":m==Uint8Array&&(c="getUint8");let _=d.byteOffset||0;l=((p.byteOffset||0)+_)/m.BYTES_PER_ELEMENT,f=l+m.BYTES_PER_ELEMENT*h.count/m.BYTES_PER_ELEMENT;let g=0;for(;l<f;l++){let t=u[c](l*m.BYTES_PER_ELEMENT,!0);i[3*t]=a[3*g],i[3*t+1]=a[3*g+1],i[3*t+2]=a[3*g+2],g++}}};class Gi{constructor(t,e,r,n){let i=[];r.targets&&r.targets.forEach((function(r){let n={vertices:[],verticesColor_0:[],normals:[],uvs:[],uvs1:[],jointWeights:[],joints:[],tangents:[]};i.push(n);for(let i in r){let a=n.vertices,o=n.verticesColor_0,s=n.normals,u=n.uvs,l=n.uvs1,f=n.jointWeights,m=n.joints,c=n.tangents,h=r[i],d=new li(t,e,h);Pi(0,0,i,d,a,u,l,s,f,m,o,c),d.accessor.sparse&&Ei(t,i,d.accessor,e,a)}})),this.list=i,i.weights=n||[],this.origin=null}}let Di=function(t,e,r,n,i){if("mesh"in n){let r=n.mesh;(function(t,e,r){let n,i,a,o;r.name&&(n=r.name);let s=[];return r.primitives.forEach((function(u,l){let f,m,c,h,d=[],p=[],v=[],_=[],g=[],x=[],y=[],S=[],T=[];if(u.attributes)for(let r in u.attributes){let n=u.attributes[r],i=new li(t,e,n);Pi(0,0,r,i,p,_,g,x,y,S,v,T),i.accessor.sparse&&Ei(t,r,i.accessor,e,p)}if("indices"in u){let r=u.indices;!function(t,e,r,n){let i,a=r.componentType_BYTES_PER_ELEMENT,o=r.bufferURIDataView,s=r.getMethod,u=r.accessor.type,l=r.accessor.count,f=r.startIndex;switch(u){case"SCALAR":for(i=f+l;f<i;f++)n.push(o[s](f*a,!0))}}(0,0,new li(t,e,r),d)}if(m=wi(t,e,u),i=m[1],a=m[2],o=m[3],m=m[0],m instanceof xi&&t.parsingResult.materials.push(m),"mode"in u)switch(u.mode){case 0:c="point-list";break;case 1:case 2:c="line-list";break;case 3:c="line-strip";break;case 4:c="triangle-list";break;case 5:case 6:c="triangle-strip"}h=x.length?x:qe.calculateNormals(p,d);let U,b=[];Mi(b,p,v,h,_,g,y,S,T);let M=[];if(p.length&&M.push(new Si("aVertexPosition","float3")),h.length&&M.push(new Si("aVertexNormal","float3")),_.length&&M.push(new Si("aTexcoord","float2")),(g.length||_.length)&&M.push(new Si("aTexcoord1","float2")),M.push(new Si("aVertexColor_0","float4")),M.push(new Si("aVertexWeight","float4")),M.push(new Si("aVertexJoint","float4")),M.push(new Si("aVertexTangent","float4")),U=new Ui(t.redGPUContext,new bi(t.redGPUContext,"testGLTF_interleaveBuffer_"+ze.getNextUUID(),bi.TYPE_VERTEX,new Float32Array(b),M),d.length?new bi(t.redGPUContext,"testGLTF_indexBuffer_"+ze.getNextUUID(),bi.TYPE_INDEX,new Uint32Array(d)):null),m||qe.throwFunc("재질을 파싱할수없는경우 ",u),f=new qn(t.redGPUContext,U,m),n&&(f.name=n,t.parsingOption))for(let e in t.parsingOption)n.toLowerCase().indexOf(e)>-1&&t.parsingOption[e](f);switch(f.primitiveTopology=c||"triangle-list",i&&(f.cullMode="none",m.useMaterialDoubleSide=!0),a){case"BLEND":f.renderDrawLayerIndex=va.DRAW_LAYER_INDEX1,m.alphaBlend=2;break;case"MASK":m.alphaBlend=1,m.cutOff=o,m.useCutOff=!0;break;default:m.alphaBlend=0,m.useCutOff=!1}v.length&&(m.useVertexColor_0=!0),T.length&&(m.useVertexTangent=!0);let P=new Gi(t,e,u,r.weights);P.list.forEach((function(t){let e;e=t.normals.length?t.normals:qe.calculateNormals(t.vertices,d);let r=[];Mi(r,t.vertices,t.verticesColor_0,e,t.uvs,t.uvs1,t.jointWeights,t.joints,t.tangents),t.interleaveData=r})),f._morphInfo=P,f._morphInfo.origin=new Float32Array(b);let w=f.geometry.interleaveBuffer.data,E=0;M.forEach((function(t){E+=t.size})),f._morphInfo.list.forEach((function(t,e){let r=0,n=w.length/E,i=null==f._morphInfo.list.weights[e]?.5:f._morphInfo.list.weights[e];for(;r<n;r++)w[r*E+0]+=t.vertices[3*r+0]*i,w[r*E+1]+=t.vertices[3*r+1]*i,w[r*E+2]+=t.vertices[3*r+2]*i})),f.geometry.interleaveBuffer.update(w),f._morphInfo.origin=new Float32Array(w),u.Mesh=f,s.push(f)})),s})(t,e,e.meshes[r]).forEach((function(r){i.addChild(n.Mesh=r),pi(r,n),"children"in n&&n.children.forEach((function(n){Di(t,e,n,e.nodes[n],r)})),"skin"in n&&_i(t,e,e.skins[n.skin],r)}))}else{let a;if(t.parsingResult.groups[r]?(a=t.parsingResult.groups[r],n.Mesh=a):(a=new qn(t.redGPUContext),i.addChild(a),n.Mesh=a,t.parsingResult.groups[r]=a,t.parsingResult.groups[r].name=n.name),pi(a,n),"camera"in n){t.parsingResult.cameras[n.camera]._parentMesh=i,t.parsingResult.cameras[n.camera]._targetMesh=a;let e=new qn(t.redGPUContext);a.addChild(e),t.parsingResult.cameras[n.camera]._cameraMesh=e}"children"in n&&n.children.forEach((function(r){Di(t,e,r,e.nodes[r],a)})),"skin"in n&&_i(t,e,e.skins[n.skin],a)}},Li=function(t,e,r){let n,i,a,o;a=e.scenes[0].nodes,n=0,i=a.length;let s=function(){o=a[n],Di(t,e,o,e.nodes[o],t.resultMesh),n++,n===i?r&&r():s()};s()};var Bi;!function(){var t,e,r=(e={},function(t,r,n,i){if(e[t])requestAnimationFrame((function(){n(e[t])}));else{var a=new XMLHttpRequest;a.open("GET",t,!0),a.onreadystatechange=function(r){4===a.readyState&&200===a.status?(e[t]=a,n(a)):i(a,r)},a.send()}}),n=function(){var t={};return function(e,r,n){if(t[e])requestAnimationFrame((function(){r(t[e])}));else{var i=new XMLHttpRequest;i.open("GET",e,!0),i.overrideMimeType("application/octet-stream"),i.responseType="arraybuffer",i.onreadystatechange=function(a){4===i.readyState&&200===i.status?(t[e]=i,r(i)):n(i,a)},i.send()}}}();Bi=function(e,i,a,s,u,l){if(!(this instanceof Bi))return new Bi(e,i,a,s,u,l);this.redGPUContext=e;var f=this;if(a.indexOf(".glb")>-1){var m;m=function(t){var e="";return t.map((function(t){e+=String.fromCharCode(t)})),e},n(i+a,(function(r){for(var n=null,i=null,a=null,o=null,u=0,l=0,c=null,h=new DataView(r.response,12),d=(m(new Uint8Array(r.response,0,4)),h.getUint32(4,!0),h.getUint32(8,!0),new DataView(r.response,12));u<d.byteLength;)l=d.getUint32(u,!0),u+=4,c=d.getUint32(u,!0),u+=4,1313821514===c?(i=new Uint8Array(r.response,12+u,l),n=m(i)):5130562===c&&(o=12+u,a=r.response.slice(o,o+l)),u+=l;if(null===n)throw new Error("JSON content not found");var p=JSON.parse(n),v=a;p.images&&p.images.forEach((function(t){if("image/png"===t.mimeType||"image/jpeg"===t.mimeType||"image/gif"===t.mimeType){var e;e=p.bufferViews[t.bufferView].byteOffset||0;var r=v.slice(e,e+p.bufferViews[t.bufferView].byteLength),n=new Blob([new Uint8Array(r)],{type:t.mimeType});t.uri=URL.createObjectURL(n)}})),t(f,e,p,(function(){s&&s(f)}),v)}),(function(t,e){}))}else r(i+a,null,(function(r){t(f,e,JSON.parse(r.response),(function(){s&&s(f)}))}),(function(t,e){}));this.redGPUContext=e,this.path=i,this.fileName=a,this.resultMesh=new qn(e),this.resultMesh.name="instanceOfGLTFLoader_"+ze.getNextUUID(),this.parsingResult={groups:[],materials:[],uris:{buffers:[]},textures:{},textureRawList:[],cameras:[],animations:[]},this.parsingOption=l,this.environmentTexture=u||null;var c=null;this.stopAnimation=function(){o.indexOf(c)>-1&&o.splice(o.indexOf(c),1)},this.playAnimation=function(t){o.push(c={startTime:performance.now(),targetAnimationData:t})}};var i,a,o=[];Bi.animationLooper=t=>function(t,e){let r,n,i,a,o,s,u,l,f,m,c,h,d,p,v,_,g,x,y,S,T,U,b,M,P,w,E,G,D,L,B,R,C,I,N,F,A,V,O,Y,X,z,$,k,W,Z,H,q,j,J,Q,K,tt,et,rt,nt,it,at,ot,st,ut=e.length;for(;ut--;)for(L=e[ut],G=L.targetAnimationData,B=G.length;B--;){for(R=G[B],r=(t-L.startTime)%(1e3*G.maxTime)/1e3,C=R.target,F=R.time,A=R.time,V=F.length,O=0,N=F.length-1,I=0,n=F[N],i=F[I];O<V;O++){let t=F[O];if(t<r&&(N=O,n=F[N],null==F[N+1]?(I=0,i=F[I]):(I=N+1,i=F[I])),0==O&&r<F[O]){N=V-1,n=F[N],I=O,i=F[I],r=t;break}if(O==V-1&&r>t){N=0,n=F[N],I=V-1,i=F[I],r=t;break}}if(C&&(C.dirtyTransform=!0),"CUBICSPLINE"==R.interpolation){D=i-n,"NaN"==D.toString()&&(D=0);let t=(r-n)/D;"NaN"==t.toString()&&(t=0);let e=t*t,G=e*t,L=-2*G+3*e,B=G-e,F=1-L,O=B-e+t;if(C){let t,e,r,n,i=R.data;switch(R.key){case"rotation":if(b=i[12*N+4],M=i[12*N+5],P=i[12*N+6],w=i[12*N+7],E=b*b+M*M+P*P+w*w,E>0&&(E=1/Math.sqrt(E)),v=b*E,_=M*E,g=P*E,x=w*E,b=i[12*I+4],M=i[12*I+5],P=i[12*I+6],w=i[12*I+7],E=b*b+M*M+P*P+w*w,E>0&&(E=1/Math.sqrt(E)),a=b*E,o=M*E,s=P*E,u=w*E,b=i[12*N+8],M=i[12*N+9],P=i[12*N+10],w=i[12*N+11],E=b*b+M*M+P*P+w*w,E>0&&(E=1/Math.sqrt(E)),y=b*E,S=M*E,T=P*E,U=w*E,b=i[12*N+0],M=i[12*N+1],P=i[12*N+2],w=i[12*N+3],E=b*b+M*M+P*P+w*w,E>0&&(E=1/Math.sqrt(E)),c=b*E,h=M*E,d=P*E,p=w*E,N!=V-1){t=v,e=y*D,r=a,n=c*D,b=F*t+O*e+L*r+B*n,t=_,e=S*D,r=o,n=h*D,M=F*t+O*e+L*r+B*n,t=g,e=T*D,r=s,n=d*D,P=F*t+O*e+L*r+B*n,t=x,e=U*D,r=u,n=p*D,w=F*t+O*e+L*r+B*n;let i=[],l=[0,0,0],f=b+b,m=M+M,E=P+P,G=b*f,R=b*m,I=b*E,N=M*m,A=M*E,V=P*E,Y=w*f,X=w*m,z=w*E;i[0]=1-(N+V),i[4]=R-z,i[8]=I+X,i[1]=R+z,i[5]=1-(G+V),i[9]=A-Y,i[2]=I-X,i[6]=A+Y,i[10]=1-(G+N),i[3]=0,i[7]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1;let $=i[0],k=i[4],W=i[8],Z=i[5],H=i[9],q=i[6],j=i[10];l[1]=Math.asin(Math.max(-1,Math.min(1,W))),Math.abs(W)<.99999?(l[0]=Math.atan2(-H,j),l[2]=Math.atan2(-k,$)):(l[0]=Math.atan2(q,Z),l[2]=0),l[0]=-180*l[0]/Math.PI,l[1]=-180*l[1]/Math.PI,l[2]=-180*l[2]/Math.PI,C._rotationX=l[0],C._rotationY=l[1],C._rotationZ=l[2]}break;case"translation":a=i[9*N+3],o=i[9*N+4],s=i[9*N+5],v=i[9*I+3],_=i[9*I+4],g=i[9*I+5],y=i[9*N+6],S=i[9*N+7],T=i[9*N+8],l=i[9*I+0],f=i[9*I+1],m=i[9*I+2],N!=V-1&&(t=v,e=y*D,r=a,n=l*D,C._x=F*t+O*e+L*r+B*n,t=_,e=S*D,r=o,n=f*D,C._y=F*t+O*e+L*r+B*n,t=g,e=T*D,r=s,n=m*D,C._z=F*t+O*e+L*r+B*n);break;case"scale":a=i[9*N+3],o=i[9*N+4],s=i[9*N+5],v=i[9*I+3],_=i[9*I+4],g=i[9*I+5],y=i[9*N+6],S=i[9*N+7],T=i[9*N+8],l=i[9*I+0],f=i[9*I+1],m=i[9*I+2],N!=V-1&&(t=v,e=y*D,r=a,n=l*D,C._scaleX=F*t+O*e+L*r+B*n,t=_,e=S*D,r=o,n=f*D,C._scaleY=F*t+O*e+L*r+B*n,t=g,e=T*D,r=s,n=m*D,C._scaleZ=F*t+O*e+L*r+B*n);break;case"weights":for(Y=R.targets.length;Y--;){let t;for(X=R.targets[Y],z=X.geometry.interleaveBuffer.data,$=X._morphInfo.origin,k=X.geometry.interleaveBuffer.stride,Z=z.length/k,et=X._morphInfo.list.length,A=R.data,rt=X._morphInfo.list,rt.cacheData||(rt.cacheData={}),W=0;W<Z;W++){if(tt=W*k,st=rt.cacheData[tt+"_"+N+"_"+I],st)H=st[0],q=st[1],j=st[2],J=st[3],Q=st[4],K=st[5];else{for(H=$[tt],q=$[tt],j=$[tt+1],J=$[tt+1],Q=$[tt+2],K=$[tt+2],nt=et;nt--;)nt%3==1&&(it=A[N*et+nt],at=A[I*et+nt],ot=rt[nt].interleaveData,t=ot[tt],H+=it*t,q+=at*t,t=ot[tt+1],j+=it*t,J+=at*t,t=ot[tt+2],Q+=it*t,K+=at*t);rt.cacheData[tt+"_"+N+"_"+I]=[H,q,j,J,Q,K]}z[tt]=H+D*(q-H),z[tt+1]=j+D*(J-j),z[tt+2]=Q+D*(K-Q)}X.geometry.interleaveBuffer.update(z)}}}}else if(D="STEP"==R.interpolation?0:(r-n)/(i-n),"NaN"==D.toString()&&(D=0),C){let t=R.data;switch(R.key){case"rotation":let e,r,n,i,l;b=t[4*N],M=t[4*N+1],P=t[4*N+2],w=t[4*N+3],E=b*b+M*M+P*P+w*w,E>0&&(E=1/Math.sqrt(E)),v=b*E,_=M*E,g=P*E,x=w*E,b=t[4*I],M=t[4*I+1],P=t[4*I+2],w=t[4*I+3],E=b*b+M*M+P*P+w*w,E>0&&(E=1/Math.sqrt(E)),a=b*E,o=M*E,s=P*E,u=w*E,r=v*a+_*o+g*s+x*u,r<0&&(r=-r,a=-a,o=-o,s=-s,u=-u),1-r>Ae.glMatrix.EPSILON?(e=Math.acos(r),n=Math.sin(e),i=Math.sin((1-D)*e)/n,l=Math.sin(D*e)/n):(i=1-D,l=D),b=i*v+l*a,M=i*_+l*o,P=i*g+l*s,w=i*x+l*u;let f=[],m=[0,0,0],c=b+b,h=M+M,d=P+P,p=b*c,y=b*h,S=b*d,T=M*h,U=M*d,G=P*d,L=w*c,B=w*h,F=w*d;f[0]=1-(T+G),f[4]=y-F,f[8]=S+B,f[1]=y+F,f[5]=1-(p+G),f[9]=U-L,f[2]=S-B,f[6]=U+L,f[10]=1-(p+T),f[3]=0,f[7]=0,f[11]=0,f[12]=0,f[13]=0,f[14]=0,f[15]=1;let V=f[0],O=f[4],ut=f[8],lt=f[5],ft=f[9],mt=f[6],ct=f[10];m[1]=Math.asin(Math.max(-1,Math.min(1,ut))),Math.abs(ut)<.99999?(m[0]=Math.atan2(-ft,ct),m[2]=Math.atan2(-O,V)):(m[0]=Math.atan2(mt,lt),m[2]=0),m[0]=-180*m[0]/Math.PI,m[1]=-180*m[1]/Math.PI,m[2]=-180*m[2]/Math.PI,C._rotationX=m[0],C._rotationY=m[1],C._rotationZ=m[2];break;case"translation":a=t[3*I],o=t[3*I+1],s=t[3*I+2],v=t[3*N],_=t[3*N+1],g=t[3*N+2],C._x=v+D*(a-v),C._y=_+D*(o-_),C._z=g+D*(s-g);break;case"scale":a=t[3*I],o=t[3*I+1],s=t[3*I+2],v=t[3*N],_=t[3*N+1],g=t[3*N+2],C._scaleX=v+D*(a-v),C._scaleY=_+D*(o-_),C._scaleZ=g+D*(s-g);break;case"weights":for(Y=R.targets.length;Y--;){let t;for(X=R.targets[Y],z=X.geometry.interleaveBuffer.data,$=X._morphInfo.origin,k=X.geometry.interleaveBuffer.stride,Z=z.length/k,et=X._morphInfo.list.length,A=R.data,rt=X._morphInfo.list,rt.cacheData||(rt.cacheData={}),W=0;W<Z;W++){if(tt=W*k,st=rt.cacheData[tt+"_"+N+"_"+I],st)H=st[0],q=st[1],j=st[2],J=st[3],Q=st[4],K=st[5];else{for(H=$[tt],q=$[tt],j=$[tt+1],J=$[tt+1],Q=$[tt+2],K=$[tt+2],nt=et;nt--;)it=A[N*et+nt],at=A[I*et+nt],ot=rt[nt].interleaveData,t=ot[tt],H+=it*t,q+=at*t,t=ot[tt+1],j+=it*t,J+=at*t,t=ot[tt+2],Q+=it*t,K+=at*t;rt.cacheData[tt+"_"+N+"_"+I]=[H,q,j,J,Q,K]}z[tt]=H+D*(q-H),z[tt+1]=j+D*(J-j),z[tt+2]=Q+D*(K-Q)}X.geometry.interleaveBuffer.update(z)}}}}}(t,o),i=function(t){void 0===t.asset&&qe.throwFunc("GLTFLoader - asset은 반드시 정의되어야함"),t.asset.version[0]<2&&qe.throwFunc("GLTFLoader - asset의 버전은 2.0이상이어야함")},a=function(t,e,r){var i=0,a=0;e.buffers.forEach((function(e,o){if(e._redURIkey="buffers",e._redURIIndex=o,i++,e.uri instanceof ArrayBuffer)a++,t.parsingResult.uris[e._redURIkey][e._redURIIndex]=new DataView(e.uri),a==i&&r&&r();else{var s="data:"==e.uri.substr(0,5)?e.uri:t.path+e.uri;n(s,(function(n){a++,t.parsingResult.uris[e._redURIkey][e._redURIIndex]=new DataView(n.response),a==i&&r&&r()}),(function(t,e){}))}}))},t=function(t,e,r,n,o){i(r),o?(r.buffers[0].uri=o,a(t,r,(function(){di(t,r),Li(t,r,(function(){new si(t.redGPUContext,t.parsingResult.textureRawList,e=>{e.textures.forEach(t=>{t.userInfo.targetMaterial[t.userInfo.targetTexture]=t.texture}),mi(t,r).then(t=>{n&&n()})})}))}))):a(t,r,(function(){di(t,r),Li(t,r,(function(){new si(t.redGPUContext,t.parsingResult.textureRawList,e=>{e.textures.forEach(t=>{t.userInfo.targetMaterial[t.userInfo.targetTexture]=t.texture}),mi(t,r).then(t=>{n&&n()})})}))}))}}();var Ri=Bi;let Ci,Ii,Ni=!1,Fi=t=>{Ii||(Ii=document.createElement("div"),Ii.style.cssText="\n\t\t\tposition:fixed;\n\t\t\tbottom:0; left:0;\n\t\t\twidth : 200px;\n\t\t\toverflow : hidden;\n\t\t\tbackground:rgba(0, 0, 0, 0.5);\n\t\t\tpadding:5px;\n\t\t\tfont-size:11px;\n\t\t\tcolor:#fff;\n\t\t")};const Ai={LEFT_TOP:"leftTop",RIGHT_TOP:"rightTop",LEFT_BOTTOM:"leftBottom",RIGHT_BOTTOM:"rightBottom",resetData:t=>(Ci=[],t.forEach(t=>Ci.push({view:t,object3DNum:0,dirtyTransformNum:0,drawCallNum:0,triangleNum:0,dirtyPipelineNum:0,x:t.x,y:t.y,width:t.width,height:t.height,viewRect:t.viewRect,baseRenderTime:0,postEffectRenderTime:0,finalRenderTime:0})),Ci),visible:(t,e=Ai.LEFT_BOTTOM)=>{Ni=t,Fi(),Ni?(document.body.appendChild(Ii),Ai.setLocation(e)):Ii.parentNode&&document.body.removeChild(Ii)},setLocation:(t=Ai.LEFT_BOTTOM)=>{switch(Ii.style.top="",Ii.style.bottom="",Ii.style.left="",Ii.style.right="",t){case Ai.LEFT_TOP:Ii.style.left=Ii.style.top=0;break;case Ai.LEFT_BOTTOM:Ii.style.left=Ii.style.bottom=0;break;case Ai.RIGHT_TOP:Ii.style.right=Ii.style.top=0;break;case Ai.RIGHT_BOTTOM:Ii.style.right=Ii.style.bottom=0}},update:t=>{Fi(),Ni&&(Ii.innerHTML="",Ci.forEach(t=>{let e,r,n,i,a={x:1,width:1};e=document.createElement("div"),e.style.cssText="\n\t\t\t\t\tbackground : rgba(0,0,0,0.75);\n\t\t\t\t\tmargin-bottom : 1px;\n\t\t\t\t\tpadding : 8px;\n\t\t\t\t",Ii.appendChild(e),r=document.createElement("div"),r.style.color="#fff",e.appendChild(r),n="";for(let e in t)i=t[e],"number"==typeof i&&(e.includes("Time")&&(i=i.toFixed(5)),i=i.toLocaleString()),n+=`<span style="color:rgba(255,255,255,0.5)">${e}</span> : ${i}`,n+=a[e]?" / ":"<br>";r.innerHTML=n}))}};class Vi extends Ti{constructor(t,e=1,r=1,n=1,i=1,a=1,o=!1){let s;if(super(),Oi.set(this,{writable:!0,value:function(){let t,e,r,n,i,a,o,s,u,l,f,m,c,h,d,p;return function(v,_,g,x,y,S,T,U){t=g/2,e=x/2,r=Math.floor(y)||1,n=Math.floor(S)||1,i=r+1,a=n+1,o=g/r,s=x/n;const b=[],M=[];for(l=0;l<a;l++)for(m=l*s-e,u=0;u<i;u++)f=u*o-t,b.push(f,-m,0,0,0,1,u/r*T,(U?1-l/n:l/n)*T);for(l=0;l<n;l++)for(u=0;u<r;u++)c=u+i*l,h=u+i*(l+1),d=u+1+i*(l+1),p=u+1+i*l,M.push(c,h,p,h,d,p);return new Ui(v,new bi(v,_+"_interleaveBuffer",bi.TYPE_VERTEX,new Float32Array(b),[new Si("vertexPosition","float3"),new Si("vertexNormal","float3"),new Si("texcoord","float2")]),new bi(v,_+"_indexBuffer",bi.TYPE_INDEX,new Uint32Array(M)))}}()}),s=[this.constructor.name,e,r,n,i,a,o].join("_"),t.state.Geometry.has(s))return t.state.Geometry.get(s);let u=Oe(this,Oi).call(this,t,s,e,r,n,i,a,o);this.interleaveBuffer=u.interleaveBuffer,this.indexBuffer=u.indexBuffer,this.vertexState=u.vertexState,t.state.Geometry.set(s,this)}}var Oi=new WeakMap;let Yi=new Float32Array(1);class Xi extends Yr{get sprite3DMode(){return this._sprite3DMode}set sprite3DMode(t){this._sprite3DMode=t,Yi[0]=t?1:0,this.uniformBuffer_vertex.GPUBuffer.setSubData(this.uniformBufferDescriptor_vertex.redStructOffsetMap.sprite3DMode,Yi)}constructor(t,e){super(t),Ve(this,"_sprite3DMode",!0),this.diffuseTexture=e,this.needResetBindingInfo=!0}resetBindingInfo(){this.entries=[{binding:0,resource:{buffer:this.uniformBuffer_vertex.GPUBuffer,offset:0,size:this.uniformBufferDescriptor_vertex.size}},{binding:1,resource:{buffer:this.uniformBuffer_fragment.GPUBuffer,offset:0,size:this.uniformBufferDescriptor_fragment.size}},{binding:2,resource:this._diffuseTexture?this._diffuseTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:3,resource:this._diffuseTexture?this._diffuseTexture._GPUTextureView:this.redGPUContext.state.emptyTextureView}],this._afterResetBindingInfo()}}Ve(Xi,"vertexShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_vertex.systemUniforms}\n    ${tr.GLSL_SystemUniforms_vertex.meshUniforms}\n    ${tr.GLSL_SystemUniforms_vertex.getSprite3DMatrix}    \n\tlayout(location = 0) in vec3 a_pos;\n    layout(location = 1) in vec2 a_uv;\n    layout(location = 2) in vec3 position;\n    layout(location = 3) in float alpha;\n    layout(location = 4) in vec3 rotation;\n    layout(location = 5) in float scale;\n\tlayout(location = 0 ) out vec2 vUV;\n\tlayout(location = 1 ) out float vMouseColorID;\t\n\tlayout(location = 2 ) out float vSumOpacity;\n\tlayout( set = ${tr.SET_INDEX_VertexUniforms}, binding = 0 ) uniform VertexUniforms {\n        float sprite3DMode;\n    } vertexUniforms;\n\tmat4 rotationMTX(vec3 t)\n    {\n       float s = sin(t[0]);float c = cos(t[0]);\n       mat4 m1 = mat4( 1,0,0,0, 0,c,s,0, 0,-s,c,0, 0,0,0,1);s = sin(t[1]);c = cos(t[1]);\n       mat4 m2 = mat4(c,0,-s,0, 0,1,0,0, s,0,c,0,  0,0,0,1);s = sin(t[2]);c = cos(t[2]);\n       mat4 m3 = mat4(c,s,0,0, -s,c,0,0, 0,0,1,0,  0,0,0,1);\n       return m3*m2*m1;\n    }\n\tvoid main() {\n\t\tvUV = a_uv;\n\t\tvMouseColorID = meshUniforms.mouseColorID;\n\t\tvSumOpacity = meshUniforms.sumOpacity * alpha;\n\t\tfloat ratio = systemUniforms.resolution.x/systemUniforms.resolution.y; \n\t\tif( vertexUniforms.sprite3DMode == 1.0 ) {\n\t\t\tmat4 scaleMTX = mat4(\n\t\t\t\t1, 0, 0, 0,\n\t\t\t\t0, 1, 0, 0,\n\t\t\t\t0, 0, 1, 0,\n\t\t\t\tposition, 1\n\t\t\t) *\n\t\t\tmat4(\n\t\t\t\tscale, 0, 0, 0,\n\t\t\t\t0, scale , 0, 0,\n\t\t\t\t0, 0, scale, 0,\n\t\t\t\t0, 0, 0, 1\n\t\t\t) ;\n\t\t\tgl_Position = systemUniforms.perspectiveMTX * getSprite3DMatrix( systemUniforms.cameraMTX,  scaleMTX ) * rotationMTX(vec3(0,0, rotation.z)) * vec4(a_pos , 1);\n\t\t}else{\n\t\t\tmat4 scaleMTX = mat4(\n\t\t\t\tscale, 0, 0, 0,\n\t\t\t\t0, scale, 0, 0,\n\t\t\t\t0, 0, scale, 0,\n\t\t\t\tposition, 1\n\t\t\t)\n\t\t\t* rotationMTX(rotation);\n\t\t\tgl_Position = systemUniforms.perspectiveMTX *  systemUniforms.cameraMTX * scaleMTX * vec4(a_pos , 1);\n\t\t}\n\t\t\n\t}\n\t`),Ve(Xi,"fragmentShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\tconst float TRUTHY = 1.0;\n\tlayout( location = 0 ) in vec2 vUV;\n\tlayout( location = 1 ) in float vMouseColorID;\t\n\tlayout( location = 2 ) in float vSumOpacity;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 1 ) uniform FragmentUniforms {\n        float alpha;\n        //\n        float __diffuseTextureRenderYn;\n    } fragmentUniforms;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 2 ) uniform sampler uSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 3 ) uniform texture2D uDiffuseTexture;\n\tlayout( location = 0 ) out vec4 outColor;\n\tlayout( location = 1 ) out vec4 out_MouseColorID_Depth;\n\tvoid main() {\n\t\tvec4 diffuseColor = vec4(0.0);\n\t\tif(fragmentUniforms.__diffuseTextureRenderYn == TRUTHY) diffuseColor = texture(sampler2D(uDiffuseTexture, uSampler), vUV) ;\n\t\toutColor = diffuseColor;\n\t\toutColor.a *= fragmentUniforms.alpha * vSumOpacity;\n\t\tout_MouseColorID_Depth = vec4(vMouseColorID, gl_FragCoord.z/gl_FragCoord.w, 0.0, 0.0);\n\t\t\n\t}\n`),Ve(Xi,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(Xi,"uniformsBindGroupLayoutDescriptor_material",{entries:[{binding:0,visibility:GPUShaderStage.VERTEX,type:"uniform-buffer"},{binding:1,visibility:GPUShaderStage.FRAGMENT,type:"uniform-buffer"},{binding:2,visibility:GPUShaderStage.FRAGMENT,type:"sampler"},{binding:3,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture"}]}),Ve(Xi,"uniformBufferDescriptor_vertex",[{size:$e.float,valueName:"sprite3DMode"}]),Ve(Xi,"uniformBufferDescriptor_fragment",[{size:$e.float,valueName:"alpha"},{size:$e.float,valueName:"__diffuseTextureRenderYn"}]);class zi extends ze{constructor(t,e){super(),$i.set(this,{writable:!0,value:void 0}),ki.set(this,{writable:!0,value:void 0}),Ve(this,"GPURenderPipeline",void 0),Ye(this,$i,t),Ye(this,ki,e),this.GPURenderPipeline=null}update(t,e){let r=Oe(this,ki);const n=t.device,i={layout:n.createPipelineLayout({bindGroupLayouts:[e.systemUniformInfo_vertex.GPUBindGroupLayout,e.systemUniformInfo_fragment.GPUBindGroupLayout,r.GPUBindGroupLayout,r._material.GPUBindGroupLayout]}),vertexStage:{module:r._material.vShaderModule.GPUShaderModule,entryPoint:"main"},fragmentStage:{module:r._material.fShaderModule.GPUShaderModule,entryPoint:"main"},vertexState:{indexFormat:"uint32",vertexBuffers:[{arrayStride:32,stepMode:"vertex",attributes:[{shaderLocation:0,offset:0,format:"float3"},{shaderLocation:1,offset:24,format:"float2"}]},{arrayStride:4*r._PROPERTY_NUM,stepMode:"instance",attributes:[{shaderLocation:2,offset:16,format:"float3"},{shaderLocation:3,offset:28,format:"float"},{shaderLocation:4,offset:32,format:"float3"},{shaderLocation:5,offset:44,format:"float"}]}]},colorStates:[{format:t.swapChainFormat,colorBlend:{srcFactor:r._blendColorSrc,dstFactor:r._blendColorDst,operation:"add"},alphaBlend:{srcFactor:r._blendAlphaSrc,dstFactor:r._blendAlphaDst,operation:"add"}},{format:"rgba32float"}],rasterizationState:{frontFace:"ccw",cullMode:r._cullMode},primitiveTopology:r._primitiveTopology,depthStencilState:{format:"depth24plus-stencil8",depthWriteEnabled:r._depthWriteEnabled,depthCompare:r._depthCompare},sampleCount:4};this.GPURenderPipeline=n.createRenderPipeline(i)}}var $i=new WeakMap,ki=new WeakMap;class Wi extends kn{get particleNum(){return this._particleNum}set particleNum(t){this._particleNum=t,this.setParticleData()}get sprite3DMode(){return this._material._sprite3DMode}set sprite3DMode(t){return this._material.sprite3DMode=t}get texture(){return this._material.diffuseTexture}set texture(t){return this._material.diffuseTexture=t}get material(){return this._material}set material(t){}compute(t){Oe(this,Hi).set([t,this._x,this._y,this._z,this.minLife,this.maxLife,this.minStartX,this.maxStartX,this.minEndX,this.maxEndX,this.easeX,this.minStartY,this.maxStartY,this.minEndY,this.maxEndY,this.easeY,this.minStartZ,this.maxStartZ,this.minEndZ,this.maxEndZ,this.easeZ,this.minStartAlpha,this.maxStartAlpha,this.minEndAlpha,this.maxEndAlpha,this.easeAlpha,this.minStartScale,this.maxStartScale,this.minEndScale,this.maxEndScale,this.easeScale,this.minStartRotationX,this.maxStartRotationX,this.minEndRotationX,this.maxEndRotationX,this.easeRotationX,this.minStartRotationY,this.maxStartRotationY,this.minEndRotationY,this.maxEndRotationY,this.easeRotationY,this.minStartRotationZ,this.maxStartRotationZ,this.minEndRotationZ,this.maxEndRotationZ,this.easeRotationZ],0),this.simParamBuffer.setSubData(0,Oe(this,Hi));const e=Oe(this,Zi).device.createCommandEncoder({}),r=e.beginComputePass();r.setPipeline(this.computePipeline),r.setBindGroup(tr.SET_INDEX_ComputeUniforms,this.particleBindGroup),r.dispatch(this._particleNum),r.endPass(),Oe(this,Zi).device.defaultQueue.submit([e.finish()])}constructor(t,e=1,r={},n,i){super(t),Zi.set(this,{writable:!0,value:void 0}),Hi.set(this,{writable:!0,value:void 0}),Ve(this,"computePipeline",void 0),Ve(this,"particleBindGroup",void 0),Ve(this,"particleBuffer",void 0),Ve(this,"minLife",2e3),Ve(this,"maxLife",1e4),Ve(this,"minStartX",-1),Ve(this,"maxStartX",1),Ve(this,"minEndX",-15),Ve(this,"maxEndX",15),Ve(this,"minStartY",-1),Ve(this,"maxStartY",1),Ve(this,"minEndY",-15),Ve(this,"maxEndY",15),Ve(this,"minStartZ",-1),Ve(this,"maxStartZ",1),Ve(this,"minEndZ",-15),Ve(this,"maxEndZ",15),Ve(this,"minStartAlpha",0),Ve(this,"maxStartAlpha",1),Ve(this,"minEndAlpha",0),Ve(this,"maxEndAlpha",0),Ve(this,"minStartScale",0),Ve(this,"maxStartScale",.25),Ve(this,"minEndScale",0),Ve(this,"maxEndScale",3),Ve(this,"minStartRotationX",360*-Math.random()),Ve(this,"maxStartRotationX",360*Math.random()),Ve(this,"minEndRotationX",360*-Math.random()),Ve(this,"maxEndRotationX",360*Math.random()),Ve(this,"minStartRotationY",360*-Math.random()),Ve(this,"maxStartRotationY",360*Math.random()),Ve(this,"minEndRotationY",360*-Math.random()),Ve(this,"maxEndRotationY",360*Math.random()),Ve(this,"minStartRotationZ",360*-Math.random()),Ve(this,"maxStartRotationZ",360*Math.random()),Ve(this,"minEndRotationZ",360*-Math.random()),Ve(this,"maxEndRotationZ",360*Math.random()),Ve(this,"easeX",Wi.Linear),Ve(this,"easeY",Wi.Linear),Ve(this,"easeZ",Wi.Linear),Ve(this,"easeScale",Wi.Linear),Ve(this,"easeRotationX",Wi.Linear),Ve(this,"easeRotationY",Wi.Linear),Ve(this,"easeRotationZ",Wi.Linear),Ve(this,"easeAlpha",Wi.Linear),Ye(this,Zi,t),this._material=new Xi(t);for(const t in r)this.hasOwnProperty(t)&&(this[t]=r[t]);this.geometry=i||new Vi(t),this.texture=n,this.renderDrawLayerIndex=va.DRAW_LAYER_INDEX2_Z_POINT_SORT,this._PROPERTY_NUM=44,this.blendColorSrc="src-alpha",this.blendColorDst="one",this.blendAlphaSrc="src-alpha",this.blendAlphaDst="one",this.depthWriteEnabled=!1,this.cullMode="none",Ye(this,Hi,new Float32Array([performance.now(),this._x,this._y,this._z,this.minLife,this.maxLife,this.minStartX,this.maxStartX,this.minEndX,this.maxEndX,this.easeX,this.minStartY,this.maxStartY,this.minEndY,this.maxEndY,this.easeY,this.minStartZ,this.maxStartZ,this.minEndZ,this.maxEndZ,this.easeZ,this.minStartAlpha,this.maxStartAlpha,this.minEndAlpha,this.maxEndAlpha,this.easeAlpha,this.minStartScale,this.maxStartScale,this.minEndScale,this.maxEndScale,this.easeScale,this.minStartRotationX,this.maxStartRotationX,this.minEndRotationX,this.maxEndRotationX,this.easeRotationX,this.minStartRotationY,this.maxStartRotationY,this.minEndRotationY,this.maxEndRotationY,this.easeRotationY,this.minStartRotationZ,this.maxStartRotationZ,this.minEndRotationZ,this.maxEndRotationZ,this.easeRotationZ]));let a={size:Oe(this,Hi).byteLength,usage:GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST};this.simParamBuffer=t.device.createBuffer(a),this.simParamBuffer.setSubData(0,Oe(this,Hi)),this.pipeline=new zi(t,this),this.particleNum=e||1}setParticleData(){let t=Oe(this,Zi);const e=this._PROPERTY_NUM,r=new Float32Array(this._particleNum*e),n=performance.now();for(let t=0;t<this._particleNum;++t){let i=Math.random()*this.maxLife,a=Math.random()*i;r[e*t+0]=n-a,r[e*t+1]=i,r[e*t+4]=0,r[e*t+5]=0,r[e*t+6]=0,r[e*t+7]=r[e*t+8]=0,r[e*t+9]=0,r[e*t+10]=0,r[e*t+11]=0,r[e*t+12]=Math.random()*(this.maxStartX-this.minStartX)+this.minStartX,r[e*t+13]=Math.random()*(this.maxEndX-this.minEndX)+this.minEndX,r[e*t+14]=this.easeX,r[e*t+15]=this._x,r[e*t+16]=Math.random()*(this.maxStartY-this.minStartY)+this.minStartY,r[e*t+17]=Math.random()*(this.maxEndY-this.minEndY)+this.minEndY,r[e*t+18]=this.easeY,r[e*t+19]=this._y,r[e*t+20]=Math.random()*(this.maxStartZ-this.minStartZ)+this.minStartZ,r[e*t+21]=Math.random()*(this.maxEndZ-this.minEndZ)+this.minEndZ,r[e*t+22]=this.easeZ,r[e*t+23]=this._z,r[e*t+24]=Math.random()*(this.maxStartRotationX-this.minStartRotationX)+this.minStartRotationX,r[e*t+25]=Math.random()*(this.maxEndRotationX-this.minEndRotationX)+this.minEndRotationX,r[e*t+26]=this.easeRotationX,r[e*t+27]=0,r[e*t+28]=Math.random()*(this.maxStartRotationY-this.minStartRotationY)+this.minStartRotationY,r[e*t+29]=Math.random()*(this.maxEndRotationY-this.minEndRotationY)+this.minEndRotationY,r[e*t+30]=this.easeRotationY,r[e*t+31]=0,r[e*t+32]=Math.random()*(this.maxStartRotationZ-this.minStartRotationZ)+this.minStartRotationZ,r[e*t+33]=Math.random()*(this.maxEndRotationZ-this.minEndRotationZ)+this.minEndRotationZ,r[e*t+34]=this.easeRotationZ,r[e*t+35]=0,r[e*t+36]=Math.random()*(this.maxStartScale-this.minStartScale)+this.minStartScale,r[e*t+37]=Math.random()*(this.maxEndScale-this.minEndScale)+this.minEndScale,r[e*t+38]=this.easeScale,r[e*t+39]=0,r[e*t+40]=Math.random()*(this.maxStartAlpha-this.minStartAlpha)+this.minStartAlpha,r[e*t+41]=Math.random()*(this.maxEndAlpha-this.minEndAlpha)+this.minEndAlpha,r[e*t+42]=this.easeAlpha,r[e*t+43]=0}this.particleBuffer&&(this.particleBuffer.destroy(),this.particleBuffer=null),this.particleBuffer=t.device.createBuffer({size:r.byteLength,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.VERTEX|GPUBufferUsage.STORAGE}),this.particleBuffer.setSubData(0,r);let i=(t=>`\n\t#version 450\n\t// 파티클 구조체 선언\n\tstruct Info {\n\t\tfloat startValue;\n\t\tfloat endValue;\n\t\tfloat easeType;\n\t\tfloat birthCenterValue;\n\t};\n\tstruct InfoGroup {\n\t\tInfo infoX;\n\t\tInfo infoY;\n\t\tInfo infoZ;\n\t};\n\tstruct Particle {\n\t\tfloat startTime;\n\t    float life;\n\t    vec3 valuePosition;\n\t    float valueAlpha;\n        vec3 valueRotation;\n\t    float valueScale;\t  \n\t    InfoGroup infoPosition;\n\t    InfoGroup infoRotation;\n\t    Info infoScale;\n\t    Info infoAlpha;\n\t};\n\t\n\t// 이건 설정값인듯 하고\n\tlayout(std140, set = ${tr.SET_INDEX_ComputeUniforms}, binding = 0) uniform SimParams {\n\t    float time;\n        float currentPositionX,currentPositionY,currentPositionZ;\n\t    float minLife, maxLife;\n\t    float minStartX, maxStartX, minEndX, maxEndX, easeX;\n\t    float minStartY, maxStartY, minEndY, maxEndY, easeY;\n\t    float minStartZ, maxStartZ, minEndZ, maxEndZ, easeZ;\n\t    float minStartAlpha, maxStartAlpha, minEndAlpha, maxEndAlpha, easeAlpha;\n\t    float minStartScale, maxStartScale, minEndScale, maxEndScale, easeScale;\n        float minStartRotationX, maxStartRotationX, minEndRotationX, maxEndRotationX, easeRotationX;\n\t    float minStartRotationY, maxStartRotationY, minEndRotationY, maxEndRotationY, easeRotationY;\n\t    float minStartRotationZ, maxStartRotationZ, minEndRotationZ, maxEndRotationZ, easeRotationZ;\n\t\n\t} params;\n\t\n\t// 여기다 쓰곘다는건가\t\n\tlayout(std140, set = ${tr.SET_INDEX_ComputeUniforms}, binding = 1) buffer ParticlesA {\n\t    Particle particles[${t}];\n\t} particlesA;\n\t\n\t\n\n\t\n\tconst float PI = 3.141592653589793;\n\tconst float HPI = PI * 0.5;\n\tconst float PI2 = PI * 2;\n\tfloat calEasing(float n, float type){\n\t\tswitch( int(type) ){\n\t\t\t// linear\n\t\t\tcase 0 : break;\n\t\t\t// QuintIn\n\t\t\tcase 1 : n = n * n * n * n * n; break;\n\t\t\t// QuintOut\n\t\t\tcase 2 : n = ((n -= 1) * n * n * n * n) + 1; break;\n\t\t\t// QuintInOut\n\t\t\tcase 3 : n = ((n = n * 2) < 1) ? n * n * n * n * n * 0.5 : 0.5 * ((n -= 2) * n * n * n * n + 2); break;\n\t\t\t////////////////////////\n\t\t\t// BackIn\n\t\t\tcase 4 : n = n * n * (n * 1.70158 + n - 1.70158); break;\n\t\t\t// BackOut\n\t\t\tcase 5 : n = (n -= 1) * n * (n * 1.70158 + n + 1.70158) + 1; break;\n\t\t\t// BackInOut\n\t\t\tcase 6 : n = ((n = n * 2) < 1) ? 0.5 * n * n * (n * 1.70158 + n - 1.70158) : 0.5 * (n -= 2) * n * (n * 1.70158 + n + 1.70158) + 1; break;\n\t\t\t////////////////////////\n\t\t\t// CircIn\n\t\t\tcase 7 : n = -1 * (sqrt(1 - n * n) - 1); break;\n\t\t\t// CircOut\n\t\t\tcase 8 : n = sqrt(1 - (n -= 1) * n); break;\n\t\t\t// CircInOut\n\t\t\tcase 9 : n = ((n = n * 2) < 1) ? -0.5 * (sqrt(1 - n * n) - 1) : 0.5 * sqrt(1 - (n -= 2) * n) + 0.5; break;\n\t\t\t////////////////////////\n\t\t\t// CubicIn\n\t\t\tcase 10 : n = n * n * n; break;\n\t\t\t// CubicOut\n\t\t\tcase 11 : n = ((n -= 1) * n * n) + 1; break;\n\t\t\t// CubicInOut\n\t\t\tcase 12 : n = ((n = n * 2) < 1) ? n * n * n * 0.5 : 0.5 * ((n -= 2) * n * n + 2); break;\n\t\t\t////////////////////////\n\t\t\t// ExpoIn\n\t\t\tcase 13 : n = n == 0.0 ? 0.0 : pow(2, 10 * (n - 1)); break;\n\t\t\t// ExpoOut\n\t\t\tcase 14 : n = n == 1.0 ? 1.0 : -pow(2, -10 * n) + 1; break;\n\t\t\t// ExpoInOut\n\t\t\tcase 15 : n = ((n = n * 2) < 1) ? (n == 0.0 ? 0.0 : 0.5 * pow(2, 10 * (n - 1))) : (n == 2.0 ? 1.0 : -0.5 * pow(2, -10 * (n - 1)) + 1); break;\n\t\t\t////////////////////////\n\t\t\t// QuadIn\n\t\t\tcase 16 : n = n * n; break;\n\t\t\t// QuadOut\n\t\t\tcase 17 : n = ((2 - n) * n); break;\n\t\t\t// QuadInOut\n\t\t\tcase 18 : n = ((n = n * 2) < 1) ? n * n * 0.5 : 0.5 * ((2 - (n -= 1)) * n + 1); break;\n\t\t\t////////////////////////\n\t\t\t// QuartIn\n\t\t\tcase 19 : n = n * n * n * n; break;\n\t\t\t// QuartOut\n\t\t\tcase 20 : n = 1 - ((n -= 1) * n * n * n); break;\n\t\t\t// QuartInOut\n\t\t\tcase 21 : n = ((n = n * 2) < 1) ? n * n * n * n * 0.5 : 1 - ((n -= 2) * n * n * n * 0.5); break;\n\t\t\t////////////////////////\n\t\t\t// SineIn\n\t\t\tcase 22 : n = -cos(n * HPI) + 1; break;\n\t\t\t// SineOut\n\t\t\tcase 23 : n = sin(n * HPI); break;\n\t\t\t// SineInOut\n\t\t\tcase 24 : n = (-cos(n * PI) + 1) * 0.5; break;\n\t\t\t////////////////////////\n\t\t\t// ElasticIn\n\t\t\tcase 25 : n = n == 0.0 ? 0.0 : n == 1.0 ? 1.0 : -1 * pow(2, 10 * (n -= 1)) * sin((n - 0.075) * (PI2) / 0.3); break;\n\t\t\t// ElasticOut\n\t\t\tcase 26 : n = n == 0.0 ? 0.0 : n == 1.0 ? 1.0 : pow(2, -10 * n) * sin((n - 0.075) * (PI2) / 0.3) + 1; break;\n\t\t\t// ElasticInOut\n\t\t\tcase 27 : n =( (n == 0.0 ? 0.0 : (n == 1.0 ? 1.0 : n *= 2)), (n < 1) ? -0.5 * pow(2, 10 * (n -= 1)) * sin((n - 0.075) * (PI2) / 0.3) : 0.5 * pow(2, -10 * (n -= 1)) * sin((n - 0.075) * (PI2) / 0.3) + 1); break;\n\t\t}\n\t\treturn n;\n\t}\n\tfloat rand(float n){return fract(sin(n) * 43758.5453123);}\n\tfloat randomRange(float min, float max, float v)\n\t{\n        float newValue = rand(v);\n\t\treturn (newValue * (max-min)) + min;\n\t}\n\tvoid main() {\n\t\tuint index = gl_GlobalInvocationID.x;\n\t\tParticle targetParticle = particlesA.particles[index];\n\t\n\t\tfloat age = params.time - targetParticle.startTime;\n\t\tfloat lifeRatio = age/targetParticle.life;\n\t\tif(lifeRatio>=1) {\n\t\t\tfloat uuid = params.time + index;\n\t\t\tparticlesA.particles[index].startTime = params.time;\n\t\t\tparticlesA.particles[index].life = randomRange( params.minLife, params.maxLife, uuid );\n\t\t\t// position\n\t\t\tparticlesA.particles[index].infoPosition.infoX.startValue = randomRange( params.minStartX, params.maxStartX, uuid + 1 );\n\t\t\tparticlesA.particles[index].infoPosition.infoX.endValue   = randomRange( params.minEndX, params.maxEndX, uuid + 2 );\n\t\t\tparticlesA.particles[index].infoPosition.infoX.easeType   = params.easeX;\n\t\t\tparticlesA.particles[index].infoPosition.infoY.startValue = randomRange( params.minStartY, params.maxStartY, uuid + 3 );\n\t\t\tparticlesA.particles[index].infoPosition.infoY.endValue   = randomRange( params.minEndY, params.maxEndY, uuid + 4 );\n\t\t\tparticlesA.particles[index].infoPosition.infoY.easeType   = params.easeY;\n\t\t\tparticlesA.particles[index].infoPosition.infoZ.startValue = randomRange( params.minStartZ, params.maxStartZ, uuid + 5 );\n\t\t\tparticlesA.particles[index].infoPosition.infoZ.endValue   = randomRange( params.minEndZ, params.maxEndZ, uuid + 6 );\n\t\t\tparticlesA.particles[index].infoPosition.infoZ.easeType   = params.easeZ;\n\t\t\t// alpha\n\t\t\tparticlesA.particles[index].infoAlpha.startValue = randomRange( params.minStartAlpha, params.maxStartAlpha, uuid + 7 );\n\t\t\tparticlesA.particles[index].infoAlpha.endValue   = randomRange( params.minEndAlpha, params.maxEndAlpha, uuid + 8 );\n\t\t\tparticlesA.particles[index].infoAlpha.easeType   = params.easeAlpha;\n\t\t\t// scale\n\t\t\tparticlesA.particles[index].infoScale.startValue = randomRange( params.minStartScale, params.maxStartScale, uuid + 9 );\n\t\t\tparticlesA.particles[index].infoScale.endValue   = randomRange( params.minEndScale, params.maxEndScale, uuid + 10 );\n\t\t\tparticlesA.particles[index].infoScale.easeType   = params.easeScale;\n\t\t\t// rotation\n\t\t\tparticlesA.particles[index].infoRotation.infoX.startValue = randomRange( params.minStartRotationX, params.maxStartRotationX, uuid + 11 );\n\t\t\tparticlesA.particles[index].infoRotation.infoX.endValue   = randomRange( params.minEndRotationX, params.maxEndRotationX, uuid + 12 );\n\t\t\tparticlesA.particles[index].infoRotation.infoX.easeType   = params.easeRotationX;\n\t\t\tparticlesA.particles[index].infoRotation.infoY.startValue = randomRange( params.minStartRotationY, params.maxStartRotationY, uuid + 13 );\n\t\t\tparticlesA.particles[index].infoRotation.infoY.endValue   = randomRange( params.minEndRotationY, params.maxEndRotationY, uuid + 14 );\n\t\t\tparticlesA.particles[index].infoRotation.infoY.easeType   = params.easeRotationY;\n\t\t\tparticlesA.particles[index].infoRotation.infoZ.startValue = randomRange( params.minStartRotationZ, params.maxStartRotationZ, uuid + 15 );\n\t\t\tparticlesA.particles[index].infoRotation.infoZ.endValue   = randomRange( params.minEndRotationZ, params.maxEndRotationZ, uuid + 16 );\n\t\t\tparticlesA.particles[index].infoRotation.infoZ.easeType   = params.easeRotationZ;\n\t\t\t// birth position\n\t\t\tparticlesA.particles[index].infoPosition.infoX.birthCenterValue = params.currentPositionX;\n\t\t\tparticlesA.particles[index].infoPosition.infoY.birthCenterValue = params.currentPositionY;\n\t\t\tparticlesA.particles[index].infoPosition.infoZ.birthCenterValue = params.currentPositionZ;\n\t\t\tlifeRatio = 0;\n\t\t}\n\t\tInfo tInfo;\n\t\t// position\n\t\ttInfo = targetParticle.infoPosition.infoX;\n\t\tparticlesA.particles[index].valuePosition.x = tInfo.birthCenterValue + tInfo.startValue +  (tInfo.endValue - tInfo.startValue) * calEasing(lifeRatio, tInfo.easeType);\n\t\ttInfo = targetParticle.infoPosition.infoY;\n\t\tparticlesA.particles[index].valuePosition.y = tInfo.birthCenterValue + tInfo.startValue +  (tInfo.endValue - tInfo.startValue) * calEasing(lifeRatio, tInfo.easeType);\n\t\ttInfo = targetParticle.infoPosition.infoZ;\n\t\tparticlesA.particles[index].valuePosition.z = tInfo.birthCenterValue + tInfo.startValue +  (tInfo.endValue - tInfo.startValue) * calEasing(lifeRatio, tInfo.easeType);\n\t\t\n\t\t// alpha\n\t\ttInfo = targetParticle.infoAlpha;\n\t\tparticlesA.particles[index].valueAlpha = tInfo.startValue +  (tInfo.endValue - tInfo.startValue) * calEasing(lifeRatio, tInfo.easeType);\n\t\t\n\t\t// scale\n\t\ttInfo = targetParticle.infoScale;\n\t\tparticlesA.particles[index].valueScale = tInfo.startValue + (tInfo.endValue - tInfo.startValue) * calEasing(lifeRatio, tInfo.easeType);\n\t\t\t\t\n\t\t// rotation\n\t\ttInfo = targetParticle.infoRotation.infoX;\n\t\tparticlesA.particles[index].valueRotation.x = (tInfo.startValue +  (tInfo.endValue - tInfo.startValue) * calEasing(lifeRatio, tInfo.easeType)) * PI/180;\n\t\ttInfo = targetParticle.infoRotation.infoY;\n\t\tparticlesA.particles[index].valueRotation.y = (tInfo.startValue +  (tInfo.endValue - tInfo.startValue) * calEasing(lifeRatio, tInfo.easeType)) * PI/180;\n\t\ttInfo = targetParticle.infoRotation.infoZ;\n\t\tparticlesA.particles[index].valueRotation.z = (tInfo.startValue +  (tInfo.endValue - tInfo.startValue) * calEasing(lifeRatio, tInfo.easeType)) * PI/180;\n\t}\n`)(this._particleNum),a={code:t.glslang.compileGLSL(i,"compute"),source:i},o=t.device.createShaderModule(a);const s=t.device.createBindGroupLayout({entries:[{binding:0,visibility:GPUShaderStage.COMPUTE,type:"uniform-buffer"},{binding:1,visibility:GPUShaderStage.COMPUTE,type:"storage-buffer"}]}),u=t.device.createPipelineLayout({bindGroupLayouts:[s]});this.particleBindGroup=t.device.createBindGroup({layout:s,entries:[{binding:0,resource:{buffer:this.simParamBuffer,offset:0,size:Oe(this,Hi).byteLength}},{binding:1,resource:{buffer:this.particleBuffer,offset:0,size:r.byteLength}}]}),this.computePipeline=t.device.createComputePipeline({layout:u,computeStage:{module:o,entryPoint:"main"}})}}var Zi=new WeakMap,Hi=new WeakMap;Ve(Wi,"Linear",0),Ve(Wi,"QuintIn",1),Ve(Wi,"QuintOut",2),Ve(Wi,"QuintInOut",3),Ve(Wi,"BackIn",4),Ve(Wi,"BackOut",5),Ve(Wi,"BackInOut",6),Ve(Wi,"CircIn",7),Ve(Wi,"CircOut",8),Ve(Wi,"CircInOut",9),Ve(Wi,"CubicIn",10),Ve(Wi,"CubicOut",11),Ve(Wi,"CubicInOut",12),Ve(Wi,"ExpoIn",13),Ve(Wi,"ExpoOut",14),Ve(Wi,"ExpoInOut",15),Ve(Wi,"QuadIn",16),Ve(Wi,"QuadOut",17),Ve(Wi,"QuadInOut",18),Ve(Wi,"QuartIn",19),Ve(Wi,"QuartOut",20),Ve(Wi,"QuartInOut",21),Ve(Wi,"SineIn",22),Ve(Wi,"SineOut",23),Ve(Wi,"SineInOut",24),Ve(Wi,"ElasticIn",25),Ve(Wi,"ElasticOut",26),Ve(Wi,"ElasticInOut",27);class qi extends kn{constructor(t){super(t)}}class ji extends ze{constructor(t,e){super(),Ji.set(this,{writable:!0,value:void 0}),Qi.set(this,{writable:!0,value:void 0}),Ve(this,"GPURenderPipeline",void 0),Ye(this,Ji,t),Ye(this,Qi,e),this.GPURenderPipeline=null}update(t,e){let r=Oe(this,Qi);const n=t.device,i={layout:n.createPipelineLayout({bindGroupLayouts:[e.systemUniformInfo_vertex.GPUBindGroupLayout,e.systemUniformInfo_fragment.GPUBindGroupLayout,r.GPUBindGroupLayout,r._material.GPUBindGroupLayout]}),vertexStage:{module:r._material.vShaderModule.GPUShaderModule,entryPoint:"main"},fragmentStage:{module:r._material.fShaderModule.GPUShaderModule,entryPoint:"main"},vertexState:r._geometry.vertexState,colorStates:[{format:t.swapChainFormat,colorBlend:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"},alphaBlend:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"}}],rasterizationState:{frontFace:"ccw",cullMode:r._cullMode},primitiveTopology:r._primitiveTopology,sampleCount:1};this.GPURenderPipeline=n.createRenderPipeline(i)}}var Ji=new WeakMap,Qi=new WeakMap;class Ki extends(Er.mix(hr)){constructor(t){super(t),ta.set(this,{writable:!0,value:[]}),Ve(this,"baseAttachment",void 0),Ve(this,"baseAttachmentView",void 0),this.quad=new qn(t,new Vi(t),this),this.quad.pipeline=new ji(t,this.quad),this.sampler=new en(t,{magFilter:"linear",minFilter:"linear",mipmapFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"repeat"})}checkSize(t,e){if([Oe(this,ta)[2],Oe(this,ta)[3]].toString()!=[e.viewRect[2],e.viewRect[3]].toString())return this.baseAttachment&&this.baseAttachment.destroy(),Ye(this,ta,e.viewRect.concat()),this.baseAttachment=t.device.createTexture({size:{width:e.viewRect[2],height:e.viewRect[3],depth:1},sampleCount:1,format:t.swapChainFormat,usage:GPUTextureUsage.OUTPUT_ATTACHMENT|GPUTextureUsage.COPY_SRC|GPUTextureUsage.SAMPLED}),this.baseAttachmentView=this.baseAttachment.createView(),!0}render(t,e,r,n){let i=this.checkSize(t,e);const a=t.device.createCommandEncoder(),o=a.beginRenderPass({colorAttachments:[{attachment:this.baseAttachmentView,loadValue:{r:0,g:0,b:0,a:0}}]});let s=this.sourceTexture===n;this.sourceTexture=n,s||this.resetBindingInfo(),i&&this.quad.pipeline.update(t,e),va.clearStateCache(),e.updateSystemUniform(o,t),r(t,e,o,[this.quad]),o.endPass(),t.device.defaultQueue.submit([a.finish()])}resetBindingInfo(){this.entries=[{binding:0,resource:{buffer:this.uniformBuffer_fragment.GPUBuffer,offset:0,size:this.uniformBufferDescriptor_fragment.size}},{binding:1,resource:this.sampler.GPUSampler},{binding:2,resource:this.sourceTexture},{binding:3,resource:{buffer:this.uniformBuffer_vertex.GPUBuffer,offset:0,size:this.uniformBufferDescriptor_vertex.size}}],this._afterResetBindingInfo()}}var ta=new WeakMap;Ve(Ki,"vertexShaderGLSL",""),Ve(Ki,"fragmentShaderGLSL",""),Ve(Ki,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(Ki,"uniformsBindGroupLayoutDescriptor_material",{entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,type:"uniform-buffer"},{binding:1,visibility:GPUShaderStage.FRAGMENT,type:"sampler"},{binding:2,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture"},{binding:3,visibility:GPUShaderStage.VERTEX,type:"uniform-buffer"}]}),Ve(Ki,"uniformBufferDescriptor_vertex",hr.uniformBufferDescriptor_empty),Ve(Ki,"uniformBufferDescriptor_fragment",hr.uniformBufferDescriptor_empty);class ea extends Ki{constructor(t){super(t),Ve(this,"viewRect",new Float32Array(4)),this.projectionMatrix=Ae.mat4.create()}checkSize(t,e){return Ae.mat4.ortho(this.projectionMatrix,0,1,0,1,-1e3,1e3),Ae.mat4.scale(this.projectionMatrix,this.projectionMatrix,[1/parseInt(t.canvas.style.width),1/parseInt(t.canvas.style.height),1]),Ae.mat4.translate(this.projectionMatrix,this.projectionMatrix,[e.getViewRect(t)[2]/2+e.getViewRect(t)[0],parseInt(t.canvas.style.height)-e.getViewRect(t)[3]/2-e.getViewRect(t)[1],0]),Ae.mat4.scale(this.projectionMatrix,this.projectionMatrix,[e.getViewRect(t)[2],e.getViewRect(t)[3],1]),this.uniformBuffer_vertex.GPUBuffer.setSubData(this.uniformBufferDescriptor_vertex.redStructOffsetMap.projectionMatrix,this.projectionMatrix),!0}render(t,e,r,n,i){let a=this.checkSize(t,e),o=this.sourceTexture===n;this.sourceTexture=n,o||this.resetBindingInfo(),a&&this.quad.pipeline.update(t,e),va.clearStateCache(),e.updateSystemUniform(i,t),r(t,e,i,[this.quad])}}Ve(ea,"vertexShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_vertex.systemUniforms}\n\t${tr.GLSL_SystemUniforms_vertex.meshUniforms}\n\tlayout( location = 0 ) in vec3 position;\n\tlayout( location = 1 ) in vec3 normal;\n\tlayout( location = 2 ) in vec2 uv;\n\tlayout( location = 0 ) out vec3 vNormal;\n\tlayout( location = 1 ) out vec2 vUV;\n\tlayout( set = ${tr.SET_INDEX_VertexUniforms}, binding = 3 ) uniform VertexUniforms {\n\t    mat4 projectionMatrix;\n        vec4 viewRect;\n    } vertexUniforms;\n\tvoid main() {\n\t\t// gl_Position = systemUniforms.perspectiveMTX * systemUniforms.cameraMTX * meshMatrixUniforms.modelMatrix[ int(meshUniforms.index) ] * vec4(position,1.0);\n\t\tgl_Position = vertexUniforms.projectionMatrix * vec4(position,1.0);\n\t\t\n\t\tvNormal = normal;\n\t\tvUV = uv;\n\t}\n\t`),Ve(ea,"fragmentShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\tlayout( location = 0 ) in vec3 vNormal;\n\tlayout( location = 1 ) in vec2 vUV;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 1 ) uniform sampler uSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 2 ) uniform texture2D uSourceTexture;\n\tlayout( location = 0 ) out vec4 outColor;\n\tvoid main() {\n\t\tvec4 diffuseColor = vec4(0.0);\n\t\n\t\tdiffuseColor = texture( sampler2D( uSourceTexture, uSampler ), vUV ) ;\n\t\t// diffuseColor.a = 0.5;\n\n\t\t// diffuseColor.rgb = 1.0 - diffuseColor.rgb;\n\t\toutColor = diffuseColor;\n\t}\n`),Ve(ea,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(ea,"uniformsBindGroupLayoutDescriptor_material",Ki.uniformsBindGroupLayoutDescriptor_material),Ve(ea,"uniformBufferDescriptor_vertex",[{size:$e.mat4,valueName:"projectionMatrix"},{size:$e.float4,valueName:"viewRect"}]),Ve(ea,"uniformBufferDescriptor_fragment",hr.uniformBufferDescriptor_empty);let ra,na,ia,aa,oa,sa,ua=[],la=[],fa=[],ma=[],ca={},ha=(t,e,r,n,i=0)=>{let a,o,s,u,l,f,m,c,h,d,p,v,_,g,x,y,S,T,U,b,M,P,w,E,G,D,L,B,R,C,I,N,F,A,V,O,Y,X,z,$,k,W,Z,H,q,j,J,Q,K,tt,et,rt,nt,it,at,ot,st,ut,lt,ft,mt,ct,ht,dt,pt,vt,_t,gt,xt,yt,St,Tt,Ut=Math.PI/180;k=3.141592653589793,W=6.283185307179586,Z=.225,H=1.27323954,q=.405284735,j=1.5707963267948966,a=n.length,J=ua[0],Q=ua[1],K=ua[2],tt=ua[3],et=ua[4],rt=ua[5];let bt=n==e.scene._flatChildList,Mt=e.camera instanceof qi;for(;a--;){if(ct=n[a],mt=ct._material,ft=ct._geometry,ut=ct._parent,ot=0,Tt=1,st=0,St=ct._opacity,ut&&(st=ut._renderTimeDirtyTransform,ot=ut.matrix,Tt=ut._sumOpacity),ct._sumOpacity!=St*Tt&&(ct.sumOpacity=St*Tt),ht=ct.dirtyTransform,ct._renderTimeDirtyTransform=st||ht,pt=ct.dirtyPipeline,dt=ct.pipeline,lt=ct.skinInfo,nt=ct.matrix,at=ct.localMatrix,vt=0,ra.object3DNum++,mt&&(mt.needResetBindingInfo&&(mt.resetBindingInfo(),mt.needResetBindingInfo=!1,vt=ct._prevMaterialUUID!=mt._UUID,sa[mt._UUID]=1),mt instanceof jr&&mt.update(na),vt=sa[mt._UUID]),ft){(pt||vt)&&(dt instanceof hn||dt instanceof zi)&&(dt.update(t,e),ra.dirtyPipelineNum++),_t=1;let n=!1;i==va.DRAW_LAYER_INDEX0&&ct._renderDrawLayerIndex==va.DRAW_LAYER_INDEX1?la.push(ct):ct._renderDrawLayerIndex==va.DRAW_LAYER_INDEX2_Z_POINT_SORT||mt instanceof jr?(_=e.camera.matrix[2],S=e.camera.matrix[6],M=e.camera.matrix[10],G=e.camera.matrix[14],L=nt[12],B=nt[13],R=nt[14],C=1,ma.push({z:L*_+B*S+R*M+C*G,targetText:ct})):n=!0,(n||i)&&(e._useFrustumCulling&&(gt=ft._volume||ft.volume,xt=gt.xSize*ct.matrix[0],yt=gt.ySize*ct.matrix[5],xt=xt<yt?yt:xt,yt=gt.zSize*ct.matrix[10],xt=xt<yt?yt:xt,p=nt[12],v=nt[13],_=nt[14],(J[0]*p+J[1]*v+J[2]*_+J[3]<=-xt||Q[0]*p+Q[1]*v+Q[2]*_+Q[3]<=-xt||K[0]*p+K[1]*v+K[2]*_+K[3]<=-xt||tt[0]*p+tt[1]*v+tt[2]*_+tt[3]<=-xt||et[0]*p+et[1]*v+et[2]*_+et[3]<=-xt||rt[0]*p+rt[1]*v+rt[2]*_+rt[3]<=-xt)&&(_t=0)),ct instanceof Wi?(ct.compute(na),r.setPipeline(dt.GPURenderPipeline),ia!=ft.interleaveBuffer._UUID&&(r.setVertexBuffer(0,ft.interleaveBuffer.GPUBuffer),ia=ft.interleaveBuffer._UUID),r.setVertexBuffer(1,ct.particleBuffer),r.setBindGroup(2,ct.GPUBindGroup),oa!=mt._UUID&&(r.setBindGroup(3,mt.uniformBindGroup_material.GPUBindGroup),oa=mt._UUID),ft.indexBuffer?(aa!=ft.indexBuffer._UUID&&(r.setIndexBuffer(ft.indexBuffer.GPUBuffer),aa=ft.indexBuffer._UUID),r.drawIndexed(ft.indexBuffer.indexNum,ct._particleNum,0,0,0),ra.triangleNum+=ft.indexBuffer.indexNum/3):(r.draw(ft.interleaveBuffer.vertexCount,ct._particleNum,0,0,0),ra.triangleNum+=ft.interleaveBuffer.data.length/ft.interleaveBuffer.stride),ra.drawCallNum++):_t&&(r.setPipeline(dt.GPURenderPipeline),ia!=ft.interleaveBuffer._UUID&&(r.setVertexBuffer(0,ft.interleaveBuffer.GPUBuffer),ia=ft.interleaveBuffer._UUID),r.setBindGroup(2,ct.GPUBindGroup),oa!=mt._UUID&&(r.setBindGroup(3,mt.uniformBindGroup_material.GPUBindGroup),oa=mt._UUID),ft.indexBuffer?(aa!=ft.indexBuffer._UUID&&(r.setIndexBuffer(ft.indexBuffer.GPUBuffer),aa=ft.indexBuffer._UUID),r.drawIndexed(ft.indexBuffer.indexNum,1,0,0,0),ra.triangleNum+=ft.indexBuffer.indexNum/3):(r.draw(ft.interleaveBuffer.vertexCount,1,0,0,0),ra.triangleNum+=ft.interleaveBuffer.data.length/ft.interleaveBuffer.stride),ra.drawCallNum++),ct._prevMaterialUUID=mt._UUID)}if(ht&&(p=1,v=0,_=0,x=0,y=1,S=0,U=0,b=0,M=1,at[12]=ct._x,at[13]=ct._y*(Mt?-1:1),at[14]=ct._z,at[15]=1,c=ct._rotationX*Ut,h=ct._rotationY*Ut,d=ct._rotationZ*Ut,$=c%W,$<-k?$+=W:$>k&&($-=W),$=$<0?H*$+q*$*$:H*$-q*$*$,o=$<0?Z*($*-$-$)+$:Z*($*$-$)+$,$=(c+j)%W,$<-k?$+=W:$>k&&($-=W),$=$<0?H*$+q*$*$:H*$-q*$*$,l=$<0?Z*($*-$-$)+$:Z*($*$-$)+$,$=h%W,$<-k?$+=W:$>k&&($-=W),$=$<0?H*$+q*$*$:H*$-q*$*$,s=$<0?Z*($*-$-$)+$:Z*($*$-$)+$,$=(h+j)%W,$<-k?$+=W:$>k&&($-=W),$=$<0?H*$+q*$*$:H*$-q*$*$,f=$<0?Z*($*-$-$)+$:Z*($*$-$)+$,$=d%W,$<-k?$+=W:$>k&&($-=W),$=$<0?H*$+q*$*$:H*$-q*$*$,u=$<0?Z*($*-$-$)+$:Z*($*$-$)+$,$=(d+j)%W,$<-k?$+=W:$>k&&($-=W),$=$<0?H*$+q*$*$:H*$-q*$*$,m=$<0?Z*($*-$-$)+$:Z*($*$-$)+$,I=f*m,N=o*s*m-l*u,F=l*s*m+o*u,A=f*u,V=o*s*u+l*m,O=l*s*u-o*m,Y=-s,X=o*f,z=l*f,c=ct._scaleX,h=ct._scaleY,d=ct._scaleZ,at[0]=(p*I+x*N+U*F)*c,at[1]=(v*I+y*N+b*F)*c,at[2]=(_*I+S*N+M*F)*c,at[3]=at[3]*c,at[4]=(p*A+x*V+U*O)*h,at[5]=(v*A+y*V+b*O)*h,at[6]=(_*A+S*V+M*O)*h,at[7]=at[7]*h,at[8]=(p*Y+x*X+U*z)*d,at[9]=(v*Y+y*X+b*z)*d,at[10]=(_*Y+S*X+M*z)*d,at[11]=at[11]*d,(ct._pivotX||ct._pivotY||ct._pivotZ)&&(p=at[0],v=at[1],_=at[2],g=at[3],x=at[4],y=at[5],S=at[6],T=at[7],U=at[8],b=at[9],M=at[10],P=at[11],w=at[12],E=at[13],G=at[14],D=at[15],L=1,B=0,R=0,C=0,at[0]=L*p+B*x+R*U+C*w,at[1]=L*v+B*y+R*b+C*E,at[2]=L*_+B*S+R*M+C*G,at[3]=L*g+B*T+R*P+C*D,L=0,B=1,R=0,C=0,at[4]=L*p+B*x+R*U+C*w,at[5]=L*v+B*y+R*b+C*E,at[6]=L*_+B*S+R*M+C*G,at[7]=L*g+B*T+R*P+C*D,L=0,B=0,R=1,C=0,at[8]=L*p+B*x+R*U+C*w,at[9]=L*v+B*y+R*b+C*E,at[10]=L*_+B*S+R*M+C*G,at[11]=L*g+B*T+R*P+C*D,Mt?ot?(L=-ct._pivotX,B=ct._pivotY,R=-ct._pivotZ,C=1):(L=-ct._pivotX/c,B=ct._pivotY/h,R=-ct._pivotZ,C=1):(L=-ct._pivotX,B=-ct._pivotY,R=-ct._pivotZ,C=1),at[12]=L*p+B*x+R*U+C*w,at[13]=L*v+B*y+R*b+C*E,at[14]=L*_+B*S+R*M+C*G,at[15]=L*g+B*T+R*P+C*D)),(st||ht)&&(ra.dirtyTransformNum++,ot?(p=ot[0],v=ot[1],_=ot[2],g=ot[3],x=ot[4],y=ot[5],S=ot[6],T=ot[7],U=ot[8],b=ot[9],M=ot[10],P=ot[11],w=ot[12],E=ot[13],G=ot[14],D=ot[15],L=at[0],B=at[1],R=at[2],C=at[3],nt[0]=L*p+B*x+R*U+C*w,nt[1]=L*v+B*y+R*b+C*E,nt[2]=L*_+B*S+R*M+C*G,nt[3]=L*g+B*T+R*P+C*D,L=at[4],B=at[5],R=at[6],C=at[7],nt[4]=L*p+B*x+R*U+C*w,nt[5]=L*v+B*y+R*b+C*E,nt[6]=L*_+B*S+R*M+C*G,nt[7]=L*g+B*T+R*P+C*D,L=at[8],B=at[9],R=at[10],C=at[11],nt[8]=L*p+B*x+R*U+C*w,nt[9]=L*v+B*y+R*b+C*E,nt[10]=L*_+B*S+R*M+C*G,nt[11]=L*g+B*T+R*P+C*D,L=at[12],B=at[13],R=at[14],C=at[15],nt[12]=L*p+B*x+R*U+C*w,nt[13]=L*v+B*y+R*b+C*E,nt[14]=L*_+B*S+R*M+C*G,nt[15]=L*g+B*T+R*P+C*D):(nt[0]=at[0],nt[1]=at[1],nt[2]=at[2],nt[3]=at[3],nt[4]=at[4],nt[5]=at[5],nt[6]=at[6],nt[7]=at[7],nt[8]=at[8],nt[9]=at[9],nt[10]=at[10],nt[11]=at[11],nt[12]=at[12],nt[13]=at[13],nt[14]=at[14],nt[15]=at[15]),it=ct.normalMatrix,p=nt[0],v=nt[1],_=nt[2],g=nt[3],x=nt[4],y=nt[5],S=nt[6],T=nt[7],U=nt[8],b=nt[9],M=nt[10],P=nt[11],E=nt[12],G=nt[13],D=nt[14],L=nt[15],w=p*y-v*x,B=p*S-_*x,R=p*T-g*x,C=v*S-_*y,I=v*T-g*y,N=_*T-g*S,F=U*G-b*E,A=U*D-M*E,V=U*L-P*E,O=b*D-M*G,Y=b*L-P*G,O=M*L-P*D,z=w*O-B*Y+R*O+C*V-I*A+N*F,z=1/z,it[0]=(y*O-S*Y+T*O)*z,it[4]=(-v*O+_*Y-g*O)*z,it[8]=(G*N-D*I+L*C)*z,it[12]=(-b*N+M*I-P*C)*z,it[1]=(-x*O+S*V-T*A)*z,it[5]=(p*O-_*V+g*A)*z,it[9]=(-E*N+D*R-L*B)*z,it[13]=(U*N-M*R+P*B)*z,it[2]=(x*Y-y*V+T*F)*z,it[6]=(-p*Y+v*V-g*F)*z,it[10]=(E*I-G*R+L*w)*z,it[14]=(-U*I+b*R-P*w)*z,it[3]=(-x*O+y*A-S*F)*z,it[7]=(p*O-v*A+_*F)*z,it[11]=(-E*C+G*B-D*w)*z,it[15]=(U*C-b*B+M*w)*z,!fa.includes(ct.uniformBuffer_meshMatrix)&&fa.push(ct.uniformBuffer_meshMatrix),ct.uniformBuffer_meshMatrix.meshFloat32Array.set(ct.matrix,ct.offsetMatrix/Float32Array.BYTES_PER_ELEMENT),ct.uniformBuffer_meshMatrix.meshFloat32Array.set(ct.normalMatrix,ct.offsetNormalMatrix/Float32Array.BYTES_PER_ELEMENT)),lt){let t,e=lt.joints,r=0,n=e.length,i=new Float32Array(16*n),a=new Float32Array([nt[0],nt[1],nt[2],nt[3],nt[4],nt[5],nt[6],nt[7],nt[8],nt[9],nt[10],nt[11],nt[12],nt[13],nt[14],nt[15]]),o=a,s=a,u=s[0],l=s[1],f=s[2],m=s[3],c=s[4],h=s[5],d=s[6],p=s[7],v=s[8],_=s[9],g=s[10],x=s[11],y=s[12],S=s[13],T=s[14],U=s[15],b=_*T*p-S*g*p+S*d*x-h*T*x-_*d*U+h*g*U,M=y*g*p-v*T*p-y*d*x+c*T*x+v*d*U-c*g*U,P=v*S*p-y*_*p+y*h*x-c*S*x-v*h*U+c*_*U,w=y*_*d-v*S*d-y*h*g+c*S*g+v*h*T-c*_*T,E=u*b+l*M+f*P+m*w;if(0===E)return mat4.identity(a);{const t=1/E;o[0]=b*t,o[1]=(S*g*m-_*T*m-S*f*x+l*T*x+_*f*U-l*g*U)*t,o[2]=(h*T*m-S*d*m+S*f*p-l*T*p-h*f*U+l*d*U)*t,o[3]=(_*d*m-h*g*m-_*f*p+l*g*p+h*f*x-l*d*x)*t,o[4]=M*t,o[5]=(v*T*m-y*g*m+y*f*x-u*T*x-v*f*U+u*g*U)*t,o[6]=(y*d*m-c*T*m-y*f*p+u*T*p+c*f*U-u*d*U)*t,o[7]=(c*g*m-v*d*m+v*f*p-u*g*p-c*f*x+u*d*x)*t,o[8]=P*t,o[9]=(y*_*m-v*S*m-y*l*x+u*S*x+v*l*U-u*_*U)*t,o[10]=(c*S*m-y*h*m+y*l*p-u*S*p-c*l*U+u*h*U)*t,o[11]=(v*h*m-c*_*m-v*l*p+u*_*p+c*l*x-u*h*x)*t,o[12]=w*t,o[13]=(v*S*f-y*_*f+y*l*g-u*S*g-v*l*T+u*_*T)*t,o[14]=(y*h*f-c*S*f-y*l*d+u*S*d+c*l*T-u*h*T)*t,o[15]=(c*_*f-v*h*f+v*l*d-u*_*d-c*l*g+u*h*g)*t}for(;r<n;r++)t=e[r].matrix,i[16*r+0]=t[0],i[16*r+1]=t[1],i[16*r+2]=t[2],i[16*r+3]=t[3],i[16*r+4]=t[4],i[16*r+5]=t[5],i[16*r+6]=t[6],i[16*r+7]=t[7],i[16*r+8]=t[8],i[16*r+9]=t[9],i[16*r+10]=t[10],i[16*r+11]=t[11],i[16*r+12]=t[12],i[16*r+13]=t[13],i[16*r+14]=t[14],i[16*r+15]=t[15];mt.uniformBuffer_vertex.float32Array.set(a,mt.uniformBufferDescriptor_vertex.redStructOffsetMap.globalTransformOfNodeThatTheMeshIsAttachedTo/Float32Array.BYTES_PER_ELEMENT),mt.uniformBuffer_vertex.float32Array.set(i,mt.uniformBufferDescriptor_vertex.redStructOffsetMap.jointMatrix/Float32Array.BYTES_PER_ELEMENT),lt.inverseBindMatrices._UUID||(lt.inverseBindMatrices._UUID=JSON.stringify(lt.inverseBindMatrices));let G=mt.uniformBuffer_vertex._UUID;ca[G]!=lt.inverseBindMatrices._UUID&&(mt.uniformBuffer_vertex.float32Array.set(lt.inverseBindMatrices,mt.uniformBufferDescriptor_vertex.redStructOffsetMap.inverseBindMatrixForJoint/Float32Array.BYTES_PER_ELEMENT),ca[G]=lt.inverseBindMatrices._UUID),mt.uniformBuffer_vertex.GPUBuffer.setSubData(0,mt.uniformBuffer_vertex.float32Array)}bt||ha(t,e,r,ct.children),ct.dirtyPipeline=!1,ct.dirtyTransform=!1}},da=(t=>{let e,r=[];return(t,n,i)=>{e=n.scene,e.skyBox&&(.6*n.camera.farClipping!=e.skyBox._prevScale&&(e.skyBox.scaleX=e.skyBox.scaleY=e.skyBox.scaleZ=e.skyBox._prevScale=.6*n.camera.farClipping),r.push(e.skyBox)),e.grid&&r.push(e.grid),e.axis&&r.push(e.axis),r.length&&ha(t,n,i,r),r.length=0}})(),pa=(t,e,r,n)=>{let i,a,o=performance.now();i=e.scene,a=i.backgroundColorRGBA,e.camera.update&&e.camera.update(),ua=e.computeViewFrustumPlanes(e);let s={colorAttachments:[{attachment:e.baseAttachmentView,resolveTarget:e.baseAttachment_ResolveTargetView,loadValue:{r:a[0],g:a[1],b:a[2],a:a[3]}},{attachment:e.baseAttachment_mouseColorID_depthView,resolveTarget:e.baseAttachment_mouseColorID_depth_ResolveTargetView,loadValue:{r:0,g:0,b:0,a:0}}],depthStencilAttachment:{attachment:e.baseDepthStencilAttachmentView,depthLoadValue:1,depthStoreOp:"store",stencilLoadValue:0,stencilStoreOp:"store"}},u=t.device.createCommandEncoder(),l=u.beginRenderPass(s);e.updateSystemUniform(l,t);let f=e.viewRect;l.setViewport(0,0,f[2],f[3],0,1),l.setScissorRect(0,0,f[2],f[3]),da(t,e,l),ha(t,e,l,i._flatChildList),((t,e,r)=>{la.length&&ha(t,e,r,la,va.DRAW_LAYER_INDEX1),la.length=0})(t,e,l),((t,e,r)=>{if(ma.length){let n=[],i=ma.length;for(ma.sort((t,e)=>t.z>e.z?-1:t.z<e.z?1:0);i--;)n[i]=ma[i].targetText;ha(t,e,r,n,va.DRAW_LAYER_INDEX2_Z_POINT_SORT)}ma.length=0})(t,e,l),((t,e,r)=>{if(e.debugLightList.length){let n=e.useFrustumCulling;e.useFrustumCulling=!1,ha(t,e,r,e.debugLightList),e.useFrustumCulling=n}})(t,e,l),l.endPass(),ra.baseRenderTime=performance.now()-o,o=performance.now();let m=e.postEffect.effectList.length?((t,e)=>{let r=e.baseAttachment_ResolveTargetView,n=e.baseAttachment_ResolveTarget,i=0,a=e.postEffect.effectList.length;for(;i<a;i++){let a=e.postEffect.effectList[i];a.render(t,e,ha,r),r=a.baseAttachmentView,n=a.baseAttachment}return n})(t,e):e.baseAttachment_ResolveTarget;return e._lastTextureView=m.createView(),ra.postEffectRenderTime=performance.now()-o,o=performance.now(),u.finish()};class va{constructor(){}render(t,e){na=t;let r,n=Ai.resetData(e.viewList),i=0,a=e.viewList.length;sa={};let o=[],s=e.swapChain.getCurrentTexture(),u=s.createView(),l=[];const f=e.device.createCommandEncoder(),m=f.beginRenderPass({colorAttachments:[{attachment:u,loadValue:{r:0,g:0,b:0,a:0}}]});for(;i<a;i++)r=e.viewList[i],ra=n[i],va.clearStateCache(),cn.needFlatListUpdate&&(r.scene._flatChildList=qe.getFlatChildList(r.scene._children)),l.push(pa(e,r)),o.push(r.mouseEventChecker.check(e)),r._finalRender||(r._finalRender=new ea(e)),r._finalRender.baseAttachment=s,r._finalRender.baseAttachmentView=u,r._finalRender.render(e,r,ha,r._lastTextureView,m);for(m.endPass(),l.push(f.finish()),e.device.defaultQueue.submit(l),o.includes("pointer")?e.canvas.style.cursor="pointer":e.canvas.style.cursor="default",i=fa.length;i--;)fa[i].GPUBuffer.setSubData(0,fa[i].meshFloat32Array);cn.needFlatListUpdate=!1,fa.length=0,Ri.animationLooper(t),Ai.update()}}Ve(va,"clearStateCache",t=>{ia=null,aa=null,oa=null}),Ve(va,"DRAW_LAYER_INDEX0",0),Ve(va,"DRAW_LAYER_INDEX1",1),Ve(va,"DRAW_LAYER_INDEX2_Z_POINT_SORT",2);class _a extends ze{get color(){return Oe(this,ga)}set color(t){Ye(this,ga,t);let e=qe.hexToRGB_ZeroToOne(t);this._colorRGBA[0]=e[0],this._colorRGBA[1]=e[1],this._colorRGBA[2]=e[2],this._colorRGBA[3]=1,this._debugMaterial.color=t}get colorRGBA(){return this._colorRGBA}get x(){return this._x}set x(t){this._x=this._debugMesh.x=t,this._debugMesh.targetTo(0,0,0)}get y(){return this._y}set y(t){this._y=this._debugMesh.y=t,this._debugMesh.targetTo(0,0,0)}get z(){return this._z}set z(t){this._z=this._debugMesh.z=t,this._debugMesh.targetTo(0,0,0)}get intensity(){return this._intensity}set intensity(t){this._intensity=t}constructor(t){super(),Ve(this,"_intensity",1),Ve(this,"_x",0),Ve(this,"_y",0),Ve(this,"_z",0),ga.set(this,{writable:!0,value:"#ff0000"}),Ve(this,"_colorRGBA",new Float32Array([1,0,0,1])),Ve(this,"_debugMesh",void 0),Ve(this,"_debugMaterial",void 0),Ve(this,"useDebugMesh",!1),this._debugMesh=new qn(t),this._debugMaterial=new Br(t),this._debugMaterial.colorAlpha=.5}}var ga=new WeakMap;var xa=new WeakMap,ya=new WeakMap,Sa=new WeakMap,Ta=new WeakMap,Ua=new WeakMap,ba=new WeakMap,Ma=new WeakMap,Pa=new WeakMap,wa=new WeakMap,Ea=new WeakMap,Ga=new WeakMap,Da=new WeakMap,La=new WeakMap,Ba=new WeakMap,Ra=new WeakMap;class Ca extends _a{constructor(t,e="#111",r=.1){super(t),this.color=e,this.intensity=r}}class Ia extends Ti{constructor(t,e=1,r=8,n=8,i=0,a=2*Math.PI,o=0,s=Math.PI,u=1){let l;if(super(),Na.set(this,{writable:!0,value:function(){let t,e,r,n,i,a,o,s,u=[],l=new Float32Array([0,0,0]),f=new Float32Array([0,0,0]);return function(m,c,h,d,p,v,_,g,x,y){t=g+x,n=0,u.length=0,l[0]=0,l[1]=0,l[2]=0,f[0]=0,f[1]=0,f[2]=0;let S=[],T=[];for(r=0;r<=p;r++){let t=[],i=r/p;for(e=0;e<=d;e++){let r=e/d;l.x=-h*Math.cos(v+r*_)*Math.sin(g+i*x),l.y=h*Math.cos(g+i*x),l.z=h*Math.sin(v+r*_)*Math.sin(g+i*x),S.push(l.x,l.y,l.z),f[0]=l.x,f[1]=l.y,f[2]=l.z,Ae.vec3.normalize(f,f),S.push(f[0],f[1],f[2]),S.push(r*y,i*y),t.push(n++)}u.push(t)}for(r=0;r<p;r++)for(e=0;e<d;e++)i=u[r][e+1],a=u[r][e],o=u[r+1][e],s=u[r+1][e+1],(0!==r||g>0)&&T.push(i,a,s),(r!==p-1||t<Math.PI)&&T.push(a,o,s);return new Ui(m,new bi(m,c+"_interleaveBuffer",bi.TYPE_VERTEX,new Float32Array(S),[new Si("vertexPosition","float3"),new Si("vertexNormal","float3"),new Si("texcoord","float2")]),new bi(m,c+"_indexBuffer",bi.TYPE_INDEX,new Uint32Array(T)))}}()}),r=Math.max(3,Math.floor(r)),n=Math.max(2,Math.floor(n)),l=[this.constructor.name,e,r,n,i,a,o,s,u].join("_"),t.state.Geometry.has(l))return t.state.Geometry.get(l);let f=Oe(this,Na).call(this,t,l,e,r,n,i,a,o,s,u);this.interleaveBuffer=f.interleaveBuffer,this.indexBuffer=f.indexBuffer,this.vertexState=f.vertexState,t.state.Geometry.set(l,this)}}var Na=new WeakMap;class Fa extends Ti{constructor(t,e=1,r=1,n=1,i=8,a=1,o=!1,s=0,u=2*Math.PI,l=1){let f;if(super(),Aa.set(this,{writable:!0,value:function(){let t,e;return function(r,n,i,a,o,s,u,l,f,m,c){let h=[],d=[],p=0,v=[],_=o/2;return t=function(){let t,e,r=[],n=[],l=(a-i)/o;for(e=0;e<=u;e++){let d=[],g=e/u,x=g*(a-i)+i;for(t=0;t<=s;t++){let e=t/s,i=e*m+f,a=Math.sin(i),u=Math.cos(i);n[0]=x*a,n[1]=-g*o+_,n[2]=x*u,h.push(n[0],n[1],n[2]),r[0]=a,r[1]=l,r[2]=u,Ae.vec3.normalize(r,r),h.push(r[0],r[1],r[2]),h.push(e*c,g*c),d.push(p++)}v.push(d)}for(t=0;t<s;t++)for(e=0;e<u;e++){let r=v[e][t],n=v[e+1][t],i=v[e+1][t+1],a=v[e][t+1];d.push(r,n,a),d.push(n,i,a)}},e=function(t){let e,r,n,o=[],u=[],l=!0===t?i:a,v=!0===t?1:-1;for(r=p,e=1;e<=s;e++)h.push(0,_*v,0),h.push(0,v,0),h.push(.5*c,.5*c),p++;for(n=p,e=0;e<=s;e++){let t=e/s*m+f,r=Math.cos(t),n=Math.sin(t);u[0]=l*n,u[1]=_*v,u[2]=l*r,h.push(u[0],u[1],u[2]),h.push(0,v,0),o[0]=.5*r+.5,o[1]=.5*n*v+.5,h.push(o[0]*c,c-o[1]*c),p++}for(e=0;e<s;e++){let i=r+e,a=n+e;!0===t?d.push(a,a+1,i):d.push(a+1,a,i)}},t(),!1===l&&(i>0&&e(!0),a>0&&e(!1)),new Ui(r,new bi(r,n+"_interleaveBuffer",bi.TYPE_VERTEX,new Float32Array(h),[new Si("vertexPosition","float3"),new Si("vertexNormal","float3"),new Si("texcoord","float2")]),new bi(r,n+"_indexBuffer",bi.TYPE_INDEX,new Uint32Array(d)))}}()}),f=[this.constructor.name,t,e,r,n,i,a,o,s,u,l].join("_"),t.state.Geometry.has(f))return t.state.Geometry.get(f);let m=Oe(this,Aa).call(this,t,f,e,r,n,i,a,o,s,u,l);this.interleaveBuffer=m.interleaveBuffer,this.indexBuffer=m.indexBuffer,this.vertexState=m.vertexState,t.state.Geometry.set(f,this)}}var Aa=new WeakMap;class Va extends _a{constructor(t,e="#ffffff",r=1){super(t),Oa.set(this,{writable:!0,value:t=>{let e=new qn(t,new Ia(t,1,16,16,16),this._debugMaterial);e.primitiveTopology="line-strip",this._debugMesh.addChild(e),[-.7,0,.7].forEach((e,r)=>{let n,i;n=new qn(t,new Fa(t,.01,.01,1==r?1e5:2),this._debugMaterial),n.rotationX=90,n.x=e,n.z=-1,i=new qn(t,new Fa(t,0,.25,.5),this._debugMaterial),i.y=1,n.addChild(i),this._debugMesh.addChild(n)})}}),Oe(this,Oa).call(this,t),this.color=e,this.intensity=r}}var Oa=new WeakMap;class Ya extends _a{get radius(){return this._radius}set radius(t){this._radius=t,this._debugMesh.setScale(t,t,t)}constructor(t,e="#ffffff",r=1,n=1){super(t),Ve(this,"_radius",1),Xa.set(this,{writable:!0,value:t=>{let e=new qn(t,new Ia(t,1,32,32,32),this._debugMaterial);e.primitiveTopology="line-strip",this._debugMesh.addChild(e)}}),this.color=e,this.intensity=r,this.radius=n,Oe(this,Xa).call(this,t)}}var Xa=new WeakMap;class za extends _a{constructor(t,e="#ffffff",r=1,n=.1,i=80){super(t),$a.set(this,{writable:!0,value:t=>{let e=new qn(t,new Fa(t,0,1,2),this._debugMaterial);e.rotationX=-90,e.primitiveTopology="line-strip",this._debugMesh.addChild(e)}}),this.color=e,this.intensity=r,this.cutoff=n,this.exponent=i,Oe(this,$a).call(this,t)}}var $a=new WeakMap;let ka=new Float32Array(1);class Wa extends(Er.mix(hr,Er.diffuseTexture,Er.normalTexture,Er.specularTexture,Er.emissiveTexture,Er.refractionTexture,Er.displacementTexture,Er.basicLightPropertys,Er.alpha)){constructor(t,e,r,n,i,a,o){super(t),Za.set(this,{writable:!0,value:void 0}),this.diffuseTexture=e,this.refractionTexture=r,this.normalTexture=n,this.emissiveTexture=a,this.specularTexture=i,this.displacementTexture=o,this.needResetBindingInfo=!0}checkTexture(t,e){if(t)if(t._GPUTexture){let r;switch(e){case"diffuseTexture":this._diffuseTexture=t,r=e;break;case"normalTexture":this._normalTexture=t,r=e;break;case"specularTexture":this._specularTexture=t,r=e;break;case"emissiveTexture":this._emissiveTexture=t,r=e;break;case"refractionTexture":this._refractionTexture=t,r=e;break;case"displacementTexture":this._displacementTexture=t,r=e}r&&(ka[0]=this[`__${e}RenderYn`]=1,"displacementTexture"==r?this.uniformBuffer_vertex.GPUBuffer.setSubData(this.uniformBufferDescriptor_vertex.redStructOffsetMap[`__${e}RenderYn`],ka):this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap[`__${e}RenderYn`],ka)),this.needResetBindingInfo=!0}else t.addUpdateTarget(this,e);else this["_"+e]&&(this["_"+e]=null,ka[0]=this[`__${e}RenderYn`]=0,"displacementTexture"==e?this.uniformBuffer_vertex.GPUBuffer.setSubData(this.uniformBufferDescriptor_vertex.redStructOffsetMap[`__${e}RenderYn`],ka):this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap[`__${e}RenderYn`],ka),this.needResetBindingInfo=!0)}resetBindingInfo(){this.entries=[{binding:0,resource:{buffer:this.uniformBuffer_vertex.GPUBuffer,offset:0,size:this.uniformBufferDescriptor_vertex.size}},{binding:1,resource:this._displacementTexture?this._displacementTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:2,resource:this._displacementTexture?this._displacementTexture._GPUTextureView:this.redGPUContext.state.emptyTextureView},{binding:3,resource:{buffer:this.uniformBuffer_fragment.GPUBuffer,offset:0,size:this.uniformBufferDescriptor_fragment.size}},{binding:4,resource:this._diffuseTexture?this._diffuseTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:5,resource:this._diffuseTexture?this._diffuseTexture._GPUTextureView:this.redGPUContext.state.emptyTextureView},{binding:6,resource:this._normalTexture?this._normalTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:7,resource:this._normalTexture?this._normalTexture._GPUTextureView:this.redGPUContext.state.emptyTextureView},{binding:8,resource:this._specularTexture?this._specularTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:9,resource:this._specularTexture?this._specularTexture._GPUTextureView:this.redGPUContext.state.emptyTextureView},{binding:10,resource:this._emissiveTexture?this._emissiveTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:11,resource:this._emissiveTexture?this._emissiveTexture._GPUTextureView:this.redGPUContext.state.emptyTextureView},{binding:12,resource:this._refractionTexture?this._refractionTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:13,resource:this._refractionTexture?this._refractionTexture._GPUTextureView:this.redGPUContext.state.emptyCubeTextureView}],this._afterResetBindingInfo()}}var Za=new WeakMap;Ve(Wa,"vertexShaderGLSL",`\n\t${tr.GLSL_VERSION}\n    ${tr.GLSL_SystemUniforms_vertex.systemUniforms}\n    ${tr.GLSL_SystemUniforms_vertex.calcDisplacement}    \n    ${tr.GLSL_SystemUniforms_vertex.meshUniforms}\n         \n\tlayout( location = 0 ) in vec3 position;\n\tlayout( location = 1 ) in vec3 normal;\n\tlayout( location = 2 ) in vec2 uv;\n\tlayout( location = 0 ) out vec3 vNormal;\n\tlayout( location = 1 ) out vec2 vUV;\n\tlayout( location = 2 ) out vec4 vVertexPosition;\t\n\tlayout( location = 3 ) out float vMouseColorID;\t\n\tlayout( location = 4 ) out float vSumOpacity;\n\tlayout( set = ${tr.SET_INDEX_VertexUniforms}, binding = 0 ) uniform VertexUniforms {\n        float displacementFlowSpeedX;\n        float displacementFlowSpeedY;\n        float displacementPower;\n        float __displacementTextureRenderYn;\n    } vertexUniforms;\n\t\n\tlayout( set = ${tr.SET_INDEX_VertexUniforms}, binding = 1 ) uniform sampler uDisplacementSampler;\n\tlayout( set = ${tr.SET_INDEX_VertexUniforms}, binding = 2 ) uniform texture2D uDisplacementTexture;\n\tvoid main() {\t\t\n\t\tvVertexPosition = meshMatrixUniforms.modelMatrix[ int(meshUniforms.index) ] * vec4(position, 1.0);\n\t\tvNormal = (meshMatrixUniforms.normalMatrix[ int(meshUniforms.index) ] * vec4(normal,1.0)).xyz;\n\t\tvUV = uv;\n\t\tvMouseColorID = meshUniforms.mouseColorID;\n\t\tvSumOpacity = meshUniforms.sumOpacity;\n\t\tif(vertexUniforms.__displacementTextureRenderYn == TRUTHY) vVertexPosition.xyz += calcDisplacement(vNormal, vertexUniforms.displacementFlowSpeedX, vertexUniforms.displacementFlowSpeedY, vertexUniforms.displacementPower, uv, uDisplacementTexture, uDisplacementSampler);\n\t\tgl_Position = systemUniforms.perspectiveMTX * systemUniforms.cameraMTX * vVertexPosition;\t\t\n\t}\n\t`),Ve(Wa,"fragmentShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_fragment.systemUniforms}\n\t${tr.GLSL_SystemUniforms_fragment.cotangent_frame}\n\t${tr.GLSL_SystemUniforms_fragment.perturb_normal}\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 3 ) uniform FragmentUniforms {\n        float normalPower;\n        float shininess; \n        float specularPower;\n\t    vec4 specularColor;\n\t    float emissivePower;\n\t    float refractionPower;\n\t    float refractionRatio;\n\t    float alpha;\n\t    float useFlatMode;\n\t    //\n\t    float __diffuseTextureRenderYn;\n\t\tfloat __refractionTextureRenderYn;\n\t\tfloat __normalTextureRenderYn;\n\t\tfloat __specularTextureRenderYn;\n\t\tfloat __emissiveTextureRenderYn;\n    } fragmentUniforms;\n\n\tlayout( location = 0 ) in vec3 vNormal;\n\tlayout( location = 1 ) in vec2 vUV;\n\tlayout( location = 2 ) in vec4 vVertexPosition;\n\tlayout( location = 3 ) in float vMouseColorID;\n\tlayout( location = 4 ) in float vSumOpacity;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 4 ) uniform sampler uDiffuseSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 5 ) uniform texture2D uDiffuseTexture;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 6 ) uniform sampler uNormalSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 7 ) uniform texture2D uNormalTexture;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 8 ) uniform sampler uSpecularSampler;\t\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 9 ) uniform texture2D uSpecularTexture;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 10 ) uniform sampler uEmissiveSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 11 ) uniform texture2D uEmissiveTexture;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 12 ) uniform sampler uRefractionSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 13 ) uniform textureCube uRefractionTexture;\n\tlayout( location = 0 ) out vec4 outColor;\n\t\n\tlayout( location = 1 ) out vec4 out_MouseColorID_Depth;\n\tvoid main() {\n\t\tfloat testAlpha = 0.0;\n\t\tvec4 diffuseColor = vec4(0.0);\n\t\tif(fragmentUniforms.__diffuseTextureRenderYn == TRUTHY) diffuseColor = texture(sampler2D(uDiffuseTexture, uDiffuseSampler), vUV) ;\n\t\t\t\n\t    vec3 N = normalize(vNormal);\n\t\tvec4 normalColor = vec4(0.0);\n\t\tif(fragmentUniforms.__normalTextureRenderYn == TRUTHY) normalColor = texture(sampler2D(uNormalTexture, uNormalSampler), vUV) ;\n\t\tif(fragmentUniforms.useFlatMode == TRUTHY) N = getFlatNormal(vVertexPosition.xyz);\n\t\tif(fragmentUniforms.__normalTextureRenderYn == TRUTHY) N = perturb_normal(N, vVertexPosition.xyz, vUV, normalColor.rgb, fragmentUniforms.normalPower) ;\n\t\n\t\tif(fragmentUniforms.__refractionTextureRenderYn == TRUTHY) {\n\t\t\tvec3 I = normalize(vVertexPosition.xyz - systemUniforms.cameraPosition);\n\t\t\tvec3 R = refract(I, N, fragmentUniforms.refractionRatio);\n\t\t\tvec4 refractionColor = texture(samplerCube(uRefractionTexture,uRefractionSampler), R);\n\t\t\tdiffuseColor = mix(diffuseColor, refractionColor, fragmentUniforms.refractionPower);\n\t\t}\n\t\t\n\t\ttestAlpha = diffuseColor.a;\n\t\t\n\t\tfloat specularTextureValue = 1.0;\n\t\tif(fragmentUniforms.__specularTextureRenderYn == TRUTHY) specularTextureValue = texture(sampler2D(uSpecularTexture, uSpecularSampler), vUV).r ;\n\t\t\n\t\tvec4 finalColor = \n\t\tcalcDirectionalLight(\n\t\t\tdiffuseColor,\n\t\t\tN,\t\t\n\t\t\tsystemUniforms.directionalLightCount,\n\t\t\tsystemUniforms.directionalLightList,\n\t\t\tfragmentUniforms.shininess,\n\t\t\tfragmentUniforms.specularPower,\n\t\t\tfragmentUniforms.specularColor,\n\t\t\tspecularTextureValue\n\t\t)\n\t\t+\n\t\tcalcPointLight(\n\t\t\tdiffuseColor,\n\t\t\tN,\t\t\n\t\t\tsystemUniforms.pointLightCount,\n\t\t\tsystemUniforms.pointLightList,\n\t\t\tfragmentUniforms.shininess,\n\t\t\tfragmentUniforms.specularPower,\n\t\t\tfragmentUniforms.specularColor,\n\t\t\tspecularTextureValue,\n\t\t\tvVertexPosition.xyz\n\t\t)\n\t\t+ la;\n\t\t\n\t\tif(fragmentUniforms.__emissiveTextureRenderYn == TRUTHY) {\n\t\t\tvec4 emissiveColor = texture(sampler2D(uEmissiveTexture, uEmissiveSampler), vUV);\n\t\t\tfinalColor.rgb += emissiveColor.rgb * fragmentUniforms.emissivePower;\n\t\t}\n\t\t\n\t\tfinalColor.a = testAlpha;\n\t\toutColor = finalColor;\n\t\toutColor.a *= fragmentUniforms.alpha * vSumOpacity;\n\t\tout_MouseColorID_Depth = vec4(vMouseColorID, gl_FragCoord.z/gl_FragCoord.w, 0.0, 0.0);\n\t\t\n\t}\n`),Ve(Wa,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(Wa,"uniformsBindGroupLayoutDescriptor_material",{entries:[{binding:0,visibility:GPUShaderStage.VERTEX,type:"uniform-buffer"},{binding:1,visibility:GPUShaderStage.VERTEX,type:"sampler"},{binding:2,visibility:GPUShaderStage.VERTEX,type:"sampled-texture"},{binding:3,visibility:GPUShaderStage.FRAGMENT,type:"uniform-buffer"},{binding:4,visibility:GPUShaderStage.FRAGMENT,type:"sampler"},{binding:5,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture"},{binding:6,visibility:GPUShaderStage.FRAGMENT,type:"sampler"},{binding:7,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture"},{binding:8,visibility:GPUShaderStage.FRAGMENT,type:"sampler"},{binding:9,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture"},{binding:10,visibility:GPUShaderStage.FRAGMENT,type:"sampler"},{binding:11,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture"},{binding:12,visibility:GPUShaderStage.FRAGMENT,type:"sampler"},{binding:13,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture",viewDimension:"cube"}]}),Ve(Wa,"uniformBufferDescriptor_vertex",[{size:$e.float,valueName:"displacementFlowSpeedX"},{size:$e.float,valueName:"displacementFlowSpeedY"},{size:$e.float,valueName:"displacementPower"},{size:$e.float,valueName:"__displacementTextureRenderYn"}]),Ve(Wa,"uniformBufferDescriptor_fragment",[{size:$e.float,valueName:"normalPower"},{size:$e.float,valueName:"shininess"},{size:$e.float,valueName:"specularPower"},{size:$e.float4,valueName:"specularColorRGBA"},{size:$e.float,valueName:"emissivePower"},{size:$e.float,valueName:"refractionPower"},{size:$e.float,valueName:"refractionRatio"},{size:$e.float,valueName:"alpha"},{size:$e.float,valueName:"useFlatMode"},{size:$e.float,valueName:"__diffuseTextureRenderYn"},{size:$e.float,valueName:"__refractionTextureRenderYn"},{size:$e.float,valueName:"__normalTextureRenderYn"},{size:$e.float,valueName:"__specularTextureRenderYn"},{size:$e.float,valueName:"__emissiveTextureRenderYn"}]);let Ha=new Float32Array(1);class qa extends(Er.mix(hr,Er.diffuseTexture,Er.alpha)){constructor(t,e){super(t),ja.set(this,{writable:!0,value:!1}),this.diffuseTexture=e,this.needResetBindingInfo=!0}get useFixedScale(){return Oe(this,ja)}set useFixedScale(t){Ye(this,ja,t),Ha[0]=t?1:0,this.uniformBuffer_vertex.GPUBuffer.setSubData(this.uniformBufferDescriptor_vertex.redStructOffsetMap.useFixedScale,Ha),this.needResetBindingInfo=!0}checkTexture(t,e){if(t)if(t._GPUTexture){let r;switch(e){case"diffuseTexture":this._diffuseTexture=t,r=e}r&&(Ha[0]=this[`__${e}RenderYn`]=1,"displacementTexture"==r?this.uniformBuffer_vertex.GPUBuffer.setSubData(this.uniformBufferDescriptor_vertex.redStructOffsetMap[`__${e}RenderYn`],Ha):this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap[`__${e}RenderYn`],Ha)),this.needResetBindingInfo=!0}else t.addUpdateTarget(this,e);else this["_"+e]&&(this["_"+e]=null,Ha[0]=this[`__${e}RenderYn`]=0,"displacementTexture"==e?this.uniformBuffer_vertex.GPUBuffer.setSubData(this.uniformBufferDescriptor_vertex.redStructOffsetMap[`__${e}RenderYn`],Ha):this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap[`__${e}RenderYn`],Ha),this.needResetBindingInfo=!0)}resetBindingInfo(){this.entries=[{binding:0,resource:{buffer:this.uniformBuffer_vertex.GPUBuffer,offset:0,size:this.uniformBufferDescriptor_vertex.size}},{binding:1,resource:{buffer:this.uniformBuffer_fragment.GPUBuffer,offset:0,size:this.uniformBufferDescriptor_fragment.size}},{binding:2,resource:this._diffuseTexture?this._diffuseTexture.sampler.GPUSampler:this.redGPUContext.state.emptySampler.GPUSampler},{binding:3,resource:this._diffuseTexture?this._diffuseTexture._GPUTextureView:this.redGPUContext.state.emptyTextureView}],this._afterResetBindingInfo()}}var ja=new WeakMap;Ve(qa,"vertexShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_vertex.systemUniforms}\n    ${tr.GLSL_SystemUniforms_vertex.meshUniforms}\n\tlayout( location = 0 ) in vec3 position;\n\tlayout( location = 1 ) in vec3 normal;\n\tlayout( location = 2 ) in vec2 uv;\n\tlayout( location = 0 ) out vec3 vNormal;\n\tlayout( location = 1 ) out vec2 vUV;\n\tlayout( location = 2 ) out float vMouseColorID;\n\tlayout( location = 3 ) out float vSumOpacity;\t\n\tlayout( set = ${tr.SET_INDEX_VertexUniforms}, binding = 0 ) uniform VertexUniforms {\n        float useFixedScale;\n    } vertexUniforms;\n    ${tr.GLSL_SystemUniforms_vertex.getSprite3DMatrix}\n\tvoid main() {\n\t\tgl_Position = systemUniforms.perspectiveMTX * getSprite3DMatrix( systemUniforms.cameraMTX, meshMatrixUniforms.modelMatrix[ int(meshUniforms.index) ] ) * vec4(position,1.0);\n\t\tif(vertexUniforms.useFixedScale == TRUTHY)  {\n\t\t\tgl_Position /= gl_Position.w;\n\t\t\tgl_Position.xy += position.xy * vec2((systemUniforms.perspectiveMTX * meshMatrixUniforms.modelMatrix[ int(meshUniforms.index) ])[0][0],(systemUniforms.perspectiveMTX * meshMatrixUniforms.modelMatrix[ int(meshUniforms.index) ])[1][1]);\n\t\t}\n\t\tvNormal = normal;\n\t\tvUV = uv;\n\t\tvMouseColorID = meshUniforms.mouseColorID;\n\t\tvSumOpacity = meshUniforms.sumOpacity;\n\t}\n\t`),Ve(qa,"fragmentShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\tconst float TRUTHY = 1.0;\n\tlayout( location = 0 ) in vec3 vNormal;\n\tlayout( location = 1 ) in vec2 vUV;\n\tlayout( location = 2 ) in float vMouseColorID;\t\n\tlayout( location = 3 ) in float vSumOpacity;\t\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 1 ) uniform FragmentUniforms {\n        float alpha;\n        //\n        float __diffuseTextureRenderYn;\n    } fragmentUniforms;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 2 ) uniform sampler uSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 3 ) uniform texture2D uDiffuseTexture;\n\tlayout( location = 0 ) out vec4 outColor;\n\t\n\tlayout( location = 1 ) out vec4 out_MouseColorID_Depth;\n\tvoid main() {\n\t\tvec4 diffuseColor = vec4(0.0);\n\t\tif(fragmentUniforms.__diffuseTextureRenderYn == TRUTHY) diffuseColor = texture(sampler2D(uDiffuseTexture, uSampler), vUV) ;\n\t\toutColor = diffuseColor;\n\t\toutColor.a *= fragmentUniforms.alpha * vSumOpacity;\n\t\tout_MouseColorID_Depth = vec4(vMouseColorID, gl_FragCoord.z/gl_FragCoord.w, 0.0, 0.0);\n\t\t\n\t}\n`),Ve(qa,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(qa,"uniformsBindGroupLayoutDescriptor_material",{entries:[{binding:0,visibility:GPUShaderStage.VERTEX,type:"uniform-buffer"},{binding:1,visibility:GPUShaderStage.FRAGMENT,type:"uniform-buffer"},{binding:2,visibility:GPUShaderStage.FRAGMENT,type:"sampler"},{binding:3,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture"}]}),Ve(qa,"uniformBufferDescriptor_vertex",[{size:$e.float,valueName:"useFixedScale"}]),Ve(qa,"uniformBufferDescriptor_fragment",[{size:$e.float,valueName:"alpha"},{size:$e.float,valueName:"__diffuseTextureRenderYn"}]);class Ja extends Ti{constructor(t,e=1,r=1,n=1,i=1,a=1,o=1,s=1){let u;if(super(),Qa.set(this,{writable:!0,value:function(){let t,e;return e=function(e,r,n,i,a,o,s,u,l,f,m,c,h){let d,p,v=u/m,_=l/c,g=u/2,x=l/2,y=f/2,S=m+1,T=c+1,U=0,b=[];for(p=0;p<T;p++){let t=p*_-x;for(d=0;d<S;d++){let r=d*v-g;b[n]=r*o,b[i]=t*s,b[a]=y,e.push(b.x,b.y,b.z),b[n]=0,b[i]=0,b[a]=f>0?1:-1,e.push(b.x,b.y,b.z),e.push(d/m*h,p/c*h),U+=1}}for(p=0;p<c;p++)for(d=0;d<m;d++){let e=t+d+S*p,n=t+d+S*(p+1),i=t+(d+1)+S*(p+1),a=t+(d+1)+S*p;r.push(e,n,a,n,i,a)}t+=U},function(r,n,i,a,o,s,u,l,f){let m=[],c=[];return t=0,e(m,c,"z","y","x",-1,-1,o,a,i,l,u,f),e(m,c,"z","y","x",1,-1,o,a,-i,l,u,f),e(m,c,"x","z","y",1,1,i,o,a,s,l,f),e(m,c,"x","z","y",1,-1,i,o,-a,s,l,f),e(m,c,"x","y","z",1,-1,i,a,o,s,u,f),e(m,c,"x","y","z",-1,-1,i,a,-o,s,u,f),new Ui(r,new bi(r,n+"_interleaveBuffer",bi.TYPE_VERTEX,new Float32Array(m),[new Si("vertexPosition","float3"),new Si("vertexNormal","float3"),new Si("texcoord","float2")]),new bi(r,n+"_indexBuffer",bi.TYPE_INDEX,new Uint32Array(c)))}}()}),u=[this.constructor.name,e,r,n,i,a,o,s].join("_"),t.state.Geometry.has(u))return t.state.Geometry.get(u);let l=Oe(this,Qa).call(this,t,u,e,r,n,i,a,o,s);this.interleaveBuffer=l.interleaveBuffer,this.indexBuffer=l.indexBuffer,this.vertexState=l.vertexState,t.state.Geometry.set(u,this)}}var Qa=new WeakMap;var Ka=new WeakMap,to=new WeakMap,eo=new WeakMap,ro=new WeakMap,no=new WeakMap;let io,ao,oo,so,uo,lo,fo,mo,co,ho,po=function(t){t._height=+t._height,t._svg.setAttribute("width",t._width),t._svg.setAttribute("height",t._height),t._svg.querySelector("foreignObject").setAttribute("height",t._height),t._svg.querySelector("table").style.height=t._height+"px",t._img.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(t._svg.outerHTML)};io=function(t,e,r){let n;n=t._svg.querySelector("td").style,t["_"+e]=r,Object.defineProperty(t,e,{get:function(){return t["_"+e]},set:function(r){t["_"+e]=r,n[e]="number"==typeof r?r+="px":r,po(t)}}),t[e]=r};ho=function(t,e,r){let n=Ae.vec2.sqrDist(e,r);if(0===n)return Ae.vec2.sqrDist(t,e);let i=((t[0]-e[0])*(r[0]-e[0])+(t[1]-e[1])*(r[1]-e[1]))/n;return i=Math.max(0,Math.min(1,i)),Ae.vec2.sqrDist(t,Ae.vec2.lerp([0,0],e,r,i))},co=function(t,e,r,n,i){let a=i||[],o=t[e],s=t[r-1],u=0,l=1,f=e+1;for(;f<r-1;++f){let e=ho(t[f],o,s);e>u&&(u=e,l=f)}return Math.sqrt(u)>n?(co(t,e,l+1,n,a),co(t,l,r,n,a)):a.push(o,s),a},so=function(t,e){null==e&&(e=1);let r,n,i,a,o=t.length,s=o-2,u=0;for(;u<o-1;u++)r=u?t[u-1].point:t[u].point,n=t[u].point,i=t[u+1].point,a=u===s?i:t[u+2].point,t[u].outPoint[0]=n[0]+(i[0]-r[0])/6*e,t[u].outPoint[1]=n[1]+(i[1]-r[1])/6*e,t[u].outPoint[2]=n[2]+(i[2]-r[2])/6*e,t[u+1].inPoint[0]=i[0]-(a[0]-n[0])/6*e,t[u+1].inPoint[1]=i[1]-(a[1]-n[1])/6*e,t[u+1].inPoint[2]=i[2]-(a[2]-n[2])/6*e;return t},lo=function(t){let e,r,n,i=[],a=0;for(e=0,r=t.length;e<r;e++)n=t[e],0===a?(i[a++]=n.point,i[a++]=n.outPoint):(i[a++]=n.inPoint,i[a++]=n.point,t[e+1]&&(i[a++]=n.outPoint));return i},uo=function(){let t,e;return t=function(t,e){let r=t[e+0],n=t[e+1],i=t[e+2],a=t[e+3],o=3*n[0]-2*r[0]-a[0],s=3*n[1]-2*r[1]-a[1],u=3*i[0]-2*a[0]-r[0],l=3*i[1]-2*a[1]-r[1];return o*=o,s*=s,u*=u,l*=l,o<u&&(o=u),s<l&&(s=l),o+s},e=function(r,n,i,a){let o=a||[];if(t(r,n)<i)o.push(r[n+0],r[n+3]);else{let t=.5,a=r[n+0],s=r[n+1],u=r[n+2],l=r[n+3],f=Ae.vec3.lerp([0,0],a,s,t),m=Ae.vec3.lerp([0,0],s,u,t),c=Ae.vec3.lerp([0,0],u,l,t),h=Ae.vec3.lerp([0,0],f,m,t),d=Ae.vec3.lerp([0,0],m,c,t),p=Ae.vec3.lerp([0,0],h,d,t);p.colorRGBA=a.colorRGBA,e([a,f,h,p],0,i,o),e([p,d,c,l],0,i,o)}return o},function(t,r){let n=[],i=(t.length-1)/3;i=Math.floor(i);let a,o=0;for(;o<i;++o)a=3*o,e(t,a,r,n);return n}}(),mo=function(t){},fo=function(t,e,r,n,i){let a,o,s,u;switch(t._interleaveData.length=0,t.type){case _o.CATMULL_ROM:case _o.BEZIER:if(e.length>1)for(t._serializedPoints=lo(_o.CATMULL_ROM===t.type?so(e,r):e),a=uo(t._serializedPoints,n),a=co(a,0,a.length,i),o=0,s=a.length;o<s;o++)u=a[o],t._interleaveData.push(u[0],u[1],u[2],...u.colorRGBA);else t._interleaveData.push(0,0,0,...qe.hexToRGB_ZeroToOne(t.color));break;default:for(o=0,s=e.length;o<s;o++)u=e[o].point,t._interleaveData.push(u[0],u[1],u[2],...u.colorRGBA)}t.debug,t._upload()};class vo{constructor(t=0,e=0,r=0,n=0,i=0,a=0,o=0,s=0,u=0,l,f){let m=[...qe.hexToRGB_ZeroToOne(l),f];this.inPoint=[n,i,a],this.inPoint.colorRGBA=m,this.point=[t,e,r],this.point.colorRGBA=m,this.outPoint=[o,s,u],this.outPoint.colorRGBA=m}}class _o extends kn{get type(){return Oe(this,go)}set type(t){t!==_o.LINEAR&&t!==_o.CATMULL_ROM&&t!==_o.BEZIER&&qe.throwFunc("Line : 허용하지 않는 타입","입력값 : "+t),Ye(this,go,t),fo(this,Oe(this,To),Oe(this,xo),Oe(this,So),Oe(this,yo))}get tension(){return Oe(this,xo)}set tension(t){Ye(this,xo,t),fo(this,Oe(this,To),Oe(this,xo),Oe(this,So),Oe(this,yo))}get distance(){return Oe(this,yo)}set distance(t){Ye(this,yo,t),fo(this,Oe(this,To),Oe(this,xo),Oe(this,So),Oe(this,yo))}get tolerance(){return Oe(this,So)}set tolerance(t){Ye(this,So,t),fo(this,Oe(this,To),Oe(this,xo),Oe(this,So),Oe(this,yo))}constructor(t,e="#ff0000",r=_o.LINEAR){super(t),go.set(this,{writable:!0,value:void 0}),xo.set(this,{writable:!0,value:void 0}),yo.set(this,{writable:!0,value:void 0}),So.set(this,{writable:!0,value:void 0}),To.set(this,{writable:!0,value:[]}),this.redGPUContext=t,this._interleaveData=[0,0,0],this.primitiveTopology="line-strip",this._serializedPoints=[],Ye(this,xo,1),Ye(this,So,.01),Ye(this,yo,.1),this.color=e,Ye(this,go,r),this._debug=!1,this.material=new $r(this.redGPUContext),this.dirtyPipeline=!1}addPoint(t=0,e=0,r=0,n,i=1,a=0,o=0,s=0,u=0,l=0,f=0){"number"==typeof t||qe.throwFunc("Line : addPoint - x값은 숫자만 허용","입력값 : "+t),"number"==typeof e||qe.throwFunc("Line : addPoint - y값은 숫자만 허용","입력값 : "+e),"number"==typeof r||qe.throwFunc("Line : addPoint - z값은 숫자만 허용","입력값 : "+r),"number"==typeof a||qe.throwFunc("Line : addPoint - inX값은 숫자만 허용","입력값 : "+a),"number"==typeof o||qe.throwFunc("Line : addPoint - inY값은 숫자만 허용","입력값 : "+o),"number"==typeof s||qe.throwFunc("Line : addPoint - inZ값은 숫자만 허용","입력값 : "+s),"number"==typeof u||qe.throwFunc("Line : addPoint - outX값은 숫자만 허용","입력값 : "+u),"number"==typeof l||qe.throwFunc("Line : addPoint - outY값은 숫자만 허용","입력값 : "+l),"number"==typeof f||qe.throwFunc("Line : addPoint - outZ값은 숫자만 허용","입력값 : "+f),Oe(this,To).push(new vo(t,e,r,a,o,s,u,l,f,n||this.color,i)),fo(this,Oe(this,To),Oe(this,xo),Oe(this,So),Oe(this,yo))}addPointAt(t,e=0,r=0,n=0,i,a=1,o=0,s=0,u=0,l=0,f=0,m=0){"number"==typeof e||qe.throwFunc("Line : addPoint - x값은 숫자만 허용","입력값 : "+e),"number"==typeof r||qe.throwFunc("Line : addPoint - y값은 숫자만 허용","입력값 : "+r),"number"==typeof n||qe.throwFunc("Line : addPoint - z값은 숫자만 허용","입력값 : "+n),"number"==typeof o||qe.throwFunc("Line : addPoint - inX값은 숫자만 허용","입력값 : "+o),"number"==typeof s||qe.throwFunc("Line : addPoint - inY값은 숫자만 허용","입력값 : "+s),"number"==typeof u||qe.throwFunc("Line : addPoint - inZ값은 숫자만 허용","입력값 : "+u),"number"==typeof l||qe.throwFunc("Line : addPoint - outX값은 숫자만 허용","입력값 : "+l),"number"==typeof f||qe.throwFunc("Line : addPoint - outY값은 숫자만 허용","입력값 : "+f),"number"==typeof m||qe.throwFunc("Line : addPoint - outZ값은 숫자만 허용","입력값 : "+m),"number"==typeof t||qe.throwFunc("addPointAt","index는 숫자만 입력가능","입력값 : "+t),Oe(this,To).length<t&&(t=Oe(this,To).length),null!=t?Oe(this,To).splice(t,0,new vo(e,r,n,o,s,u,l,f,m,i||this.color,a)):Oe(this,To).push(new vo(e,r,n,o,s,u,l,f,m,i||this.color,a)),fo(this,Oe(this,To),Oe(this,xo),Oe(this,So),Oe(this,yo))}removePointAt(t){"number"!=typeof t&&qe.throwFunc("removeChildAt","index가 Number형이 아님 ","입력값 : "+t),Oe(this,To)[t]?Oe(this,To).splice(t,1):qe.throwFunc("removeChildAt","index 해당인덱스에 위치한 포인트가 없음.","입력값 : "+t),fo(this,Oe(this,To),Oe(this,xo),Oe(this,So),Oe(this,yo))}removeAllPoint(){Oe(this,To).length=0,fo(this,Oe(this,To),Oe(this,xo),Oe(this,So),Oe(this,yo)),this._upload()}_upload(){this._UUID=ze.getNextUUID(),Oe(this,To).length?(this._interleaveBuffer=new bi(this.redGPUContext,"Line_InterleaveBuffer_"+this._UUID,bi.TYPE_VERTEX,new Float32Array(this._interleaveData),[new Si("vertexPosition","float3"),new Si("vertexColor","float4")]),this.geometry=new Ui(this.redGPUContext,this._interleaveBuffer)):(this._interleaveBuffer=null,this.geometry=null)}}var go=new WeakMap,xo=new WeakMap,yo=new WeakMap,So=new WeakMap,To=new WeakMap;Ve(_o,"LINEAR","linear"),Ve(_o,"CATMULL_ROM","catmullRom"),Ve(_o,"BEZIER","bezier");const Uo=new Float32Array(1);class bo extends Ki{get brightness(){return this._brightness}set brightness(t){this._brightness=t,Uo[0]=this._brightness/255,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.brightness,Uo)}get contrast(){return this._contrast}set contrast(t){this._contrast=t,Uo[0]=this._contrast/255,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.contrast,Uo)}constructor(t){super(t),Ve(this,"_brightness",0),Ve(this,"_contrast",0)}}Ve(bo,"vertexShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_vertex.systemUniforms}\n    \n\tlayout( location = 0 ) in vec3 position;\n\tlayout( location = 1 ) in vec3 normal;\n\tlayout( location = 2 ) in vec2 uv;\n\tlayout( location = 0 ) out vec3 vNormal;\n\tlayout( location = 1 ) out vec2 vUV;\n\tvoid main() {\n\t\tgl_Position = vec4(position*2.0,1.0);\n\t\tvNormal = normal;\n\t\tvUV = uv;\n\t}\n\t`),Ve(bo,"fragmentShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 0 ) uniform FragmentUniforms {\n        float brightness;\n        float contrast;\n    } fragmentUniforms;\n\tlayout( location = 0 ) in vec3 vNormal;\n\tlayout( location = 1 ) in vec2 vUV;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 1 ) uniform sampler uSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 2 ) uniform texture2D uSourceTexture;\n\tlayout( location = 0 ) out vec4 outColor;\n\tvoid main() {\n\t\tvec4 finalColor = vec4(0.0);\n\t\tfinalColor = texture( sampler2D( uSourceTexture, uSampler ), vUV );\n\t\tif ( fragmentUniforms.contrast > 0.0 ) finalColor.rgb = ( finalColor.rgb - 0.5 ) / ( 1.0 - fragmentUniforms.contrast ) + 0.5;\n\t\telse finalColor.rgb = ( finalColor.rgb - 0.5 ) * ( 1.0 + fragmentUniforms.contrast ) + 0.5;\n\t\tfinalColor.rgb += fragmentUniforms.brightness;\n\t\toutColor = finalColor;\n\t}\n`),Ve(bo,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(bo,"uniformsBindGroupLayoutDescriptor_material",Ki.uniformsBindGroupLayoutDescriptor_material),Ve(bo,"uniformBufferDescriptor_vertex",hr.uniformBufferDescriptor_empty),Ve(bo,"uniformBufferDescriptor_fragment",[{size:$e.float,valueName:"brightness"},{size:$e.float,valueName:"contrast"}]);class Mo extends Ki{constructor(t){super(t)}}Ve(Mo,"vertexShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_vertex.systemUniforms}\n    \n\tlayout( location = 0 ) in vec3 position;\n\tlayout( location = 1 ) in vec3 normal;\n\tlayout( location = 2 ) in vec2 uv;\n\tlayout( location = 0 ) out vec3 vNormal;\n\tlayout( location = 1 ) out vec2 vUV;\n\tvoid main() {\n\t\tgl_Position = vec4(position*2.0,1.0);\n\t\tvNormal = normal;\n\t\tvUV = uv;\n\t}\n\t`),Ve(Mo,"fragmentShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\tlayout( location = 0 ) in vec3 vNormal;\n\tlayout( location = 1 ) in vec2 vUV;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 1 ) uniform sampler uSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 2 ) uniform texture2D uSourceTexture;\n\tlayout( location = 0 ) out vec4 outColor;\n\tvoid main() {\n\t\tvec4 diffuseColor = vec4(0.0);\n\t\tdiffuseColor = texture( sampler2D( uSourceTexture, uSampler ), vUV ) ;\n\t    float gray = (diffuseColor.r  + diffuseColor.g + diffuseColor.b)/3.0;\n\t\toutColor = vec4( gray, gray, gray, 1.0);;\n\t}\n`),Ve(Mo,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(Mo,"uniformsBindGroupLayoutDescriptor_material",Ki.uniformsBindGroupLayoutDescriptor_material),Ve(Mo,"uniformBufferDescriptor_vertex",hr.uniformBufferDescriptor_empty),Ve(Mo,"uniformBufferDescriptor_fragment",hr.uniformBufferDescriptor_empty);const Po=new Float32Array(1);class wo extends Ki{get hue(){return this._hue}set hue(t){this._hue=t,Po[0]=this._hue/180,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.hue,Po)}get saturation(){return this._saturation}set saturation(t){this._saturation=t,Po[0]=this._saturation/100,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.saturation,Po)}constructor(t){super(t),Ve(this,"_hue",0),Ve(this,"_saturation",0)}}Ve(wo,"vertexShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_vertex.systemUniforms}\n    \n\tlayout( location = 0 ) in vec3 position;\n\tlayout( location = 1 ) in vec3 normal;\n\tlayout( location = 2 ) in vec2 uv;\n\tlayout( location = 0 ) out vec3 vNormal;\n\tlayout( location = 1 ) out vec2 vUV;\n\tvoid main() {\n\t\tgl_Position = vec4(position*2.0,1.0);\n\t\tvNormal = normal;\n\t\tvUV = uv;\n\t}\n\t`),Ve(wo,"fragmentShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 0 ) uniform FragmentUniforms {\n        float hue;\n        float saturation;\n    } fragmentUniforms;\n\tlayout( location = 0 ) in vec3 vNormal;\n\tlayout( location = 1 ) in vec2 vUV;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 1 ) uniform sampler uSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 2 ) uniform texture2D uSourceTexture;\n\tlayout( location = 0 ) out vec4 outColor;\n\tvoid main() {\n\t\tvec4 finalColor = vec4(0.0);\n\t\tfinalColor = texture( sampler2D( uSourceTexture, uSampler ), vUV );\n\t\t\n\t\tfloat hue_value = fragmentUniforms.hue;\n\t\tfloat angle = hue_value * 3.1415926535897932384626433832795;\n\t\tfloat s = sin(angle), c = cos(angle);\n\t\tvec3 weights = (vec3(2.0 * c, -sqrt(3.0) * s - c, sqrt(3.0) * s - c) + 1.0) / 3.0;\n\t\tfloat len = length(finalColor.rgb);\n\t\t\n\t\tfinalColor.rgb = vec3(\n\t\t\tdot(finalColor.rgb, weights.xyz),\n\t\t\tdot(finalColor.rgb, weights.zxy),\n\t\t\tdot(finalColor.rgb, weights.yzx)\n\t\t);\n\t\t\n\t\tfloat average = (finalColor.r + finalColor.g + finalColor.b) / 3.0;\n\t\tfloat saturation_value = fragmentUniforms.saturation;\n\t\tif (saturation_value > 0.0) finalColor.rgb += (average - finalColor.rgb) * (1.0 - 1.0 / (1.001 - saturation_value));\n\t\telse finalColor.rgb += (average - finalColor.rgb) * (-saturation_value);\n\t\t\n\t\toutColor = finalColor;\n\t}\n`),Ve(wo,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(wo,"uniformsBindGroupLayoutDescriptor_material",Ki.uniformsBindGroupLayoutDescriptor_material),Ve(wo,"uniformBufferDescriptor_vertex",hr.uniformBufferDescriptor_empty),Ve(wo,"uniformBufferDescriptor_fragment",[{size:$e.float,valueName:"hue"},{size:$e.float,valueName:"saturation"}]);class Eo extends Ki{constructor(t){super(t)}}Ve(Eo,"vertexShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_vertex.systemUniforms}\n    \n\tlayout( location = 0 ) in vec3 position;\n\tlayout( location = 1 ) in vec3 normal;\n\tlayout( location = 2 ) in vec2 uv;\n\tlayout( location = 0 ) out vec3 vNormal;\n\tlayout( location = 1 ) out vec2 vUV;\n\tvoid main() {\n\t\tgl_Position = vec4(position*2.0,1.0);\n\t\tvNormal = normal;\n\t\tvUV = uv;\n\t}\n\t`),Ve(Eo,"fragmentShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\tlayout( location = 0 ) in vec3 vNormal;\n\tlayout( location = 1 ) in vec2 vUV;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 1 ) uniform sampler uSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 2 ) uniform texture2D uSourceTexture;\n\tlayout( location = 0 ) out vec4 outColor;\n\tvoid main() {\n\t\tvec4 diffuseColor = vec4(0.0);\n\t\tdiffuseColor = texture( sampler2D( uSourceTexture, uSampler ), vUV ) ;\n\t\tdiffuseColor.rgb = 1.0 - diffuseColor.rgb;\n\t\toutColor = diffuseColor;\n\t}\n`),Ve(Eo,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(Eo,"uniformsBindGroupLayoutDescriptor_material",Ki.uniformsBindGroupLayoutDescriptor_material),Ve(Eo,"uniformBufferDescriptor_vertex",hr.uniformBufferDescriptor_empty),Ve(Eo,"uniformBufferDescriptor_fragment",hr.uniformBufferDescriptor_empty);const Go=new Float32Array(1);class Do extends Ki{get threshold(){return this._threshold}set threshold(t){this._threshold=t,Go[0]=this._threshold,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.threshold,Go)}constructor(t){super(t),Ve(this,"_threshold",128)}}Ve(Do,"vertexShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_vertex.systemUniforms}\n    \n\tlayout( location = 0 ) in vec3 position;\n\tlayout( location = 1 ) in vec3 normal;\n\tlayout( location = 2 ) in vec2 uv;\n\tlayout( location = 0 ) out vec3 vNormal;\n\tlayout( location = 1 ) out vec2 vUV;\n\tvoid main() {\n\t\tgl_Position = vec4(position*2.0,1.0);\n\t\tvNormal = normal;\n\t\tvUV = uv;\n\t}\n\t`),Ve(Do,"fragmentShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 0 ) uniform FragmentUniforms {\n        float threshold;\n    } fragmentUniforms;\n\tlayout( location = 0 ) in vec3 vNormal;\n\tlayout( location = 1 ) in vec2 vUV;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 1 ) uniform sampler uSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 2 ) uniform texture2D uSourceTexture;\n\tlayout( location = 0 ) out vec4 outColor;\n\tvoid main() {\n\t\tvec4 finalColor = vec4(0.0);\n\t\tfinalColor = texture( sampler2D( uSourceTexture, uSampler ), vUV );\n\t\tfloat v = 0.0;\n\t\tif( 0.2126 * finalColor.r + 0.7152 * finalColor.g + 0.0722 * finalColor.b >= fragmentUniforms.threshold/255.0 ) v = 1.0;\n\t\tfinalColor.r = finalColor.g = finalColor.b = v;\n\t\toutColor = finalColor;\n\t}\n`),Ve(Do,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(Do,"uniformsBindGroupLayoutDescriptor_material",Ki.uniformsBindGroupLayoutDescriptor_material),Ve(Do,"uniformBufferDescriptor_vertex",hr.uniformBufferDescriptor_empty),Ve(Do,"uniformBufferDescriptor_fragment",[{size:$e.float,valueName:"threshold"}]);const Lo=new Float32Array(1);class Bo extends Ki{get size(){return this._size}set size(t){this._size=t,Lo[0]=this._size,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.size,Lo)}constructor(t){super(t),Ve(this,"_size",50)}}Ve(Bo,"vertexShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_vertex.systemUniforms}\n    \n\tlayout( location = 0 ) in vec3 position;\n\tlayout( location = 1 ) in vec3 normal;\n\tlayout( location = 2 ) in vec2 uv;\n\tlayout( location = 0 ) out vec3 vNormal;\n\tlayout( location = 1 ) out vec2 vUV;\n\tvoid main() {\n\t\tgl_Position = vec4(position*2.0,1.0);\n\t\tvNormal = normal;\n\t\tvUV = uv;\n\t}\n\t`),Ve(Bo,"fragmentShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_fragment.systemUniforms}\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 0 ) uniform FragmentUniforms {\n        float size;\n    } fragmentUniforms;\n\tlayout( location = 0 ) in vec3 vNormal;\n\tlayout( location = 1 ) in vec2 vUV;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 1 ) uniform sampler uSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 2 ) uniform texture2D uSourceTexture;\n\tlayout( location = 0 ) out vec4 outColor;\n\t\n\tfloat random(vec3 scale, float seed) {\n\t\treturn fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n\t}\n\n\tvoid main() {\n\t\tvec4 finalColor = vec4(0.0);\n\t\tvec2 delta;\n\t\tfloat total = 0.0;\n\t\tfloat offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n\t\tdelta = vec2( fragmentUniforms.size/systemUniforms.resolution.x, 0.0 );\n\t\tfor (float t = -10.0; t <= 10.0; t++) {\n\t\t\tfloat percent = (t + offset - 0.5) / 10.0;\n\t\t\tfloat weight = 1.0 - abs(percent);\n\t\t\tvec4 color = texture( sampler2D( uSourceTexture, uSampler ), vUV  + delta * percent );\n\t\t\tcolor.rgb *= color.a;\n\t\t\tfinalColor += color * weight;\n\t\t\ttotal += weight;\n\t\t}\n\t\tfinalColor = finalColor / total;\n\t\tfinalColor.rgb /= finalColor.a + 0.00001;\n\t\toutColor = finalColor;\n\t}\n`),Ve(Bo,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(Bo,"uniformsBindGroupLayoutDescriptor_material",Ki.uniformsBindGroupLayoutDescriptor_material),Ve(Bo,"uniformBufferDescriptor_vertex",hr.uniformBufferDescriptor_empty),Ve(Bo,"uniformBufferDescriptor_fragment",[{size:$e.float,valueName:"size"}]);const Ro=new Float32Array(1);class Co extends Ki{get size(){return this._size}set size(t){this._size=t,Ro[0]=this._size,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.size,Ro)}constructor(t){super(t),Ve(this,"_size",50)}}Ve(Co,"vertexShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_vertex.systemUniforms}\n    \n\tlayout( location = 0 ) in vec3 position;\n\tlayout( location = 1 ) in vec3 normal;\n\tlayout( location = 2 ) in vec2 uv;\n\tlayout( location = 0 ) out vec3 vNormal;\n\tlayout( location = 1 ) out vec2 vUV;\n\tvoid main() {\n\t\tgl_Position = vec4(position*2.0,1.0);\n\t\tvNormal = normal;\n\t\tvUV = uv;\n\t}\n\t`),Ve(Co,"fragmentShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_fragment.systemUniforms}\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 0 ) uniform FragmentUniforms {\n        float size;\n    } fragmentUniforms;\n\tlayout( location = 0 ) in vec3 vNormal;\n\tlayout( location = 1 ) in vec2 vUV;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 1 ) uniform sampler uSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 2 ) uniform texture2D uSourceTexture;\n\tlayout( location = 0 ) out vec4 outColor;\n\t\n\tfloat random(vec3 scale, float seed) {\n\t\treturn fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n\t}\n\n\tvoid main() {\n\t\tvec4 finalColor = vec4(0.0);\n\t\tvec2 delta;\n\t\tfloat total = 0.0;\n\t\tfloat offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n\t\tdelta = vec2( 0.0, fragmentUniforms.size/systemUniforms.resolution.y );\n\t\tfor (float t = -10.0; t <= 10.0; t++) {\n\t\t\tfloat percent = (t + offset - 0.5) / 10.0;\n\t\t\tfloat weight = 1.0 - abs(percent);\n\t\t\tvec4 color = texture( sampler2D( uSourceTexture, uSampler ), vUV  + delta * percent );\n\t\t\tcolor.rgb *= color.a;\n\t\t\tfinalColor += color * weight;\n\t\t\ttotal += weight;\n\t\t}\n\t\tfinalColor = finalColor / total;\n\t\tfinalColor.rgb /= finalColor.a + 0.00001;\n\t\toutColor = finalColor;\n\t}\n`),Ve(Co,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(Co,"uniformsBindGroupLayoutDescriptor_material",Ki.uniformsBindGroupLayoutDescriptor_material),Ve(Co,"uniformBufferDescriptor_vertex",hr.uniformBufferDescriptor_empty),Ve(Co,"uniformBufferDescriptor_fragment",[{size:$e.float,valueName:"size"}]);class Io extends Ki{get radius(){return this._radius}set radius(t){this._radius=t,Oe(this,No).size=t,Oe(this,Fo).size=t}constructor(t){super(t),No.set(this,{writable:!0,value:void 0}),Fo.set(this,{writable:!0,value:void 0}),Ve(this,"_radius",void 0),Ye(this,No,new Bo(t)),Ye(this,Fo,new Co(t)),this.radius=5}render(t,e,r,n){this.checkSize(t,e),Oe(this,No).render(t,e,r,n),Oe(this,Fo).render(t,e,r,Oe(this,No).baseAttachmentView),this.baseAttachment=Oe(this,Fo).baseAttachment,this.baseAttachmentView=Oe(this,Fo).baseAttachmentView}}var No=new WeakMap,Fo=new WeakMap;Ve(Io,"vertexShaderGLSL",`\n\t\t${tr.GLSL_VERSION}\n\t\tvoid main() {}\n\t`),Ve(Io,"fragmentShaderGLSL",`\n\t\t${tr.GLSL_VERSION}\n\t\tvoid main() {}\n\t`),Ve(Io,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(Io,"uniformsBindGroupLayoutDescriptor_material",Ki.uniformsBindGroupLayoutDescriptor_material),Ve(Io,"uniformBufferDescriptor_vertex",hr.uniformBufferDescriptor_empty),Ve(Io,"uniformBufferDescriptor_fragment",hr.uniformBufferDescriptor_empty);const Ao=new Float32Array(1);class Vo extends Ki{get bloomStrength(){return this._bloomStrength}set bloomStrength(t){this._bloomStrength=t,Ao[0]=this._bloomStrength,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.bloomStrength,Ao)}get exposure(){return this._exposure}set exposure(t){this._exposure=t,Ao[0]=this._exposure,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.exposure,Ao)}constructor(t){super(t),Ve(this,"blurTexture",void 0),Ve(this,"_bloomStrength",15),Ve(this,"_exposure",15)}resetBindingInfo(){this.entries=[{binding:0,resource:{buffer:this.uniformBuffer_fragment.GPUBuffer,offset:0,size:this.uniformBufferDescriptor_fragment.size}},{binding:1,resource:this.sampler.GPUSampler},{binding:2,resource:this.sourceTexture},{binding:3,resource:this.blurTexture}],this._afterResetBindingInfo()}}Ve(Vo,"vertexShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_vertex.systemUniforms}\n    \n\tlayout( location = 0 ) in vec3 position;\n\tlayout( location = 1 ) in vec3 normal;\n\tlayout( location = 2 ) in vec2 uv;\n\tlayout( location = 0 ) out vec3 vNormal;\n\tlayout( location = 1 ) out vec2 vUV;\n\tvoid main() {\n\t\tgl_Position = vec4(position*2.0,1.0);\n\t\tvNormal = normal;\n\t\tvUV = uv;\n\t}\n\t`),Ve(Vo,"fragmentShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_fragment.systemUniforms}\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 0 ) uniform FragmentUniforms {\n        float bloomStrength;\n        float exposure;\n    } fragmentUniforms;\n\tlayout( location = 0 ) in vec3 vNormal;\n\tlayout( location = 1 ) in vec2 vUV;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 1 ) uniform sampler uSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 2 ) uniform texture2D uSourceTexture;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 3 ) uniform texture2D uBlurTexture;\n\tlayout( location = 0 ) out vec4 outColor;\n\tvoid main() {\n\t\tvec4 diffuseColor;\n\t\tvec4 blurColor;\n\t\tvec4 finalColor;\n\t\tdiffuseColor = texture( sampler2D( uSourceTexture, uSampler ), vUV );\n\t\tblurColor = texture( sampler2D( uBlurTexture, uSampler ), vUV );\t\n\t\tfinalColor = diffuseColor;\n\t\tfinalColor.rgb = (finalColor.rgb  + blurColor.rgb * fragmentUniforms.bloomStrength ) * fragmentUniforms.exposure ;\n\t\toutColor = finalColor;\n\t}\n`),Ve(Vo,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(Vo,"uniformsBindGroupLayoutDescriptor_material",{entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,type:"uniform-buffer"},{binding:1,visibility:GPUShaderStage.FRAGMENT,type:"sampler"},{binding:2,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture"},{binding:3,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture"}]}),Ve(Vo,"uniformBufferDescriptor_vertex",hr.uniformBufferDescriptor_empty),Ve(Vo,"uniformBufferDescriptor_fragment",[{size:$e.float,valueName:"bloomStrength"},{size:$e.float,valueName:"exposure"}]);class Oo extends Ki{get blur(){return Oe(this,$o)}set blur(t){Ye(this,$o,t),Oe(this,Yo).radius=t}get threshold(){return Oe(this,ko)}set threshold(t){Ye(this,ko,t),Oe(this,zo).threshold=t}get exposure(){return Oe(this,Wo)}set exposure(t){Ye(this,Wo,t),Oe(this,Xo).exposure=t}get bloomStrength(){return Oe(this,Zo)}set bloomStrength(t){Ye(this,Zo,t),Oe(this,Xo).bloomStrength=t}constructor(t){super(t),Yo.set(this,{writable:!0,value:void 0}),Xo.set(this,{writable:!0,value:void 0}),zo.set(this,{writable:!0,value:void 0}),$o.set(this,{writable:!0,value:void 0}),ko.set(this,{writable:!0,value:void 0}),Wo.set(this,{writable:!0,value:void 0}),Zo.set(this,{writable:!0,value:void 0}),Ye(this,zo,new Do(t)),Ye(this,Yo,new Io(t)),Ye(this,Xo,new Vo(t)),this.blur=20,this.threshold=75,this.exposure=1,this.bloomStrength=1.2}render(t,e,r,n){this.checkSize(t,e),Oe(this,zo).render(t,e,r,n),Oe(this,Yo).render(t,e,r,Oe(this,zo).baseAttachmentView),Oe(this,Xo).blurTexture=Oe(this,Yo).baseAttachmentView,Oe(this,Xo).render(t,e,r,n),this.baseAttachment=Oe(this,Xo).baseAttachment,this.baseAttachmentView=Oe(this,Xo).baseAttachmentView}}var Yo=new WeakMap,Xo=new WeakMap,zo=new WeakMap,$o=new WeakMap,ko=new WeakMap,Wo=new WeakMap,Zo=new WeakMap;Ve(Oo,"vertexShaderGLSL",`\n\t\t${tr.GLSL_VERSION}\n\t\tvoid main() {}\n\t`),Ve(Oo,"fragmentShaderGLSL",`\n\t\t${tr.GLSL_VERSION}\n\t\tvoid main() {}\n\t`),Ve(Oo,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(Oo,"uniformsBindGroupLayoutDescriptor_material",Ki.uniformsBindGroupLayoutDescriptor_material),Ve(Oo,"uniformBufferDescriptor_vertex",hr.uniformBufferDescriptor_empty),Ve(Oo,"uniformBufferDescriptor_fragment",hr.uniformBufferDescriptor_empty);class Ho extends Ki{constructor(t){super(t)}}Ve(Ho,"vertexShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_vertex.systemUniforms}\n    \n\tlayout( location = 0 ) in vec3 position;\n\tlayout( location = 1 ) in vec3 normal;\n\tlayout( location = 2 ) in vec2 uv;\n\tlayout( location = 0 ) out vec3 vNormal;\n\tlayout( location = 1 ) out vec2 vUV;\n\tvoid main() {\n\t\tgl_Position = vec4(position*2.0,1.0);\n\t\tvNormal = normal;\n\t\tvUV = uv;\n\t}\n\t`),Ve(Ho,"fragmentShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_fragment.systemUniforms}\n\tlayout( location = 0 ) in vec3 vNormal;\n\tlayout( location = 1 ) in vec2 vUV;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 1 ) uniform sampler uSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 2 ) uniform texture2D uSourceTexture;\n\tlayout( location = 0 ) out vec4 outColor;\n\tvoid main() {\n\t\tvec2 px = vec2(1.0/systemUniforms.resolution.x, 1.0/systemUniforms.resolution.y);\n\t\tvec4 finalColor = vec4(0.0);\n\t\tfinalColor += texture( sampler2D( uSourceTexture, uSampler ), vUV + vec2(-7.0*px.x, -7.0*px.y) )*0.0044299121055113265;\n\t\tfinalColor += texture( sampler2D( uSourceTexture, uSampler ), vUV + vec2(-6.0*px.x, -6.0*px.y) )*0.00895781211794;\n\t\tfinalColor += texture( sampler2D( uSourceTexture, uSampler ), vUV + vec2(-5.0*px.x, -5.0*px.y) )*0.0215963866053;\n\t\tfinalColor += texture( sampler2D( uSourceTexture, uSampler ), vUV + vec2(-4.0*px.x, -4.0*px.y) )*0.0443683338718;\n\t\tfinalColor += texture( sampler2D( uSourceTexture, uSampler ), vUV + vec2(-3.0*px.x, -3.0*px.y) )*0.0776744219933;\n\t\tfinalColor += texture( sampler2D( uSourceTexture, uSampler ), vUV + vec2(-2.0*px.x, -2.0*px.y) )*0.115876621105;\n\t\tfinalColor += texture( sampler2D( uSourceTexture, uSampler ), vUV + vec2(-1.0*px.x, -1.0*px.y) )*0.147308056121;\n\t\tfinalColor += texture( sampler2D( uSourceTexture, uSampler ), vUV                             )*0.159576912161;\n\t\tfinalColor += texture( sampler2D( uSourceTexture, uSampler ), vUV + vec2( 1.0*px.x,  1.0*px.y) )*0.147308056121;\n\t\tfinalColor += texture( sampler2D( uSourceTexture, uSampler ), vUV + vec2( 2.0*px.x,  2.0*px.y) )*0.115876621105;\n\t\tfinalColor += texture( sampler2D( uSourceTexture, uSampler ), vUV + vec2( 3.0*px.x,  3.0*px.y) )*0.0776744219933;\n\t\tfinalColor += texture( sampler2D( uSourceTexture, uSampler ), vUV + vec2( 4.0*px.x,  4.0*px.y) )*0.0443683338718;\n\t\tfinalColor += texture( sampler2D( uSourceTexture, uSampler ), vUV + vec2( 5.0*px.x,  5.0*px.y) )*0.0215963866053;\n\t\tfinalColor += texture( sampler2D( uSourceTexture, uSampler ), vUV + vec2( 6.0*px.x,  6.0*px.y) )*0.00895781211794;\n\t\tfinalColor += texture( sampler2D( uSourceTexture, uSampler ), vUV + vec2( 7.0*px.x,  7.0*px.y) )*0.0044299121055113265;\n\t\toutColor = finalColor;\n\t}\n`),Ve(Ho,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(Ho,"uniformsBindGroupLayoutDescriptor_material",Ki.uniformsBindGroupLayoutDescriptor_material),Ve(Ho,"uniformBufferDescriptor_vertex",hr.uniformBufferDescriptor_empty),Ve(Ho,"uniformBufferDescriptor_fragment",hr.uniformBufferDescriptor_empty);const qo=new Float32Array(1);class jo extends Ki{constructor(t){super(t),Ve(this,"_centerX",0),Ve(this,"_centerY",0),Ve(this,"_amount",38)}get centerX(){return this._centerX}set centerX(t){this._centerX=t,qo[0]=this._centerX,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.centerX,qo)}get centerY(){return this._centerY}set centerY(t){this._centerY=t,qo[0]=this._centerY,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.centerY,qo)}get amount(){return this._amount}set amount(t){this._amount=t,qo[0]=this._amount,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.amount,qo)}get radius(){return this._radius}}Ve(jo,"vertexShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_vertex.systemUniforms}\n    \n\tlayout( location = 0 ) in vec3 position;\n\tlayout( location = 1 ) in vec3 normal;\n\tlayout( location = 2 ) in vec2 uv;\n\tlayout( location = 0 ) out vec3 vNormal;\n\tlayout( location = 1 ) out vec2 vUV;\n\tvoid main() {\n\t\tvNormal = normal;\n\t\tvUV = uv;\n\t\tgl_Position = vec4(position*2.0,1.0);\n\t}\n\t`),Ve(jo,"fragmentShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_fragment.systemUniforms}\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 0 ) uniform FragmentUniforms {\n        float centerX;\n        float centerY;\n        float amount;\n    } fragmentUniforms;\n\tlayout( location = 0 ) in vec3 vNormal;\n\tlayout( location = 1 ) in vec2 vUV;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 1 ) uniform sampler uSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 2 ) uniform texture2D uSourceTexture;\n\tlayout( location = 0 ) out vec4 outColor;\n\t\n\tfloat random(vec3 scale, float seed) {\n\t\treturn fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n\t}\n\n\tvoid main() {\n\t\tvec4 finalColor = vec4(0.0);\n\t\tvec2 center = vec2( fragmentUniforms.centerX + 0.5, -fragmentUniforms.centerY + 0.5 );\n\t\tvec2 toCenter = center - vUV ;\n\t\tfloat offset = random(vec3(12.9898, 78.233, 151.7182), 0.0);\n\t\tfloat total = 0.0;\n\t\t\n\t\tfor (float t = 0.0; t <= 30.0; t++) {\n\t\t\tfloat percent = (t + offset) / 30.0;\n\t\t\tfloat weight = 3.0 * (percent - percent * percent);\n\t\t\tvec4 color = texture( sampler2D( uSourceTexture, uSampler ), vUV + toCenter * percent * fragmentUniforms.amount / 100.0 );\n\t\t\tcolor.rgb *= color.a;\n\t\t\tfinalColor += color * weight;\n\t\t\ttotal += weight;\n\t\t}\n\t\tfinalColor = finalColor / total;\n\t\tfinalColor.rgb /= finalColor.a + 0.00001;\n\t\toutColor = finalColor;\n\t}\n`),Ve(jo,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(jo,"uniformsBindGroupLayoutDescriptor_material",Ki.uniformsBindGroupLayoutDescriptor_material),Ve(jo,"uniformBufferDescriptor_vertex",hr.uniformBufferDescriptor_empty),Ve(jo,"uniformBufferDescriptor_fragment",[{size:$e.float,valueName:"centerX"},{size:$e.float,valueName:"centerY"},{size:$e.float,valueName:"amount"}]);const Jo=new Float32Array(1);class Qo extends Ki{get focusLength(){return this._focusLength}set focusLength(t){this._focusLength=t,Jo[0]=this._focusLength,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.focusLength,Jo)}constructor(t){super(t),Ve(this,"blurTexture",void 0),Ve(this,"depthTexture",void 0),Ve(this,"_focusLength",15)}resetBindingInfo(){this.entries=[{binding:0,resource:{buffer:this.uniformBuffer_fragment.GPUBuffer,offset:0,size:this.uniformBufferDescriptor_fragment.size}},{binding:1,resource:this.sampler.GPUSampler},{binding:2,resource:this.sourceTexture},{binding:3,resource:this.blurTexture},{binding:4,resource:this.depthTexture}],this._afterResetBindingInfo()}}Ve(Qo,"vertexShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_vertex.systemUniforms}\n    \n\tlayout( location = 0 ) in vec3 position;\n\tlayout( location = 1 ) in vec3 normal;\n\tlayout( location = 2 ) in vec2 uv;\n\tlayout( location = 0 ) out vec3 vNormal;\n\tlayout( location = 1 ) out vec2 vUV;\n\tvoid main() {\n\t\tgl_Position = vec4(position*2.0,1.0);\n\t\tvNormal = normal;\n\t\tvUV = uv;\n\t}\n\t`),Ve(Qo,"fragmentShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_fragment.systemUniforms}\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 0 ) uniform FragmentUniforms {\n        float focusLength;\n    } fragmentUniforms;\n\tlayout( location = 0 ) in vec3 vNormal;\n\tlayout( location = 1 ) in vec2 vUV;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 1 ) uniform sampler uSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 2 ) uniform texture2D uSourceTexture;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 3 ) uniform texture2D uBlurTexture;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 4 ) uniform texture2D uDepthTexture;\n\tlayout( location = 0 ) out vec4 outColor;\n\tvoid main() {\n\t\tvec4 diffuseColor;\n\t\tvec4 blurColor;\n\t\tvec4 depthColor;\n\t\tdiffuseColor = texture( sampler2D( uSourceTexture, uSampler ), vUV );\n\t\tblurColor = texture( sampler2D( uBlurTexture, uSampler ), vUV );\n\t\tdepthColor = texture( sampler2D( uDepthTexture, uSampler ), vUV );\n\t\tdepthColor = depthColor * fragmentUniforms.focusLength;\n\t\t\n\t\tdiffuseColor.rgb *= min(depthColor.g,1.0);\n\t\tblurColor.rgb *= max(1.0 - depthColor.g,0.0);\n\t\toutColor = diffuseColor + blurColor;\n\t}\n`),Ve(Qo,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(Qo,"uniformsBindGroupLayoutDescriptor_material",{entries:[{binding:0,visibility:GPUShaderStage.FRAGMENT,type:"uniform-buffer"},{binding:1,visibility:GPUShaderStage.FRAGMENT,type:"sampler"},{binding:2,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture"},{binding:3,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture"},{binding:4,visibility:GPUShaderStage.FRAGMENT,type:"sampled-texture"}]}),Ve(Qo,"uniformBufferDescriptor_vertex",hr.uniformBufferDescriptor_empty),Ve(Qo,"uniformBufferDescriptor_fragment",[{size:$e.float,valueName:"focusLength"}]);class Ko extends Ki{get blur(){return Oe(this,rs)}set blur(t){Ye(this,rs,t),Oe(this,ts).radius=t}get focusLength(){return Oe(this,ns)}set focusLength(t){Ye(this,ns,t),Oe(this,es).focusLength=t}constructor(t){super(t),ts.set(this,{writable:!0,value:void 0}),es.set(this,{writable:!0,value:void 0}),rs.set(this,{writable:!0,value:void 0}),ns.set(this,{writable:!0,value:void 0}),Ye(this,ts,new Io(t)),Ye(this,es,new Qo(t)),this.blur=5,this.focusLength=15}render(t,e,r,n){this.checkSize(t,e),Oe(this,ts).render(t,e,r,n),Oe(this,es).blurTexture=Oe(this,ts).baseAttachmentView,Oe(this,es).depthTexture=e.baseAttachment_mouseColorID_depth_ResolveTargetView,Oe(this,es).render(t,e,r,n),this.baseAttachment=Oe(this,es).baseAttachment,this.baseAttachmentView=Oe(this,es).baseAttachmentView}}var ts=new WeakMap,es=new WeakMap,rs=new WeakMap,ns=new WeakMap;Ve(Ko,"vertexShaderGLSL",`\n\t\t${tr.GLSL_VERSION}\n\t\tvoid main() {}\n\t`),Ve(Ko,"fragmentShaderGLSL",`\n\t\t${tr.GLSL_VERSION}\n\t\tvoid main() {}\n\t`),Ve(Ko,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(Ko,"uniformsBindGroupLayoutDescriptor_material",Ki.uniformsBindGroupLayoutDescriptor_material),Ve(Ko,"uniformBufferDescriptor_vertex",hr.uniformBufferDescriptor_empty),Ve(Ko,"uniformBufferDescriptor_fragment",hr.uniformBufferDescriptor_empty);const is=new Float32Array(1);class as extends Ki{get centerX(){return this._centerX}set centerX(t){this._centerX=t,is[0]=this._centerX,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.centerX,is)}get centerY(){return this._centerY}set centerY(t){this._centerY=t,is[0]=this._centerY,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.centerY,is)}get angle(){return this._angle}set angle(t){this._angle=t,is[0]=this._angle,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.angle,is)}get radius(){return this._radius}set radius(t){this._radius=t,is[0]=this._radius,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.radius,is)}get grayMode(){return this._grayMode}set grayMode(t){this._grayMode=t?1:0,is[0]=this._grayMode?1:0,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.grayMode,is)}constructor(t){super(t),Ve(this,"_centerX",0),Ve(this,"_centerY",0),Ve(this,"_angle",0),Ve(this,"_radius",2),Ve(this,"_grayMode",0)}}Ve(as,"vertexShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_vertex.systemUniforms}\n    \n\tlayout( location = 0 ) in vec3 position;\n\tlayout( location = 1 ) in vec3 normal;\n\tlayout( location = 2 ) in vec2 uv;\n\tlayout( location = 0 ) out vec3 vNormal;\n\tlayout( location = 1 ) out vec2 vUV;\n\tvoid main() {\n\t\tvNormal = normal;\n\t\tvUV = uv;\n\t\tgl_Position = vec4(position*2.0,1.0);\n\t}\n\t`),Ve(as,"fragmentShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_fragment.systemUniforms}\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 0 ) uniform FragmentUniforms {\n        float centerX;\n        float centerY;\n        float angle;\n        float radius;\n        float grayMode;\n    } fragmentUniforms;\n\tlayout( location = 0 ) in vec3 vNormal;\n\tlayout( location = 1 ) in vec2 vUV;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 1 ) uniform sampler uSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 2 ) uniform texture2D uSourceTexture;\n\tlayout( location = 0 ) out vec4 outColor;\n\t\n\tfloat pattern(float angle) {\n\t\tangle = angle * 3.141592653589793/180.0;\n\t\tfloat s = sin(angle), c = cos(angle);\n\t\tvec2 tex = vUV;\n\t\ttex.x -= fragmentUniforms.centerX + 0.5;\n\t\ttex.y -= fragmentUniforms.centerY + 0.5;\n\t\tvec2 point = vec2(\n\t\t\tc * tex.x - s * tex.y,\n\t\t\ts * tex.x + c * tex.y\n\t\t) * systemUniforms.resolution /fragmentUniforms.radius;\n\t\treturn (sin(point.x) * sin(point.y)) * 4.0;\n\t}\n\n\tvoid main() {\n\t\tvec4 finalColor = texture( sampler2D( uSourceTexture, uSampler ), vUV );\n\t\tif(fragmentUniforms.grayMode == 1.0) {\n\t\t\tfloat average = (finalColor.r + finalColor.g + finalColor.b) / 3.0;\n\t\t\tfinalColor = vec4(vec3(average * 10.0 - 5.0 + pattern(fragmentUniforms.angle)), finalColor.a);\n\t\t}else{\n\t\t\tvec3 cmy = 1.0 - finalColor.rgb;\n\t\t\tfloat k = min(cmy.x, min(cmy.y, cmy.z));\n\t\t\tcmy = (cmy - k) / (1.0 - k);\n\t\t\tcmy = clamp(cmy * 10.0 - 3.0 + vec3(pattern(fragmentUniforms.angle + 0.26179), pattern(fragmentUniforms.angle + 1.30899), pattern(fragmentUniforms.angle)), 0.0, 1.0);\n\t\t\tk = clamp(k * 10.0 - 5.0 + pattern(fragmentUniforms.angle + 0.78539), 0.0, 1.0);\n\t\t\tfinalColor = vec4(1.0 - cmy - k, finalColor.a);\n\t\t}\n\t\toutColor = finalColor;\n\t}\n`),Ve(as,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(as,"uniformsBindGroupLayoutDescriptor_material",Ki.uniformsBindGroupLayoutDescriptor_material),Ve(as,"uniformBufferDescriptor_vertex",hr.uniformBufferDescriptor_empty),Ve(as,"uniformBufferDescriptor_fragment",[{size:$e.float,valueName:"centerX"},{size:$e.float,valueName:"centerY"},{size:$e.float,valueName:"angle"},{size:$e.float,valueName:"radius"},{size:$e.float,valueName:"grayMode"}]);const os=new Float32Array(1);class ss extends Ki{get width(){return this._width}set width(t){this._width=t,os[0]=this._width,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.width,os)}get height(){return this._height}set height(t){this._height=t,os[0]=this._height,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.height,os)}constructor(t){super(t),Ve(this,"_width",5),Ve(this,"_height",5)}}Ve(ss,"vertexShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_vertex.systemUniforms}\n    \n\tlayout( location = 0 ) in vec3 position;\n\tlayout( location = 1 ) in vec3 normal;\n\tlayout( location = 2 ) in vec2 uv;\n\tlayout( location = 0 ) out vec3 vNormal;\n\tlayout( location = 1 ) out vec2 vUV;\n\tvoid main() {\n\t\tvNormal = normal;\n\t\tvUV = uv;\n\t\tgl_Position = vec4(position*2.0,1.0);\n\t}\n\t`),Ve(ss,"fragmentShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_fragment.systemUniforms}\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 0 ) uniform FragmentUniforms {\n        float width;\n        float height;\n    } fragmentUniforms;\n\tlayout( location = 0 ) in vec3 vNormal;\n\tlayout( location = 1 ) in vec2 vUV;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 1 ) uniform sampler uSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 2 ) uniform texture2D uSourceTexture;\n\tlayout( location = 0 ) out vec4 outColor;\n\tvoid main() {\n\t\tvec4 finalColor;\n\t\tfloat dx = 1.0/systemUniforms.resolution.x * fragmentUniforms.width;\n\t\tfloat dy = 1.0/systemUniforms.resolution.y * fragmentUniforms.height;\n\t\tvec2 coord = vec2(\n\t\t\tdx * (floor(vUV.x / dx) + 0.5),\n\t\t\tdy * (floor(vUV.y / dy) + 0.5)\n\t\t);\n\t\tfinalColor = texture( sampler2D( uSourceTexture, uSampler ), coord );\n\t\toutColor = finalColor;\n\t}\n`),Ve(ss,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(ss,"uniformsBindGroupLayoutDescriptor_material",Ki.uniformsBindGroupLayoutDescriptor_material),Ve(ss,"uniformBufferDescriptor_vertex",hr.uniformBufferDescriptor_empty),Ve(ss,"uniformBufferDescriptor_fragment",[{size:$e.float,valueName:"width"},{size:$e.float,valueName:"height"}]);const us=new Float32Array(1);class ls extends Ki{get kernel(){return this._kernel}set kernel(t){this._kernel=t,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.kernel,this._kernel),this.kernelWeight=1}get kernelWeight(){return this._kernelWeight}set kernelWeight(t){let e=0,r=this._kernel.length;for(;r--;)e+=this._kernel[r];this._kernelWeight=e,us[0]=e,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.kernelWeight,us)}constructor(t,e=ls.NORMAL){super(t),Ve(this,"_kernel",void 0),Ve(this,"_kernelWeight",void 0),this.kernel=e}}Ve(ls,"vertexShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_vertex.systemUniforms}\n    \n\tlayout( location = 0 ) in vec3 position;\n\tlayout( location = 1 ) in vec3 normal;\n\tlayout( location = 2 ) in vec2 uv;\n\tlayout( location = 0 ) out vec3 vNormal;\n\tlayout( location = 1 ) out vec2 vUV;\n\tlayout( location = 2 ) out float vTime;\n\tvoid main() {\n\t\tvNormal = normal;\n\t\tvUV = uv;\n\t\tvTime = systemUniforms.time;\n\t\tgl_Position = vec4(position*2.0,1.0);\n\t}\n\t`),Ve(ls,"fragmentShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_fragment.systemUniforms}\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 0 ) uniform FragmentUniforms {\n        float kernelWeight;\n        mat3 kernel;\n    } fragmentUniforms;\n\tlayout( location = 0 ) in vec3 vNormal;\n\tlayout( location = 1 ) in vec2 vUV;\n\tlayout( location = 2 ) in float vTime;\n\tlayout( set = ${tr.SET_INDEX_VertexUniforms}, binding = 1 ) uniform sampler uSampler;\n\tlayout( set = ${tr.SET_INDEX_VertexUniforms}, binding = 2 ) uniform texture2D uSourceTexture;\n\tlayout( location = 0 ) out vec4 outColor;\n\t\n\tvoid main() {\n\n\t\tvec2 perPX = vec2(1.0/systemUniforms.resolution.x, 1.0/systemUniforms.resolution.y);\n\t\tvec4 finalColor = vec4(0.0);\n\t\tfinalColor += texture( sampler2D( uSourceTexture, uSampler ), vUV + perPX * vec2(-1.0, -1.0)) * fragmentUniforms.kernel[0][0] ;\n\t\tfinalColor += texture( sampler2D( uSourceTexture, uSampler ), vUV + perPX * vec2( 0.0, -1.0)) * fragmentUniforms.kernel[0][1] ;\n\t\tfinalColor += texture( sampler2D( uSourceTexture, uSampler ), vUV + perPX * vec2( 1.0, -1.0)) * fragmentUniforms.kernel[0][2] ;\n\t\tfinalColor += texture( sampler2D( uSourceTexture, uSampler ), vUV + perPX * vec2(-1.0,  0.0)) * fragmentUniforms.kernel[1][0] ;\n\t\tfinalColor += texture( sampler2D( uSourceTexture, uSampler ), vUV + perPX * vec2( 0.0,  0.0)) * fragmentUniforms.kernel[1][1] ;\n\t\tfinalColor += texture( sampler2D( uSourceTexture, uSampler ), vUV + perPX * vec2( 1.0,  0.0)) * fragmentUniforms.kernel[1][2] ;\n\t\tfinalColor += texture( sampler2D( uSourceTexture, uSampler ), vUV + perPX * vec2(-1.0,  1.0)) * fragmentUniforms.kernel[2][0] ;\n\t\tfinalColor += texture( sampler2D( uSourceTexture, uSampler ), vUV + perPX * vec2( 0.0,  1.0)) * fragmentUniforms.kernel[2][1] ;\n\t\tfinalColor += texture( sampler2D( uSourceTexture, uSampler ), vUV + perPX * vec2( 1.0,  1.0)) * fragmentUniforms.kernel[2][2] ;\n\t\n\t\toutColor = vec4((finalColor / fragmentUniforms.kernelWeight).rgb, 1.0);\n\t}\n`),Ve(ls,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(ls,"uniformsBindGroupLayoutDescriptor_material",Ki.uniformsBindGroupLayoutDescriptor_material),Ve(ls,"uniformBufferDescriptor_vertex",hr.uniformBufferDescriptor_empty),Ve(ls,"uniformBufferDescriptor_fragment",[{size:$e.float,valueName:"kernelWeight"},{size:$e.mat3,valueName:"kernel"}]),Ve(ls,"NORMAL",new Float32Array([0,0,0,0,0,1,0,0,0,0,0,0])),Ve(ls,"SHARPEN",new Float32Array([0,-1,0,0,-1,5,-1,0,0,-1,0,0])),Ve(ls,"BLUR",new Float32Array([1,1,1,0,1,1,1,0,1,1,1,0])),Ve(ls,"EDGE",new Float32Array([0,1,0,0,1,-4,1,0,0,1,0,0])),Ve(ls,"EMBOSS",new Float32Array([-2,-1,0,0,-1,1,1,0,0,1,2,0]));const fs=new Float32Array(1);class ms extends Ki{get scanlineIntensity(){return this._scanlineIntensity}set scanlineIntensity(t){this._scanlineIntensity=t,fs[0]=this._scanlineIntensity,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.scanlineIntensity,fs)}get noiseIntensity(){return this._noiseIntensity}set noiseIntensity(t){this._noiseIntensity=t,fs[0]=this._noiseIntensity,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.noiseIntensity,fs)}get scanlineCount(){return this._scanlineCount}set scanlineCount(t){this._scanlineCount=t,fs[0]=this._scanlineCount,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.scanlineCount,fs)}get grayMode(){return this._grayMode}set grayMode(t){this._grayMode=t,fs[0]=this._grayMode?1:0,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.grayMode,fs)}constructor(t){super(t),Ve(this,"_scanlineIntensity",.5),Ve(this,"_noiseIntensity",.5),Ve(this,"_scanlineCount",2048),Ve(this,"_grayMode",!1)}}Ve(ms,"vertexShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_vertex.systemUniforms}\n    \n\tlayout( location = 0 ) in vec3 position;\n\tlayout( location = 1 ) in vec3 normal;\n\tlayout( location = 2 ) in vec2 uv;\n\tlayout( location = 0 ) out vec3 vNormal;\n\tlayout( location = 1 ) out vec2 vUV;\n\tlayout( location = 2 ) out float vTime;\n\tvoid main() {\n\t\tvNormal = normal;\n\t\tvUV = uv;\n\t\tvTime = systemUniforms.time;\n\t\tgl_Position = vec4(position*2.0,1.0);\n\t}\n\t`),Ve(ms,"fragmentShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_fragment.systemUniforms}\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 0 ) uniform FragmentUniforms {\n        float scanlineIntensity;\n        float noiseIntensity;\n        float scanlineCount;\n        float grayMode;\n    } fragmentUniforms;\n\tlayout( location = 0 ) in vec3 vNormal;\n\tlayout( location = 1 ) in vec2 vUV;\n\tlayout( location = 2 ) in float vTime;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 1 ) uniform sampler uSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 2 ) uniform texture2D uSourceTexture;\n\tlayout( location = 0 ) out vec4 outColor;\n\t\n\tfloat random(vec3 scale, float seed) {\n\t\treturn fract(sin(dot(gl_FragCoord.xyz + seed, scale)) * 43758.5453 + seed);\n\t}\n\n\tvoid main() {\n\n\t\tvec4 diffuseColor = texture( sampler2D( uSourceTexture, uSampler ), vUV );\n\n\t\t// make some noise\n\t\tfloat x = vUV.x * vUV.y * vTime;\n\t\tx = mod( x, 13.0 ) * mod( x, 123.0 );\n\t\tfloat dx = mod( x, 0.01 );\n\t\t\n\t\t// add noise\n\t\tvec3 finalColor = diffuseColor.rgb + diffuseColor.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );\n\t\t\n\t\t// get us a sine and cosine\n\t\tvec2 sc = vec2( sin( vUV.y * fragmentUniforms.scanlineCount ), cos( vUV.y * fragmentUniforms.scanlineCount ) );\n\t\t\n\t\t// add scanlines\n\t\tfinalColor += diffuseColor.rgb * vec3( sc.x, sc.y, sc.x ) * fragmentUniforms.scanlineIntensity;\n\t\t\n\t\t// interpolate between source and result by intensity\n\t\tfinalColor = diffuseColor.rgb + clamp( fragmentUniforms.noiseIntensity, 0.0, 1.0 ) * ( finalColor - diffuseColor.rgb );\n\t\t\n\t\t// convert to grayscale if desired\n\t\tif(fragmentUniforms.grayMode == 1.0) finalColor = vec3( finalColor.r * 0.3 + finalColor.g * 0.59 + finalColor.b * 0.11 );\n\t\toutColor = vec4( finalColor, diffuseColor.a );\n\t}\n`),Ve(ms,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(ms,"uniformsBindGroupLayoutDescriptor_material",Ki.uniformsBindGroupLayoutDescriptor_material),Ve(ms,"uniformBufferDescriptor_vertex",hr.uniformBufferDescriptor_empty),Ve(ms,"uniformBufferDescriptor_fragment",[{size:$e.float,valueName:"scanlineIntensity"},{size:$e.float,valueName:"noiseIntensity"},{size:$e.float,valueName:"scanlineCount"},{size:$e.float,valueName:"grayMode"}]);const cs=new Float32Array(1);class hs extends Ki{get intensity(){return this._intensity}set intensity(t){this._intensity=t,cs[0]=this._intensity,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.intensity,cs)}get size(){return this._size}set size(t){this._size=t,cs[0]=this._size,this.uniformBuffer_fragment.GPUBuffer.setSubData(this.uniformBufferDescriptor_fragment.redStructOffsetMap.size,cs)}constructor(t){super(t),Ve(this,"_intensity",.85),Ve(this,"_size",.1)}}Ve(hs,"vertexShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_vertex.systemUniforms}\n    \n\tlayout( location = 0 ) in vec3 position;\n\tlayout( location = 1 ) in vec3 normal;\n\tlayout( location = 2 ) in vec2 uv;\n\tlayout( location = 0 ) out vec3 vNormal;\n\tlayout( location = 1 ) out vec2 vUV;\n\tvoid main() {\n\t\tvNormal = normal;\n\t\tvUV = uv;\n\t\tgl_Position = vec4(position*2.0,1.0);\n\t}\n\t`),Ve(hs,"fragmentShaderGLSL",`\n\t${tr.GLSL_VERSION}\n\t${tr.GLSL_SystemUniforms_fragment.systemUniforms}\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 0 ) uniform FragmentUniforms {\n        float intensity;\n        float size;\n    } fragmentUniforms;\n\tlayout( location = 0 ) in vec3 vNormal;\n\tlayout( location = 1 ) in vec2 vUV;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 1 ) uniform sampler uSampler;\n\tlayout( set = ${tr.SET_INDEX_FragmentUniforms}, binding = 2 ) uniform texture2D uSourceTexture;\n\tlayout( location = 0 ) out vec4 outColor;\n\n\tvoid main() {\n\t\tvec4 finalColor = texture( sampler2D( uSourceTexture, uSampler ), vUV );\n\t\tfloat dist = distance(vUV, vec2(0.5, 0.5));\n\t\tfinalColor.rgb *= smoothstep(0.8, fragmentUniforms.size * 0.799, dist * ( fragmentUniforms.intensity + fragmentUniforms.size ));\n\t\toutColor = finalColor;\n\t}\n`),Ve(hs,"PROGRAM_OPTION_LIST",{vertex:[],fragment:[]}),Ve(hs,"uniformsBindGroupLayoutDescriptor_material",Ki.uniformsBindGroupLayoutDescriptor_material),Ve(hs,"uniformBufferDescriptor_vertex",hr.uniformBufferDescriptor_empty),Ve(hs,"uniformBufferDescriptor_fragment",[{size:$e.float,valueName:"intensity"},{size:$e.float,valueName:"size"}]);var ds=new WeakMap,ps=new WeakMap,vs=new WeakMap,_s=new WeakMap,gs=new WeakMap,xs=new WeakMap,ys=new WeakMap,Ss=new WeakMap,Ts=new WeakMap,Us=new WeakMap;const RedGPU={glMatrix:Ae,DetectorGPU:Je,UUID:ze,Mix:Er,baseGeometry:Ti,BaseLight:_a,BaseMaterial:hr,DisplayContainer:cn,BaseObject3D:kn,ShareGLSL:tr,BasePostEffect:Ki,BaseTexture:Kn,PipelineBasic:hn,BindGroup:fr,Buffer:bi,UniformBuffer:fn,UniformBufferDescriptor:je,Camera2D:qi,Camera3D:ci,ObitController:class extends ci{get needUpdate(){return Oe(this,Ra)}set needUpdate(t){Ye(this,Ra,t)}get centerX(){return Oe(this,xa)}set centerX(t){Ye(this,xa,t)}get centerY(){return Oe(this,ya)}set centerY(t){Ye(this,ya,t)}get centerZ(){return Oe(this,Sa)}set centerZ(t){Ye(this,Sa,t)}get distance(){return Oe(this,Ta)}set distance(t){Ye(this,Ta,t)}get speedDistance(){return Oe(this,Ua)}set speedDistance(t){Ye(this,Ua,t)}get delayDistance(){return Oe(this,ba)}set delayDistance(t){Ye(this,ba,t)}get speedRotation(){return Oe(this,Ma)}set speedRotation(t){Ye(this,Ma,t)}get delayRotation(){return Oe(this,Pa)}set delayRotation(t){Ye(this,Pa,t)}get minTilt(){return Oe(this,Ea)}set minTilt(t){Ye(this,Ea,t)}get maxTilt(){return Oe(this,Ga)}set maxTilt(t){Ye(this,Ga,t)}get pan(){return Oe(this,Da)}set pan(t){Ye(this,Da,t)}get tilt(){return Oe(this,wa)}set tilt(t){Ye(this,wa,t)}constructor(t){super(t),xa.set(this,{writable:!0,value:0}),ya.set(this,{writable:!0,value:0}),Sa.set(this,{writable:!0,value:0}),Ta.set(this,{writable:!0,value:10}),Ua.set(this,{writable:!0,value:1}),ba.set(this,{writable:!0,value:.1}),Ma.set(this,{writable:!0,value:3}),Pa.set(this,{writable:!0,value:.1}),wa.set(this,{writable:!0,value:-45}),Ea.set(this,{writable:!0,value:-90}),Ga.set(this,{writable:!0,value:90}),Da.set(this,{writable:!0,value:0}),La.set(this,{writable:!0,value:0}),Ba.set(this,{writable:!0,value:0}),Ve(this,"currentDistance",0),Ra.set(this,{writable:!0,value:!0}),Ve(this,"targetView",void 0),(e=>{let r,n,i,a,o,s,u,l,f,m,c,h,d,p;p=t=>{let e=this.targetView;if(e){let r,n,i=e.viewRect;if(r=t[f],n=t[m],!(i[0]<r&&r<i[0]+i[2]))return;if(!(i[1]<n&&n<i[1]+i[3]))return}return!0},c=t.detector.move,h=t.detector.up,d=t.detector.down,o=0,s=0,u=0,l=0,f="layerX",m="layerY",r=e=>{p(e)&&Oe(this,Ra)&&(o=e[f],s=e[m],t.canvas.addEventListener(c,n),window.addEventListener(h,i))},n=t=>{p(t)&&Oe(this,Ra)&&(u=t[f]-o,l=t[m]-s,o=t[f],s=t[m],Ye(this,Da,Oe(this,Da)-u*Oe(this,Ma)*.1),Ye(this,wa,Oe(this,wa)-l*Oe(this,Ma)*.1))},i=e=>{t.canvas.removeEventListener(c,n),window.removeEventListener(h,i)},a=t=>{if(Oe(this,Ra)){if(!p(t))return;Ye(this,Ta,Oe(this,Ta)+t.deltaY/100*Oe(this,Ua))}},t.canvas.addEventListener(d,r),t.canvas.addEventListener("wheel",a)})()}update(t){let e,r,n;n=Math.PI/180,Oe(this,Ra)&&(Oe(this,wa)<Oe(this,Ea)&&Ye(this,wa,Oe(this,Ea)),Oe(this,wa)>Oe(this,Ga)&&Ye(this,wa,Oe(this,Ga)),e=Oe(this,Pa),r=this.matrix,Ye(this,La,Oe(this,La)+(Oe(this,Da)-Oe(this,La))*e),Ye(this,Ba,Oe(this,Ba)+(Oe(this,wa)-Oe(this,Ba))*e),Oe(this,Ta)<this.nearClipping&&Ye(this,Ta,this.nearClipping),this.currentDistance+=(Oe(this,Ta)-this.currentDistance)*Oe(this,ba),this.currentDistance<this.nearClipping&&(this.currentDistance=this.nearClipping),Ae.mat4.identity(r),Ae.mat4.translate(r,r,[Oe(this,xa),Oe(this,ya),Oe(this,Sa)]),Ae.mat4.rotateY(r,r,Oe(this,La)*n),Ae.mat4.rotateX(r,r,Oe(this,Ba)*n),Ae.mat4.translate(r,r,[0,0,this.currentDistance]),this.x=r[12],this.y=r[13],this.z=r[14],this.lookAt(Oe(this,xa),Oe(this,ya),Oe(this,Sa)))}},Geometry:Ui,InterleaveInfo:Si,AmbientLight:Ca,DirectionalLight:Va,PointLight:Ya,SpotLight:za,GLTFLoader:Ri,TextureLoader:si,GridMaterial:Xr,PBRMaterial_System:xi,SkyBoxMaterial:zr,BitmapMaterial:Yr,ColorMaterial:Br,ColorPhongMaterial:Rr,ColorPhongTextureMaterial:Ir,SpriteSheetAction:class extends ze{constructor(t,e=60,r=1,n=1,i=1){super(),this.texture=t,this.frameRate=e,this.segmentW=r,this.segmentH=n,this.totalFrame=i}},SpriteSheetMaterial:jr,Sprite3DMaterial:qa,EnvironmentMaterial:Ar,RefractionMaterial:Wa,StandardMaterial:Dr,Axis:class extends kn{constructor(t){let e,r,n,i,a,o,s;super(t),n=new Ja(t),i=new Fa(t,0,.5),a=new Br(t,"#ff0000"),o=new Br(t,"#00ff00"),s=new Br(t,"#0000ff"),e=new qn(t,i,a),r=new qn(t,n,a),r.setScale(5,.1,.1),e.x=5,e.rotationZ=90,r.x=2.5,this.addChild(r,e),e=new qn(t,i,o),r=new qn(t,n,o),r.setScale(.1,5,.1),e.y=5,r.y=2.5,this.addChild(r,e),e=new qn(t,i,s),r=new qn(t,n,s),r.setScale(.1,.1,5),e.z=5,e.rotationX=-90,r.z=2.5,this.addChild(r,e),this.addChild(new qn(t,new Ia(t,.25,16,16,16),new Br(t,"#ff00ff")))}},Grid:class extends kn{get color(){return Oe(this,ro)}set color(t){Ye(this,ro,t),this.makeGridGeometry()}get centerColor(){return Oe(this,eo)}set centerColor(t){Ye(this,eo,t),this.makeGridGeometry()}get divisions(){return Oe(this,to)}set divisions(t){Ye(this,to,t),this.makeGridGeometry()}get size(){return Oe(this,Ka)}set size(t){Ye(this,Ka,t),this.makeGridGeometry()}constructor(t,e=100,r=100,n="#cccccc",i="#666666"){super(t),Ka.set(this,{writable:!0,value:100}),to.set(this,{writable:!0,value:100}),eo.set(this,{writable:!0,value:"#cccccc"}),ro.set(this,{writable:!0,value:"#666666"}),no.set(this,{writable:!0,value:void 0}),Ye(this,no,t),this.size=e,this.divisions=r,this.centerColor=n,this.color=i,this.makeGridGeometry(),this.material=new Xr(t),this.primitiveTopology="line-list"}makeGridGeometry(){let t,e,r,n,i,a,o=Oe(this,no),s=[];for(t=this.divisions/2,e=this.size/this.divisions,r=this.size/2,n=0,i=-r;n<=this.divisions;n++,i+=e)a=n===t?qe.hexToRGB_ZeroToOne(this.centerColor):qe.hexToRGB_ZeroToOne(this.color),s.push(-r,0,i,a[0],a[1],a[2],1,r,0,i,a[0],a[1],a[2],1,i,0,-r,a[0],a[1],a[2],1,i,0,r,a[0],a[1],a[2],1);this.geometry=new Ui(o,new bi(o,"gridInterleaveBuffer_"+this.size+"_"+this.divisions+"_"+this.centerColor+"_"+this.color,bi.TYPE_VERTEX,new Float32Array(s),[new Si("vertexPosition","float3"),new Si("vertexColor","float4")]))}},Mesh:qn,SkyBox:class extends kn{constructor(t,e){super(t),this.geometry=new Ja(t),this.material=new zr(t,e),this.cullMode="front"}},Sprite3D:class extends kn{set material(t){t instanceof qa?(this._material=t,this.dirtyPipeline=!0):qe.throwFunc(`addChild - only allow Sprite3DMaterial Instance. - inputValue : ${t} { type : ${typeof t} }`)}get material(){return this._material}get rotationX(){return this._rotationX}set rotationX(t){}get rotationY(){return this._rotationY}set rotationY(t){}get rotationZ(){return this._rotationZ}set rotationZ(t){}get useFixedScale(){return this.material.useFixedScale}set useFixedScale(t){this.material.useFixedScale=t}constructor(t,e,r){super(t),this.geometry=e,this.material=r,this.cullMode="none",this.renderDrawLayerIndex=va.DRAW_LAYER_INDEX2_Z_POINT_SORT}addChild(t){}},Text:class extends kn{get height(){return this._height}set height(t){this.material.height=this._height=t<2?2:t,po(this)}get width(){return this._width}set width(t){this.material.width=this._width=t<2?2:t,po(this)}get useFixedScale(){return this.material.useFixedScale}set useFixedScale(t){this.material.useFixedScale=t}get useSprite3DMode(){return this.material.useSprite3DMode}set useSprite3DMode(t){this.material.useSprite3DMode=t}constructor(t,e=256,r=128){super(t),Ve(this,"_cvs",void 0),Ve(this,"_ctx",void 0),Ve(this,"_svg",void 0),Ve(this,"_img",void 0),Ve(this,"_width",256),Ve(this,"_height",128),this.renderDrawLayerIndex=va.DRAW_LAYER_INDEX2_Z_POINT_SORT,e>1920&&(e=1920),r>1920&&(r=1920),this._cvs=new OffscreenCanvas(e,r),this._ctx=this._cvs.getContext("2d"),this._svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this._svg.setAttribute("xmlns","http://www.w3.org/2000/svg"),this._svg.style="position:absolute;top:0px;left:0px;text-align:center;z-index:10",this._svg.innerHTML='<foreignObject  width="100%" style="position:absolute;top:0;left:0">   <table xmlns="http://www.w3.org/1999/xhtml" style="border-collapse: collapse;position:table;top:0;left:0;width:100%;table-layout:fixed">       <tr xmlns="http://www.w3.org/1999/xhtml">       <td xmlns="http://www.w3.org/1999/xhtml"  > </td>       </tr>   </table></foreignObject>',this.geometry=new Vi(t),this.material=new Wr(t),this.cullMode="none",this.depthWriteEnabled=!1,this._img=new Image,this.width=e,this.height=r,io(this,"padding",0),io(this,"background",""),io(this,"color","#000"),io(this,"fontFamily","Arial"),io(this,"fontSize",22),io(this,"fontWeight","normal"),io(this,"fontStyle","normal"),io(this,"lineHeight",33),io(this,"letterSpacing",0),io(this,"wordBreak","break-all"),io(this,"verticalAlign","middle"),io(this,"textAlign","center"),this._img.onload=e=>{let r,n;r=this._width,n=this._height,this._cvs.width=r,this._cvs.height=n,this._ctx.clearRect(0,0,r,n),this._ctx.drawImage(this._img,0,0,r,n),this.material.width=r,this.material.height=n,this._cvs.convertToBlob().then(e=>{new ii(t,URL.createObjectURL(e),{magFilter:"linear",minFilter:"linear",mipmapFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"repeat"},!0,t=>{this.material.diffuseTexture&&this.material.diffuseTexture.GPUTexture.destroy(),this.material.diffuseTexture=t})})}}addChild(t){}set material(t){t instanceof Wr?(this._material=t,this.dirtyPipeline=!0):qe.throwFunc(`addChild - only allow TextMaterial Instance. - inputValue : ${t} { type : ${typeof t} }`)}get material(){return this._material}get text(){return this._text}set text(t){ao=this._svg,oo=ao.querySelector("foreignObject td"),t=t.toString(),this._text=t.replace(/\<br\>/gi,"<div/>");let e=this,r=this._text.match(/<img .*?>/g),n=[],i=this._text;r=r||[];let a=r.length,o=0;r.forEach((function(t){let r=t.match(/src\s*=\s*(\'|\").*?(\'|\")/g)[0];r=r.replace(/src\s*=\s*(\'|\")/g,"").replace(/(\'|\")/g,"");let s=document.createElement("div");s.innerHTML=t;let u=s.querySelector("img");u.onload=function(){let t=document.createElement("canvas");t.width=u.style.width?+u.style.width:u.width,t.height=u.style.height?+u.style.height:u.height;let r=t.getContext("2d");r.scale(t.width/u.naturalWidth,t.height/u.naturalHeight),r.drawImage(u,0,0),l.result='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink= "http://www.w3.org/1999/xlink" width="'+u.width+'" height="'+u.height+'" display="inline" style="vertical-align: middle;display: inline-block"><image xlink:href="'+t.toDataURL("image/png")+'" height="'+u.height+'px" width="'+u.width+'px" /></svg>',o++,o==a&&(n.forEach((function(t){i=i.replace(t.source,t.result)})),oo.innerHTML=i,po(e)),u.onload=null};let l={source:t,sourceSrc:r,result:""};n.push(l)})),0==r.length&&(oo.innerHTML=i,po(this))}},Line:_o,Particle:Wi,PostEffect_BrightnessContrast:bo,PostEffect_Gray:Mo,PostEffect_HueSaturation:wo,PostEffect_Invert:Eo,PostEffect_Threshold:Do,PostEffect_Bloom:Oo,PostEffect_Bloom_blend:Vo,PostEffect_Blur:Ho,PostEffect_BlurX:Bo,PostEffect_BlurY:Co,PostEffect_GaussianBlur:Io,PostEffect_ZoomBlur:jo,PostEffect_DoF:Ko,PostEffect_DoF_blend:Qo,PostEffect_HalfTone:as,PostEffect_Pixelize:ss,PostEffect:vn,PostEffect_Convolution:ls,PostEffect_Film:ms,PostEffect_Vignetting:hs,Box:Ja,Cylinder:Fa,Plane:Vi,Sphere:Ia,Render:va,Debugger:Ai,CopyBufferToTexture:Qn,ImageLoader:Jn,BitmapCubeTexture:oi,BitmapTexture:ii,Sampler:en,ShaderModule_GLSL:ur,TypeSize:$e,UTILColor:ke,UTILMath:Ze,UTIL:qe,RedGPUContext:on,Scene:class extends cn{get grid(){return Oe(this,Ss)}set grid(t){Ye(this,Ss,t)}get axis(){return Oe(this,Ts)}set axis(t){Ye(this,Ts,t)}get skyBox(){return Oe(this,Us)}set skyBox(t){Ye(this,Us,t)}get backgroundColor(){return Oe(this,ds)}set backgroundColor(t){Ye(this,ds,t);let e=qe.hexToRGB_ZeroToOne(t);Ye(this,vs,[e[0]*Oe(this,ps),e[1]*Oe(this,ps),e[2]*Oe(this,ps),Oe(this,ps)])}get backgroundColorAlpha(){return Oe(this,ps)}set backgroundColorAlpha(t){Ye(this,ps,t);let e=qe.hexToRGB_ZeroToOne(Oe(this,ds));Ye(this,vs,[e[0]*Oe(this,ps),e[1]*Oe(this,ps),e[2]*Oe(this,ps),Oe(this,ps)])}get backgroundColorRGBA(){return Oe(this,vs)}get directionalLightList(){return Oe(this,_s)}get pointLightList(){return Oe(this,gs)}get ambientLight(){return Oe(this,ys)}get spotLightList(){return Oe(this,xs)}constructor(){super(),ds.set(this,{writable:!0,value:"#000"}),ps.set(this,{writable:!0,value:1}),vs.set(this,{writable:!0,value:[0,0,0,Oe(this,ps)]}),_s.set(this,{writable:!0,value:[]}),gs.set(this,{writable:!0,value:[]}),xs.set(this,{writable:!0,value:[]}),ys.set(this,{writable:!0,value:void 0}),Ss.set(this,{writable:!0,value:void 0}),Ts.set(this,{writable:!0,value:void 0}),Us.set(this,{writable:!0,value:void 0}),Ve(this,"_flatChildList",[])}addLight(t){switch(t.constructor){case Va:Oe(this,_s).length===tr.MAX_DIRECTIONAL_LIGHT&&qe.throwFunc(`addLight : DirectionalLight - Up to ${tr.MAX_DIRECTIONAL_LIGHT} are allowed.`),Oe(this,_s).push(t);break;case Ya:Oe(this,gs).length===tr.MAX_POINT_LIGHT&&qe.throwFunc(`addLight : PointLight - Up to ${tr.MAX_POINT_LIGHT} are allowed.`),Oe(this,gs).push(t);break;case za:qe.throwFunc("addLight : spotLightList -아직사용할 수없는 유형의 라이트");break;case Ca:Ye(this,ys,t);break;default:qe.throwFunc(`addLight : only allow BaseLight Instance - inputValue : ${t} { type : ${typeof t} }`)}}removeLight(t){let e;switch(t.constructor){case Va:e=Oe(this,_s).indexOf(t),e>-1&&Oe(this,_s).splice(e,1);break;case Ya:e=Oe(this,gs).indexOf(t),e>-1&&Oe(this,gs).splice(e,1);break;case za:break;case Ca:Ye(this,ys,null);break;default:qe.throwFunc(`removeLight : only allow BaseLight Instance - inputValue : ${t} { type : ${typeof t} }`)}}removeLightAll(){Oe(this,_s).length=0,Oe(this,gs).length=0,Oe(this,xs).length=0,Ye(this,ys,null)}},View:Pn};export default RedGPU;
